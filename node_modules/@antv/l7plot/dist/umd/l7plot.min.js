!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).L7Plot={})}(this,(function(t){"use strict";const e=new Map;const r=new Map;const n=new Map;var i=function(t){return null!==t&&"function"!=typeof t&&isFinite(t.length)},o={}.toString,a=function(t,e){return o.call(t)==="[object "+e+"]"},s=function(t){return a(t,"Function")},l=function(t){return Array.isArray?Array.isArray(t):a(t,"Array")},u=function(t){var e=typeof t;return null!==t&&"object"===e||"function"===e};function c(t,e){if(t)if(l(t))for(var r=0,n=t.length;r<n&&!1!==e(t[r],r);r++);else if(u(t))for(var i in t)if(t.hasOwnProperty(i)&&!1===e(t[i],i))break}var h=function(t){return"object"==typeof t&&null!==t},p=function(t){if(!h(t)||!a(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},d=function(t){return a(t,"String")},f=Object.values?function(t){return Object.values(t)}:function(t){var e=[];return c(t,(function(r,n){s(t)&&"prototype"===n||e.push(r)})),e},m=function(t){return(e=t,function(t){return null==t}(e)?"":e.toString()).toLowerCase();var e};function g(t,e){return t&&e?t.replace(/\\?\{([^{}]+)\}/g,(function(t,r){return"\\"===t.charAt(0)?t.slice(1):void 0===e[r]?"":e[r]})):t}var _=function(t){return a(t,"Boolean")},v=function(t){return void 0===t},y=function(t){if("object"!=typeof t||null===t)return t;var e;if(l(t)){e=[];for(var r=0,n=t.length;r<n;r++)"object"==typeof t[r]&&null!=t[r]?e[r]=y(t[r]):e[r]=t[r]}else for(var i in e={},t)"object"==typeof t[i]&&null!=t[i]?e[i]=y(t[i]):e[i]=t[i];return e};function x(t,e,r,n){for(var i in r=r||0,n=n||5,e)if(e.hasOwnProperty(i)){var o=e[i];null!==o&&p(o)?(p(t[i])||(t[i]={}),r<n?x(t[i],o,r+1,n):t[i]=e[i]):l(o)?(t[i]=[],t[i]=t[i].concat(o)):void 0!==o&&(t[i]=o)}}var b=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var n=0;n<e.length;n+=1)x(t,e[n]);return t},E=function(t,e){if(t===e)return!0;if(!t||!e)return!1;if(d(t)||d(e))return!1;if(i(t)||i(e)){if(t.length!==e.length)return!1;for(var r=!0,n=0;n<t.length&&(r=E(t[n],e[n]));n++);return r}if(h(t)||h(e)){var o=Object.keys(t),a=Object.keys(e);if(o.length!==a.length)return!1;for(r=!0,n=0;n<o.length&&(r=E(t[o[n]],e[o[n]]));n++);return r}return!1},T=Object.prototype.hasOwnProperty,S=function(t,e){if(null===t||!p(t))return{};var r={};return c(e,(function(e){T.call(t,e)&&(r[e]=t[e])})),r},A={},w=function(t){return A[t=t||"g"]?A[t]+=1:A[t]=1,t+A[t]},C=function(t,e){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},C(t,e)};function R(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}C(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var L,I=function(){return I=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},I.apply(this,arguments)};function M(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r}function O(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))}function P(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function D(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function B(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function N(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError,function(t,e){if(!s(t))throw new TypeError("Expected a function");var r=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=e?e.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var s=t.apply(this,n);return a.set(o,s),s};r.cache=new Map}((function(t,e){void 0===e&&(e={});var r=e.fontSize,n=e.fontFamily,i=e.fontWeight,o=e.fontStyle,a=e.fontVariant;return L||(L=document.createElement("canvas").getContext("2d")),L.font=[o,a,i,r+"px",n].join(" "),L.measureText(d(t)?t:"").width}),(function(t,e){return void 0===e&&(e={}),function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}([t],f(e)).join("")}));var F="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},k={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ITEM_TPL=t.CONTAINER_TPL=t.VALUE_CLASS=t.NAME_CLASS=t.LIST_ITEM_CLASS=t.LIST_CLASS=t.TITLE_CLASS=t.CONTAINER_CLASS=void 0,t.CONTAINER_CLASS="l7plot-tooltip",t.TITLE_CLASS="l7plot-tooltip__title",t.LIST_CLASS="l7plot-tooltip__list",t.LIST_ITEM_CLASS="l7plot-tooltip__list-item",t.NAME_CLASS="l7plot-tooltip__name",t.VALUE_CLASS="l7plot-tooltip__value",t.CONTAINER_TPL=`<div class="${t.CONTAINER_CLASS}">\n  <div class="${t.TITLE_CLASS}"></div>\n  <ul class="${t.LIST_CLASS}"></ul>\n</div>`,t.ITEM_TPL=`<li class="${t.LIST_ITEM_CLASS}" data-index={index}>\n  <span class="${t.NAME_CLASS}">{name}</span>\n  <span class="${t.VALUE_CLASS}">{value}</span>\n</li>`}(k);var U={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ITEM_TPL=t.CONTAINER_TPL=t.VALUE_CLASS=t.MARKER_CLASS=t.LIST_ITEM_CLASS=t.LIST_CLASS=t.TITLE_CLASS=t.CONTAINER_CLASS=void 0,t.CONTAINER_CLASS="l7plot-legend l7plot-legend__category",t.TITLE_CLASS="l7plot-legend__title",t.LIST_CLASS="l7plot-legend__category-list",t.LIST_ITEM_CLASS="l7plot-legend__list-item",t.MARKER_CLASS="l7plot-legend__category-marker",t.VALUE_CLASS="l7plot-legend__category-value",t.CONTAINER_TPL=`<div class="${t.CONTAINER_CLASS}">\n  <div class="${t.TITLE_CLASS}"></div>\n  <ul class="${t.LIST_CLASS}"></ul>\n</div>`,t.ITEM_TPL=`<li class="${t.LIST_ITEM_CLASS}" data-index={index}>\n  <span class="${t.MARKER_CLASS}" style="background:{color}"></span>\n  <span class="${t.VALUE_CLASS}">{value}</span>\n</li>`}(U);var z={};function G(t){const e={point:{default:{fill:t.pointFillColor,size:t.pointSize,stroke:t.pointBorderColor,lineWidth:t.pointBorder,fillOpacity:t.pointFillOpacity},active:{fill:t.pointActiveFillColor},selected:{fill:t.pointSelectedFillColor}}};return{mapStyle:t.mapStyle,defaultColor:t.brandColor,subColor:t.subColor,semanticRed:t.paletteSemanticRed,semanticGreen:t.paletteSemanticGreen,fontFamily:t.fontFamily,colors10:t.paletteQualitative10,colors20:t.paletteQualitative20,sequenceColors:t.paletteSequence,shapes:{point:["circle","square"],line:["line"]},sizes:[1,10],geometries:{point:{circle:{default:{style:e.point.default},active:{style:e.point.active},selected:{style:e.point.selected}}},line:{},polygon:{}},components:{legend:{category:{domStyles:{[U.CONTAINER_CLASS]:{visibility:"visible",zIndex:1,backgroundColor:t.legendContainerFillColor,boxShadow:t.legendContainerShadow,borderRadius:`${t.legendContainerBorderRadius}px`,color:t.legendTextFillColor,fontFamily:t.fontFamily,padding:"10px",lineHeight:"1",fontSize:`${t.legendTextFontSize}px`},[U.TITLE_CLASS]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[U.LIST_CLASS]:{margin:"0px",padding:"0px"},[U.LIST_ITEM_CLASS]:{marginBottom:"2px"},[U.MARKER_CLASS]:{width:"10px",height:"10px"},[U.VALUE_CLASS]:{paddingLeft:"8px"}}},continue:{domStyles:{[z.CONTAINER_CLASS]:{visibility:"visible",zIndex:1,backgroundColor:t.legendContainerFillColor,boxShadow:t.legendContainerShadow,borderRadius:`${t.legendContainerBorderRadius}px`,color:t.legendTextFillColor,fontFamily:t.fontFamily,padding:"10px",lineHeight:1,fontSize:`${t.legendTextFontSize}px`},[z.TITLE_CLASS]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[z.RIBBON_CLASS]:{display:"flex",alignItems:"center"},[z.GRADIENT_BAR_CLASS]:{width:"140px",height:"14px",margin:"0px 5px"},[z.VALUE_RANGE_CLASS]:{padding:"0px"}}}},tooltip:{domStyles:{[k.CONTAINER_CLASS]:{visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:t.tooltipContainerFillColor,boxShadow:t.tooltipContainerShadow,borderRadius:`${t.tooltipContainerBorderRadius}px`,color:t.tooltipTextFillColor,fontSize:`${t.tooltipTextFontSize}px`,fontFamily:t.fontFamily,lineHeight:t.tooltipTextLineHeight},[k.TITLE_CLASS]:{marginBottom:"4px"},[k.LIST_CLASS]:{margin:"0px",padding:"0px"},[k.LIST_ITEM_CLASS]:{marginBottom:"4px"},[k.NAME_CLASS]:{color:t.tooltipItemNameFillColor},[k.VALUE_CLASS]:{color:t.tooltipItemValueFillColor,marginLeft:"30px"}}},label:{style:{textAnchor:"center",textOffset:[0,0],fill:t.labelFillColor,fontSize:t.labelFontSize,fontFamily:t.fontFamily,fillColorDark:t.labelFillColorDark,fillColorLight:t.labelFillColorLight}}}}}!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.RIBBON_TPL=t.CONTAINER_TPL=t.VALUE_RANGE_CLASS=t.GRADIENT_BAR_CLASS=t.RIBBON_CLASS=t.RIBBON_CONTAINER_CLASS=t.TITLE_CLASS=t.CONTAINER_CLASS=void 0,t.CONTAINER_CLASS="l7plot-legend l7plot-legend__continue",t.TITLE_CLASS="l7plot-legend__title",t.RIBBON_CONTAINER_CLASS="l7plot-legend__ribbon-container",t.RIBBON_CLASS="l7plot-legend__ribbon",t.GRADIENT_BAR_CLASS="l7plot-legend__gradient-bar",t.VALUE_RANGE_CLASS="l7plot-legend__value-range",t.CONTAINER_TPL=`<div class="${t.CONTAINER_CLASS}">\n  <div class="${t.TITLE_CLASS}"></div>\n  <div class="${t.RIBBON_CONTAINER_CLASS}"></div>\n</div>`,t.RIBBON_TPL=`<div class="${t.RIBBON_CLASS}">\n  <span class="${t.VALUE_RANGE_CLASS}">{min}</span>\n  <div class="${t.GRADIENT_BAR_CLASS}" style="background-image: {backgroundImage}"></div>\n  <span class="${t.VALUE_RANGE_CLASS}">{max}</span>\n</div>`}(z);const j="#000",V="#595959",H="#FFFFFF",W=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],X=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],Z=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],q=(t={})=>{const{mapStyle:e="light",subColor:r="rgba(0,0,0,0.05)",paletteQualitative10:n=W,paletteQualitative20:i=X,paletteSemanticRed:o="#F4664A",paletteSemanticGreen:a="#30BF78",paletteSemanticYellow:s="#FAAD14",paletteSequence:l=Z,fontFamily:u='"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,\n    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",\n    "Noto Color Emoji"'}=t,{brandColor:c=n[0]}=t;return{mapStyle:e,brandColor:c,subColor:r,paletteQualitative10:n,paletteQualitative20:i,paletteSemanticRed:o,paletteSemanticGreen:a,paletteSemanticYellow:s,paletteSequence:l,fontFamily:u,legendContainerFillColor:"rgba(255, 255, 255, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:V,legendTextFontSize:12,tooltipContainerFillColor:"rgba(255, 255, 255, 0.9)",tooltipContainerShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",tooltipContainerBorderRadius:2,tooltipTextFillColor:V,tooltipItemNameFillColor:V,tooltipItemValueFillColor:V,tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:V,labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:c,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:H,pointActiveBorderColor:j,pointSelectedBorderColor:j}};q();const Y="#000",K="#FFFFFF",$="#A6A6A6",Q=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],J=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],tt=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],et=(t={})=>{const{mapStyle:e="dark",subColor:r="rgba(255,255,255,0.05)",paletteQualitative10:n=Q,paletteQualitative20:i=J,paletteSemanticRed:o="#F4664A",paletteSemanticGreen:a="#30BF78",paletteSemanticYellow:s="#FAAD14",paletteSequence:l=tt,fontFamily:u='"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,\n    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",\n    "Noto Color Emoji"'}=t,{brandColor:c=n[0]}=t;return{mapStyle:e,brandColor:c,subColor:r,paletteQualitative10:n,paletteQualitative20:i,paletteSemanticRed:o,paletteSemanticGreen:a,paletteSemanticYellow:s,paletteSequence:l,fontFamily:u,legendContainerFillColor:"rgba(31, 31, 31, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:$,legendTextFontSize:12,tooltipContainerFillColor:"rgba(31, 31, 31, 0.9)",tooltipContainerShadow:"0px 2px 4px rgba(0, 0, 0, 0.5)",tooltipContainerBorderRadius:2,tooltipTextFillColor:$,tooltipItemNameFillColor:$,tooltipItemValueFillColor:$,tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:$,labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:Q[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:Y,pointActiveBorderColor:K,pointSelectedBorderColor:K}};function rt(t){const{styleSheet:e={}}=t,r=M(t,["styleSheet"]),n=q(e);return b({},G(n),r)}function nt(t){const{styleSheet:e={}}=t,r=M(t,["styleSheet"]),n=et(e);return b({},G(n),r)}et();const it=rt({}),ot={default:it,light:it,dark:nt({})};function at(t="default"){return function(t,e,r){for(var n=0,i=d(e)?e.split("."):e;t&&n<i.length;)t=t[i[n++]];return void 0===t||n<i.length?r:t}(ot,m(t),ot.default)}var st,lt,ut,ct;t.LineStyleType=void 0,(st=t.LineStyleType||(t.LineStyleType={}))[st.solid=0]="solid",st[st.dash=1]="dash",t.LayerType=void 0,(lt=t.LayerType||(t.LayerType={})).TextLayer="textLayer",lt.DotLayer="dotLayer",lt.IconLayer="iconLayer",lt.DotDensity="dotDensityLayer",lt.ColumnLayer="columnLayer",lt.HeatmapLayer="heatmapLayer",lt.GridLayer="gridLayer",lt.HexbinLayer="hexbinLayer",lt.LinesLayer="linesLayer",lt.PathLayer="pathLayer",lt.ArcLayer="arcLayer",lt.AreaLayer="areaLayer",lt.PrismLayer="prismLayer",t.BaseMapType=void 0,(ut=t.BaseMapType||(t.BaseMapType={})).Map="map",ut.Amap="amap",ut.AmapV1="amapv1",ut.AmapV2="amapv2",ut.Mapbox="mapbox",t.PlotType=void 0,(ct=t.PlotType||(t.PlotType={})).Dot="dot",ct.DotDensity="dotDensity",ct.Heatmap="heatmap",ct.Grid="grid",ct.Hexbin="hexbin",ct.Path="path",ct.Flow="flow",ct.Area="area",ct.Choropleth="choropleth";var ht={},pt={},dt=t=>pt[t],ft=(t,e)=>{pt[t]=e},mt=(t,e)=>{ht[t]=e},gt={},_t={};function vt(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function yt(t){var e=Object.create(null),r=[];return t.forEach((function(t){for(var n in t)n in e||r.push(e[n]=n)})),r}function xt(t,e){var r=t+"",n=r.length;return n<e?new Array(e-n+1).join(0)+r:r}function bt(t){var e=t.getUTCHours(),r=t.getUTCMinutes(),n=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":function(t){return t<0?"-"+xt(-t,6):t>9999?"+"+xt(t,6):xt(t,4)}(t.getUTCFullYear())+"-"+xt(t.getUTCMonth()+1,2)+"-"+xt(t.getUTCDate(),2)+(i?"T"+xt(e,2)+":"+xt(r,2)+":"+xt(n,2)+"."+xt(i,3)+"Z":n?"T"+xt(e,2)+":"+xt(r,2)+":"+xt(n,2)+"Z":r||e?"T"+xt(e,2)+":"+xt(r,2)+"Z":"")}var Et=function(t){var e=new RegExp('["'+t+"\n\r]"),r=t.charCodeAt(0);function n(t,e){var n,i=[],o=t.length,a=0,s=0,l=o<=0,u=!1;function c(){if(l)return _t;if(u)return u=!1,gt;var e,n,i=a;if(34===t.charCodeAt(i)){for(;a++<o&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=o?l=!0:10===(n=t.charCodeAt(a++))?u=!0:13===n&&(u=!0,10===t.charCodeAt(a)&&++a),t.slice(i+1,e-1).replace(/""/g,'"')}for(;a<o;){if(10===(n=t.charCodeAt(e=a++)))u=!0;else if(13===n)u=!0,10===t.charCodeAt(a)&&++a;else if(n!==r)continue;return t.slice(i,e)}return l=!0,t.slice(i,o)}for(10===t.charCodeAt(o-1)&&--o,13===t.charCodeAt(o-1)&&--o;(n=c())!==_t;){for(var h=[];n!==gt&&n!==_t;)h.push(n),n=c();e&&null==(h=e(h,s++))||i.push(h)}return i}function i(e,r){return e.map((function(e){return r.map((function(t){return a(e[t])})).join(t)}))}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?bt(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var r,i,o=n(t,(function(t,n){if(r)return r(t,n-1);i=t,r=e?function(t,e){var r=vt(t);return function(n,i){return e(r(n),i,t)}}(t,e):vt(t)}));return o.columns=i||[],o},parseRows:n,format:function(e,r){return null==r&&(r=yt(e)),[r.map(a).join(t)].concat(i(e,r)).join("\n")},formatBody:function(t,e){return null==e&&(e=yt(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(o).join("\n")},formatRow:o,formatValue:a}}(","),Tt=Et.parse,St=6371008.8,At={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:St,metres:St,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:3440.069546436285,radians:1,yards:6967335.223679999};function wt(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function Ct(t,e,r){void 0===r&&(r={});for(var n=0,i=t;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return wt({type:"Polygon",coordinates:t},e,r)}function Rt(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return wt({type:"LineString",coordinates:t},e,r)}function Lt(t){return t%360*Math.PI/180}function It(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Mt(t){return"Feature"===t.type?t.geometry:t}function Ot(t,e,r){if(null!==t)for(var n,i,o,a,s,l,u,c,h=0,p=0,d=t.type,f="FeatureCollection"===d,m="Feature"===d,g=f?t.features.length:1,_=0;_<g;_++){s=(c=!!(u=f?t.features[_].geometry:m?t.geometry:t)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var v=0;v<s;v++){var y=0,x=0;if(null!==(a=c?u.geometries[v]:u)){l=a.coordinates;var b=a.type;switch(h=!r||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(l,p,_,y,x))return!1;p++,y++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===e(l[n],p,_,y,x))return!1;p++,"MultiPoint"===b&&y++}"LineString"===b&&y++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-h;i++){if(!1===e(l[n][i],p,_,y,x))return!1;p++}"MultiLineString"===b&&y++,"Polygon"===b&&x++}"Polygon"===b&&y++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(x=0,i=0;i<l[n].length;i++){for(o=0;o<l[n][i].length-h;o++){if(!1===e(l[n][i][o],p,_,y,x))return!1;p++}x++}y++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===Ot(a.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Pt(t,e){!function(t,e){var r,n,i,o,a,s,l,u,c,h,p=0,d="FeatureCollection"===t.type,f="Feature"===t.type,m=d?t.features.length:1;for(r=0;r<m;r++){for(s=d?t.features[r].geometry:f?t.geometry:t,u=d?t.features[r].properties:f?t.properties:{},c=d?t.features[r].bbox:f?t.bbox:void 0,h=d?t.features[r].id:f?t.id:void 0,a=(l=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=l?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,u,c,h))return!1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===e(o.geometries[n],p,u,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,u,c,h))return!1;p++}}(t,(function(t,r,n,i,o){var a,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e(wt(t,n,{bbox:i,id:o}),r,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var l=0;l<t.coordinates.length;l++){var u=t.coordinates[l];if(!1===e(wt({type:a,coordinates:u},n),r,l))return!1}}))}var Dt={REGISTERED_PROTOCOLS:{}},Bt=Object.defineProperty,Nt=Object.defineProperties,Ft=Object.getOwnPropertyDescriptors,kt=Object.getOwnPropertySymbols,Ut=Object.prototype.hasOwnProperty,zt=Object.prototype.propertyIsEnumerable,Gt=(t,e,r)=>e in t?Bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jt=(t,e)=>{for(var r in e||(e={}))Ut.call(e,r)&&Gt(t,r,e[r]);if(kt)for(var r of kt(e))zt.call(e,r)&&Gt(t,r,e[r]);return t},Vt=(t,e)=>Nt(t,Ft(e)),Ht=t=>Dt.REGISTERED_PROTOCOLS[t.substring(0,t.indexOf("://"))],Wt=class extends Error{constructor(t,e,r,n){super(`AJAXError: ${e} (${t}): ${r}`),this.status=t,this.statusText=e,this.url=r,this.body=n}};function Xt(t,e){const r=new XMLHttpRequest,n=Array.isArray(t.url)?t.url[0]:t.url;r.open(t.method||"GET",n,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer");for(const e in t.headers)t.headers.hasOwnProperty(e)&&r.setRequestHeader(e,t.headers[e]);return"json"===t.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===t.credentials,r.onerror=()=>{e(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let n=r.response;if("json"===t.type)try{n=JSON.parse(r.response)}catch(t){return e(t)}e(null,n,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{const t=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});e(new Wt(r.status,r.statusText,n.toString(),t))}},r.cancel=r.abort,r.send(t.body),r}function Zt(t){return new Promise(((e,r)=>{Xt(t,((t,n,i,o,a)=>{t?r({err:t,data:null,xhr:a}):e({err:null,data:n,cacheControl:i,expires:o,xhr:a})}))}))}function qt(t,e){return Xt(t,e)}var Yt=(t,e)=>(Ht(t.url)||qt)(Vt(jt({},t),{type:"arrayBuffer"}),e),Kt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function $t(t,e){const r=new window.Image,n=window.URL||window.webkitURL;r.crossOrigin="anonymous",r.onload=()=>{e(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame((()=>{r.src=Kt}))},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const i=new Blob([new Uint8Array(t)],{type:"image/png"});r.src=t.byteLength?n.createObjectURL(i):Kt}function Qt(t,e){const r=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(r).then((t=>{e(null,t)})).catch((t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}var Jt=(t,e,r)=>{const n=(t,n)=>{if(t)e(t);else if(n){const t="function"==typeof createImageBitmap,i=r?r(n):n;t?Qt(i,e):$t(i,e)}};return"json"===t.type?((t,e)=>(Ht(t.url)||qt)(Vt(jt({},t),{type:"json"}),e))(t,n):Yt(t,n)},te=(t=>(t.CENTER="center",t.TOP="top",t["TOP-LEFT"]="top-left",t["TOP-RIGHT"]="top-right",t.BOTTOM="bottom",t["BOTTOM-LEFT"]="bottom-left",t["BOTTOM-RIGHT"]="bottom-right",t.LEFT="left",t.RIGHT="right",t))(te||{}),ee={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function re(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function ne(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function ie(){}var oe=.7,ae=1/oe,se="\\s*([+-]?\\d+)\\s*",le="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ue="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ce=/^#([0-9a-f]{3,8})$/,he=new RegExp("^rgb\\("+[se,se,se]+"\\)$"),pe=new RegExp("^rgb\\("+[ue,ue,ue]+"\\)$"),de=new RegExp("^rgba\\("+[se,se,se,le]+"\\)$"),fe=new RegExp("^rgba\\("+[ue,ue,ue,le]+"\\)$"),me=new RegExp("^hsl\\("+[le,ue,ue]+"\\)$"),ge=new RegExp("^hsla\\("+[le,ue,ue,le]+"\\)$"),_e={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ve(){return this.rgb().formatHex()}function ye(){return this.rgb().formatRgb()}function xe(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=ce.exec(t))?(r=e[1].length,e=parseInt(e[1],16),6===r?be(e):3===r?new Se(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===r?Ee(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===r?Ee(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=he.exec(t))?new Se(e[1],e[2],e[3],1):(e=pe.exec(t))?new Se(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=de.exec(t))?Ee(e[1],e[2],e[3],e[4]):(e=fe.exec(t))?Ee(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=me.exec(t))?Re(e[1],e[2]/100,e[3]/100,1):(e=ge.exec(t))?Re(e[1],e[2]/100,e[3]/100,e[4]):_e.hasOwnProperty(t)?be(_e[t]):"transparent"===t?new Se(NaN,NaN,NaN,0):null}function be(t){return new Se(t>>16&255,t>>8&255,255&t,1)}function Ee(t,e,r,n){return n<=0&&(t=e=r=NaN),new Se(t,e,r,n)}function Te(t,e,r,n){return 1===arguments.length?((i=t)instanceof ie||(i=xe(i)),i?new Se((i=i.rgb()).r,i.g,i.b,i.opacity):new Se):new Se(t,e,r,null==n?1:n);var i}function Se(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}function Ae(){return"#"+Ce(this.r)+Ce(this.g)+Ce(this.b)}function we(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Ce(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Re(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new Ie(t,e,r,n)}function Le(t){if(t instanceof Ie)return new Ie(t.h,t.s,t.l,t.opacity);if(t instanceof ie||(t=xe(t)),!t)return new Ie;if(t instanceof Ie)return t;var e=(t=t.rgb()).r/255,r=t.g/255,n=t.b/255,i=Math.min(e,r,n),o=Math.max(e,r,n),a=NaN,s=o-i,l=(o+i)/2;return s?(a=e===o?(r-n)/s+6*(r<n):r===o?(n-e)/s+2:(e-r)/s+4,s/=l<.5?o+i:2-o-i,a*=60):s=l>0&&l<1?0:a,new Ie(a,s,l,t.opacity)}function Ie(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}function Me(t,e,r){return 255*(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)}function Oe(t){const e=xe(t),r=[0,0,0,0];return null!=e&&(r[0]=e.r/255,r[1]=e.g/255,r[2]=e.b/255,r[3]=e.opacity),r}function Pe(t){return(t&&t[0])+256*(t&&t[1])+65536*(t&&t[2])-1}function De(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}function Be(t){let e=window.document.createElement("canvas"),r=e.getContext("2d");e.width=256,e.height=1;let n=null;const i=r.createLinearGradient(0,0,256,1),o=t.positions[0],a=t.positions[t.positions.length-1];for(let e=0;e<t.colors.length;++e){const r=(t.positions[e]-o)/(a-o);i.addColorStop(r,t.colors[e])}return r.fillStyle=i,r.fillRect(0,0,256,1),n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),e=null,r=null,{data:n,width:256,height:1}}function Ne(t,e){const r=t.createImageData(256,1);for(let t=0;t<r.data.length;t+=4)r.data[t+0]=e[t+0],r.data[t+1]=e[t+1],r.data[t+2]=e[t+2],r.data[t+3]=e[t+3];return r}function Fe(t){return"cat"===(null==t?void 0:t.type)?[0,255]:[0,1]}re(ie,xe,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:ve,formatHex:ve,formatHsl:function(){return Le(this).formatHsl()},formatRgb:ye,toString:ye}),re(Se,Te,ne(ie,{brighter:function(t){return t=null==t?ae:Math.pow(ae,t),new Se(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?oe:Math.pow(oe,t),new Se(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ae,formatHex:Ae,formatRgb:we,toString:we})),re(Ie,(function(t,e,r,n){return 1===arguments.length?Le(t):new Ie(t,e,r,null==n?1:n)}),ne(ie,{brighter:function(t){return t=null==t?ae:Math.pow(ae,t),new Ie(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?oe:Math.pow(oe,t),new Ie(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,i=2*r-n;return new Se(Me(t>=240?t-240:t+120,i,n),Me(t,i,n),Me(t<120?t+240:t-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var ke=function(t,e,r){return t==t&&(void 0!==r&&(t=t<=r?t:r),void 0!==e&&(t=t>=e?t:e)),t},Ue=/\s/;var ze=function(t){for(var e=t.length;e--&&Ue.test(t.charAt(e)););return e},Ge=ze,je=/^\s+/;var Ve=function(t){return t?t.slice(0,Ge(t)+1).replace(je,""):t};var He=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},We="object"==typeof F&&F&&F.Object===Object&&F,Xe=We,Ze="object"==typeof self&&self&&self.Object===Object&&self,qe=Xe||Ze||Function("return this")(),Ye=qe.Symbol,Ke=Ye,$e=Object.prototype,Qe=$e.hasOwnProperty,Je=$e.toString,tr=Ke?Ke.toStringTag:void 0;var er=function(t){var e=Qe.call(t,tr),r=t[tr];try{t[tr]=void 0;var n=!0}catch(t){}var i=Je.call(t);return n&&(e?t[tr]=r:delete t[tr]),i},rr=Object.prototype.toString;var nr=er,ir=function(t){return rr.call(t)},or=Ye?Ye.toStringTag:void 0;var ar=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":or&&or in Object(t)?nr(t):ir(t)};var sr=function(t){return null!=t&&"object"==typeof t},lr=ar,ur=sr;var cr=function(t){return"symbol"==typeof t||ur(t)&&"[object Symbol]"==lr(t)},hr=Ve,pr=He,dr=cr,fr=/^[-+]0x[0-9a-f]+$/i,mr=/^0b[01]+$/i,gr=/^0o[0-7]+$/i,_r=parseInt;var vr=function(t){if("number"==typeof t)return t;if(dr(t))return NaN;if(pr(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=pr(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=hr(t);var r=mr.test(t);return r||gr.test(t)?_r(t.slice(2),r?2:8):fr.test(t)?NaN:+t},yr=ke,xr=vr;var br=function(t,e,r){return void 0===r&&(r=e,e=void 0),void 0!==r&&(r=(r=xr(r))==r?r:0),void 0!==e&&(e=(e=xr(e))==e?e:0),yr(xr(t),e,r)};var Er=function(){this.__data__=[],this.size=0};var Tr=function(t,e){return t===e||t!=t&&e!=e},Sr=Tr;var Ar=function(t,e){for(var r=t.length;r--;)if(Sr(t[r][0],e))return r;return-1},wr=Ar,Cr=Array.prototype.splice;var Rr=Ar;var Lr=Ar;var Ir=Ar;var Mr=Er,Or=function(t){var e=this.__data__,r=wr(e,t);return!(r<0)&&(r==e.length-1?e.pop():Cr.call(e,r,1),--this.size,!0)},Pr=function(t){var e=this.__data__,r=Rr(e,t);return r<0?void 0:e[r][1]},Dr=function(t){return Lr(this.__data__,t)>-1},Br=function(t,e){var r=this.__data__,n=Ir(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function Nr(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Nr.prototype.clear=Mr,Nr.prototype.delete=Or,Nr.prototype.get=Pr,Nr.prototype.has=Dr,Nr.prototype.set=Br;var Fr=Nr,kr=Fr;var Ur=function(){this.__data__=new kr,this.size=0};var zr=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var Gr=function(t){return this.__data__.get(t)};var jr=function(t){return this.__data__.has(t)},Vr=ar,Hr=He;var Wr,Xr=function(t){if(!Hr(t))return!1;var e=Vr(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},Zr=qe["__core-js_shared__"],qr=(Wr=/[^.]+$/.exec(Zr&&Zr.keys&&Zr.keys.IE_PROTO||""))?"Symbol(src)_1."+Wr:"";var Yr=function(t){return!!qr&&qr in t},Kr=Function.prototype.toString;var $r=function(t){if(null!=t){try{return Kr.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Qr=Xr,Jr=Yr,tn=He,en=$r,rn=/^\[object .+?Constructor\]$/,nn=Function.prototype,on=Object.prototype,an=nn.toString,sn=on.hasOwnProperty,ln=RegExp("^"+an.call(sn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var un=function(t,e){return null==t?void 0:t[e]},cn=function(t){return!(!tn(t)||Jr(t))&&(Qr(t)?ln:rn).test(en(t))},hn=un;var pn=function(t,e){var r=hn(t,e);return cn(r)?r:void 0},dn=pn(qe,"Map"),fn=pn(Object,"create"),mn=fn;var gn=function(){this.__data__=mn?mn(null):{},this.size=0};var _n=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},vn=fn,yn=Object.prototype.hasOwnProperty;var xn=function(t){var e=this.__data__;if(vn){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return yn.call(e,t)?e[t]:void 0},bn=fn,En=Object.prototype.hasOwnProperty;var Tn=fn;var Sn=gn,An=_n,wn=xn,Cn=function(t){var e=this.__data__;return bn?void 0!==e[t]:En.call(e,t)},Rn=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Tn&&void 0===e?"__lodash_hash_undefined__":e,this};function Ln(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ln.prototype.clear=Sn,Ln.prototype.delete=An,Ln.prototype.get=wn,Ln.prototype.has=Cn,Ln.prototype.set=Rn;var In=Ln,Mn=Fr,On=dn;var Pn=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Dn=function(t,e){var r=t.__data__;return Pn(e)?r["string"==typeof e?"string":"hash"]:r.map},Bn=Dn;var Nn=function(t){var e=Bn(this,t).delete(t);return this.size-=e?1:0,e},Fn=Dn;var kn=Dn;var Un=Dn;var zn=function(){this.size=0,this.__data__={hash:new In,map:new(On||Mn),string:new In}},Gn=Nn,jn=function(t){return Fn(this,t).get(t)},Vn=function(t){return kn(this,t).has(t)},Hn=function(t,e){var r=Un(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function Wn(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Wn.prototype.clear=zn,Wn.prototype.delete=Gn,Wn.prototype.get=jn,Wn.prototype.has=Vn,Wn.prototype.set=Hn;var Xn=Wn,Zn=Fr,qn=dn,Yn=Xn;var Kn=Fr,$n=Ur,Qn=zr,Jn=Gr,ti=jr,ei=function(t,e){var r=this.__data__;if(r instanceof Zn){var n=r.__data__;if(!qn||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Yn(n)}return r.set(t,e),this.size=r.size,this};function ri(t){var e=this.__data__=new Kn(t);this.size=e.size}ri.prototype.clear=$n,ri.prototype.delete=Qn,ri.prototype.get=Jn,ri.prototype.has=ti,ri.prototype.set=ei;var ni=ri;var ii=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t},oi=pn,ai=function(){try{var t=oi(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),si=ai,li=si;var ui=function(t,e,r){"__proto__"==e&&li?li(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r},ci=ui,hi=Tr,pi=Object.prototype.hasOwnProperty;var di=function(t,e,r){var n=t[e];pi.call(t,e)&&hi(n,r)&&(void 0!==r||e in t)||ci(t,e,r)},fi=di,mi=ui;var gi=function(t,e,r,n){var i=!r;r||(r={});for(var o=-1,a=e.length;++o<a;){var s=e[o],l=n?n(r[s],t[s],s,r,t):void 0;void 0===l&&(l=t[s]),i?mi(r,s,l):fi(r,s,l)}return r};var _i=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n},vi=ar,yi=sr;var xi=function(t){return yi(t)&&"[object Arguments]"==vi(t)},bi=sr,Ei=Object.prototype,Ti=Ei.hasOwnProperty,Si=Ei.propertyIsEnumerable,Ai=xi(function(){return arguments}())?xi:function(t){return bi(t)&&Ti.call(t,"callee")&&!Si.call(t,"callee")},wi=Ai,Ci=Array.isArray,Ri={exports:{}};var Li=function(){return!1};!function(t,e){var r=qe,n=Li,i=e&&!e.nodeType&&e,o=i&&t&&!t.nodeType&&t,a=o&&o.exports===i?r.Buffer:void 0,s=(a?a.isBuffer:void 0)||n;t.exports=s}(Ri,Ri.exports);var Ii=/^(?:0|[1-9]\d*)$/;var Mi=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&Ii.test(t))&&t>-1&&t%1==0&&t<e};var Oi=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},Pi=ar,Di=Oi,Bi=sr,Ni={};Ni["[object Float32Array]"]=Ni["[object Float64Array]"]=Ni["[object Int8Array]"]=Ni["[object Int16Array]"]=Ni["[object Int32Array]"]=Ni["[object Uint8Array]"]=Ni["[object Uint8ClampedArray]"]=Ni["[object Uint16Array]"]=Ni["[object Uint32Array]"]=!0,Ni["[object Arguments]"]=Ni["[object Array]"]=Ni["[object ArrayBuffer]"]=Ni["[object Boolean]"]=Ni["[object DataView]"]=Ni["[object Date]"]=Ni["[object Error]"]=Ni["[object Function]"]=Ni["[object Map]"]=Ni["[object Number]"]=Ni["[object Object]"]=Ni["[object RegExp]"]=Ni["[object Set]"]=Ni["[object String]"]=Ni["[object WeakMap]"]=!1;var Fi=function(t){return Bi(t)&&Di(t.length)&&!!Ni[Pi(t)]};var ki=function(t){return function(e){return t(e)}},Ui={exports:{}};!function(t,e){var r=We,n=e&&!e.nodeType&&e,i=n&&t&&!t.nodeType&&t,o=i&&i.exports===n&&r.process,a=function(){try{var t=i&&i.require&&i.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=a}(Ui,Ui.exports);var zi=Fi,Gi=ki,ji=Ui.exports,Vi=ji&&ji.isTypedArray,Hi=Vi?Gi(Vi):zi,Wi=_i,Xi=wi,Zi=Ci,qi=Ri.exports,Yi=Mi,Ki=Hi,$i=Object.prototype.hasOwnProperty;var Qi=function(t,e){var r=Zi(t),n=!r&&Xi(t),i=!r&&!n&&qi(t),o=!r&&!n&&!i&&Ki(t),a=r||n||i||o,s=a?Wi(t.length,String):[],l=s.length;for(var u in t)!e&&!$i.call(t,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Yi(u,l))||s.push(u);return s},Ji=Object.prototype;var to=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ji)};var eo=function(t,e){return function(r){return t(e(r))}},ro=eo(Object.keys,Object),no=to,io=ro,oo=Object.prototype.hasOwnProperty;var ao=function(t){if(!no(t))return io(t);var e=[];for(var r in Object(t))oo.call(t,r)&&"constructor"!=r&&e.push(r);return e},so=Xr,lo=Oi;var uo=function(t){return null!=t&&lo(t.length)&&!so(t)},co=Qi,ho=ao,po=uo;var fo=function(t){return po(t)?co(t):ho(t)},mo=gi,go=fo;var _o=function(t,e){return t&&mo(e,go(e),t)};var vo=function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e},yo=He,xo=to,bo=vo,Eo=Object.prototype.hasOwnProperty;var To=function(t){if(!yo(t))return bo(t);var e=xo(t),r=[];for(var n in t)("constructor"!=n||!e&&Eo.call(t,n))&&r.push(n);return r},So=Qi,Ao=To,wo=uo;var Co=function(t){return wo(t)?So(t,!0):Ao(t)},Ro=gi,Lo=Co;var Io=function(t,e){return t&&Ro(e,Lo(e),t)},Mo={exports:{}};!function(t,e){var r=qe,n=e&&!e.nodeType&&e,i=n&&t&&!t.nodeType&&t,o=i&&i.exports===n?r.Buffer:void 0,a=o?o.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var r=t.length,n=a?a(r):new t.constructor(r);return t.copy(n),n}}(Mo,Mo.exports);var Oo=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e};var Po=function(t,e){for(var r=-1,n=null==t?0:t.length,i=0,o=[];++r<n;){var a=t[r];e(a,r,t)&&(o[i++]=a)}return o};var Do=function(){return[]},Bo=Po,No=Do,Fo=Object.prototype.propertyIsEnumerable,ko=Object.getOwnPropertySymbols,Uo=ko?function(t){return null==t?[]:(t=Object(t),Bo(ko(t),(function(e){return Fo.call(t,e)})))}:No,zo=Uo,Go=gi,jo=zo;var Vo=function(t,e){return Go(t,jo(t),e)};var Ho=function(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t},Wo=eo(Object.getPrototypeOf,Object),Xo=Ho,Zo=Wo,qo=zo,Yo=Do,Ko=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Xo(e,qo(t)),t=Zo(t);return e}:Yo,$o=gi,Qo=Ko;var Jo=function(t,e){return $o(t,Qo(t),e)},ta=Ho,ea=Ci;var ra=function(t,e,r){var n=e(t);return ea(t)?n:ta(n,r(t))},na=ra,ia=zo,oa=fo;var aa=function(t){return na(t,oa,ia)},sa=ra,la=Ko,ua=Co;var ca=function(t){return sa(t,ua,la)},ha=pn(qe,"DataView"),pa=pn(qe,"Promise"),da=pn(qe,"Set"),fa=ha,ma=dn,ga=pa,_a=da,va=pn(qe,"WeakMap"),ya=ar,xa=$r,ba="[object Map]",Ea="[object Promise]",Ta="[object Set]",Sa="[object WeakMap]",Aa="[object DataView]",wa=xa(fa),Ca=xa(ma),Ra=xa(ga),La=xa(_a),Ia=xa(va),Ma=ya;(fa&&Ma(new fa(new ArrayBuffer(1)))!=Aa||ma&&Ma(new ma)!=ba||ga&&Ma(ga.resolve())!=Ea||_a&&Ma(new _a)!=Ta||va&&Ma(new va)!=Sa)&&(Ma=function(t){var e=ya(t),r="[object Object]"==e?t.constructor:void 0,n=r?xa(r):"";if(n)switch(n){case wa:return Aa;case Ca:return ba;case Ra:return Ea;case La:return Ta;case Ia:return Sa}return e});var Oa=Ma,Pa=Object.prototype.hasOwnProperty;var Da=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&Pa.call(t,"index")&&(r.index=t.index,r.input=t.input),r},Ba=qe.Uint8Array,Na=Ba;var Fa=function(t){var e=new t.constructor(t.byteLength);return new Na(e).set(new Na(t)),e},ka=Fa;var Ua=function(t,e){var r=e?ka(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)},za=/\w*$/;var Ga=function(t){var e=new t.constructor(t.source,za.exec(t));return e.lastIndex=t.lastIndex,e},ja=Ye?Ye.prototype:void 0,Va=ja?ja.valueOf:void 0;var Ha=Fa;var Wa=function(t,e){var r=e?Ha(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)},Xa=Fa,Za=Ua,qa=Ga,Ya=function(t){return Va?Object(Va.call(t)):{}},Ka=Wa;var $a=function(t,e,r){var n=t.constructor;switch(e){case"[object ArrayBuffer]":return Xa(t);case"[object Boolean]":case"[object Date]":return new n(+t);case"[object DataView]":return Za(t,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Ka(t,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(t);case"[object RegExp]":return qa(t);case"[object Symbol]":return Ya(t)}},Qa=He,Ja=Object.create,ts=function(){function t(){}return function(e){if(!Qa(e))return{};if(Ja)return Ja(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),es=ts,rs=Wo,ns=to;var is=function(t){return"function"!=typeof t.constructor||ns(t)?{}:es(rs(t))},os=Oa,as=sr;var ss=function(t){return as(t)&&"[object Map]"==os(t)},ls=ki,us=Ui.exports,cs=us&&us.isMap,hs=cs?ls(cs):ss,ps=Oa,ds=sr;var fs=function(t){return ds(t)&&"[object Set]"==ps(t)},ms=ki,gs=Ui.exports,_s=gs&&gs.isSet,vs=_s?ms(_s):fs,ys=ni,xs=ii,bs=di,Es=_o,Ts=Io,Ss=Mo.exports,As=Oo,ws=Vo,Cs=Jo,Rs=aa,Ls=ca,Is=Oa,Ms=Da,Os=$a,Ps=is,Ds=Ci,Bs=Ri.exports,Ns=hs,Fs=He,ks=vs,Us=fo,zs=Co,Gs="[object Arguments]",js="[object Function]",Vs="[object Object]",Hs={};Hs[Gs]=Hs["[object Array]"]=Hs["[object ArrayBuffer]"]=Hs["[object DataView]"]=Hs["[object Boolean]"]=Hs["[object Date]"]=Hs["[object Float32Array]"]=Hs["[object Float64Array]"]=Hs["[object Int8Array]"]=Hs["[object Int16Array]"]=Hs["[object Int32Array]"]=Hs["[object Map]"]=Hs["[object Number]"]=Hs[Vs]=Hs["[object RegExp]"]=Hs["[object Set]"]=Hs["[object String]"]=Hs["[object Symbol]"]=Hs["[object Uint8Array]"]=Hs["[object Uint8ClampedArray]"]=Hs["[object Uint16Array]"]=Hs["[object Uint32Array]"]=!0,Hs["[object Error]"]=Hs[js]=Hs["[object WeakMap]"]=!1;var Ws=function t(e,r,n,i,o,a){var s,l=1&r,u=2&r,c=4&r;if(n&&(s=o?n(e,i,o,a):n(e)),void 0!==s)return s;if(!Fs(e))return e;var h=Ds(e);if(h){if(s=Ms(e),!l)return As(e,s)}else{var p=Is(e),d=p==js||"[object GeneratorFunction]"==p;if(Bs(e))return Ss(e,l);if(p==Vs||p==Gs||d&&!o){if(s=u||d?{}:Ps(e),!l)return u?Cs(e,Ts(s,e)):ws(e,Es(s,e))}else{if(!Hs[p])return o?e:{};s=Os(e,p,l)}}a||(a=new ys);var f=a.get(e);if(f)return f;a.set(e,s),ks(e)?e.forEach((function(i){s.add(t(i,r,n,i,e,a))})):Ns(e)&&e.forEach((function(i,o){s.set(o,t(i,r,n,o,e,a))}));var m=h?void 0:(c?u?Ls:Rs:u?zs:Us)(e);return xs(m||e,(function(i,o){m&&(i=e[o=i]),bs(s,o,t(i,r,n,o,e,a))})),s},Xs=Ws;var Zs=function(t){return Xs(t,5)},qs=qe,Ys=He,Ks=function(){return qs.Date.now()},$s=vr,Qs=Math.max,Js=Math.min;var tl=function(t,e,r){var n,i,o,a,s,l,u=0,c=!1,h=!1,p=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function d(e){var r=n,o=i;return n=i=void 0,u=e,a=t.apply(o,r)}function f(t){var r=t-l;return void 0===l||r>=e||r<0||h&&t-u>=o}function m(){var t=Ks();if(f(t))return g(t);s=setTimeout(m,function(t){var r=e-(t-l);return h?Js(r,o-(t-u)):r}(t))}function g(t){return s=void 0,p&&n?d(t):(n=i=void 0,a)}function _(){var t=Ks(),r=f(t);if(n=arguments,i=this,l=t,r){if(void 0===s)return function(t){return u=t,s=setTimeout(m,e),c?d(t):a}(l);if(h)return clearTimeout(s),s=setTimeout(m,e),d(l)}return void 0===s&&(s=setTimeout(m,e)),a}return e=$s(e)||0,Ys(r)&&(c=!!r.leading,o=(h="maxWait"in r)?Qs($s(r.maxWait)||0,e):o,p="trailing"in r?!!r.trailing:p),_.cancel=function(){void 0!==s&&clearTimeout(s),u=0,n=l=i=s=void 0},_.flush=function(){return void 0===s?a:g(Ks())},_},el=Ci,rl=cr,nl=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,il=/^\w*$/;var ol=function(t,e){if(el(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!rl(t))||(il.test(t)||!nl.test(t)||null!=e&&t in Object(e))},al=Xn;function sl(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=t.apply(this,n);return r.cache=o.set(i,a)||o,a};return r.cache=new(sl.Cache||al),r}sl.Cache=al;var ll=sl;var ul=function(t){var e=ll(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e},cl=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,hl=/\\(\\)?/g,pl=ul((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(cl,(function(t,r,n,i){e.push(n?i.replace(hl,"$1"):r||t)})),e})),dl=pl;var fl=function(t,e){for(var r=-1,n=null==t?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i},ml=fl,gl=Ci,_l=cr,vl=Ye?Ye.prototype:void 0,yl=vl?vl.toString:void 0;var xl=function t(e){if("string"==typeof e)return e;if(gl(e))return ml(e,t)+"";if(_l(e))return yl?yl.call(e):"";var r=e+"";return"0"==r&&1/e==-1/0?"-0":r},bl=xl;var El=function(t){return null==t?"":bl(t)},Tl=Ci,Sl=ol,Al=dl,wl=El;var Cl=function(t,e){return Tl(t)?t:Sl(t,e)?[t]:Al(wl(t))},Rl=cr;var Ll=function(t){if("string"==typeof t||Rl(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e},Il=Cl,Ml=Ll;var Ol=function(t,e){for(var r=0,n=(e=Il(e,t)).length;null!=t&&r<n;)t=t[Ml(e[r++])];return r&&r==n?t:void 0},Pl=Ol;var Dl=function(t,e,r){var n=null==t?void 0:Pl(t,e);return void 0===n?r:n},Bl=ar,Nl=sr;var Fl=function(t){return!0===t||!1===t||Nl(t)&&"[object Boolean]"==Bl(t)};var kl=Xn,Ul=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},zl=function(t){return this.__data__.has(t)};function Gl(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new kl;++e<r;)this.add(t[e])}Gl.prototype.add=Gl.prototype.push=Ul,Gl.prototype.has=zl;var jl=Gl;var Vl=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var Hl=function(t,e){return t.has(e)},Wl=jl,Xl=Vl,Zl=Hl;var ql=function(t,e,r,n,i,o){var a=1&r,s=t.length,l=e.length;if(s!=l&&!(a&&l>s))return!1;var u=o.get(t),c=o.get(e);if(u&&c)return u==e&&c==t;var h=-1,p=!0,d=2&r?new Wl:void 0;for(o.set(t,e),o.set(e,t);++h<s;){var f=t[h],m=e[h];if(n)var g=a?n(m,f,h,e,t,o):n(f,m,h,t,e,o);if(void 0!==g){if(g)continue;p=!1;break}if(d){if(!Xl(e,(function(t,e){if(!Zl(d,e)&&(f===t||i(f,t,r,n,o)))return d.push(e)}))){p=!1;break}}else if(f!==m&&!i(f,m,r,n,o)){p=!1;break}}return o.delete(t),o.delete(e),p};var Yl=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var Kl=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},$l=Ba,Ql=Tr,Jl=ql,tu=Yl,eu=Kl,ru=Ye?Ye.prototype:void 0,nu=ru?ru.valueOf:void 0;var iu=function(t,e,r,n,i,o,a){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!o(new $l(t),new $l(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ql(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=tu;case"[object Set]":var l=1&n;if(s||(s=eu),t.size!=e.size&&!l)return!1;var u=a.get(t);if(u)return u==e;n|=2,a.set(t,e);var c=Jl(s(t),s(e),n,i,o,a);return a.delete(t),c;case"[object Symbol]":if(nu)return nu.call(t)==nu.call(e)}return!1},ou=aa,au=Object.prototype.hasOwnProperty;var su=function(t,e,r,n,i,o){var a=1&r,s=ou(t),l=s.length;if(l!=ou(e).length&&!a)return!1;for(var u=l;u--;){var c=s[u];if(!(a?c in e:au.call(e,c)))return!1}var h=o.get(t),p=o.get(e);if(h&&p)return h==e&&p==t;var d=!0;o.set(t,e),o.set(e,t);for(var f=a;++u<l;){var m=t[c=s[u]],g=e[c];if(n)var _=a?n(g,m,c,e,t,o):n(m,g,c,t,e,o);if(!(void 0===_?m===g||i(m,g,r,n,o):_)){d=!1;break}f||(f="constructor"==c)}if(d&&!f){var v=t.constructor,y=e.constructor;v==y||!("constructor"in t)||!("constructor"in e)||"function"==typeof v&&v instanceof v&&"function"==typeof y&&y instanceof y||(d=!1)}return o.delete(t),o.delete(e),d},lu=ni,uu=ql,cu=iu,hu=su,pu=Oa,du=Ci,fu=Ri.exports,mu=Hi,gu="[object Arguments]",_u="[object Array]",vu="[object Object]",yu=Object.prototype.hasOwnProperty;var xu=function(t,e,r,n,i,o){var a=du(t),s=du(e),l=a?_u:pu(t),u=s?_u:pu(e),c=(l=l==gu?vu:l)==vu,h=(u=u==gu?vu:u)==vu,p=l==u;if(p&&fu(t)){if(!fu(e))return!1;a=!0,c=!1}if(p&&!c)return o||(o=new lu),a||mu(t)?uu(t,e,r,n,i,o):cu(t,e,l,r,n,i,o);if(!(1&r)){var d=c&&yu.call(t,"__wrapped__"),f=h&&yu.call(e,"__wrapped__");if(d||f){var m=d?t.value():t,g=f?e.value():e;return o||(o=new lu),i(m,g,r,n,o)}}return!!p&&(o||(o=new lu),hu(t,e,r,n,i,o))},bu=xu,Eu=sr;var Tu=function t(e,r,n,i,o){return e===r||(null==e||null==r||!Eu(e)&&!Eu(r)?e!=e&&r!=r:bu(e,r,n,i,t,o))},Su=Tu;var Au=function(t,e){return Su(t,e)};var wu=function(t){return null==t},Cu=ar,Ru=sr;var Lu=function(t){return"number"==typeof t||Ru(t)&&"[object Number]"==Cu(t)},Iu=ar,Mu=Wo,Ou=sr,Pu=Function.prototype,Du=Object.prototype,Bu=Pu.toString,Nu=Du.hasOwnProperty,Fu=Bu.call(Object);var ku=function(t){if(!Ou(t)||"[object Object]"!=Iu(t))return!1;var e=Mu(t);if(null===e)return!0;var r=Nu.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Bu.call(r)==Fu},Uu=ar,zu=Ci,Gu=sr;var ju=function(t){return"string"==typeof t||!zu(t)&&Gu(t)&&"[object String]"==Uu(t)},Vu=ui,Hu=Tr;var Wu=function(t,e,r){(void 0!==r&&!Hu(t[e],r)||void 0===r&&!(e in t))&&Vu(t,e,r)};var Xu=function(t){return function(e,r,n){for(var i=-1,o=Object(e),a=n(e),s=a.length;s--;){var l=a[t?s:++i];if(!1===r(o[l],l,o))break}return e}},Zu=Xu(),qu=uo,Yu=sr;var Ku=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]},$u=gi,Qu=Co;var Ju=Wu,tc=Mo.exports,ec=Wa,rc=Oo,nc=is,ic=wi,oc=Ci,ac=function(t){return Yu(t)&&qu(t)},sc=Ri.exports,lc=Xr,uc=He,cc=ku,hc=Hi,pc=Ku,dc=function(t){return $u(t,Qu(t))};var fc=function(t,e,r,n,i,o,a){var s=pc(t,r),l=pc(e,r),u=a.get(l);if(u)Ju(t,r,u);else{var c=o?o(s,l,r+"",t,e,a):void 0,h=void 0===c;if(h){var p=oc(l),d=!p&&sc(l),f=!p&&!d&&hc(l);c=l,p||d||f?oc(s)?c=s:ac(s)?c=rc(s):d?(h=!1,c=tc(l,!0)):f?(h=!1,c=ec(l,!0)):c=[]:cc(l)||ic(l)?(c=s,ic(s)?c=dc(s):uc(s)&&!lc(s)||(c=nc(l))):h=!1}h&&(a.set(l,c),i(c,l,n,o,a),a.delete(l)),Ju(t,r,c)}},mc=ni,gc=Wu,_c=Zu,vc=fc,yc=He,xc=Co,bc=Ku;var Ec=function t(e,r,n,i,o){e!==r&&_c(r,(function(a,s){if(o||(o=new mc),yc(a))vc(e,r,s,n,t,i,o);else{var l=i?i(bc(e,s),a,s+"",e,r,o):void 0;void 0===l&&(l=a),gc(e,s,l)}}),xc)};var Tc=function(t){return t};var Sc=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},Ac=Sc,wc=Math.max;var Cc=function(t,e,r){return e=wc(void 0===e?t.length-1:e,0),function(){for(var n=arguments,i=-1,o=wc(n.length-e,0),a=Array(o);++i<o;)a[i]=n[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=n[i];return s[e]=r(a),Ac(t,this,s)}};var Rc=function(t){return function(){return t}},Lc=si,Ic=Lc?function(t,e){return Lc(t,"toString",{configurable:!0,enumerable:!1,value:Rc(e),writable:!0})}:Tc,Mc=Ic,Oc=Date.now;var Pc=function(t){var e=0,r=0;return function(){var n=Oc(),i=16-(n-r);if(r=n,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}},Dc=Pc(Mc),Bc=Tc,Nc=Cc,Fc=Dc;var kc=function(t,e){return Fc(Nc(t,e,Bc),t+"")},Uc=Tr,zc=uo,Gc=Mi,jc=He;var Vc=function(t,e,r){if(!jc(r))return!1;var n=typeof e;return!!("number"==n?zc(r)&&Gc(e,r.length):"string"==n&&e in r)&&Uc(r[e],t)},Hc=kc,Wc=Vc;var Xc=function(t){return Hc((function(e,r){var n=-1,i=r.length,o=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(o=t.length>3&&"function"==typeof o?(i--,o):void 0,a&&Wc(r[0],r[1],a)&&(o=i<3?void 0:o,i=1),e=Object(e);++n<i;){var s=r[n];s&&t(e,s,n,o)}return e}))},Zc=Ec,qc=Xc((function(t,e,r){Zc(t,e,r)})),Yc=qc,Kc=Ec,$c=Xc((function(t,e,r,n){Kc(t,e,r,n)})),Qc=$c;var Jc=function(t,e,r,n){for(var i=t.length,o=r+(n?1:-1);n?o--:++o<i;)if(e(t[o],o,t))return o;return-1};var th=function(t,e,r){for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1},eh=Jc,rh=function(t){return t!=t},nh=th;var ih=function(t,e,r){return e==e?nh(t,e,r):eh(t,rh,r)};var oh=function(t,e,r,n){for(var i=r-1,o=t.length;++i<o;)if(n(t[i],e))return i;return-1},ah=fl,sh=ih,lh=oh,uh=ki,ch=Oo,hh=Array.prototype.splice;var ph=function(t,e,r,n){var i=n?lh:sh,o=-1,a=e.length,s=t;for(t===e&&(e=ch(e)),r&&(s=ah(t,uh(r)));++o<a;)for(var l=0,u=e[o],c=r?r(u):u;(l=i(s,c,l,n))>-1;)s!==t&&hh.call(s,l,1),hh.call(t,l,1);return t},dh=ph;var fh=function(t,e){return t&&t.length&&e&&e.length?dh(t,e):t},mh=kc(fh),gh=tl,_h=He;var vh=function(t,e,r){var n=!0,i=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return _h(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),gh(t,e,{leading:n,maxWait:e,trailing:i})},yh=ih;var xh=function(t,e){return!!(null==t?0:t.length)&&yh(t,e,0)>-1};var bh=function(t,e,r){for(var n=-1,i=null==t?0:t.length;++n<i;)if(r(e,t[n]))return!0;return!1};var Eh=da,Th=function(){},Sh=Eh&&1/Kl(new Eh([,-0]))[1]==1/0?function(t){return new Eh(t)}:Th,Ah=jl,wh=xh,Ch=bh,Rh=Hl,Lh=Sh,Ih=Kl;var Mh=function(t,e,r){var n=-1,i=wh,o=t.length,a=!0,s=[],l=s;if(r)a=!1,i=Ch;else if(o>=200){var u=e?null:Lh(t);if(u)return Ih(u);a=!1,i=Rh,l=new Ah}else l=e?[]:s;t:for(;++n<o;){var c=t[n],h=e?e(c):c;if(c=r||0!==c?c:0,a&&h==h){for(var p=l.length;p--;)if(l[p]===h)continue t;e&&l.push(h),s.push(c)}else i(l,h,r)||(l!==s&&l.push(h),s.push(c))}return s},Oh=Mh;var Ph=function(t){return t&&t.length?Oh(t):[]};var Dh=function(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(r=r>i?i:r)<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var o=Array(i);++n<i;)o[n]=t[n+e];return o},Bh=Dh;var Nh=function(t,e,r){var n=t.length;return r=void 0===r?n:r,!e&&r>=n?t:Bh(t,e,r)},Fh=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var kh=function(t){return Fh.test(t)};var Uh=function(t){return t.split("")},zh="\\ud800-\\udfff",Gh="["+zh+"]",jh="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Vh="\\ud83c[\\udffb-\\udfff]",Hh="[^"+zh+"]",Wh="(?:\\ud83c[\\udde6-\\uddff]){2}",Xh="[\\ud800-\\udbff][\\udc00-\\udfff]",Zh="(?:"+jh+"|"+Vh+")"+"?",qh="[\\ufe0e\\ufe0f]?",Yh=qh+Zh+("(?:\\u200d(?:"+[Hh,Wh,Xh].join("|")+")"+qh+Zh+")*"),Kh="(?:"+[Hh+jh+"?",jh,Wh,Xh,Gh].join("|")+")",$h=RegExp(Vh+"(?="+Vh+")|"+Kh+Yh,"g");var Qh=function(t){return t.match($h)||[]},Jh=Uh,tp=kh,ep=Qh;var rp=function(t){return tp(t)?ep(t):Jh(t)},np=Nh,ip=kh,op=rp,ap=El;var sp=function(t){return function(e){e=ap(e);var r=ip(e)?op(e):void 0,n=r?r[0]:e.charAt(0),i=r?np(r,1).join(""):e.slice(1);return n[t]()+i}},lp=sp("toUpperCase");var up=function(t){return void 0===t},cp=El,hp=lp;var pp=function(t){return hp(cp(t).toLowerCase())};var dp=function(t,e,r,n){var i=-1,o=null==t?0:t.length;for(n&&o&&(r=t[++i]);++i<o;)r=e(r,t[i],i,t);return r};var fp=function(t){return function(e){return null==t?void 0:t[e]}},mp=fp({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),gp=El,_p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,vp=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var yp=function(t){return(t=gp(t))&&t.replace(_p,mp).replace(vp,"")},xp=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var bp=function(t){return t.match(xp)||[]},Ep=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var Tp=function(t){return Ep.test(t)},Sp="\\ud800-\\udfff",Ap="\\u2700-\\u27bf",wp="a-z\\xdf-\\xf6\\xf8-\\xff",Cp="A-Z\\xc0-\\xd6\\xd8-\\xde",Rp="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Lp="["+Rp+"]",Ip="\\d+",Mp="["+Ap+"]",Op="["+wp+"]",Pp="[^"+Sp+Rp+Ip+Ap+wp+Cp+"]",Dp="(?:\\ud83c[\\udde6-\\uddff]){2}",Bp="[\\ud800-\\udbff][\\udc00-\\udfff]",Np="["+Cp+"]",Fp="(?:"+Op+"|"+Pp+")",kp="(?:"+Np+"|"+Pp+")",Up="(?:['’](?:d|ll|m|re|s|t|ve))?",zp="(?:['’](?:D|LL|M|RE|S|T|VE))?",Gp="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",jp="[\\ufe0e\\ufe0f]?",Vp=jp+Gp+("(?:\\u200d(?:"+["[^"+Sp+"]",Dp,Bp].join("|")+")"+jp+Gp+")*"),Hp="(?:"+[Mp,Dp,Bp].join("|")+")"+Vp,Wp=RegExp([Np+"?"+Op+"+"+Up+"(?="+[Lp,Np,"$"].join("|")+")",kp+"+"+zp+"(?="+[Lp,Np+Fp,"$"].join("|")+")",Np+"?"+Fp+"+"+Up,Np+"+"+zp,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ip,Hp].join("|"),"g");var Xp=function(t){return t.match(Wp)||[]},Zp=bp,qp=Tp,Yp=El,Kp=Xp;var $p=function(t,e,r){return t=Yp(t),void 0===(e=r?void 0:e)?qp(t)?Kp(t):Zp(t):t.match(e)||[]},Qp=dp,Jp=yp,td=$p,ed=RegExp("['’]","g");var rd=function(t){return function(e){return Qp(td(Jp(e).replace(ed,"")),t,"")}},nd=pp,id=rd((function(t,e,r){return e=e.toLowerCase(),t+(r?nd(e):e)})),od=El,ad=0;var sd=function(t){var e=++ad;return od(t)+e},ld={isNil:wu,merge:Yc,throttle:vh,isString:ju,debounce:tl,pull:mh,isTypedArray:Hi,isPlainObject:ku,isNumber:Lu,isBoolean:Fl,isEqual:Au,cloneDeep:Zs,uniq:Ph,clamp:br,upperFirst:lp,get:Dl,mergeWith:Qc,isFunction:Xr,isObject:He,isUndefined:up,camelCase:id,uniqueId:sd};function ud(t){let e=t;return"string"==typeof t&&(e=window.document.getElementById(t)),e}function cd(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function hd(t){return cd(t).split(/\s+/)}function pd(t,e,r){const n=window.document.createElement(t);return e&&(n.className=e||""),r&&r.appendChild(n),n}function dd(t){const e=t.parentNode;e&&e.removeChild(t)}function fd(t,e){if(void 0!==t.classList){const r=hd(e);for(let e=0,n=r.length;e<n;e++)t.classList.add(r[e])}else if(!function(t,e){if(void 0!==t.classList)return t.classList.contains(e);const r=_d(t);return r.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(r)}(t,e)){const r=_d(t);gd(t,(r?r+" ":"")+e)}}function md(t,e){if(void 0!==t.classList){hd(e).forEach((e=>{t.classList.remove(e)}))}else gd(t,cd((" "+_d(t)+" ").replace(" "+e+" "," ")))}function gd(t,e){t instanceof HTMLElement?t.className=e:t.className.baseVal=e}function _d(t){return t instanceof SVGElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}var vd=function(t){var e;const r=null==(e=null==document?void 0:document.documentElement)?void 0:e.style;if(!r)return t[0];for(const e in t)if(t[e]&&t[e]in r)return t[e];return t[0]}(["transform","WebkitTransform"]);var yd=function(){var t;const e=window.document.querySelector('meta[name="viewport"]');if(!e)return 1;const r=(null==(t=e.content)?void 0:t.split(",")).find((t=>{const[e]=t.split("=");return"initial-scale"===e}));return r?1*r.split("=")[1]:1}()<1?1:window.devicePixelRatio;function xd(t,e){t.setAttribute("style",`${t.style.cssText}${e}`)}function bd(t){t.innerHTML=""}var Ed=null==navigator?void 0:navigator.userAgent;function Td(t){var e=[1/0,1/0,-1/0,-1/0];return Ot(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}function Sd(t){return"number"==typeof t}function Ad(t){return t-Math.fround(t)}Ed.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Ed.indexOf("Android")>-1||Ed.indexOf("Adr"),Td.default=Td;var wd=2*Math.PI*6378137/2;function Cd(t){const e=[1/0,1/0,-1/0,-1/0];return t.forEach((t=>{const{coordinates:r}=t;Rd(e,r)})),e}function Rd(t,e){return Array.isArray(e[0])?e.forEach((e=>{Rd(t,e)})):(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])),t}function Ld(t,e=!0,r={enable:!0,decimal:1}){t=function(t,e){if(!1===e)return t;const r=function(t){if(null==t)throw new Error("lng is required");(t>180||t<-180)&&((t%=360)>180&&(t=-360+t),t<-180&&(t=360+t),0===t&&(t=0));return t}(t[0]);let n=function(t){if(null==t)throw new Error("lat is required");(t>90||t<-90)&&((t%=180)>90&&(t=-180+t),t<-90&&(t=180+t),0===t&&(t=0));return t}(t[1]);n>85&&(n=85);n<-85&&(n=-85);return 3===t.length?[r,n,t[2]]:[r,n]}(t,e);const n=t[0],i=t[1];let o=n*wd/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*wd/180,r.enable&&(o=Number(o.toFixed(r.decimal)),a=Number(a.toFixed(r.decimal))),3===t.length?[o,a,t[2]]:[o,a]}function Id(t){const e=85.0511287798,r=Math.max(Math.min(e,t[1]),-e),n=256<<20;let i=Math.PI/180,o=t[0]*i,a=r*i;a=Math.log(Math.tan(Math.PI/4+a/2));return i=.5,o=n*(.5/Math.PI*o+.5),a=n*(-.5/Math.PI*a+i),[Math.floor(o),Math.floor(a)]}function Md(t,e){const r=85.0511287798,n=Math.PI/180,i=6378137;return e=Math.max(Math.min(r,e),-r),e*=n,[(t*=n)*i,(e=Math.log(Math.tan(Math.PI/4+e/2)))*i]}function Od(t,e,r){const n=Lt(e[1]-t[1]),i=Lt(e[0]-t[0]),o=Lt(t[1]),a=Lt(e[1]),s=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return function(t,e){void 0===e&&(e="kilometers");var r=At[e];if(!r)throw new Error(e+" units is invalid");return t*r}(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function Pd(t,e){const r=Math.abs(t[1][1]-t[0][1])*e,n=Math.abs(t[1][0]-t[0][0])*e;return[[t[0][0]-n,t[0][1]-r],[t[1][0]+n,t[1][1]+r]]}function Dd(t,e){return t[0][0]<=e[0][0]&&t[0][1]<=e[0][1]&&t[1][0]>=e[1][0]&&t[1][1]>=e[1][1]}function Bd(t){return[[t[0],t[1]],[t[2],t[3]]]}function Nd(t){const e=(r=t,n=[0,0],Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2)));var r,n;return[t[0]/e,t[1]/e]}function Fd(t){if(Sd(t[0]))return t;if(Sd(t[0][0]))throw new Error("当前数据不支持标注");if(Sd(t[0][0][0])){let e=0,r=0,n=0;return t.forEach((t=>{t.forEach((t=>{e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("当前数据不支持标注")}var kd=class{constructor(t=50,e){this.limit=t,this.destroy=e||this.defaultDestroy,this.order=[],this.clear()}clear(){this.order.forEach((t=>{this.delete(t)})),this.cache={},this.order=[]}get(t){const e=this.cache[t];return e&&(this.deleteOrder(t),this.appendOrder(t)),e}set(t,e){this.cache[t]?(this.delete(t),this.cache[t]=e,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=e,this.appendOrder(t))}delete(t){const e=this.cache[t];e&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(e,t))}deleteCache(t){delete this.cache[t]}deleteOrder(t){const e=this.order.findIndex((e=>e===t));e>=0&&this.order.splice(e,1)}appendOrder(t){this.order.push(t)}defaultDestroy(t,e){return null}};function Ud(t){if(0===t.length)return 0;let e=1*t[0];for(let r=1;r<t.length;r++)e+=1*t[r];return e}var zd={min:function(t){if(0===t.length)throw new Error("min requires at least one data point");let e=t[0];for(let r=1;r<t.length;r++)t[r]<e&&(e=t[r]);return 1*e},max:function(t){if(0===t.length)throw new Error("max requires at least one data point");let e=t[0];for(let r=1;r<t.length;r++)t[r]>e&&(e=t[r]);return 1*e},mean:function(t){if(0===t.length)throw new Error("mean requires at least one data point");return Ud(t)/t.length},sum:Ud,mode:function(t){if(0===t.length)throw new Error("mean requires at least one data point");if(t.length<3)return t[0];t.sort();let e=t[0],r=NaN,n=0,i=1;for(let o=1;o<t.length+1;o++)t[o]!==e?(i>n&&(n=i,r=e),i=1,e=t[o]):i++;return 1*r}};function Gd(t,e){return t.map((t=>t[e]))}function jd(t,e){void 0===e&&(e={});var r=Number(t[0]),n=Number(t[1]),i=Number(t[2]),o=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[r,n];return Ct([[a,[i,n],[i,o],[r,o],a]],e.properties,{bbox:t,id:e.id})}var Vd={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}function i(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function o(t,e,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||t,a),l=r?r+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],s]:t._events[l].push(s):(t._events[l]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var t,n,i=[];if(0===this._eventsCount)return i;for(n in t=this._events)e.call(t,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},s.prototype.emit=function(t,e,n,i,o,a){var s=r?r+t:t;if(!this._events[s])return!1;var l,u,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,i),!0;case 5:return c.fn.call(c.context,e,n,i,o),!0;case 6:return c.fn.call(c.context,e,n,i,o,a),!0}for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var p,d=c.length;for(u=0;u<d;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,n);break;case 4:c[u].fn.call(c[u].context,e,n,i);break;default:if(!l)for(p=1,l=new Array(h-1);p<h;p++)l[p-1]=arguments[p];c[u].fn.apply(c[u].context,l)}}return!0},s.prototype.on=function(t,e,r){return o(this,t,e,r,!1)},s.prototype.once=function(t,e,r){return o(this,t,e,r,!0)},s.prototype.removeListener=function(t,e,n,i){var o=r?r+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var l=0,u=[],c=s.length;l<c;l++)(s[l].fn!==e||i&&!s[l].once||n&&s[l].context!==n)&&u.push(s[l]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&a(this,e)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,t.exports=s}(Vd);var Hd=Vd.exports,Wd=(t=>(t.Realtime="realtime",t.Overlap="overlap",t.Replace="replace",t))(Wd||{}),Xd=(t=>(t.Loading="Loading",t.Loaded="Loaded",t.Failure="Failure",t.Cancelled="Cancelled",t))(Xd||{}),Zd=2;function qd(t){for(;t;){if(t.isLoaded)return t.properties.state|=Zd,!0;t=t.parent}return!1}function Yd(t){t.children.forEach((t=>{t.isLoaded?t.properties.state|=Zd:Yd(t)}))}var Kd=[-1/0,-1/0,1/0,1/0],$d={[Wd.Realtime]:function(t){t.forEach((t=>{t.isCurrent&&(t.isVisible=t.isLoaded)}))},[Wd.Overlap]:function(t){t.forEach((t=>{t.properties.state=0})),t.forEach((t=>{t.isCurrent&&!qd(t)&&Yd(t)})),t.forEach((t=>{t.isVisible=Boolean(t.properties.state&Zd)}))},[Wd.Replace]:function(t){t.forEach((t=>{t.properties.state=0})),t.forEach((t=>{t.isCurrent&&qd(t)}));const e=t.slice().sort(((t,e)=>t.z-e.z));e.forEach((t=>{t.isVisible=Boolean(t.properties.state&Zd),t.children.length&&(t.isVisible||1&t.properties.state)?t.children.forEach((t=>{t.properties.state=1})):t.isCurrent&&Yd(t)}))}},Qd=()=>{};function Jd(t,e,r){return[Math.floor((t+180)/360*Math.pow(2,r)),Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,r))]}function tf(t,e,r){const n=t/Math.pow(2,r)*360-180,i=Math.PI-2*Math.PI*e/Math.pow(2,r);return[n,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}var ef=(t,e,r)=>{const[n,i]=tf(t,e,r),[o,a]=tf(t+1,e+1,r);return[n,a,o,i]};var rf=class extends Vd.exports.EventEmitter{constructor(t){super(),this.tileSize=256,this.isVisible=!1,this.isCurrent=!1,this.isVisibleChange=!1,this.loadedLayers=0,this.isLayerLoaded=!1,this.isLoad=!1,this.isChildLoad=!1,this.parent=null,this.children=[],this.data=null,this.properties={},this.loadDataId=0;const{x:e,y:r,z:n,tileSize:i,warp:o=!0}=t;this.x=e,this.y=r,this.z=n,this.warp=o||!0,this.tileSize=i}get isLoading(){return this.loadStatus===Xd.Loading}get isLoaded(){return this.loadStatus===Xd.Loaded}get isFailure(){return this.loadStatus===Xd.Failure}setTileLayerLoaded(){this.isLayerLoaded=!0}get isCancelled(){return this.loadStatus===Xd.Cancelled}get isDone(){return[Xd.Loaded,Xd.Cancelled,Xd.Failure].includes(this.loadStatus)}get bounds(){return ef(this.x,this.y,this.z)}get bboxPolygon(){const[t,e,r,n]=this.bounds,i=[(r-t)/2,(n-e)/2];return jd(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:i,meta:`\n      ${this.key}\n      `}})}get key(){return`${this.x}_${this.y}_${this.z}`}layerLoad(){this.loadedLayers++,this.emit("layerLoaded")}loadData(t){return e=this,r=arguments,n=function*({getData:t,onLoad:e,onError:r}){this.loadDataId++;const n=this.loadDataId;this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Xd.Loading;let i,o=null;try{const{x:e,y:r,z:n,bounds:i,tileSize:a,warp:s}=this,{warpX:l,warpY:u}=((t,e,r,n=!0)=>{const i=Math.pow(2,r);let o=t;return n&&(o<0?o+=i:o>i-1&&(o%=i)),{warpX:o,warpY:e}})(e,r,n,s),{signal:c}=this.abortController,h={x:l,y:u,z:n,bounds:i,tileSize:a,signal:c,warp:s};o=yield t(h,this)}catch(t){i=t}if(n===this.loadDataId&&(!this.isCancelled||o)){if(i||!o)return this.loadStatus=Xd.Failure,void r(i,this);this.loadStatus=Xd.Loaded,this.data=o,e(this)}},new Promise(((t,i)=>{var o=t=>{try{s(n.next(t))}catch(t){i(t)}},a=t=>{try{s(n.throw(t))}catch(t){i(t)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,a);s((n=n.apply(e,r)).next())}));var e,r,n}reloadData(t){this.isLoading&&this.abortLoad(),this.loadData(t)}abortLoad(){this.isLoaded||this.isCancelled||(this.loadStatus=Xd.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}},nf=Object.defineProperty,of=Object.defineProperties,af=Object.getOwnPropertyDescriptors,sf=Object.getOwnPropertySymbols,lf=Object.prototype.hasOwnProperty,uf=Object.prototype.propertyIsEnumerable,cf=(t,e,r)=>e in t?nf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hf=(t,e)=>{for(var r in e||(e={}))lf.call(e,r)&&cf(t,r,e[r]);if(sf)for(var r of sf(e))uf.call(e,r)&&cf(t,r,e[r]);return t},{throttle:pf}=ld,df=class extends Hd{constructor(t){super(),this.currentTiles=[],this.cacheTiles=new Map,this.throttleUpdate=pf(((t,e)=>{this.update(t,e)}),16),this.onTileLoad=t=>{this.emit("tile-loaded",t),this.updateTileVisible(),this.loadFinished()},this.onTileError=(t,e)=>{this.emit("tile-error",{error:t,tile:e}),this.updateTileVisible(),this.loadFinished()},this.onTileUnload=t=>{this.emit("tile-unload",t),this.loadFinished()},this.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:Kd,getTileData:Qd,warp:!0,updateStrategy:Wd.Replace},this.updateOptions(t)}get isLoaded(){return this.currentTiles.every((t=>t.isDone))}get tiles(){const t=Array.from(this.cacheTiles.values()).sort(((t,e)=>t.z-e.z));return t}updateOptions(t){const e=void 0===t.minZoom?this.options.minZoom:Math.ceil(t.minZoom),r=void 0===t.maxZoom?this.options.maxZoom:Math.floor(t.maxZoom);var n;this.options=(n=hf(hf({},this.options),t),of(n,af({minZoom:e,maxZoom:r})))}update(t,e){const r=Math.max(0,Math.ceil(t));if(this.lastViewStates&&this.lastViewStates.zoom===r&&((t,e)=>Dd(Bd(t),Bd(e)))(this.lastViewStates.latLonBoundsBuffer,e))return;const n=((t,e)=>{const r=Pd(Bd(t),e),n=85.0511287798065;return[Math.max(r[0][0],-900),Math.max(r[0][1],-n),Math.min(r[1][0],900),Math.min(r[1][1],n)]})(e,.2);this.lastViewStates={zoom:r,latLonBounds:e,latLonBoundsBuffer:n},this.currentZoom=r;let i=!1;const o=this.getTileIndices(r,n).filter((t=>this.options.warp||t.x>=0&&t.x<Math.pow(2,r)));this.emit("tiles-load-start"),this.currentTiles=o.map((({x:t,y:e,z:r})=>{let n=this.getTile(t,e,r);if(n){return((null==n?void 0:n.isFailure)||(null==n?void 0:n.isCancelled))&&n.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),n}return n=this.createTile(t,e,r),i=!0,n})),i&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}reloadAll(){for(const[t,e]of this.cacheTiles){if(!this.currentTiles.includes(e))return this.cacheTiles.delete(t),void this.onTileUnload(e);this.onTileUnload(e),e.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}reloadTileById(t,e,r){const n=this.cacheTiles.get(`${e},${r},${t}`);n&&(this.onTileUnload(n),n.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}reloadTileByLnglat(t,e,r){const n=this.getTileByLngLat(t,e,r);n&&this.reloadTileById(n.z,n.x,n.y)}reloadTileByExtent(t,e){this.getTileIndices(e,t).forEach((t=>{this.reloadTileById(t.z,t.x,t.y)}))}pruneRequests(){const t=[];for(const e of this.cacheTiles.values())e.isLoading&&(e.isCurrent||e.isVisible||t.push(e));for(;t.length>0;){t.shift().abortLoad()}}getTileByLngLat(t,e,r){const{zoomOffset:n}=this.options,i=Math.ceil(r)+n,o=Jd(t,e,i);return this.tiles.filter((t=>t.key===`${o[0]}_${o[1]}_${i}`))[0]}getTileExtent(t,e){return this.getTileIndices(e,t)}getTileByZXY(t,e,r){return this.tiles.filter((n=>n.key===`${e}_${r}_${t}`))[0]}clear(){for(const t of this.cacheTiles.values())t.isLoading?t.abortLoad():this.onTileUnload(t);this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}destroy(){this.clear(),this.removeAllListeners()}updateTileVisible(){const t=this.options.updateStrategy,e=new Map;for(const t of this.cacheTiles.values())e.set(t.key,t.isVisible),t.isCurrent=!1,t.isVisible=!1;for(const t of this.currentTiles)t.isCurrent=!0,t.isVisible=!0;const r=Array.from(this.cacheTiles.values());"function"==typeof t?t(r):$d[t](r);let n=!1;Array.from(this.cacheTiles.values()).forEach((t=>{t.isVisible!==e.get(t.key)?(t.isVisibleChange=!0,n=!0):t.isVisibleChange=!1})),n&&this.emit("tile-update")}getTileIndices(t,e){const{tileSize:r,extent:n,zoomOffset:i}=this.options,o=function({zoom:t,latLonBounds:e,maxZoom:r=1/0,minZoom:n=0,zoomOffset:i=0,extent:o=Kd}){let a=Math.ceil(t)+i;if(Number.isFinite(n)&&a<n)return[];Number.isFinite(r)&&a>r&&(a=r);const[s,l,u,c]=e,h=[Math.max(s,o[0]),Math.max(l,o[1]),Math.min(u,o[2]),Math.min(c,o[3])],p=[],[d,f]=Jd(h[0],h[1],a),[m,g]=Jd(h[2],h[3],a);for(let t=d;t<=m;t++)for(let e=g;e<=f;e++)p.push({x:t,y:e,z:a});const _=(m+d)/2,v=(f+g)/2,y=(t,e)=>Math.abs(t-_)+Math.abs(e-v);return p.sort(((t,e)=>y(t.x,t.y)-y(e.x,e.y))),p}({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:i,tileSize:r,zoom:t,latLonBounds:e,extent:n});return o}getTileId(t,e,r){return`${t},${e},${r}`}loadFinished(){const t=!this.currentTiles.some((t=>!t.isDone));return t&&this.emit("tiles-load-finished"),t}getTile(t,e,r){const n=this.getTileId(t,e,r);return this.cacheTiles.get(n)}createTile(t,e,r){const n=this.getTileId(t,e,r),i=new rf({x:t,y:e,z:r,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(n,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}resizeCacheTiles(){const t=5*this.currentTiles.length;if(this.cacheTiles.size>t)for(const[e,r]of this.cacheTiles)if(r.isVisible||this.currentTiles.includes(r)||(this.cacheTiles.delete(e),this.onTileUnload(r)),this.cacheTiles.size<=t)break;this.rebuildTileTree()}rebuildTileTree(){for(const t of this.cacheTiles.values())t.parent=null,t.children.length=0;for(const t of this.cacheTiles.values()){const e=this.getNearestAncestor(t.x,t.y,t.z);t.parent=e,(null==e?void 0:e.children)&&e.children.push(t)}}getNearestAncestor(t,e,r){for(;r>this.options.minZoom;){t=Math.floor(t/2),e=Math.floor(e/2),r-=1;const n=this.getTile(t,e,r);if(n)return n}return null}};function ff(t){const e=[];let r=/\{([a-z])-([a-z])\}/.exec(t);if(r){const n=r[1].charCodeAt(0),i=r[2].charCodeAt(0);let o;for(o=n;o<=i;++o)e.push(t.replace(r[0],String.fromCharCode(o)));return e}if(r=/\{(\d+)-(\d+)\}/.exec(t),r){const n=parseInt(r[2],10);for(let i=parseInt(r[1],10);i<=n;i++)e.push(t.replace(r[0],i.toString()));return e}return e.push(t),e}function mf(t,e){if(!t||!t.length)throw new Error("url is not allowed to be empty");const{x:r,y:n,z:i}=e,o=ff(t),a=Math.abs(r+n)%o.length;return(Ht(o[a])?`${o[a]}/{z}/{x}/{y}`:o[a]).replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,ef(r,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function gf(t,e){const{x:r,y:n,z:i,layer:o,version:a="1.0.0",style:s="default",format:l,service:u="WMTS",tileMatrixset:c}=e,h=ff(t);return`${h[Math.abs(r+n)%h.length]}&SERVICE=${u}&REQUEST=GetTile&VERSION=${a}&LAYER=${o}&STYLE=${s}&TILEMATRIXSET=${c}&FORMAT=${l}&TILECOL=${r}&TILEROW=${n}&TILEMATRIX=${i}`}function _f(t,e){return null==t?e:t}var vf=function t(e,r){var n,i=e&&e.type;if("FeatureCollection"===i)for(n=0;n<e.features.length;n++)t(e.features[n],r);else if("GeometryCollection"===i)for(n=0;n<e.geometries.length;n++)t(e.geometries[n],r);else if("Feature"===i)t(e.geometry,r);else if("Polygon"===i)yf(e.coordinates,r);else if("MultiPolygon"===i)for(n=0;n<e.coordinates.length;n++)yf(e.coordinates[n],r);return e};function yf(t,e){if(0!==t.length){xf(t[0],e);for(var r=1;r<t.length;r++)xf(t[r],!e)}}function xf(t,e){for(var r=0,n=0,i=0,o=t.length,a=o-1;i<o;a=i++){var s=(t[i][0]-t[a][0])*(t[a][1]+t[i][1]),l=r+s;n+=Math.abs(r)>=Math.abs(s)?r-l+s:s-l+r,r=l}r+n>=0!=!!e&&t.reverse()}function bf(t){return!!Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function Ef(t){const e=Object.isFrozen(t)?ld.cloneDeep(t):t;return vf(e,!0),e}function Tf(t,e){return t||[[e[0],e[3]],[e[2],e[3]],[e[2],e[1]],[e[0],e[1]]]}var Sf=Object.defineProperty,Af=Object.defineProperties,wf=Object.getOwnPropertyDescriptors,Cf=Object.getOwnPropertySymbols,Rf=Object.prototype.hasOwnProperty,Lf=Object.prototype.propertyIsEnumerable,If=(t,e,r)=>e in t?Sf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mf=(t,e)=>{for(var r in e||(e={}))Rf.call(e,r)&&If(t,r,e[r]);if(Cf)for(var r of Cf(e))Lf.call(e,r)&&If(t,r,e[r]);return t},Of=(t,e)=>Af(t,wf(e));function Pf(t,e){const{x:r,y:n,x1:i,y1:o,coordinates:a,geometry:s}=e,l=[];if(!Array.isArray(t))return{dataArray:[]};if(s)return t.filter((t=>t[s]&&t[s].type&&t[s].coordinates&&t[s].coordinates.length>0)).forEach(((t,e)=>{Pt(Ef(t[s]),(r=>{const n=It(r),i=Of(Mf({},t),{_id:e,coordinates:n});l.push(i)}))})),{dataArray:l};for(let e=0;e<t.length;e++){const s=t[e];let u=[];if(a){let t="Polygon";Array.isArray(a[0])||(t="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(t="LineString");u=Ef({type:t,coordinates:s[a]}).coordinates}else if(r&&n&&i&&o){u=[[parseFloat(s[r]),parseFloat(s[n])],[parseFloat(s[i]),parseFloat(s[o])]]}else r&&n&&(u=[parseFloat(s[r]),parseFloat(s[n])]);const c=Of(Mf({},s),{_id:e,coordinates:u});l.push(c)}return{dataArray:l}}var Df=Object.defineProperty,Bf=Object.defineProperties,Nf=Object.getOwnPropertyDescriptors,Ff=Object.getOwnPropertySymbols,kf=Object.prototype.hasOwnProperty,Uf=Object.prototype.propertyIsEnumerable,zf=(t,e,r)=>e in t?Df(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;function Gf(t,e,r,n){for(var i,o=n,a=r-e>>1,s=r-e,l=t[e],u=t[e+1],c=t[r],h=t[r+1],p=e+3;p<r;p+=3){var d=jf(t[p],t[p+1],l,u,c,h);if(d>o)i=p,o=d;else if(d===o){var f=Math.abs(p-a);f<s&&(i=p,s=f)}}o>n&&(i-e>3&&Gf(t,e,i,n),t[i+2]=o,r-i>3&&Gf(t,i,r,n))}function jf(t,e,r,n,i,o){var a=i-r,s=o-n;if(0!==a||0!==s){var l=((t-r)*a+(e-n)*s)/(a*a+s*s);l>1?(r=i,n=o):l>0&&(r+=a*l,n+=s*l)}return(a=t-r)*a+(s=e-n)*s}function Vf(t,e,r,n){var i={id:void 0===t?null:t,type:e,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)Hf(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<e.length;n++)Hf(t,e[n]);else if("MultiPolygon"===r)for(n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)Hf(t,e[n][i])}(i),i}function Hf(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function Wf(t,e,r,n){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],l=e.id;if(r.promoteId?l=e.properties[r.promoteId]:r.generateId&&(l=n||0),"Point"===o)Xf(i,s);else if("MultiPoint"===o)for(var u=0;u<i.length;u++)Xf(i[u],s);else if("LineString"===o)Zf(i,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(u=0;u<i.length;u++)s=[],Zf(i[u],s,a,!1),t.push(Vf(l,"LineString",s,e.properties));return}qf(i,s,a,!1)}else if("Polygon"===o)qf(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(u=0;u<e.geometry.geometries.length;u++)Wf(t,{id:l,geometry:e.geometry.geometries[u],properties:e.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<i.length;u++){var c=[];qf(i[u],c,a,!0),s.push(c)}}t.push(Vf(l,o,s,e.properties))}}function Xf(t,e){e.push(Yf(t[0])),e.push(Kf(t[1])),e.push(0)}function Zf(t,e,r,n){for(var i,o,a=0,s=0;s<t.length;s++){var l=Yf(t[s][0]),u=Kf(t[s][1]);e.push(l),e.push(u),e.push(0),s>0&&(a+=n?(i*u-l*o)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(u-o,2))),i=l,o=u}var c=e.length-3;e[2]=1,Gf(e,0,c,r),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function qf(t,e,r,n){for(var i=0;i<t.length;i++){var o=[];Zf(t[i],o,r,n),e.push(o)}}function Yf(t){return t/360+.5}function Kf(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function $f(t,e,r,n,i,o,a,s){if(n/=e,o>=(r/=e)&&a<n)return t;if(a<r||o>=n)return null;for(var l=[],u=0;u<t.length;u++){var c=t[u],h=c.geometry,p=c.type,d=0===i?c.minX:c.minY,f=0===i?c.maxX:c.maxY;if(d>=r&&f<n)l.push(c);else if(!(f<r||d>=n)){var m=[];if("Point"===p||"MultiPoint"===p)Qf(h,m,r,n,i);else if("LineString"===p)Jf(h,m,r,n,i,!1,s.lineMetrics);else if("MultiLineString"===p)em(h,m,r,n,i,!1);else if("Polygon"===p)em(h,m,r,n,i,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var _=[];em(h[g],_,r,n,i,!0),_.length&&m.push(_)}if(m.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<m.length;g++)l.push(Vf(c.id,p,m[g],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),l.push(Vf(c.id,p,m,c.tags))}}}return l.length?l:null}function Qf(t,e,r,n,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=r&&a<=n&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function Jf(t,e,r,n,i,o,a){for(var s,l,u=tm(t),c=0===i?nm:im,h=t.start,p=0;p<t.length-3;p+=3){var d=t[p],f=t[p+1],m=t[p+2],g=t[p+3],_=t[p+4],v=0===i?d:f,y=0===i?g:_,x=!1;a&&(s=Math.sqrt(Math.pow(d-g,2)+Math.pow(f-_,2))),v<r?y>r&&(l=c(u,d,f,g,_,r),a&&(u.start=h+s*l)):v>n?y<n&&(l=c(u,d,f,g,_,n),a&&(u.start=h+s*l)):rm(u,d,f,m),y<r&&v>=r&&(l=c(u,d,f,g,_,r),x=!0),y>n&&v<=n&&(l=c(u,d,f,g,_,n),x=!0),!o&&x&&(a&&(u.end=h+s*l),e.push(u),u=tm(t)),a&&(h+=s)}var b=t.length-3;d=t[b],f=t[b+1],m=t[b+2],(v=0===i?d:f)>=r&&v<=n&&rm(u,d,f,m),b=u.length-3,o&&b>=3&&(u[b]!==u[0]||u[b+1]!==u[1])&&rm(u,u[0],u[1],u[2]),u.length&&e.push(u)}function tm(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function em(t,e,r,n,i,o){for(var a=0;a<t.length;a++)Jf(t[a],e,r,n,i,o,!1)}function rm(t,e,r,n){t.push(e),t.push(r),t.push(n)}function nm(t,e,r,n,i,o){var a=(o-e)/(n-e);return t.push(o),t.push(r+(i-r)*a),t.push(1),a}function im(t,e,r,n,i,o){var a=(o-r)/(i-r);return t.push(e+(n-e)*a),t.push(o),t.push(1),a}function om(t,e){for(var r=[],n=0;n<t.length;n++){var i,o=t[n],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=am(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(am(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(am(o.geometry[s][u],e));i.push(l)}r.push(Vf(o.id,a,i,o.tags))}return r}function am(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var n=0;n<t.length;n+=3)r.push(t[n]+e,t[n+1],t[n+2]);return r}function sm(t,e){if(t.transformed)return t;var r,n,i,o=1<<t.z,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var l=t.features[r],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(n=0;n<u.length;n+=2)l.geometry.push(lm(u[n],u[n+1],e,o,a,s));else for(n=0;n<u.length;n++){var h=[];for(i=0;i<u[n].length;i+=2)h.push(lm(u[n][i],u[n][i+1],e,o,a,s));l.geometry.push(h)}}return t.transformed=!0,t}function lm(t,e,r,n,i,o){return[Math.round(r*(t*n-i)),Math.round(r*(e*n-o))]}function um(t,e,r,n,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,cm(a,t[s],o,i);var l=t[s].minX,u=t[s].minY,c=t[s].maxX,h=t[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function cm(t,e,r,n){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)hm(a,i,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)hm(a,i[s],t,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<i.length;l++){var u=i[l];for(s=0;s<u.length;s++)hm(a,u[s],t,r,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function hm(t,e,r,n,i,o){var a=n*n;if(n>0&&e.size<(i?a:n))r.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===n||e[l+2]>a)&&(r.numSimplified++,s.push(e[l]),s.push(e[l+1])),r.numPoints++;i&&function(t,e){for(var r=0,n=0,i=t.length,o=i-2;n<i;o=n,n+=2)r+=(t[n]-t[o])*(t[n+1]+t[o+1]);if(r>0===e)for(n=0,i=t.length;n<i/2;n+=2){var a=t[n],s=t[n+1];t[n]=t[i-2-n],t[n+1]=t[i-1-n],t[i-2-n]=a,t[i-1-n]=s}}(s,o),t.push(s)}}function pm(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)Wf(r,t.features[n],e,n);else"Feature"===t.type?Wf(r,t,e):Wf(r,{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(t,e){var r=e.buffer/e.extent,n=t,i=$f(t,1,-1-r,r,0,-1,2,e),o=$f(t,1,1-r,2+r,0,-1,2,e);return(i||o)&&(n=$f(t,1,-r,1+r,0,-1,2,e)||[],i&&(n=om(i,1).concat(n)),o&&(n=n.concat(om(o,-1)))),n}(n,e),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function dm(t,e,r){return 32*((1<<t)*r+e)+t}pm.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},pm.prototype.splitTile=function(t,e,r,n,i,o,a){for(var s=[t,e,r,n],l=this.options,u=l.debug;s.length;){n=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=dm(e,r,n),p=this.tiles[h];if(!p&&(u>1&&console.time("creation"),p=this.tiles[h]=um(t,e,r,n,l),this.tileCoords.push({z:e,x:r,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=t,i){if(e===l.maxZoom||e===i)continue;var f=1<<i-e;if(r!==Math.floor(o/f)||n!==Math.floor(a/f))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){u>1&&console.time("clipping");var m,g,_,v,y,x,b=.5*l.buffer/l.extent,E=.5-b,T=.5+b,S=1+b;m=g=_=v=null,y=$f(t,c,r-b,r+T,0,p.minX,p.maxX,l),x=$f(t,c,r+E,r+S,0,p.minX,p.maxX,l),t=null,y&&(m=$f(y,c,n-b,n+T,1,p.minY,p.maxY,l),g=$f(y,c,n+E,n+S,1,p.minY,p.maxY,l),y=null),x&&(_=$f(x,c,n-b,n+T,1,p.minY,p.maxY,l),v=$f(x,c,n+E,n+S,1,p.minY,p.maxY,l),x=null),u>1&&console.timeEnd("clipping"),s.push(m||[],e+1,2*r,2*n),s.push(g||[],e+1,2*r,2*n+1),s.push(_||[],e+1,2*r+1,2*n),s.push(v||[],e+1,2*r+1,2*n+1)}}},pm.prototype.getTile=function(t,e,r){var n=this.options,i=n.extent,o=n.debug;if(t<0||t>24)return null;var a=1<<t,s=dm(t,e=(e%a+a)%a,r);if(this.tiles[s])return sm(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var l,u=t,c=e,h=r;!l&&u>0;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[dm(u,c,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,c,h),o>1&&console.time("drilling down"),this.splitTile(l.source,u,c,h,t,e,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?sm(this.tiles[s],i):null):null};var fm=class{constructor(t,e,r,n){this.vectorLayerCache={},this.x=e,this.y=r,this.z=n,this.vectorTile=t}getTileData(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];return this.vectorTile.layers[t].features}getFeatureById(){throw new Error("Method not implemented.")}},mm=Object.defineProperty,gm=Object.defineProperties,_m=Object.getOwnPropertyDescriptors,vm=Object.getOwnPropertySymbols,ym=Object.prototype.hasOwnProperty,xm=Object.prototype.propertyIsEnumerable,bm=(t,e,r)=>e in t?mm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Em=(t,e)=>{for(var r in e||(e={}))ym.call(e,r)&&bm(t,r,e[r]);if(vm)for(var r of vm(e))xm.call(e,r)&&bm(t,r,e[r]);return t},Tm={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function Sm(t){let e=0;for(let r,n,i=0,o=t.length,a=o-1;i<o;a=i++)r=t[i],n=t[a],e+=(n.x-r.x)*(r.y+n.y);return e}var Am=["Unknown","Point","LineString","Polygon"];function wm(t,e,r,n,i){let o=i.geometry;const a=i.type,s=i.tags,l=i.id,u=t*Math.pow(2,n),c=t*e,h=t*r;let p,d,f=Am[a];function m(t){for(let e=0;e<t.length;e++){const r=t[e];if(r[3])break;const n=180-360*(r[1]+h)/u,i=360*(r[0]+c)/u-180,o=360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90;t[e]=[i,o,0,1]}}switch(a){case 1:const t=[];for(p=0;p<o.length;p++)t[p]=o[p][0];o=t,m(o);break;case 2:for(p=0;p<o.length;p++)m(o[p]);break;case 3:for(o=function(t){const e=t.length;if(e<=1)return[t];const r=[];let n,i;for(let o=0;o<e;o++){const e=Sm(t[o]);0!==e&&(void 0===i&&(i=e<0),i===e<0?(n&&r.push(n),n=[t[o]]):n.push(t[o]))}return n&&r.push(n),r}(o),p=0;p<o.length;p++)for(d=0;d<o[p].length;d++)m(o[p][d])}1===o.length?o=o[0]:f="Multi"+f;return{type:"Feature",geometry:{type:f,coordinates:o},properties:s,id:l,tileOrigin:[0,0],coord:""}}var Cm=(t,e,r,n)=>{return i=void 0,o=null,a=function*(){return new Promise((i=>{const o=e.getTile(t.z,t.x,t.y),a=o?o.features.map((t=>wm(n,r.x,r.y,r.z,t))):[];i(new fm({layers:{defaultLayer:{features:a}}},t.x,t.y,t.z))}))},new Promise(((t,e)=>{var r=t=>{try{s(a.next(t))}catch(t){e(t)}},n=t=>{try{s(a.throw(t))}catch(t){e(t)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,n);s((a=a.apply(i,o)).next())}));var i,o,a};var Rm=Object.defineProperty,Lm=Object.defineProperties,Im=Object.getOwnPropertyDescriptors,Mm=Object.getOwnPropertySymbols,Om=Object.prototype.hasOwnProperty,Pm=Object.prototype.propertyIsEnumerable,Dm=(t,e,r)=>e in t?Rm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bm=(t,e)=>{for(var r in e||(e={}))Om.call(e,r)&&Dm(t,r,e[r]);if(Mm)for(var r of Mm(e))Pm.call(e,r)&&Dm(t,r,e[r]);return t},Nm=(t,e)=>Lm(t,Im(e));function Fm(t,e){const{extent:r=[121.168,30.2828,121.384,30.4219],coordinates:n,requestParameters:i={}}=e,o=new Promise((e=>{t instanceof HTMLImageElement||function(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}(t)?e([t]):function(t,e,r){const n=[];if("string"==typeof t)Jt(Nm(Bm({},e),{url:t}),((t,e)=>{e&&(n.push(e),r(n))}));else{const i=t.length;let o=0;t.forEach((t=>{Jt(Nm(Bm({},e),{url:t}),((t,e)=>{o++,e&&n.push(e),o===i&&r(n)}))}))}}(t,i,(t=>{e(t)}))})),a=Tf(n,r);return{originData:t,images:o,_id:1,dataArray:[{_id:0,coordinates:a}]}}var km=Object.defineProperty,Um=Object.defineProperties,zm=Object.getOwnPropertyDescriptors,Gm=Object.getOwnPropertySymbols,jm=Object.prototype.hasOwnProperty,Vm=Object.prototype.propertyIsEnumerable,Hm=(t,e,r)=>e in t?km(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wm=(t,e)=>{for(var r in e||(e={}))jm.call(e,r)&&Hm(t,r,e[r]);if(Gm)for(var r of Gm(e))Vm.call(e,r)&&Hm(t,r,e[r]);return t},Xm=(t,e)=>Um(t,zm(e)),Zm=(t,e,r,n)=>{return i=void 0,o=null,a=function*(){const i={x:e.x,y:e.y,z:e.z},o=mf(t,i);return new Promise((t=>{n?n(i,((r,n)=>{if(r||!n){const r=new fm({layers:{defaultLayer:{features:[]}}},e.x,e.y,e.z);t(r)}else{const r={layers:{defaultLayer:{features:n.features}}},i=new fm(r,e.x,e.y,e.z);t(i)}})):((t,e)=>{qt(Vt(jt({},t),{method:"GET"}),e)})(Xm(Wm({},r),{url:o}),((r,n)=>{if(r||!n){const r=new fm({layers:{defaultLayer:{features:[]}}},e.x,e.y,e.z);t(r)}else{const r=JSON.parse(n),i=new fm({layers:{defaultLayer:{features:r}}},e.x,e.y,e.z);t(i)}}))}))},new Promise(((t,e)=>{var r=t=>{try{s(a.next(t))}catch(t){e(t)}},n=t=>{try{s(a.throw(t))}catch(t){e(t)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,n);s((a=a.apply(i,o)).next())}));var i,o,a};var qm=Ym;function Ym(t,e){this.x=t,this.y=e}Ym.prototype={clone:function(){return new Ym(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,i=r*this.x+e*this.y;return this.x=n,this.y=i,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.x+r*(this.x-e.x)-n*(this.y-e.y),o=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ym.convert=function(t){return t instanceof Ym?t:Array.isArray(t)?new Ym(t[0],t[1]):t};var Km=qm,$m=Qm;function Qm(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(Jm,this,e)}function Jm(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){var r=t.readVarint()+t.pos;for(;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function tg(t){for(var e,r,n=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],n+=((r=t[a]).x-e.x)*(e.y+r.y);return n}Qm.types=["Unknown","Point","LineString","Polygon"],Qm.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,i=0,o=0,a=0,s=[];t.pos<r;){if(i<=0){var l=t.readVarint();n=7&l,i=l>>3}if(i--,1===n||2===n)o+=t.readSVarint(),a+=t.readSVarint(),1===n&&(e&&s.push(e),e=[]),e.push(new Km(o,a));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&s.push(e),s},Qm.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(n<=0){var c=t.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<l&&(l=o),o>u&&(u=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,s,u]},Qm.prototype.toGeoJSON=function(t,e,r){var n,i,o=this.extent*Math.pow(2,r),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),u=Qm.types[this.type];function c(t){for(var e=0;e<t.length;e++){var r=t[e],n=180-360*(r.y+s)/o;t[e]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];c(l=h);break;case 2:for(n=0;n<l.length;n++)c(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],o=0;o<e;o++){var a=tg(t[o]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(r&&i.push(r),r=[t[o]]):r.push(t[o]))}r&&i.push(r);return i}(l),n=0;n<l.length;n++)for(i=0;i<l[n].length;i++)c(l[n][i])}1===l.length?l=l[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var eg=$m,rg=ng;function ng(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ig,this,e),this.length=this._features.length}function ig(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){var e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(r))}ng.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new eg(this._pbf,e,this.extent,this._keys,this._values)};var og=rg,ag=function(t,e){this.layers=t.readFields(sg,{},e)};function sg(t,e,r){if(3===t){var n=new og(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}var lg=ag,ug={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(t,e,r,n,i){var o,a,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?i-1:0,p=r?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),o-=u}return(d?-1:1)*a*Math.pow(2,o-n)},write:function(t,e,r,n,i,o){var a,s,l,u=8*o-i-1,c=(1<<u)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,f=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*l-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[r+d]=255&s,d+=f,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;t[r+d]=255&a,d+=f,a/=256,u-=8);t[r+d-f]|=128*m}},cg=pg,hg=ug;function pg(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}pg.Varint=0,pg.Fixed64=1,pg.Bytes=2,pg.Fixed32=5;var dg=4294967296,fg=1/dg,mg="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");function gg(t){return t.type===pg.Bytes?t.readVarint()+t.pos:t.pos+1}function _g(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function vg(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function yg(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function xg(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function bg(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Eg(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Tg(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Sg(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function Ag(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function wg(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function Cg(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function Rg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Lg(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function Ig(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}pg.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Rg(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Ig(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Rg(this.buf,this.pos)+Rg(this.buf,this.pos+4)*dg;return this.pos+=8,t},readSFixed64:function(){var t=Rg(this.buf,this.pos)+Ig(this.buf,this.pos+4)*dg;return this.pos+=8,t},readFloat:function(){var t=hg.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=hg.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,o=r.buf;if(i=o[r.pos++],n=(112&i)>>4,i<128)return _g(t,n,e);if(i=o[r.pos++],n|=(127&i)<<3,i<128)return _g(t,n,e);if(i=o[r.pos++],n|=(127&i)<<10,i<128)return _g(t,n,e);if(i=o[r.pos++],n|=(127&i)<<17,i<128)return _g(t,n,e);if(i=o[r.pos++],n|=(127&i)<<24,i<128)return _g(t,n,e);if(i=o[r.pos++],n|=(1&i)<<31,i<128)return _g(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&mg?function(t,e,r){return mg.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){var n="",i=e;for(;i<r;){var o,a,s,l=t[i],u=null,c=l>239?4:l>223?3:l>191?2:1;if(i+c>r)break;1===c?l<128&&(u=l):2===c?128==(192&(o=t[i+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&((u=(15&l)<<12|(63&o)<<6|63&a)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),i+=c}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==pg.Bytes)return t.push(this.readVarint(e));var r=gg(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==pg.Bytes)return t.push(this.readSVarint());var e=gg(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==pg.Bytes)return t.push(this.readBoolean());var e=gg(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==pg.Bytes)return t.push(this.readFloat());var e=gg(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==pg.Bytes)return t.push(this.readDouble());var e=gg(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==pg.Bytes)return t.push(this.readFixed32());var e=gg(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==pg.Bytes)return t.push(this.readSFixed32());var e=gg(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==pg.Bytes)return t.push(this.readFixed64());var e=gg(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==pg.Bytes)return t.push(this.readSFixed64());var e=gg(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===pg.Varint)for(;this.buf[this.pos++]>127;);else if(e===pg.Bytes)this.pos=this.readVarint()+this.pos;else if(e===pg.Fixed32)this.pos+=4;else{if(e!==pg.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Lg(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Lg(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Lg(this.buf,-1&t,this.pos),Lg(this.buf,Math.floor(t*fg),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Lg(this.buf,-1&t,this.pos),Lg(this.buf,Math.floor(t*fg),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;if(e.buf[e.pos++]|=r|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){n>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&vg(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),hg.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),hg.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&vg(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,pg.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,yg,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,xg,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Tg,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,bg,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Eg,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Sg,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Ag,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,wg,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Cg,e)},writeBytesField:function(t,e){this.writeTag(t,pg.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,pg.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,pg.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,pg.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,pg.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,pg.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,pg.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,pg.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,pg.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,pg.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Mg=Object.defineProperty,Og=Object.defineProperties,Pg=Object.getOwnPropertyDescriptors,Dg=Object.getOwnPropertySymbols,Bg=Object.prototype.hasOwnProperty,Ng=Object.prototype.propertyIsEnumerable,Fg=(t,e,r)=>e in t?Mg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kg=(t,e)=>{for(var r in e||(e={}))Bg.call(e,r)&&Fg(t,r,e[r]);if(Dg)for(var r of Dg(e))Ng.call(e,r)&&Fg(t,r,e[r]);return t},Ug=class{constructor(t,e,r,n){this.vectorLayerCache={},this.x=e,this.y=r,this.z=n,this.vectorTile=new lg(new cg(t))}getTileData(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];const e=this.vectorTile.layers[t];if(Array.isArray(e.features))return this.vectorLayerCache[t]=e.features,e.features;const r=[];for(let t=0;t<e.length;t++){const o=e.feature(t).toGeoJSON(this.x,this.y,this.z);r.push((n=kg({},o),i={properties:kg({id:o.id},o.properties)},Og(n,Pg(i))))}var n,i;return this.vectorLayerCache[t]=r,r}getFeatureById(){throw new Error("Method not implemented.")}},zg=Object.defineProperty,Gg=Object.defineProperties,jg=Object.getOwnPropertyDescriptors,Vg=Object.getOwnPropertySymbols,Hg=Object.prototype.hasOwnProperty,Wg=Object.prototype.propertyIsEnumerable,Xg=(t,e,r)=>e in t?zg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zg=(t,e)=>{for(var r in e||(e={}))Hg.call(e,r)&&Xg(t,r,e[r]);if(Vg)for(var r of Vg(e))Wg.call(e,r)&&Xg(t,r,e[r]);return t},qg=(t,e)=>Gg(t,jg(e)),Yg={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},Kg=(t,e,r,n,i)=>{return o=void 0,a=null,s=function*(){const o=mf(t,e);return new Promise((t=>{if(i)i({x:r.x,y:r.y,z:r.z},((e,n)=>{if(e||!n)t(void 0);else{const e=new Ug(n,r.x,r.y,r.z);t(e)}}));else{const e=Yt(qg(Zg({},n),{url:o}),((e,n)=>{if(e||!n)t(void 0);else{const e=new Ug(n,r.x,r.y,r.z);t(e)}}));r.xhrCancel=()=>e.cancel()}}))},new Promise(((t,e)=>{var r=t=>{try{i(s.next(t))}catch(t){e(t)}},n=t=>{try{i(s.throw(t))}catch(t){e(t)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,n);i((s=s.apply(o,a)).next())}));var o,a,s};function $g(t,e){const{width:r,height:n}=e[0],i=e.map((t=>t.rasterData)),o=r*n,a=[],s=JSON.stringify(t);for(let t=0;t<o;t++){const e=JSON.parse(s),r=Qg(e,i,t);if("number"==typeof r)a.push(r);else{const t=Jg(e);a.push(t)}}return a}function Qg(t,e,r){if(2===t.length&&"band"===t[0]&&"number"==typeof t[1])try{return e[t[1]][r]}catch(t){return console.warn("Raster Data err!"),0}t.map(((n,i)=>{if(Array.isArray(n)&&n.length>0)if("band"===n[0])try{t[i]=e[n[1]][r]}catch(e){console.warn("Raster Data err!"),t[i]=0}else Qg(n,e,r)}))}function Jg(t){const e=function(t){const[e,r=-1,n=-1]=t;return void 0===e?(console.warn("Express err!"),["+",0,0]):[e.replace(/\s+/g,""),r,n]}(t),r=e[0];let n=e[1],i=e[2];return Array.isArray(n)&&(n=Jg(t[1])),Array.isArray(i)&&(i=Jg(t[2])),function(t,e,r){switch(t){case"+":return e+r;case"-":return e-r;case"*":return e*r;case"/":return e/r;case"%":return e%r;case"^":return Math.pow(e,r);case"abs":return Math.abs(e);case"floor":return Math.floor(e);case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"sin":return Math.sin(e);case"cos":return Math.cos(e);case"atan":return-1===r?Math.atan(e):Math.atan2(e,r);case"min":return Math.min(e,r);case"max":return Math.max(e,r);case"log10":return Math.log(e);case"log2":return Math.log2(e);default:return console.warn("Calculate symbol err! Return default 0"),0}}(r,n,i)}var t_={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:function(t,e){const r=t[0].rasterData,n=t[1].rasterData,i=t[2].rasterData,o=[],[a,s]=(null==e?void 0:e.countCut)||[2,98],l=(null==e?void 0:e.RMinMax)||e_(r,a,s),u=(null==e?void 0:e.GMinMax)||e_(n,a,s),c=(null==e?void 0:e.BMinMax)||e_(i,a,s);for(let t=0;t<r.length;t++)o.push(Math.max(0,r[t]-l[0])),o.push(Math.max(0,n[t]-u[0])),o.push(Math.max(0,i[t]-c[0]));return{rasterData:o,rMinMax:l,gMinMax:u,bMinMax:c}}}};function e_(t,e,r){const n=t.slice().sort(((t,e)=>t-e)),i=n.length;return[n[Math.ceil(i*e/100)],n[Math.ceil(i*r/100)]]}var r_=Object.defineProperty,n_=Object.defineProperties,i_=Object.getOwnPropertyDescriptors,o_=Object.getOwnPropertySymbols,a_=Object.prototype.hasOwnProperty,s_=Object.prototype.propertyIsEnumerable,l_=(t,e,r)=>e in t?r_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,u_=(t,e)=>{for(var r in e||(e={}))a_.call(e,r)&&l_(t,r,e[r]);if(o_)for(var r of o_(e))s_.call(e,r)&&l_(t,r,e[r]);return t},c_=(t,e)=>n_(t,i_(e)),h_=(t,e,r)=>new Promise(((n,i)=>{var o=t=>{try{s(r.next(t))}catch(t){i(t)}},a=t=>{try{s(r.throw(t))}catch(t){i(t)}},s=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,a);s((r=r.apply(t,e)).next())}));function p_(t,e,r){return h_(this,null,(function*(){if(0===t.length)return{rasterData:[0],width:1,heigh:1};const n=yield Promise.all(t.map((({data:t,bands:r=[0]})=>e(t,r)))),i=[];n.forEach((t=>{Array.isArray(t)?i.push(...t):i.push(t)}));const{width:o,height:a}=i[0];let s;switch(typeof r){case"function":s=r(i);break;case"object":s=Array.isArray(r)?{rasterData:$g(r,i)}:function(t,e){const r=t_[t.type];if("function"===r.type)return r.method(e,null==t?void 0:t.options);if("operation"===r.type)return"rgb"===t.type?function(t,e){void 0===t.r&&console.warn("Channel R lost in Operation! Use band[0] to fill!");void 0===t.g&&console.warn("Channel G lost in Operation! Use band[0] to fill!");void 0===t.b&&console.warn("Channel B lost in Operation! Use band[0] to fill!");const r=$g(t.r||["band",0],e),n=$g(t.g||["band",0],e),i=$g(t.b||["band",0],e);return[r,n,i]}(r.expression,e):{rasterData:$g(r.expression,e)}}(r,i);break;default:s={rasterData:i[0].rasterData}}return c_(u_({},s),{width:o,height:a})}))}function d_(t,e,r,n){return h_(this,null,(function*(){const i=yield p_(t,e,r);n(null,{data:i})}))}function f_(t){return f_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f_(t)}function m_(t){var e=function(t,e){if("object"!=f_(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=f_(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==f_(e)?e:e+""}function g_(t,e,r){return(e=m_(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function __(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function v_(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?__(Object(r),!0).forEach((function(e){g_(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):__(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}let y_=function(t){return t.Normal="normal",t.PostProcessing="post-processing",t}({}),x_=function(t){return t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.MAX_EXT=32776]="MAX_EXT",t[t.MIN_EXT=32775]="MIN_EXT",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.CULL_FACE=2884]="CULL_FACE",t[t.BLEND=3042]="BLEND",t[t.DITHER=3024]="DITHER",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.TEXTURE1=33985]="TEXTURE1",t[t.TEXTURE2=33986]="TEXTURE2",t[t.TEXTURE3=33987]="TEXTURE3",t[t.TEXTURE4=33988]="TEXTURE4",t[t.TEXTURE5=33989]="TEXTURE5",t[t.TEXTURE6=33990]="TEXTURE6",t[t.TEXTURE7=33991]="TEXTURE7",t[t.TEXTURE8=33992]="TEXTURE8",t[t.TEXTURE9=33993]="TEXTURE9",t[t.TEXTURE10=33994]="TEXTURE10",t[t.TEXTURE11=33995]="TEXTURE11",t[t.TEXTURE12=33996]="TEXTURE12",t[t.TEXTURE13=33997]="TEXTURE13",t[t.TEXTURE14=33998]="TEXTURE14",t[t.TEXTURE15=33999]="TEXTURE15",t[t.TEXTURE16=34e3]="TEXTURE16",t[t.TEXTURE17=34001]="TEXTURE17",t[t.TEXTURE18=34002]="TEXTURE18",t[t.TEXTURE19=34003]="TEXTURE19",t[t.TEXTURE20=34004]="TEXTURE20",t[t.TEXTURE21=34005]="TEXTURE21",t[t.TEXTURE22=34006]="TEXTURE22",t[t.TEXTURE23=34007]="TEXTURE23",t[t.TEXTURE24=34008]="TEXTURE24",t[t.TEXTURE25=34009]="TEXTURE25",t[t.TEXTURE26=34010]="TEXTURE26",t[t.TEXTURE27=34011]="TEXTURE27",t[t.TEXTURE28=34012]="TEXTURE28",t[t.TEXTURE29=34013]="TEXTURE29",t[t.TEXTURE30=34014]="TEXTURE30",t[t.TEXTURE31=34015]="TEXTURE31",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t}({});const{camelCase:b_,isNil:E_,upperFirst:T_}=ld;class S_{constructor(){g_(this,"shaderModuleService",void 0),g_(this,"rendererService",void 0),g_(this,"config",void 0),g_(this,"quad","attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}"),g_(this,"enabled",!0),g_(this,"renderToScreen",!1),g_(this,"model",void 0),g_(this,"name",void 0),g_(this,"optionsToUpdate",{})}getName(){return this.name}setName(t){this.name=t}getType(){return y_.PostProcessing}init(t,e){this.config=e,this.rendererService=t.getContainer().rendererService,this.shaderModuleService=t.getContainer().shaderModuleService;const{createAttribute:r,createBuffer:n,createModel:i}=this.rendererService,{vs:o,fs:a,uniforms:s}=this.setupShaders();this.model=i({vs:o,fs:a,attributes:{a_Position:r({buffer:n({data:[-4,-4,4,-4,0,4],type:x_.FLOAT}),size:2})},uniforms:v_(v_({u_Texture:null},s),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}render(t,e){const r=t.multiPassRenderer.getPostProcessor(),{useFramebuffer:n,getViewportSize:i,clear:o}=this.rendererService,{width:a,height:s}=i();n(this.renderToScreen?null:r.getWriteFBO(),(()=>{o({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});const t=v_({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[a,s]},this.convertOptionsToUniforms(this.optionsToUpdate));e&&(t.u_BloomFinal=1,t.u_Texture2=e),this.model.draw({uniforms:t})}))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}setRenderToScreen(t){this.renderToScreen=t}updateOptions(t){this.optionsToUpdate=v_(v_({},this.optionsToUpdate),t)}setupShaders(){throw new Error("Method not implemented.")}convertOptionsToUniforms(t){const e={};return Object.keys(t).forEach((r=>{E_(t[r])||(e[`u_${T_(b_(r))}`]=t[r])})),e}}const A_=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function w_(t,e=!1){const r={};return t=t.replace(A_,((t,n,i)=>{const o=i.split(":"),a=o[0].trim();let s="";switch(o.length>1&&(s=o[1].trim()),n){case"bool":s="true"===s;break;case"float":case"int":s=Number(s);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":s=s?s.replace("[","").replace("]","").split(",").reduce(((t,e)=>(t.push(Number(e.trim())),t)),[]):new Array(function(t){let e=0;switch(t){case"vec2":case"ivec2":e=2;break;case"vec3":case"ivec3":e=3;break;case"vec4":case"ivec4":case"mat2":e=4;break;case"mat3":e=9;break;case"mat4":e=16}return e}(n)).fill(0)}return r[a]=s,`${e?"uniform ":""}${n} ${a};\n`})),{content:t,uniforms:r}}function C_(t){let{content:e,uniforms:r}=w_(t,!0);return e=e.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,((t,e,n)=>{n=n.trim().replace(/^.*$/gm,(t=>`uniform ${t}`));const{content:i,uniforms:o}=w_(n);return Object.assign(r,o),`${e}{\n${i}\n};`})),{content:e,uniforms:r}}function R_(t){const e={};return t.replace(A_,((t,r,n)=>{const i=n.trim();return e[i]?"":(e[i]=!0,`uniform ${r} ${i};\n`)}))}const L_="u_ProjectionMatrix",I_="u_ViewMatrix",M_="u_ViewProjectionMatrix",O_="u_Zoom",P_="u_ZoomScale",D_="u_FocalDistance",B_="u_CameraPosition";let N_=function(t){return t.TOPRIGHT="topright",t.TOPLEFT="topleft",t.BOTTOMRIGHT="bottomright",t.BOTTOMLEFT="bottomleft",t.TOPCENTER="topcenter",t.BOTTOMCENTER="bottomcenter",t.LEFTCENTER="leftcenter",t.RIGHTCENTER="rightcenter",t.LEFTTOP="lefttop",t.RIGHTTOP="righttop",t.LEFTBOTTOM="leftbottom",t.RIGHTBOTTOM="rightbottom",t}({}),F_=function(t){return t[t.LNGLAT=1]="LNGLAT",t[t.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",t[t.VECTOR_TILE=3]="VECTOR_TILE",t[t.IDENTITY=4]="IDENTITY",t[t.METER_OFFSET=5]="METER_OFFSET",t}({});const k_="u_CoordinateSystem",U_="u_ViewportCenter",z_="u_ViewportCenterProjection",G_="u_PixelsPerDegree",j_="u_PixelsPerDegree2",V_="u_PixelsPerMeter";var H_="layerInitStart",W_="layerInitEnd",X_="sourceInitStart",Z_="sourceInitEnd",q_="scaleInitStart",Y_="scaleInitEnd",K_="mappingStart",$_="mappingEnd",Q_="buildModelStart",J_="buildModelEnd";let tv=function(t){return t.Hover="hover",t.Click="click",t.Select="select",t.Active="active",t.Drag="drag",t}({}),ev=function(t){return t.normal="normal",t.additive="additive",t.subtractive="subtractive",t.min="min",t.max="max",t.none="none",t}({}),rv=function(t){return t.MULTIPLE="MULTIPLE",t.SINGLE="SINGLE",t}({}),nv=function(t){return t.AND="and",t.OR="or",t}({}),iv=function(t){return t.INIT="init",t.UPDATE="update",t}({}),ov=function(t){return t.LINEAR="linear",t.SEQUENTIAL="sequential",t.POWER="power",t.LOG="log",t.IDENTITY="identity",t.TIME="time",t.QUANTILE="quantile",t.QUANTIZE="quantize",t.THRESHOLD="threshold",t.CAT="cat",t.DIVERGING="diverging",t.CUSTOM="threshold",t}({}),av=function(t){return t.CONSTANT="constant",t.VARIABLE="variable",t}({}),sv=function(t){return t[t.Attribute=0]="Attribute",t[t.InstancedAttribute=1]="InstancedAttribute",t[t.Uniform=2]="Uniform",t}({});const lv=["mapload","mapchange","mapAfterFrameChange"];var uv={exports:{}};uv.exports=hv,uv.exports.default=hv;var cv=1e20;function hv(t,e,r,n,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=n||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=r||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function pv(t,e,r,n,i,o){for(var a=0;a<e;a++)dv(t,a,e,r,n,i,o);for(var s=0;s<r;s++)dv(t,s*e,1,e,n,i,o)}function dv(t,e,r,n,i,o,a){var s,l,u,c;for(o[0]=0,a[0]=-cv,a[1]=cv,s=0;s<n;s++)i[s]=t[e+s*r];for(s=1,l=0,u=0;s<n;s++){do{c=o[l],u=(i[s]-i[c]+s*s-c*c)/(s-c)/2}while(u<=a[l]&&--l>-1);o[++l]=s,a[l]=u,a[l+1]=cv}for(s=0,l=0;s<n;s++){for(;a[l+1]<s;)l++;c=o[l],t[e+s*r]=i[c]+(s-c)*(s-c)}}hv.prototype._draw=function(t,e){var r,n,i,o,a,s,l,u,c,h=this.ctx.measureText(t),p=h.width,d=2*this.buffer;e&&this.useMetrics?(a=Math.floor(h.actualBoundingBoxAscent),u=this.buffer+Math.ceil(h.actualBoundingBoxAscent),s=this.buffer,l=this.buffer,r=(n=Math.min(this.size,Math.ceil(h.actualBoundingBoxRight-h.actualBoundingBoxLeft)))+d,i=(o=Math.min(this.size-s,Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)))+d,this.ctx.textBaseline="alphabetic"):(r=n=this.size,i=o=this.size,a=19*this.fontSize/24,s=l=0,u=this.middle,this.ctx.textBaseline="middle"),n&&o&&(this.ctx.clearRect(l,s,n,o),this.ctx.fillText(t,this.buffer,u),c=this.ctx.getImageData(l,s,n,o));var f=new Uint8ClampedArray(r*i);return function(t,e,r,n,i,o,a){o.fill(cv,0,e*r),a.fill(0,0,e*r);for(var s=(e-n)/2,l=0;l<i;l++)for(var u=0;u<n;u++){var c=(l+s)*e+u+s,h=t.data[4*(l*n+u)+3]/255;if(1===h)o[c]=0,a[c]=cv;else if(0===h)o[c]=cv,a[c]=0;else{var p=Math.max(0,.5-h),d=Math.max(0,h-.5);o[c]=p*p,a[c]=d*d}}}(c,r,i,n,o,this.gridOuter,this.gridInner),pv(this.gridOuter,r,i,this.f,this.v,this.z),pv(this.gridInner,r,i,this.f,this.v,this.z),function(t,e,r,n,i,o,a){for(var s=0;s<e*r;s++){var l=Math.sqrt(n[s])-Math.sqrt(i[s]);t[s]=Math.round(255-255*(l/o+a))}}(f,r,i,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:f,metrics:{width:n,height:o,sdfWidth:r,sdfHeight:i,top:a,left:0,advance:p}}},hv.prototype.draw=function(t){return this._draw(t,!1).data},hv.prototype.drawWithMetrics=function(t){return this._draw(t,!0)};var fv=uv.exports;function mv(t,e,r){for(const n of e){const{icon:e,xOffset:i}=n;t[e.id]=v_(v_({},e),{},{x:i,y:r,image:e.image,width:e.width,height:e.height})}}function gv(t){return Math.pow(2,Math.ceil(Math.log2(t)))}const _v=function(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}();function vv(t,e,r,n){t.font=`${n} ${r}px ${e}`,t.fillStyle="black",t.textBaseline="middle"}function yv(t,e){for(let r=0;r<t.length;r++)e.data[4*r+3]=t[r]}class xv extends Vd.exports.EventEmitter{constructor(...t){super(...t),g_(this,"fontAtlas",void 0),g_(this,"iconFontMap",void 0),g_(this,"iconFontGlyphs",{}),g_(this,"fontOptions",void 0),g_(this,"key",void 0),g_(this,"cache",new kd(3))}get scale(){return 1}get canvas(){const t=this.cache.get(this.key);return t&&t.data}get mapping(){const t=this.cache.get(this.key);return t&&t.mapping||{}}getCanvasByKey(t){const e=this.cache.get(t);return e&&e.data}getMappingByKey(t){const e=this.cache.get(t);return e&&e.mapping||{}}init(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:_v,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}addIconGlyphs(t){t.forEach((t=>{this.iconFontGlyphs[t.name]=t.unicode}))}addIconFont(t,e){this.iconFontMap.set(t,e)}getIconFontKey(t){return this.iconFontMap.get(t)||t}getGlyph(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}setFontOptions(t){this.fontOptions=v_(v_({},this.fontOptions),t),this.key=this.getKey();const e=this.getNewChars(this.key,this.fontOptions.characterSet),r=this.cache.get(this.key);if(r&&0===e.length)return;const n=this.generateFontAtlas(this.key,e,r);this.fontAtlas=n,this.cache.set(this.key,n)}addFontFace(t,e){const r=document.createElement("style");r.type="text/css",r.innerText=`\n        @font-face{\n            font-family: '${t}';\n            src: url('${e}') format('woff2'),\n            url('${e}') format('woff'),\n            url('${e}') format('truetype');\n        }`,r.onload=()=>{if(document.fonts)try{document.fonts.load(`24px ${t}`,"L7text"),document.fonts.ready.then((()=>{this.emit("fontloaded",{fontFamily:t})}))}catch(t){console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(t)}},document.getElementsByTagName("head")[0].appendChild(r)}destroy(){this.cache.clear(),this.iconFontMap.clear()}generateFontAtlas(t,e,r){const{fontFamily:n,fontWeight:i,fontSize:o,buffer:a,sdf:s,radius:l,cutoff:u,iconfont:c}=this.fontOptions;let h=r&&r.data;h||(h=window.document.createElement("canvas"),h.width=1024);const p=h.getContext("2d",{willReadFrequently:!0});vv(p,n,o,i);const{mapping:d,canvasHeight:f,xOffset:m,yOffset:g}=function({characterSet:t,getFontWidth:e,fontHeight:r,buffer:n,maxCanvasWidth:i,mapping:o={},xOffset:a=0,yOffset:s=0}){let l=0,u=a;Array.from(t).forEach(((t,r)=>{if(!o[t]){const n=e(t,r);u+30>i&&(u=0,l++),o[t]={x:u,y:s+30*l,width:30,height:30,advance:n},u+=30}}));const c=r+2*n;return{mapping:o,xOffset:u,yOffset:s+l*c,canvasHeight:gv(s+(l+1)*c)}}(v_({getFontWidth:t=>p.measureText(t).width,fontHeight:1*o,buffer:a,characterSet:e,maxCanvasWidth:1024},r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset})),_=p.getImageData(0,0,h.width,h.height);if(h.height=f,p.putImageData(_,0,0),vv(p,n,o,i),s){const t=new fv(o,a,l,u,n,i),r=p.getImageData(0,0,t.size,t.size);for(const n of e){if(c){const e=String.fromCharCode(parseInt(n.replace("&#x","").replace(";",""),16));yv(t.draw(e),r)}else yv(t.draw(n),r);p.putImageData(r,d[n].x,d[n].y)}}else for(const t of e)p.fillText(t,d[t].x,d[t].y+1*o);return{xOffset:m,yOffset:g,mapping:d,data:h,width:h.width,height:h.height}}getKey(){const{fontFamily:t,fontWeight:e}=this.fontOptions;return`${t}_${e}`}getNewChars(t,e){const r=this.cache.get(t);if(!r)return e;const n=[],i=r.mapping,o=new Set(Object.keys(i));return new Set(e).forEach((t=>{o.has(t)||n.push(t)})),n}}function bv(t,e,r,n,i,o,a){try{var s=t[o](a),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(n,i)}function Ev(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){bv(o,n,i,a,s,"next",t)}function s(t){bv(o,n,i,a,s,"throw",t)}a(void 0)}))}}class Tv extends Vd.exports.EventEmitter{constructor(...t){super(...t),g_(this,"canvasHeight",128),g_(this,"texture",void 0),g_(this,"canvas",void 0),g_(this,"iconData",void 0),g_(this,"iconMap",void 0),g_(this,"ctx",void 0),g_(this,"loadingImageCount",0)}isLoading(){return 0===this.loadingImageCount}init(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}addImage(t,e){var r=this;return Ev((function*(){let n=new Image;r.loadingImageCount++,r.hasImage(t)?console.warn("Image Id already exists"):r.iconData.push({id:t,size:64}),r.updateIconMap(),n=yield r.loadImage(e);const i=r.iconData.find((e=>e.id===t));i&&(i.image=n,i.width=n.width,i.height=n.height),r.update()}))()}addImageMini(t,e,r){const n=r.getSceneConfig().canvas;let i=n.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:64}),this.updateIconMap(),this.loadImageMini(e,n).then((e=>{i=e;const r=this.iconData.find((e=>e.id===t));r&&(r.image=i,r.width=i.width,r.height=i.height),this.update()}))}getTexture(){return this.texture}getIconMap(){return this.iconMap}getCanvas(){return this.canvas}hasImage(t){return this.iconMap.hasOwnProperty(t)}removeImage(t){this.hasImage(t)&&(this.iconData=this.iconData.filter((e=>e.id!==t)),delete this.iconMap[t],this.update())}destroy(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}loadImage(t){return new Promise(((e,r)=>{if(t instanceof HTMLImageElement)return void e(t);const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{e(n)},n.onerror=()=>{r(new Error("Could not load image at "+t))},n.src=t instanceof File?URL.createObjectURL(t):t}))}update(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}updateIconAtlas(){this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((t=>{const{x:e,y:r,image:n,width:i=64,height:o=64}=this.iconMap[t],a=Math.max(i,o)/64,s=o/a,l=i/a;n&&this.ctx.drawImage(n,e+(64-l)/2,r+(64-s)/2,l,s)}))}updateIconMap(){const{mapping:t,canvasHeight:e}=function(t,e,r){let n=0,i=0,o=0,a=[];const s={};for(const l of t)if(!s[l.id]){const{size:t}=l;n+t+e>r&&(mv(s,a,i),n=0,i=o+i+e,o=0,a=[]),a.push({icon:l,xOffset:n}),n=n+t+e,o=Math.max(o,t)}return a.length>0&&mv(s,a,i),{mapping:s,canvasHeight:gv(o+i+e)}}(this.iconData,3,1024);this.iconMap=t,this.canvasHeight=e}loadImageMini(t,e){return new Promise(((r,n)=>{const i=e.createImage();i.crossOrigin="anonymous",i.onload=()=>{r(i)},i.onerror=()=>{n(new Error("Could not load image at "+t))},i.src=t}))}}var Sv=1e-6,Av="undefined"!=typeof Float32Array?Float32Array:Array;function wv(){var t=new Av(16);return Av!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Cv(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Rv(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],_=e[15],v=r*s-n*a,y=r*l-i*a,x=r*u-o*a,b=n*l-i*s,E=n*u-o*s,T=i*u-o*l,S=c*m-h*f,A=c*g-p*f,w=c*_-d*f,C=h*g-p*m,R=h*_-d*m,L=p*_-d*g,I=v*L-y*R+x*C+b*w-E*A+T*S;return I?(I=1/I,t[0]=(s*L-l*R+u*C)*I,t[1]=(i*R-n*L-o*C)*I,t[2]=(m*T-g*E+_*b)*I,t[3]=(p*E-h*T-d*b)*I,t[4]=(l*w-a*L-u*A)*I,t[5]=(r*L-i*w+o*A)*I,t[6]=(g*x-f*T-_*y)*I,t[7]=(c*T-p*x+d*y)*I,t[8]=(a*R-s*w+u*S)*I,t[9]=(n*w-r*R-o*S)*I,t[10]=(f*E-m*x+_*v)*I,t[11]=(h*x-c*E-d*v)*I,t[12]=(s*A-a*C-l*S)*I,t[13]=(r*C-n*A+i*S)*I,t[14]=(m*y-f*b-g*v)*I,t[15]=(c*b-h*y+p*v)*I,t):null}function Lv(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],g=e[13],_=e[14],v=e[15],y=r[0],x=r[1],b=r[2],E=r[3];return t[0]=y*n+x*s+b*h+E*m,t[1]=y*i+x*l+b*p+E*g,t[2]=y*o+x*u+b*d+E*_,t[3]=y*a+x*c+b*f+E*v,y=r[4],x=r[5],b=r[6],E=r[7],t[4]=y*n+x*s+b*h+E*m,t[5]=y*i+x*l+b*p+E*g,t[6]=y*o+x*u+b*d+E*_,t[7]=y*a+x*c+b*f+E*v,y=r[8],x=r[9],b=r[10],E=r[11],t[8]=y*n+x*s+b*h+E*m,t[9]=y*i+x*l+b*p+E*g,t[10]=y*o+x*u+b*d+E*_,t[11]=y*a+x*c+b*f+E*v,y=r[12],x=r[13],b=r[14],E=r[15],t[12]=y*n+x*s+b*h+E*m,t[13]=y*i+x*l+b*p+E*g,t[14]=y*o+x*u+b*d+E*_,t[15]=y*a+x*c+b*f+E*v,t}function Iv(t,e,r){var n,i,o,a,s,l,u,c,h,p,d,f,m=r[0],g=r[1],_=r[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*_+e[12],t[13]=e[1]*m+e[5]*g+e[9]*_+e[13],t[14]=e[2]*m+e[6]*g+e[10]*_+e[14],t[15]=e[3]*m+e[7]*g+e[11]*_+e[15]):(n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=n*m+s*g+h*_+e[12],t[13]=i*m+l*g+p*_+e[13],t[14]=o*m+u*g+d*_+e[14],t[15]=a*m+c*g+f*_+e[15]),t}function Mv(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ov(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+u*n,t[5]=a*i+c*n,t[6]=s*i+h*n,t[7]=l*i+p*n,t[8]=u*i-o*n,t[9]=c*i-a*n,t[10]=h*i-s*n,t[11]=p*i-l*n,t}function Pv(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],l=e[3],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-u*n,t[1]=a*i-c*n,t[2]=s*i-h*n,t[3]=l*i-p*n,t[8]=o*n+u*i,t[9]=a*n+c*i,t[10]=s*n+h*i,t[11]=l*n+p*i,t}function Dv(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+u*n,t[1]=a*i+c*n,t[2]=s*i+h*n,t[3]=l*i+p*n,t[4]=u*i-o*n,t[5]=c*i-a*n,t[6]=h*i-s*n,t[7]=p*i-l*n,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Bv=function(t,e,r,n,i){var o,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(n-i),t[10]=(i+n)*o,t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t};function Nv(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],p=t[10],d=t[11],f=t[12],m=t[13],g=t[14],_=t[15],v=e[0],y=e[1],x=e[2],b=e[3],E=e[4],T=e[5],S=e[6],A=e[7],w=e[8],C=e[9],R=e[10],L=e[11],I=e[12],M=e[13],O=e[14],P=e[15];return Math.abs(r-v)<=Sv*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-y)<=Sv*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-x)<=Sv*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-b)<=Sv*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-E)<=Sv*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(s-T)<=Sv*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(l-S)<=Sv*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(u-A)<=Sv*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-w)<=Sv*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(h-C)<=Sv*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-R)<=Sv*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(d-L)<=Sv*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(f-I)<=Sv*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(m-M)<=Sv*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(g-O)<=Sv*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(_-P)<=Sv*Math.max(1,Math.abs(_),Math.abs(P))}function Fv(){var t=new Av(3);return Av!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function kv(t,e,r){var n=new Av(3);return n[0]=t,n[1]=e,n[2]=r,n}function Uv(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function zv(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/a,t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,t}function Gv(t,e){var r=t[0],n=t[1],i=t[2],o=e[0],a=e[1],s=e[2],l=Math.sqrt(r*r+n*n+i*i)*Math.sqrt(o*o+a*a+s*s),u=l&&function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(t,e)/l;return Math.acos(Math.min(Math.max(u,-1),1))}var jv=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t};function Vv(){var t=new Av(4);return Av!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Hv(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}function Wv(){var t=new Av(2);return Av!=Float32Array&&(t[0]=0,t[1]=0),t}function Xv(t,e){var r=new Av(2);return r[0]=t,r[1]=e,r}function Zv(t,e){return t[0]=e[0],t[1]=e[1],t}function qv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Yv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Kv(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function $v(t,e){return t[0]*e[0]+t[1]*e[1]}Fv(),function(){var t=Vv()}();var Qv=Yv;!function(){var t=Wv()}();class Jv{constructor(){g_(this,"viewport",void 0),g_(this,"overridedViewProjectionMatrix",void 0),g_(this,"viewMatrixInverse",void 0),g_(this,"cameraPosition",void 0)}init(){}update(t){this.viewport=t,this.viewMatrixInverse=wv(),Rv(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}getProjectionMatrix(){return this.viewport.getProjectionMatrix()}getModelMatrix(){return this.viewport.getModelMatrix()}getViewMatrix(){return this.viewport.getViewMatrix()}getViewMatrixUncentered(){return this.viewport.getViewMatrixUncentered()}getViewProjectionMatrixUncentered(){return this.viewport.getViewProjectionMatrixUncentered()}getViewProjectionMatrix(){return this.overridedViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}getZoom(){return this.viewport.getZoom()}getZoomScale(){return this.viewport.getZoomScale()}getCenter(){const[t,e]=this.viewport.getCenter();return[t,e]}getFocalDistance(){return this.viewport.getFocalDistance()}getCameraPosition(){return this.cameraPosition}projectFlat(t,e){return this.viewport.projectFlat(t,e)}setViewProjectionMatrix(t){this.overridedViewProjectionMatrix=t}}const ty={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"};class ey{constructor(){g_(this,"container",void 0),g_(this,"controlCorners",void 0),g_(this,"controlContainer",void 0),g_(this,"scene",void 0),g_(this,"mapsService",void 0),g_(this,"controls",[]),g_(this,"unAddControls",[])}init(t,e){this.container=t.container,this.scene=e,this.mapsService=e.mapService,this.initControlPos()}addControl(t,e){e.mapService.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}getControlByName(t){return this.controls.find((e=>e.controlOption.name===t))}removeControl(t){const e=this.controls.indexOf(t);return e>-1&&this.controls.splice(e,1),t.remove(),this}addControls(){this.unAddControls.forEach((t=>{t.addTo(this.scene),this.controls.push(t)})),this.unAddControls=[]}destroy(){for(const t of this.controls)t.remove();this.controls=[],this.clearControlPos()}initControlPos(){const t=this.controlCorners={},e=this.controlContainer=pd("div","l7-control-container",this.container);Object.values(N_).forEach((r=>{var n;!function(r=[]){const n=r.map((t=>"l7-"+t)).join(" ");t[r.filter((t=>!["row","column"].includes(t))).join("")]=pd("div",n,e)}((n=r,[...n.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),ty[n]]))})),this.checkCornerOverlap()}clearControlPos(){for(const t in this.controlCorners)this.controlCorners[t]&&dd(this.controlCorners[t]);this.controlContainer&&dd(this.controlContainer)}checkCornerOverlap(){const t=window.MutationObserver;if(t)for(const e of Object.keys(this.controlCorners)){const r=e.match(/^(top|bottom)(left|right)$/);if(r){const[,e,n]=r,i=this.controlCorners[`${e}${n}`];new t((([{target:t}])=>{i&&(i.style[e]=t.clientHeight+"px")})).observe(this.controlCorners[`${n}${e}`],{childList:!0,attributes:!0})}}}}class ry{constructor(){g_(this,"container",void 0),g_(this,"scene",void 0),g_(this,"mapsService",void 0),g_(this,"markers",[]),g_(this,"markerLayers",[]),g_(this,"unAddMarkers",[]),g_(this,"unAddMarkerLayers",[])}addMarkerLayer(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}removeMarkerLayer(t){t.destroy(),this.markerLayers.indexOf(t);const e=this.markerLayers.indexOf(t);e>-1&&this.markerLayers.splice(e,1)}addMarker(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}addMarkers(){this.unAddMarkers.forEach((t=>{t.addTo(this.scene),this.markers.push(t)})),this.unAddMarkers=[]}addMarkerLayers(){this.unAddMarkerLayers.forEach((t=>{this.markerLayers.push(t),t.addTo(this.scene)})),this.unAddMarkers=[]}removeMarker(t){t.remove(),this.markers.indexOf(t);const e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}removeAllMarkers(){this.destroy()}init(t){this.scene=t,this.mapsService=t.mapService}destroy(){this.markers.forEach((t=>{t.remove()})),this.markers=[],this.markerLayers.forEach((t=>{t.destroy()})),this.markerLayers=[]}removeMakerLayerMarker(t){t.destroy()}}class ny{constructor(){g_(this,"scene",void 0),g_(this,"mapsService",void 0),g_(this,"popups",[]),g_(this,"unAddPopups",[])}get isMarkerReady(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}removePopup(t){null!=t&&t.isOpen()&&t.remove();const e=this.popups.indexOf(t);e>-1&&this.popups.splice(e,1);const r=this.unAddPopups.indexOf(t);r>-1&&this.unAddPopups.splice(r,1)}destroy(){this.popups.forEach((t=>t.remove()))}addPopup(t){t&&t.getOptions().autoClose&&[...this.popups,...this.unAddPopups].forEach((t=>{t.getOptions().autoClose&&this.removePopup(t)})),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",(()=>{this.removePopup(t)}))}initPopup(){this.unAddPopups.length&&this.unAddPopups.forEach((t=>{this.addPopup(t),this.unAddPopups=[]}))}init(t){this.scene=t,this.mapsService=t.mapService}}const iy={MapToken:"您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定 高德地图申请地址 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox地图申请地址 https://docs.mapbox.com/help/glossary/access-token/",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},{merge:oy}=ld,ay={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},sy={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:nv.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0};const ly=Math.PI/180,uy=4003e4;function cy({latitude:t=0,zoom:e=0,scale:r,highPrecision:n=!1,flipY:i=!1}){const o={},a=512*(r=void 0!==r?r:Math.pow(2,e)),s=Math.cos(t*ly),l=a/360,u=l/s,c=a/uy/s;if(o.pixelsPerMeter=[c,-c,c],o.metersPerPixel=[1/c,-1/c,1/c],o.pixelsPerDegree=[l,-u,c],o.degreesPerPixel=[1/l,-1/u,1/c],n){const e=ly*Math.tan(t*ly)/s,r=l*e/2,n=a/uy*e,h=n/u*c;o.pixelsPerDegree2=[0,-r,n],o.pixelsPerMeter2=[h,0,h],i&&(o.pixelsPerDegree2[1]=-o.pixelsPerDegree2[1],o.pixelsPerMeter2[1]=-o.pixelsPerMeter2[1])}return i&&(o.pixelsPerMeter[1]=-o.pixelsPerMeter[1],o.metersPerPixel[1]=-o.metersPerPixel[1],o.pixelsPerDegree[1]=-o.pixelsPerDegree[1],o.degreesPerPixel[1]=-o.degreesPerPixel[1]),o}const hy=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];class py{constructor(t){g_(this,"needRefresh",!0),g_(this,"coordinateSystem",void 0),g_(this,"viewportCenter",void 0),g_(this,"viewportCenterProjection",void 0),g_(this,"pixelsPerDegree",void 0),g_(this,"pixelsPerDegree2",void 0),g_(this,"pixelsPerMeter",void 0),this.cameraService=t}refresh(t){const e=this.cameraService.getZoom(),r=t||this.cameraService.getCenter(),{pixelsPerMeter:n,pixelsPerDegree:i}=cy({latitude:r[1],zoom:e});this.viewportCenter=r,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=n,this.pixelsPerDegree=i,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===F_.LNGLAT?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===F_.LNGLAT_OFFSET&&this.calculateLnglatOffset(r,e),this.needRefresh=!1}getCoordinateSystem(){return this.coordinateSystem}setCoordinateSystem(t){this.coordinateSystem=t}getViewportCenter(){return this.viewportCenter}getViewportCenterProjection(){return this.viewportCenterProjection}getPixelsPerDegree(){return this.pixelsPerDegree}getPixelsPerDegree2(){return this.pixelsPerDegree2}getPixelsPerMeter(){return this.pixelsPerMeter}calculateLnglatOffset(t,e,r,n){const{pixelsPerMeter:i,pixelsPerDegree:o,pixelsPerDegree2:a}=cy({latitude:t[1],zoom:e,scale:r,flipY:n,highPrecision:!0});let s=this.cameraService.getViewMatrix();const l=this.cameraService.getProjectionMatrix();let u=Lv([],l,s);const c=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,e));this.viewportCenterProjection=Hv([],[c[0],c[1],0,1],u),s=this.cameraService.getViewMatrixUncentered()||s,u=Lv([],l,s),u=Lv([],u,hy),this.cameraService.setViewProjectionMatrix(u),this.pixelsPerMeter=i,this.pixelsPerDegree=o,this.pixelsPerDegree2=a}}class dy extends Vd.exports.EventEmitter{constructor(...t){super(...t),g_(this,"renderMap",new Map),g_(this,"enable",!1),g_(this,"renderEnable",!1),g_(this,"cacheLogs",{})}setEnable(t){this.enable=!!t}log(t,e){if(!this.enable)return;const r=t.split(".");let n=null;r.forEach(((t,i)=>{null!==n?(n[t]||(n[t]={}),i!==r.length-1&&(n=n[t])):(this.cacheLogs[t]||(this.cacheLogs[t]={}),i!==r.length-1&&(n=this.cacheLogs[t])),i===r.length-1&&(n[t]=v_(v_({time:Date.now()},n[t]),e))}))}getLog(t){switch(typeof t){case"string":return this.cacheLogs[t];case"object":return t.map((t=>this.cacheLogs[t])).filter((t=>void 0!==t));case"undefined":return this.cacheLogs}}removeLog(t){delete this.cacheLogs[t]}generateRenderUid(){return this.renderEnable?"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})):""}renderDebug(t){this.renderEnable=t}renderStart(t){if(!this.renderEnable||!this.enable)return;const e=this.renderMap.get(t)||{};this.renderMap.set(t,v_(v_({},e),{},{renderUid:t,renderStart:Date.now()}))}renderEnd(t){if(!this.renderEnable||!this.enable)return;const e=this.renderMap.get(t);if(e){const r=e.renderStart,n=Date.now();this.emit("renderEnd",v_(v_({},e),{},{renderEnd:n,renderDuration:n-r})),this.renderMap.delete(t)}}destroy(){this.cacheLogs=null,this.renderMap.clear()}}var fy={exports:{}};
/*! Hammer.JS - v2.0.7 - 2016-04-22
     * http://hammerjs.github.io/
     *
     * Copyright (c) 2016 Jorik Tangelder;
     * Licensed under the MIT license */!function(t){!function(e,r,n,i){var o,a=["","webkit","Moz","MS","ms","o"],s=r.createElement("div"),l="function",u=Math.round,c=Math.abs,h=Date.now;function p(t,e,r){return setTimeout(y(t,r),e)}function d(t,e,r){return!!Array.isArray(t)&&(f(t,r[e],r),!0)}function f(t,e,r){var n;if(t)if(t.forEach)t.forEach(e,r);else if(t.length!==i)for(n=0;n<t.length;)e.call(r,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(r,t[n],n,t)}function m(t,r,n){var i="DEPRECATED METHOD: "+r+"\n"+n+" AT \n";return function(){var r=new Error("get-stack-trace"),n=r&&r.stack?r.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=e.console&&(e.console.warn||e.console.log);return o&&o.call(e.console,i,n),t.apply(this,arguments)}}o="function"!=typeof Object.assign?function(t){if(t===i||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var n=arguments[r];if(n!==i&&null!==n)for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])}return e}:Object.assign;var g=m((function(t,e,r){for(var n=Object.keys(e),o=0;o<n.length;)(!r||r&&t[n[o]]===i)&&(t[n[o]]=e[n[o]]),o++;return t}),"extend","Use `assign`."),_=m((function(t,e){return g(t,e,!0)}),"merge","Use `assign`.");function v(t,e,r){var n,i=e.prototype;(n=t.prototype=Object.create(i)).constructor=t,n._super=i,r&&o(n,r)}function y(t,e){return function(){return t.apply(e,arguments)}}function x(t,e){return typeof t==l?t.apply(e&&e[0]||i,e):t}function b(t,e){return t===i?e:t}function E(t,e,r){f(w(e),(function(e){t.addEventListener(e,r,!1)}))}function T(t,e,r){f(w(e),(function(e){t.removeEventListener(e,r,!1)}))}function S(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function A(t,e){return t.indexOf(e)>-1}function w(t){return t.trim().split(/\s+/g)}function C(t,e,r){if(t.indexOf&&!r)return t.indexOf(e);for(var n=0;n<t.length;){if(r&&t[n][r]==e||!r&&t[n]===e)return n;n++}return-1}function R(t){return Array.prototype.slice.call(t,0)}function L(t,e,r){for(var n=[],i=[],o=0;o<t.length;){var a=e?t[o][e]:t[o];C(i,a)<0&&n.push(t[o]),i[o]=a,o++}return r&&(n=e?n.sort((function(t,r){return t[e]>r[e]})):n.sort()),n}function I(t,e){for(var r,n,o=e[0].toUpperCase()+e.slice(1),s=0;s<a.length;){if((n=(r=a[s])?r+o:e)in t)return n;s++}return i}var M=1;function O(t){var r=t.ownerDocument||t;return r.defaultView||r.parentWindow||e}var P="ontouchstart"in e,D=I(e,"PointerEvent")!==i,B=P&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),N="touch",F="mouse",k=25,U=1,z=4,G=8,j=1,V=2,H=4,W=8,X=16,Z=V|H,q=W|X,Y=Z|q,K=["x","y"],$=["clientX","clientY"];function Q(t,e){var r=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){x(t.options.enable,[t])&&r.handler(e)},this.init()}function J(t,e,r){var n=r.pointers.length,o=r.changedPointers.length,a=e&U&&n-o==0,s=e&(z|G)&&n-o==0;r.isFirst=!!a,r.isFinal=!!s,a&&(t.session={}),r.eventType=e,function(t,e){var r=t.session,n=e.pointers,o=n.length;r.firstInput||(r.firstInput=tt(e));o>1&&!r.firstMultiple?r.firstMultiple=tt(e):1===o&&(r.firstMultiple=!1);var a=r.firstInput,s=r.firstMultiple,l=s?s.center:a.center,u=e.center=et(n);e.timeStamp=h(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=ot(l,u),e.distance=it(l,u),function(t,e){var r=e.center,n=t.offsetDelta||{},i=t.prevDelta||{},o=t.prevInput||{};e.eventType!==U&&o.eventType!==z||(i=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=t.offsetDelta={x:r.x,y:r.y});e.deltaX=i.x+(r.x-n.x),e.deltaY=i.y+(r.y-n.y)}(r,e),e.offsetDirection=nt(e.deltaX,e.deltaY);var p=rt(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=p.x,e.overallVelocityY=p.y,e.overallVelocity=c(p.x)>c(p.y)?p.x:p.y,e.scale=s?(d=s.pointers,f=n,it(f[0],f[1],$)/it(d[0],d[1],$)):1,e.rotation=s?function(t,e){return ot(e[1],e[0],$)+ot(t[1],t[0],$)}(s.pointers,n):0,e.maxPointers=r.prevInput?e.pointers.length>r.prevInput.maxPointers?e.pointers.length:r.prevInput.maxPointers:e.pointers.length,function(t,e){var r,n,o,a,s=t.lastInterval||e,l=e.timeStamp-s.timeStamp;if(e.eventType!=G&&(l>k||s.velocity===i)){var u=e.deltaX-s.deltaX,h=e.deltaY-s.deltaY,p=rt(l,u,h);n=p.x,o=p.y,r=c(p.x)>c(p.y)?p.x:p.y,a=nt(u,h),t.lastInterval=e}else r=s.velocity,n=s.velocityX,o=s.velocityY,a=s.direction;e.velocity=r,e.velocityX=n,e.velocityY=o,e.direction=a}(r,e);var d,f;var m=t.element;S(e.srcEvent.target,m)&&(m=e.srcEvent.target);e.target=m}(t,r),t.emit("hammer.input",r),t.recognize(r),t.session.prevInput=r}function tt(t){for(var e=[],r=0;r<t.pointers.length;)e[r]={clientX:u(t.pointers[r].clientX),clientY:u(t.pointers[r].clientY)},r++;return{timeStamp:h(),pointers:e,center:et(e),deltaX:t.deltaX,deltaY:t.deltaY}}function et(t){var e=t.length;if(1===e)return{x:u(t[0].clientX),y:u(t[0].clientY)};for(var r=0,n=0,i=0;i<e;)r+=t[i].clientX,n+=t[i].clientY,i++;return{x:u(r/e),y:u(n/e)}}function rt(t,e,r){return{x:e/t||0,y:r/t||0}}function nt(t,e){return t===e?j:c(t)>=c(e)?t<0?V:H:e<0?W:X}function it(t,e,r){r||(r=K);var n=e[r[0]]-t[r[0]],i=e[r[1]]-t[r[1]];return Math.sqrt(n*n+i*i)}function ot(t,e,r){r||(r=K);var n=e[r[0]]-t[r[0]],i=e[r[1]]-t[r[1]];return 180*Math.atan2(i,n)/Math.PI}Q.prototype={handler:function(){},init:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(O(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(O(this.element),this.evWin,this.domHandler)}};var at={mousedown:U,mousemove:2,mouseup:z},st="mousedown",lt="mousemove mouseup";function ut(){this.evEl=st,this.evWin=lt,this.pressed=!1,Q.apply(this,arguments)}v(ut,Q,{handler:function(t){var e=at[t.type];e&U&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=z),this.pressed&&(e&z&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:F,srcEvent:t}))}});var ct={pointerdown:U,pointermove:2,pointerup:z,pointercancel:G,pointerout:G},ht={2:N,3:"pen",4:F,5:"kinect"},pt="pointerdown",dt="pointermove pointerup pointercancel";function ft(){this.evEl=pt,this.evWin=dt,Q.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}e.MSPointerEvent&&!e.PointerEvent&&(pt="MSPointerDown",dt="MSPointerMove MSPointerUp MSPointerCancel"),v(ft,Q,{handler:function(t){var e=this.store,r=!1,n=t.type.toLowerCase().replace("ms",""),i=ct[n],o=ht[t.pointerType]||t.pointerType,a=o==N,s=C(e,t.pointerId,"pointerId");i&U&&(0===t.button||a)?s<0&&(e.push(t),s=e.length-1):i&(z|G)&&(r=!0),s<0||(e[s]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),r&&e.splice(s,1))}});var mt={touchstart:U,touchmove:2,touchend:z,touchcancel:G};function gt(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,Q.apply(this,arguments)}function _t(t,e){var r=R(t.touches),n=R(t.changedTouches);return e&(z|G)&&(r=L(r.concat(n),"identifier",!0)),[r,n]}v(gt,Q,{handler:function(t){var e=mt[t.type];if(e===U&&(this.started=!0),this.started){var r=_t.call(this,t,e);e&(z|G)&&r[0].length-r[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:r[0],changedPointers:r[1],pointerType:N,srcEvent:t})}}});var vt={touchstart:U,touchmove:2,touchend:z,touchcancel:G},yt="touchstart touchmove touchend touchcancel";function xt(){this.evTarget=yt,this.targetIds={},Q.apply(this,arguments)}function bt(t,e){var r=R(t.touches),n=this.targetIds;if(e&(2|U)&&1===r.length)return n[r[0].identifier]=!0,[r,r];var i,o,a=R(t.changedTouches),s=[],l=this.target;if(o=r.filter((function(t){return S(t.target,l)})),e===U)for(i=0;i<o.length;)n[o[i].identifier]=!0,i++;for(i=0;i<a.length;)n[a[i].identifier]&&s.push(a[i]),e&(z|G)&&delete n[a[i].identifier],i++;return s.length?[L(o.concat(s),"identifier",!0),s]:void 0}v(xt,Q,{handler:function(t){var e=vt[t.type],r=bt.call(this,t,e);r&&this.callback(this.manager,e,{pointers:r[0],changedPointers:r[1],pointerType:N,srcEvent:t})}});var Et=2500;function Tt(){Q.apply(this,arguments);var t=y(this.handler,this);this.touch=new xt(this.manager,t),this.mouse=new ut(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function St(t,e){t&U?(this.primaryTouch=e.changedPointers[0].identifier,At.call(this,e)):t&(z|G)&&At.call(this,e)}function At(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var r={x:e.clientX,y:e.clientY};this.lastTouches.push(r);var n=this.lastTouches;setTimeout((function(){var t=n.indexOf(r);t>-1&&n.splice(t,1)}),Et)}}function wt(t){for(var e=t.srcEvent.clientX,r=t.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var i=this.lastTouches[n],o=Math.abs(e-i.x),a=Math.abs(r-i.y);if(o<=25&&a<=25)return!0}return!1}v(Tt,Q,{handler:function(t,e,r){var n=r.pointerType==N,i=r.pointerType==F;if(!(i&&r.sourceCapabilities&&r.sourceCapabilities.firesTouchEvents)){if(n)St.call(this,e,r);else if(i&&wt.call(this,r))return;this.callback(t,e,r)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ct=I(s.style,"touchAction"),Rt=Ct!==i,Lt="compute",It="auto",Mt="manipulation",Ot="none",Pt="pan-x",Dt="pan-y",Bt=function(){if(!Rt)return!1;var t={},r=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){t[n]=!r||e.CSS.supports("touch-action",n)})),t}();function Nt(t,e){this.manager=t,this.set(e)}Nt.prototype={set:function(t){t==Lt&&(t=this.compute()),Rt&&this.manager.element.style&&Bt[t]&&(this.manager.element.style[Ct]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return f(this.manager.recognizers,(function(e){x(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(A(t,Ot))return Ot;var e=A(t,Pt),r=A(t,Dt);if(e&&r)return Ot;if(e||r)return e?Pt:Dt;if(A(t,Mt))return Mt;return It}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,r=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var n=this.actions,i=A(n,Ot)&&!Bt[Ot],o=A(n,Dt)&&!Bt[Dt],a=A(n,Pt)&&!Bt[Pt];if(i){var s=1===t.pointers.length,l=t.distance<2,u=t.deltaTime<250;if(s&&l&&u)return}if(!a||!o)return i||o&&r&Z||a&&r&q?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Ft=1,kt=32;function Ut(t){this.options=o({},this.defaults,t||{}),this.id=M++,this.manager=null,this.options.enable=b(this.options.enable,!0),this.state=Ft,this.simultaneous={},this.requireFail=[]}function zt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function Gt(t){return t==X?"down":t==W?"up":t==V?"left":t==H?"right":""}function jt(t,e){var r=e.manager;return r?r.get(t):t}function Vt(){Ut.apply(this,arguments)}function Ht(){Vt.apply(this,arguments),this.pX=null,this.pY=null}function Wt(){Vt.apply(this,arguments)}function Xt(){Ut.apply(this,arguments),this._timer=null,this._input=null}function Zt(){Vt.apply(this,arguments)}function qt(){Vt.apply(this,arguments)}function Yt(){Ut.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Kt(t,e){return(e=e||{}).recognizers=b(e.recognizers,Kt.defaults.preset),new $t(t,e)}Ut.prototype={defaults:{},set:function(t){return o(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(d(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=jt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return d(t,"dropRecognizeWith",this)||(t=jt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(d(t,"requireFailure",this))return this;var e=this.requireFail;return-1===C(e,t=jt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(d(t,"dropRequireFailure",this))return this;t=jt(t,this);var e=C(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,r=this.state;function n(r){e.manager.emit(r,t)}r<8&&n(e.options.event+zt(r)),n(e.options.event),t.additionalEvent&&n(t.additionalEvent),r>=8&&n(e.options.event+zt(r))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=kt},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(kt|Ft)))return!1;t++}return!0},recognize:function(t){var e=o({},t);if(!x(this.options.enable,[this,e]))return this.reset(),void(this.state=kt);56&this.state&&(this.state=Ft),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},v(Vt,Ut,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,r=t.eventType,n=6&e,i=this.attrTest(t);return n&&(r&G||!i)?16|e:n||i?r&z?8|e:2&e?4|e:2:kt}}),v(Ht,Vt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Y},getTouchAction:function(){var t=this.options.direction,e=[];return t&Z&&e.push(Dt),t&q&&e.push(Pt),e},directionTest:function(t){var e=this.options,r=!0,n=t.distance,i=t.direction,o=t.deltaX,a=t.deltaY;return i&e.direction||(e.direction&Z?(i=0===o?j:o<0?V:H,r=o!=this.pX,n=Math.abs(t.deltaX)):(i=0===a?j:a<0?W:X,r=a!=this.pY,n=Math.abs(t.deltaY))),t.direction=i,r&&n>e.threshold&&i&e.direction},attrTest:function(t){return Vt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Gt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),v(Wt,Vt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ot]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),v(Xt,Ut,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[It]},process:function(t){var e=this.options,r=t.pointers.length===e.pointers,n=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!n||!r||t.eventType&(z|G)&&!i)this.reset();else if(t.eventType&U)this.reset(),this._timer=p((function(){this.state=8,this.tryEmit()}),e.time,this);else if(t.eventType&z)return 8;return kt},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&t.eventType&z?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=h(),this.manager.emit(this.options.event,this._input)))}}),v(Zt,Vt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ot]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),v(qt,Vt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Z|q,pointers:1},getTouchAction:function(){return Ht.prototype.getTouchAction.call(this)},attrTest:function(t){var e,r=this.options.direction;return r&(Z|q)?e=t.overallVelocity:r&Z?e=t.overallVelocityX:r&q&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&r&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&c(e)>this.options.velocity&&t.eventType&z},emit:function(t){var e=Gt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),v(Yt,Ut,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Mt]},process:function(t){var e=this.options,r=t.pointers.length===e.pointers,n=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),t.eventType&U&&0===this.count)return this.failTimeout();if(n&&i&&r){if(t.eventType!=z)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||it(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=p((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return kt},failTimeout:function(){return this._timer=p((function(){this.state=kt}),this.options.interval,this),kt},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Kt.VERSION="2.0.7",Kt.defaults={domEvents:!1,touchAction:Lt,enable:!0,inputTarget:null,inputClass:null,preset:[[Zt,{enable:!1}],[Wt,{enable:!1},["rotate"]],[qt,{direction:Z}],[Ht,{direction:Z},["swipe"]],[Yt],[Yt,{event:"doubletap",taps:2},["tap"]],[Xt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function $t(t,e){var r;this.options=o({},Kt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((r=this).options.inputClass||(D?ft:B?xt:P?Tt:ut))(r,J),this.touchAction=new Nt(this,this.options.touchAction),Qt(this,!0),f(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Qt(t,e){var r,n=t.element;n.style&&(f(t.options.cssProps,(function(i,o){r=I(n.style,o),e?(t.oldCssProps[r]=n.style[r],n.style[r]=i):n.style[r]=t.oldCssProps[r]||""})),e||(t.oldCssProps={}))}$t.prototype={set:function(t){return o(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var r;this.touchAction.preventDefaults(t);var n=this.recognizers,i=e.curRecognizer;(!i||i&&8&i.state)&&(i=e.curRecognizer=null);for(var o=0;o<n.length;)r=n[o],2===e.stopped||i&&r!=i&&!r.canRecognizeWith(i)?r.reset():r.recognize(t),!i&&14&r.state&&(i=e.curRecognizer=r),o++}},get:function(t){if(t instanceof Ut)return t;for(var e=this.recognizers,r=0;r<e.length;r++)if(e[r].options.event==t)return e[r];return null},add:function(t){if(d(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(d(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,r=C(e,t);-1!==r&&(e.splice(r,1),this.touchAction.update())}return this},on:function(t,e){if(t!==i&&e!==i){var r=this.handlers;return f(w(t),(function(t){r[t]=r[t]||[],r[t].push(e)})),this}},off:function(t,e){if(t!==i){var r=this.handlers;return f(w(t),(function(t){e?r[t]&&r[t].splice(C(r[t],e),1):delete r[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var n=r.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},destroy:function(){this.element&&Qt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},o(Kt,{INPUT_START:U,INPUT_MOVE:2,INPUT_END:z,INPUT_CANCEL:G,STATE_POSSIBLE:Ft,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:kt,DIRECTION_NONE:j,DIRECTION_LEFT:V,DIRECTION_RIGHT:H,DIRECTION_UP:W,DIRECTION_DOWN:X,DIRECTION_HORIZONTAL:Z,DIRECTION_VERTICAL:q,DIRECTION_ALL:Y,Manager:$t,Input:Q,TouchAction:Nt,TouchInput:xt,MouseInput:ut,PointerEventInput:ft,TouchMouseInput:Tt,SingleTouchInput:gt,Recognizer:Ut,AttrRecognizer:Vt,Tap:Yt,Pan:Ht,Swipe:qt,Pinch:Wt,Rotate:Zt,Press:Xt,on:E,off:T,each:f,merge:_,extend:g,assign:o,inherit:v,bindFn:y,prefixed:I}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=Kt,"function"==typeof i&&i.amd?i((function(){return Kt})):t.exports?t.exports=Kt:e.Hammer=Kt}(window,document)}(fy);var gy=fy.exports;const _y={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"};class vy extends Hd{get mapService(){return this.container.mapService}constructor(t){super(),g_(this,"indragging",!1),g_(this,"hammertime",void 0),g_(this,"lastClickTime",0),g_(this,"lastClickXY",[-1,-1]),g_(this,"clickTimer",void 0),g_(this,"$containter",void 0),g_(this,"onDrag",(t=>{const e=this.interactionEvent(t);e.type=_y[e.type],"dragging"===e.type?this.indragging=!0:this.indragging=!1,this.emit(tv.Drag,e)})),g_(this,"onHammer",(t=>{t.srcEvent.stopPropagation();const e=this.interactionEvent(t);this.emit(tv.Hover,e)})),g_(this,"onTouch",(t=>{const e=t.touches[0];this.onHover({clientX:e.clientX,clientY:e.clientY,type:"touchstart"})})),g_(this,"onTouchEnd",(t=>{if(t.changedTouches.length>0){const e=t.changedTouches[0];this.onHover({clientX:e.clientX,clientY:e.clientY,type:"touchend"})}})),g_(this,"onTouchMove",(t=>{const e=t.changedTouches[0];this.onHover({clientX:e.clientX,clientY:e.clientY,type:"touchmove"})})),g_(this,"onHover",(t=>{const{clientX:e,clientY:r}=t;let n=e,i=r;const o=t.type,a=this.mapService.getMapContainer();if(a){const{top:t,left:e}=a.getBoundingClientRect();n=n-e-a.clientLeft,i=i-t-a.clientTop}const s=this.mapService.containerToLngLat([n,i]);"click"!==o&&"touch"!==o?"click"!==o&&"dblclick"!==o&&this.emit(tv.Hover,{x:n,y:i,lngLat:s,type:o,target:t}):this.isDoubleTap(n,i,s)})),this.container=t}init(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}destroy(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(tv.Hover)}triggerHover({x:t,y:e}){this.emit(tv.Hover,{x:t,y:e})}triggerSelect(t){this.emit(tv.Select,{featureId:t})}triggerActive(t){this.emit(tv.Active,{featureId:t})}addEventListenerOnMap(){const t=this.mapService.getMapContainer();if(t){const e=new gy.Manager(t);e.add(new gy.Tap({event:"dblclick",taps:2})),e.add(new gy.Tap({event:"click"})),e.add(new gy.Pan({threshold:0,pointers:0})),e.add(new gy.Press({})),e.on("dblclick click",this.onHammer),e.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("touchstart",this.onTouch),t.addEventListener("touchend",this.onTouchEnd),t.addEventListener("mousemove",this.onHover),t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=e}}removeEventListenerOnMap(){const t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("touchstart",this.onTouch),t.removeEventListener("touchend",this.onTouchEnd),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}interactionEvent(t){const{type:e,pointerType:r}=t;let n,i;"touch"===r?(i=Math.floor(t.pointers[0].clientY),n=Math.floor(t.pointers[0].clientX)):(i=Math.floor(t.srcEvent.y),n=Math.floor(t.srcEvent.x));const o=this.mapService.getMapContainer();if(o){const{top:t,left:e}=o.getBoundingClientRect();n-=e,i-=t}return{x:n,y:i,lngLat:this.mapService.containerToLngLat([n,i]),type:e,target:t.srcEvent}}isDoubleTap(t,e,r){const n=(new Date).getTime();let i="click";n-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-e)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),i="dblclick",this.emit(tv.Hover,{x:t,y:e,lngLat:r,type:i})):(this.lastClickTime=n,this.lastClickXY=[t,e],this.clickTimer=setTimeout((()=>{i="click",this.emit(tv.Hover,{x:t,y:e,lngLat:r,type:i})}),400))}}let yy=0;let xy=function(t){return t[t.SAMPLED=0]="SAMPLED",t[t.RENDER_TARGET=1]="RENDER_TARGET",t}({});class by{constructor(t){var e=this;g_(this,"pickedColors",void 0),g_(this,"pickedTileLayers",[]),g_(this,"pickingFBO",void 0),g_(this,"width",0),g_(this,"height",0),g_(this,"alreadyInPicking",!1),g_(this,"pickBufferScale",1),g_(this,"pickFromPickingFBO",function(){var t=Ev((function*(t,{x:r,y:n,lngLat:i,type:o,target:a}){var s;let l=!1;const{readPixels:u,readPixelsAsync:c,getViewportSize:h,queryVerdorInfo:p}=e.rendererService,{width:d,height:f}=h(),{enableHighlight:m,enableSelect:g}=t.getLayerConfig(),_=r*yd,v=n*yd;if(_>d-1*yd||_<0||v>f-1*yd||v<0)return!1;let y;if(y="WebGPU"===p()?yield c({x:Math.floor(_/e.pickBufferScale),y:Math.floor((f-(n+1)*yd)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}):u({x:Math.floor(_/e.pickBufferScale),y:Math.floor((f-(n+1)*yd)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}),e.pickedColors=y,0!==y[0]||0!==y[1]||0!==y[2]){const s=Pe(y),u=t.layerPickService.getFeatureById(s);s!==t.getCurrentPickId()&&"mousemove"===o&&(o="mouseenter");const c={x:r,y:n,type:o,lngLat:i,featureId:s,feature:u,target:a};u&&(l=!0,t.setCurrentPickId(s),e.triggerHoverOnLayer(t,c))}else{const s={x:r,y:n,lngLat:i,type:null!==t.getCurrentPickId()&&"mousemove"===o?"mouseout":"un"+o,featureId:null,target:a,feature:null};e.triggerHoverOnLayer(t,v_(v_({},s),{},{type:"unpick"})),e.triggerHoverOnLayer(t,s),t.setCurrentPickId(null)}if(m&&t.layerPickService.highlightPickedFeature(y),g&&"click"===o&&(null===(s=y)||void 0===s?void 0:s.toString())!==[0,0,0,0].toString()){const e=Pe(y);null===t.getCurrentSelectedId()||e!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature(y),t.setCurrentSelectedId(e)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return l}));return function(e,r){return t.apply(this,arguments)}}()),this.container=t}get mapService(){return this.container.mapService}get rendererService(){return this.container.rendererService}get configService(){return this.container.globalConfigService}get interactionService(){return this.container.interactionService}get layerService(){return this.container.layerService}init(t){const{createTexture2D:e,createFramebuffer:r,getViewportSize:n}=this.rendererService;let{width:i,height:o}=n();this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,i=Math.round(i/this.pickBufferScale),o=Math.round(o/this.pickBufferScale);const a=e({width:i,height:o,usage:xy.RENDER_TARGET,label:"Picking Texture"});this.pickingFBO=r({color:a,depth:!0,width:i,height:o}),this.interactionService.on(tv.Hover,this.pickingAllLayer.bind(this))}boxPickLayer(t,e,r){var n=this;return Ev((function*(){const{useFramebufferAsync:i,clear:o}=n.rendererService;n.resizePickingFBO(),t.hooks.beforePickingEncode.call(),yield i(n.pickingFBO,Ev((function*(){o({framebuffer:n.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.renderModels({ispick:!0})}))),t.hooks.afterPickingEncode.call();const a=yield n.pickBox(t,e);r(a)}))()}pickBox(t,e){var r=this;return Ev((function*(){const[n,i,o,a]=e.map((t=>{const e=t<0?0:t;return Math.floor(e*yd/r.pickBufferScale)})),{readPixelsAsync:s,getViewportSize:l}=r.rendererService,{width:u,height:c}=l();if(n>(u-1)*yd/r.pickBufferScale||o<0||i>(c-1)*yd/r.pickBufferScale||a<0)return[];const h=Math.min(u/r.pickBufferScale,o)-n,p=Math.min(c/r.pickBufferScale,a)-i,d=yield s({x:n,y:Math.floor(c/r.pickBufferScale-(a+1)),width:h,height:p,data:new Uint8Array(h*p*4),framebuffer:r.pickingFBO}),f=[],m={};for(let e=0;e<d.length/4;e+=1){const r=Pe(d.slice(4*e,4*e+4));if(-1!==r&&!m[r]){const e=t.layerPickService.getFeatureById(r);f.push(v_(v_({},e),{},{pickedFeatureIdx:r})),m[r]=!0}}return f}))()}handleCursor(t,e){const{cursor:r="",cursorEnabled:n}=t.getLayerConfig();if(n){const t="amap"===this.mapService.getType()?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),n=null==t?void 0:t.style.getPropertyValue("cursor");"unmousemove"===e&&""!==n?null==t||t.style.setProperty("cursor",""):"mousemove"===e&&(null==t||t.style.setProperty("cursor",r))}}destroy(){this.pickingFBO.destroy(),this.pickingFBO=null}pickingAllLayer(t){var e=this;return Ev((function*(){e.layerService.needPick(t.type)&&e.isPickingAllLayer()&&(e.alreadyInPicking=!0,yield e.pickingLayers(t),e.layerService.renderLayers(),e.alreadyInPicking=!1)}))()}isPickingAllLayer(){return!this.alreadyInPicking&&(!this.layerService.alreadyInRendering&&(!this.interactionService.indragging&&!!this.layerService.getShaderPickStat()))}resizePickingFBO(){const{getViewportSize:t}=this.rendererService,{width:e,height:r}=t();this.width===e&&this.height===r||(this.pickingFBO.resize({width:Math.round(e/this.pickBufferScale),height:Math.round(r/this.pickBufferScale)}),this.width=e,this.height=r)}pickingLayers(t){var e=this;return Ev((function*(){const{clear:r,useFramebufferAsync:n}=e.rendererService;e.resizePickingFBO();const i=e.layerService.getRenderList();for(const o of i.filter((e=>e.needPick(t.type))).reverse()){yield n(e.pickingFBO,Ev((function*(){r({framebuffer:e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.layerPickService.pickRender(t)})));const i=yield e.pickFromPickingFBO(o,t);if(e.layerService.pickedLayerId=i?+o.id:-1,i&&!o.getLayerConfig().enablePropagation)break}}))()}triggerHoverOnLayer(t,e){(function(t){var e;let r=!0;if((null==t||null===(e=t.target)||void 0===e?void 0:e.target)instanceof HTMLElement){var n;let e=null==t||null===(n=t.target)||void 0===n?void 0:n.target;for(;e;){var i;const t=Array.from(e.classList);if(t.includes("l7-marker")||t.includes("l7-popup")){r=!1;break}e=null===(i=e)||void 0===i?void 0:i.parentElement}}return r})(e)&&(this.handleCursor(t,e.type),t.emit(e.type,e))}}class Ey{constructor(t=!0){g_(this,"autoStart",void 0),g_(this,"startTime",0),g_(this,"oldTime",0),g_(this,"running",!1),g_(this,"elapsedTime",0),this.autoStart=t}start(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}const{throttle:Ty}=ld;class Sy extends Vd.exports.EventEmitter{get renderService(){return this.container.rendererService}get mapService(){return this.container.mapService}get debugService(){return this.container.debugService}constructor(t){super(),g_(this,"pickedLayerId",-1),g_(this,"clock",new Ey),g_(this,"alreadyInRendering",!1),g_(this,"layers",[]),g_(this,"layerList",[]),g_(this,"layerRenderID",void 0),g_(this,"sceneInited",!1),g_(this,"animateInstanceCount",0),g_(this,"shaderPicking",!0),g_(this,"enableRender",!0),g_(this,"reRender",Ty((()=>{this.renderLayers()}),32)),g_(this,"throttleRenderLayers",Ty((()=>{this.renderLayers()}),16)),this.container=t}needPick(t){return this.updateLayerRenderList(),this.layerList.some((e=>e.needPick(t)))}add(t){this.layers.push(t),this.sceneInited&&t.init().then((()=>{this.renderLayers()}))}addMask(t){this.sceneInited&&t.init().then((()=>{this.renderLayers()}))}initLayers(){var t=this;return Ev((function*(){t.sceneInited=!0,t.layers.forEach(function(){var e=Ev((function*(e){e.startInit||(yield e.init(),t.updateLayerRenderList())}));return function(t){return e.apply(this,arguments)}}())}))()}getSceneInited(){return this.sceneInited}getRenderList(){return this.layerList}getLayers(){return this.layers}getLayer(t){return this.layers.find((e=>e.id===t))}getLayerByName(t){return this.layers.find((e=>e.name===t))}remove(t,e){var r=this;return Ev((function*(){e?e.layerChildren=e.layerChildren.filter((e=>e!==t)):r.layers=r.layers.filter((e=>e!==t)),t.destroy(),r.reRender(),r.emit("layerChange",r.layers)}))()}removeAllLayers(){var t=this;return Ev((function*(){t.destroy(),t.reRender()}))()}setEnableRender(t){this.enableRender=t}renderLayers(){var t=this;return Ev((function*(){if(t.alreadyInRendering||!t.enableRender)return;t.updateLayerRenderList();const e=t.debugService.generateRenderUid();t.debugService.renderStart(e),t.alreadyInRendering=!0,t.clear();for(const e of t.layerList)e.prerender();t.renderService.beginFrame();for(const e of t.layerList){const{enableMask:r}=e.getLayerConfig();e.masks.filter((t=>t.inited)).length>0&&r&&t.renderMask(e.masks),e.getLayerConfig().enableMultiPassRenderer?yield e.renderMultiPass():e.render()}t.renderService.endFrame(),t.debugService.renderEnd(e),t.alreadyInRendering=!1}))()}renderMask(t){let e=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});const r=t.length>1?rv.MULTIPLE:rv.SINGLE;for(const n of t)n.render({isStencil:!0,stencilType:r,stencilIndex:e++})}beforeRenderData(t){var e=this;return Ev((function*(){(yield t.hooks.beforeRenderData.promise())&&e.renderLayers()}))()}renderTileLayerMask(t){let e=0;const{enableMask:r=!0}=t.getLayerConfig();let n=t.tileMask?1:0;const i=t.masks.filter((t=>t.inited));n+=r?i.length:1;const o=n>1?rv.MULTIPLE:rv.SINGLE;if((t.tileMask||i.length&&r)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),i.length&&r)for(const t of i)t.render({isStencil:!0,stencilType:o,stencilIndex:e++});t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:o,stencilIndex:e++,stencilOperation:nv.OR})}renderTileLayer(t){var e=this;return Ev((function*(){e.renderTileLayerMask(t),t.getLayerConfig().enableMultiPassRenderer?yield t.renderMultiPass():yield t.render()}))()}updateLayerRenderList(){this.layerList=[],this.layers.filter((t=>t.inited)).filter((t=>t.isVisible())).sort(((t,e)=>t.zIndex-e.zIndex)).forEach((t=>{this.layerList.push(t)}))}destroy(){this.layers.forEach((t=>{t.destroy()})),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}startAnimate(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}stopAnimate(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}getOESTextureFloat(){return this.renderService.extensionObject.OES_texture_float}enableShaderPick(){this.shaderPicking=!0}disableShaderPick(){this.shaderPicking=!1}getShaderPickStat(){return this.shaderPicking}clear(){const t=Oe(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}runRender(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}stopRender(){window.cancelAnimationFrame(this.layerRenderID)}}function Ay(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.includes(n))continue;r[n]=t[n]}return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.includes(r)||{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}const{isNil:wy}=ld;class Cy{constructor(t){g_(this,"name",void 0),g_(this,"type",void 0),g_(this,"scale",void 0),g_(this,"descriptor",void 0),g_(this,"featureBufferLayout",[]),g_(this,"needRescale",!1),g_(this,"needRemapping",!1),g_(this,"needRegenerateVertices",!1),g_(this,"featureRange",{startIndex:0,endIndex:1/0}),g_(this,"vertexAttribute",void 0),g_(this,"defaultCallback",(t=>{var e;return 0===t.length?(null===(e=this.scale)||void 0===e?void 0:e.defaultValues)||[]:t.map(((t,e)=>{var r;return(null===(r=this.scale)||void 0===r?void 0:r.scalers[e].func)(t)}))})),this.setProps(t)}setProps(t){Object.assign(this,t)}mapping(t){var e;if(null!==(e=this.scale)&&void 0!==e&&e.callback){var r;const e=null===(r=this.scale)||void 0===r?void 0:r.callback(...t);if(!wy(e))return[e]}return this.defaultCallback(t)}resetDescriptor(){this.descriptor&&(this.descriptor.buffer.data=[])}}const Ry=["buffer","update","name"],Ly=["buffer","update","name"],Iy={[x_.FLOAT]:4,[x_.UNSIGNED_BYTE]:1,[x_.UNSIGNED_SHORT]:2};class My{constructor(t){g_(this,"attributesAndIndices",void 0),g_(this,"attributes",[]),g_(this,"triangulation",void 0),g_(this,"featureLayout",{sizePerElement:0,elements:[]}),this.rendererService=t}registerStyleAttribute(t){let e=this.getLayerStyleAttribute(t.name||"");return e?e.setProps(t):(e=new Cy(t),this.attributes.push(e)),e}unRegisterStyleAttribute(t){const e=this.attributes.findIndex((e=>e.name===t));e>-1&&this.attributes.splice(e,1)}updateScaleAttribute(t){this.attributes.forEach((e=>{var r;const n=e.name,i=null===(r=e.scale)||void 0===r?void 0:r.field;(t[n]||i&&t[i])&&(e.needRescale=!0,e.needRemapping=!0,e.needRegenerateVertices=!0)}))}updateStyleAttribute(t,e,r){let n=this.getLayerStyleAttribute(t);n||(n=this.registerStyleAttribute(v_(v_({},e),{},{name:t})));const{scale:i}=e;i&&n&&(n.scale=i,n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0,r&&r.featureRange&&(n.featureRange=r.featureRange))}getLayerStyleAttributes(){return this.attributes}getLayerStyleAttribute(t){return this.attributes.find((e=>e.name===t))}getLayerAttributeScale(t){var e;const r=this.getLayerStyleAttribute(t),n=null==r||null===(e=r.scale)||void 0===e?void 0:e.scalers;return n&&n[0]?n[0].func:null}updateAttributeByFeatureRange(t,e,r=0,n,i){const o=this.attributes.find((e=>e.name===t));if(o&&o.descriptor){const{descriptor:a}=o,{update:s,buffer:l,size:u=0}=a,c=Iy[l.type||x_.FLOAT];if(s){const{elements:a,sizePerElement:l}=this.featureLayout,h=a.slice(r,n);if(!h.length)return;const{offset:p}=h[0],d=p*u*c,f=h.map((({featureIdx:t,vertices:r,normals:n},i)=>{const o=r.length/l,a=[];for(let u=0;u<o;u++){const o=n?n.slice(3*u,3*u+3):[];a.push(...s(e[t],t,r.slice(u*l,u*l+l),i,o))}return a})).flat();o.vertexAttribute.updateBuffer({data:f,offset:d}),null==i||i.emit(`legend:${t}`,i.getLegend(t))}}}createAttributesAndIndices(t,e,r,n){this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);const i=this.attributes.map((t=>(t.resetDescriptor(),t.descriptor)));let o=0,a=0;const s=[];let l=3;t.forEach(((t,e)=>{const{indices:n,vertices:u,normals:c,size:h,indexes:p,count:d}=this.triangulation(t,r);"number"==typeof d&&(a+=d),n.forEach((t=>{s.push(t+o)})),l=h;const f=u.length/h;this.featureLayout.sizePerElement=l,this.featureLayout.elements.push({featureIdx:e,vertices:u,normals:c,offset:o}),o+=f;for(let r=0;r<f;r++){const n=(null==c?void 0:c.slice(3*r,3*r+3))||[],o=u.slice(r*h,r*h+h);let a=0;p&&void 0!==p[r]&&(a=p[r]),i.forEach(((i,s)=>{i&&i.update&&i.buffer.data.push(...i.update(t,e,o,r,n,a))}))}}));const{createAttribute:u,createBuffer:c,createElements:h}=this.rendererService,p={};i.forEach(((t,e)=>{if(t){const{buffer:r,update:n,name:i}=t,o=Ay(t,Ry),a=u(v_({buffer:c(r)},o));p[t.name||""]=a,this.attributes[e].vertexAttribute=a}}));const d=h({data:s,type:x_.UNSIGNED_INT,count:s.length});return this.attributesAndIndices={attributes:p,elements:d,count:a},Object.values(this.attributes).filter((t=>t.scale)).forEach((t=>{const e=t.name;null==n||n.emit(`legend:${e}`,n.getLegend(e))})),this.attributesAndIndices}createAttributes(t,e){this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);const r=this.attributes.map((t=>(t.resetDescriptor(),t.descriptor)));let n=0,i=3;t.forEach(((t,e)=>{const{indices:o,vertices:a,normals:s,size:l,indexes:u}=this.triangulation(t);o.forEach((t=>{})),i=l;const c=a.length/l;this.featureLayout.sizePerElement=i,this.featureLayout.elements.push({featureIdx:e,vertices:a,normals:s,offset:n}),n+=c;for(let n=0;n<c;n++){const i=(null==s?void 0:s.slice(3*n,3*n+3))||[],o=a.slice(n*l,n*l+l);let c=0;u&&void 0!==u[n]&&(c=u[n]),r.forEach(((r,a)=>{r&&r.update&&r.buffer.data.push(...r.update(t,e,o,n,i,c))}))}}));const{createAttribute:o,createBuffer:a}=this.rendererService,s={};return r.forEach(((t,e)=>{if(t){const{buffer:r,update:n,name:i}=t,l=Ay(t,Ly),u=o(v_({buffer:a(r)},l));s[t.name||""]=u,this.attributes[e].vertexAttribute=u}})),{attributes:s}}clearAllAttributes(){var t;this.attributes.forEach((t=>{t.vertexAttribute&&t.vertexAttribute.destroy()})),null===(t=this.attributesAndIndices)||void 0===t||t.elements.destroy(),this.attributes=[]}}function Oy(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))}function Py(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Dy(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function By(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}function Ny(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Fy={exports:{}},ky={exports:{}},Uy={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t&&"number"==typeof t.length&&t.length>=0&&t.length%1==0},t.exports=e.default}(Uy,Uy.exports);var zy={},Gy={exports:{}},jy={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];var n=e.pop();return t.call(this,e,n)}},t.exports=e.default}(jy,jy.exports);var Vy={};Object.defineProperty(Vy,"__esModule",{value:!0}),Vy.fallback=qy,Vy.wrap=Yy;var Hy,Wy=Vy.hasQueueMicrotask="function"==typeof queueMicrotask&&queueMicrotask,Xy=Vy.hasSetImmediate="function"==typeof setImmediate&&setImmediate,Zy=Vy.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function qy(t){setTimeout(t,0)}function Yy(t){return function(e){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return t((function(){return e.apply(void 0,r)}))}}Hy=Wy?queueMicrotask:Xy?setImmediate:Zy?process.nextTick:qy,Vy.default=Yy(Hy),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if((0,i.isAsync)(t))return function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];var n=e.pop();return a(t.apply(this,e),n)};return(0,r.default)((function(e,r){var n;try{n=t.apply(this,e)}catch(t){return r(t)}if(n&&"function"==typeof n.then)return a(n,r);r(null,n)}))};var r=o(jy.exports),n=o(Vy),i=zy;function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e){return t.then((function(t){s(e,null,t)}),(function(t){s(e,t&&t.message?t:new Error(t))}))}function s(t,e,r){try{t(e,r)}catch(t){(0,n.default)((function(t){throw t}),t)}}t.exports=e.default}(Gy,Gy.exports),Object.defineProperty(zy,"__esModule",{value:!0}),zy.isAsyncIterable=zy.isAsyncGenerator=zy.isAsync=void 0;var Ky,$y=(Ky=Gy.exports)&&Ky.__esModule?Ky:{default:Ky};function Qy(t){return"AsyncFunction"===t[Symbol.toStringTag]}zy.default=function(t){if("function"!=typeof t)throw new Error("expected a function");return Qy(t)?(0,$y.default)(t):t},zy.isAsync=Qy,zy.isAsyncGenerator=function(t){return"AsyncGenerator"===t[Symbol.toStringTag]},zy.isAsyncIterable=function(t){return"function"==typeof t[Symbol.asyncIterator]};var Jy={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){void 0===e&&(e=t.length);if(!e)throw new Error("arity is undefined");return function(){for(var r=this,n=[],i=arguments.length;i--;)n[i]=arguments[i];return"function"==typeof n[e-1]?t.apply(this,n):new Promise((function(i,o){n[e-1]=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];if(t)return o(t);i(e.length>1?e:e[0])},t.apply(r,n)}))}},t.exports=e.default}(Jy,Jy.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=o(Uy.exports),n=o(zy),i=o(Jy.exports);function o(t){return t&&t.__esModule?t:{default:t}}e.default=(0,i.default)((function(t,e,i){var o=(0,r.default)(e)?[]:{};t(e,(function(t,e,r){(0,n.default)(t)((function(t){for(var n=[],i=arguments.length-1;i-- >0;)n[i]=arguments[i+1];n.length<2&&(n=n[0]),o[e]=n,r(t)}))}),(function(t){return i(t,o)}))}),3),t.exports=e.default}(ky,ky.exports);var tx={exports:{}},ex={exports:{}},rx={exports:{}},nx={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){function e(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];if(null!==t){var n=t;t=null,n.apply(this,e)}}return Object.assign(e,t),e},t.exports=e.default}(nx,nx.exports);var ix={exports:{}},ox={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},t.exports=e.default}(ox,ox.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if((0,r.default)(t))return function(t){var e=-1,r=t.length;return function(){return++e<r?{value:t[e],key:e}:null}}(t);var e=(0,n.default)(t);return e?function(t){var e=-1;return function(){var r=t.next();return r.done?null:(e++,{value:r.value,key:e})}}(e):function(t){var e=t?Object.keys(t):[],r=-1,n=e.length;return function i(){var o=e[++r];return"__proto__"===o?i():r<n?{value:t[o],key:o}:null}}(t)};var r=i(Uy.exports),n=i(ox.exports);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}(ix,ix.exports);var ax={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];if(null===t)throw new Error("Callback was already called.");var n=t;t=null,n.apply(this,e)}},t.exports=e.default}(ax,ax.exports);var sx={exports:{}},lx={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.default={},t.exports=e.default}(lx,lx.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,i){var o=!1,a=!1,s=!1,l=0,u=0;function c(){l>=e||s||o||(s=!0,t.next().then((function(t){var e=t.value,r=t.done;if(!a&&!o){if(s=!1,r)return o=!0,void(l<=0&&i(null));l++,n(e,u,h),u++,c()}})).catch(p))}function h(t,e){if(l-=1,!a)return t?p(t):!1===t?(o=!0,void(a=!0)):e===r.default||o&&l<=0?(o=!0,i(null)):void c()}function p(t){a||(s=!1,o=!0,i(t))}c()};var r=function(t){return t&&t.__esModule?t:{default:t}}(lx.exports);t.exports=e.default}(sx,sx.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=l(nx.exports),n=l(ix.exports),i=l(ax.exports),o=zy,a=l(sx.exports),s=l(lx.exports);function l(t){return t&&t.__esModule?t:{default:t}}e.default=function(t){return function(e,l,u){if(u=(0,r.default)(u),t<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!e)return u(null);if((0,o.isAsyncGenerator)(e))return(0,a.default)(e,t,l,u);if((0,o.isAsyncIterable)(e))return(0,a.default)(e[Symbol.asyncIterator](),t,l,u);var c=(0,n.default)(e),h=!1,p=!1,d=0,f=!1;function m(t,e){if(!p)if(d-=1,t)h=!0,u(t);else if(!1===t)h=!0,p=!0;else{if(e===s.default||h&&d<=0)return h=!0,u(null);f||g()}}function g(){for(f=!0;d<t&&!h;){var e=c();if(null===e)return h=!0,void(d<=0&&u(null));d+=1,l(e.value,e.key,(0,i.default)(m))}f=!1}g()}},t.exports=e.default}(rx,rx.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=o(rx.exports),n=o(zy),i=o(Jy.exports);function o(t){return t&&t.__esModule?t:{default:t}}e.default=(0,i.default)((function(t,e,i,o){return(0,r.default)(e)(t,(0,n.default)(i),o)}),4),t.exports=e.default}(ex,ex.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=i(ex.exports),n=i(Jy.exports);function i(t){return t&&t.__esModule?t:{default:t}}e.default=(0,n.default)((function(t,e,n){return(0,r.default)(t,1,e,n)}),3),t.exports=e.default}(tx,tx.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return(0,r.default)(n.default,t,e)};var r=i(ky.exports),n=i(tx.exports);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}(Fy,Fy.exports);var ux=Ny(Fy.exports),cx=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.call=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];return this.args=e,ux(this.tasks)},t.prototype.tap=function(t,e){var r=this;this.tasks.push((function(n){e.apply(void 0,By([],Dy(r.args),!1)),n(null,t)}))},t}(),hx={exports:{}},px={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=u(Uy.exports),n=u(lx.exports),i=u(ex.exports),o=u(nx.exports),a=u(ax.exports),s=u(zy),l=u(Jy.exports);function u(t){return t&&t.__esModule?t:{default:t}}function c(t,e,r){r=(0,o.default)(r);var i=0,s=0,l=t.length,u=!1;function c(t,e){!1===t&&(u=!0),!0!==u&&(t?r(t):++s!==l&&e!==n.default||r(null))}for(0===l&&r(null);i<l;i++)e(t[i],i,(0,a.default)(c))}function h(t,e,r){return(0,i.default)(t,1/0,e,r)}e.default=(0,l.default)((function(t,e,n){return((0,r.default)(t)?c:h)(t,(0,s.default)(e),n)}),3),t.exports=e.default}(px,px.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return(0,n.default)(r.default,t,e)};var r=i(px.exports),n=i(ky.exports);function i(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}(hx,hx.exports);var dx={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=a(nx.exports),n=a(ax.exports),i=a(zy),o=a(Jy.exports);function a(t){return t&&t.__esModule?t:{default:t}}e.default=(0,o.default)((function(t,e){if(e=(0,r.default)(e),!Array.isArray(t))return e(new Error("First argument to waterfall must be an array of functions"));if(!t.length)return e();var o=0;function a(e){(0,i.default)(t[o++]).apply(void 0,e.concat([(0,n.default)(s)]))}function s(r){for(var n=[],i=arguments.length-1;i-- >0;)n[i]=arguments[i+1];if(!1!==r)return r||o===t.length?e.apply(void 0,[r].concat(n)):void a(n)}a([])})),t.exports=e.default}(dx,dx.exports);var fx=Ny(dx.exports),mx=function(){function t(){this.tasks=[]}return t.prototype.call=function(){return ux(this.tasks)},t.prototype.tap=function(t,e){this.tasks.push((function(r){r(e(),t)}))},t}(),gx=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.promise=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];return this.args=e,ux(this.tasks)},t.prototype.tapPromise=function(t,e){var r=this;this.tasks.push((function(n){return Oy(r,void 0,void 0,(function(){return Py(this,(function(r){switch(r.label){case 0:return[4,e.apply(void 0,By([],Dy(this.args),!1))];case 1:return r.sent(),n(null,t),[2]}}))}))}))},t}(),_x=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.promise=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];return this.args=e,ux(this.tasks)},t.prototype.tapPromise=function(t,e){var r=this;this.tasks.push((function(n){return Oy(r,void 0,void 0,(function(){var r;return Py(this,(function(i){switch(i.label){case 0:return[4,e.apply(void 0,By([],Dy(this.args),!1))];case 1:return r=i.sent(),n(r,t),[2]}}))}))}))},t}(),vx=function(){function t(){this.tasks=[]}return t.prototype.promise=function(){return fx(this.tasks)},t.prototype.tapPromise=function(t,e){0===this.tasks.length?this.tasks.push((function(t){e().then((function(e){t(null,e)}))})):this.tasks.push((function(t,r){e(t).then((function(t){r(null,t)}))}))},t}(),yx={exports:{}};(yx.exports={}).forEach=function(t,e){for(var r=0;r<t.length;r++){var n=e(t[r]);if(n)return n}};var xx={exports:{}},bx=xx.exports={};bx.isIE=function(t){return(-1!==(e=navigator.userAgent.toLowerCase()).indexOf("msie")||-1!==e.indexOf("trident")||-1!==e.indexOf(" edge/"))&&(!t||t===function(){var t=3,e=document.createElement("div"),r=e.getElementsByTagName("i");do{e.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i></i><![endif]--\x3e"}while(r[0]);return t>4?t:undefined}());var e},bx.isLegacyOpera=function(){return!!window.opera};var Ex={exports:{}};(Ex.exports={}).getOption=function(t,e,r){var n=t[e];if(null==n&&void 0!==r)return r;return n};var Tx=Ex.exports;function Sx(){var t={},e=0,r=0,n=0;return{add:function(i,o){o||(o=i,i=0),i>r?r=i:i<n&&(n=i),t[i]||(t[i]=[]),t[i].push(o),e++},process:function(){for(var e=n;e<=r;e++)for(var i=t[e],o=0;o<i.length;o++){(0,i[o])()}},size:function(){return e}}}var Ax="_erd";function Cx(t){return t[Ax]}var Rx={initState:function(t){return t[Ax]={},Cx(t)},getState:Cx,cleanState:function(t){delete t[Ax]}},Lx=xx.exports,Ix=yx.exports.forEach,Mx=yx.exports.forEach,Ox=function(t){var e=t.stateHandler.getState;return{isDetectable:function(t){var r=e(t);return r&&!!r.isDetectable},markAsDetectable:function(t){e(t).isDetectable=!0},isBusy:function(t){return!!e(t).busy},markBusy:function(t,r){e(t).busy=!!r}}},Px=function(t){var e={};function r(r){var n=t.get(r);return void 0===n?[]:e[n]||[]}return{get:r,add:function(r,n){var i=t.get(r);e[i]||(e[i]=[]),e[i].push(n)},removeListener:function(t,e){for(var n=r(t),i=0,o=n.length;i<o;++i)if(n[i]===e){n.splice(i,1);break}},removeAllListeners:function(t){var e=r(t);e&&(e.length=0)}}},Dx=function(){var t=1;return{generate:function(){return t++}}},Bx=function(t){var e=t.idGenerator,r=t.stateHandler.getState;return{get:function(t){var e=r(t);return e&&void 0!==e.id?e.id:null},set:function(t){var n=r(t);if(!n)throw new Error("setId required the element to have a resize detection state.");var i=e.generate();return n.id=i,i}}},Nx=function(t){function e(){}var r={log:e,warn:e,error:e};if(!t&&window.console){var n=function(t,e){t[e]=function(){var t=console[e];if(t.apply)t.apply(console,arguments);else for(var r=0;r<arguments.length;r++)t(arguments[r])}};n(r,"log"),n(r,"warn"),n(r,"error")}return r},Fx=xx.exports,kx=function(t){var e=(t=t||{}).reporter,r=Tx.getOption(t,"async",!0),n=Tx.getOption(t,"auto",!0);n&&!r&&(e&&e.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),r=!0);var i,o=Sx(),a=!1;function s(){for(a=!0;o.size();){var t=o;o=Sx(),t.process()}a=!1}function l(){var t;t=s,i=setTimeout(t,0)}return{add:function(t,e){!a&&n&&r&&0===o.size()&&l(),o.add(t,e)},force:function(t){a||(void 0===t&&(t=r),i&&(clearTimeout(i),i=null),t?l():s())}}},Ux=Rx,zx=function(t){var e=(t=t||{}).reporter,r=t.batchProcessor,n=t.stateHandler.getState;if(!e)throw new Error("Missing required dependency: reporter.");function i(e){var r=t.important?" !important; ":"; ";return(e.join(r)+r).trim()}function o(t){return n(t).object}return{makeDetectable:function(t,o,a){a||(a=o,o=t,t=null),(t=t||{}).debug,Lx.isIE(8)?a(o):function(o,a){var s=i(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"]),l=!1,u=window.getComputedStyle(o),c=o.offsetWidth,h=o.offsetHeight;function p(){function r(){if("static"===u.position){o.style.setProperty("position","relative",t.important?"important":"");var r=function(e,r,n,i){var o=n[i];"auto"!==o&&"0"!==function(t){return t.replace(/[^-\d\.]/g,"")}(o)&&(e.warn("An element that is positioned static has style."+i+"="+o+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+i+" will be set to 0. Element: ",r),r.style.setProperty(i,"0",t.important?"important":""))};r(e,o,u,"top"),r(e,o,u,"right"),r(e,o,u,"bottom"),r(e,o,u,"left")}}""!==u.position&&(r(),l=!0);var i=document.createElement("object");i.style.cssText=s,i.tabIndex=-1,i.type="text/html",i.setAttribute("aria-hidden","true"),i.onload=function(){l||r(),function t(e,r){if(!e.contentDocument){var i=n(e);return i.checkForObjectDocumentTimeoutId&&window.clearTimeout(i.checkForObjectDocumentTimeoutId),void(i.checkForObjectDocumentTimeoutId=setTimeout((function(){i.checkForObjectDocumentTimeoutId=0,t(e,r)}),100))}r(e.contentDocument)}(this,(function(t){a(o)}))},Lx.isIE()||(i.data="about:blank"),n(o)&&(o.appendChild(i),n(o).object=i,Lx.isIE()&&(i.data="about:blank"))}n(o).startSize={width:c,height:h},r?r.add(p):p()}(o,a)},addListener:function(t,e){function r(){e(t)}if(Lx.isIE(8))n(t).object={proxy:r},t.attachEvent("onresize",r);else{var i=o(t);if(!i)throw new Error("Element is not detectable by this strategy.");i.contentDocument.defaultView.addEventListener("resize",r)}},uninstall:function(t){if(n(t)){var e=o(t);e&&(Lx.isIE(8)?t.detachEvent("onresize",e.proxy):t.removeChild(e),n(t).checkForObjectDocumentTimeoutId&&window.clearTimeout(n(t).checkForObjectDocumentTimeoutId),delete n(t).object)}}}},Gx=function(t){var e=(t=t||{}).reporter,r=t.batchProcessor,n=t.stateHandler.getState;t.stateHandler.hasState;var i=t.idHandler;if(!r)throw new Error("Missing required dependency: batchProcessor");if(!e)throw new Error("Missing required dependency: reporter.");var o=function(){var t=500,e=500,r=document.createElement("div");r.style.cssText=l(["position: absolute","width: 1000px","height: 1000px","visibility: hidden","margin: 0","padding: 0"]);var n=document.createElement("div");n.style.cssText=l(["position: absolute","width: 500px","height: 500px","overflow: scroll","visibility: none","top: -1500px","left: -1500px","visibility: hidden","margin: 0","padding: 0"]),n.appendChild(r),document.body.insertBefore(n,document.body.firstChild);var i=t-n.clientWidth,o=e-n.clientHeight;return document.body.removeChild(n),{width:i,height:o}}(),a="erd_scroll_detection_container";function s(t){!function(t,e,r){function n(r,n){n=n||function(e){t.head.appendChild(e)};var i=t.createElement("style");return i.innerHTML=r,i.id=e,n(i),i}if(!t.getElementById(e)){var i=r+"_animation",o=r+"_animation_active",a="/* Created by the element-resize-detector library. */\n";a+="."+r+" > div::-webkit-scrollbar { "+l(["display: none"])+" }\n\n",a+="."+o+" { "+l(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+i,"animation-name: "+i])+" }\n",a+="@-webkit-keyframes "+i+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }\n",n(a+="@keyframes "+i+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }")}}(t,"erd_scroll_detection_scrollbar_style",a)}function l(e){var r=t.important?" !important; ":"; ";return(e.join(r)+r).trim()}function u(t,r,n){if(t.addEventListener)t.addEventListener(r,n);else{if(!t.attachEvent)return e.error("[scroll] Don't know how to add event listeners.");t.attachEvent("on"+r,n)}}function c(t,r,n){if(t.removeEventListener)t.removeEventListener(r,n);else{if(!t.detachEvent)return e.error("[scroll] Don't know how to remove event listeners.");t.detachEvent("on"+r,n)}}function h(t){return n(t).container.childNodes[0].childNodes[0].childNodes[0]}function p(t){return n(t).container.childNodes[0].childNodes[0].childNodes[1]}return s(window.document),{makeDetectable:function(t,s,c){function d(){if(t.debug){var r=Array.prototype.slice.call(arguments);if(r.unshift(i.get(s),"Scroll: "),e.log.apply)e.log.apply(null,r);else for(var n=0;n<r.length;n++)e.log(r[n])}}function f(t){var e=n(t).container.childNodes[0],r=window.getComputedStyle(e);return!r.width||-1===r.width.indexOf("px")}function m(){var t=window.getComputedStyle(s),e={};return e.position=t.position,e.width=s.offsetWidth,e.height=s.offsetHeight,e.top=t.top,e.right=t.right,e.bottom=t.bottom,e.left=t.left,e.widthCSS=t.width,e.heightCSS=t.height,e}function g(){if(d("storeStyle invoked."),n(s)){var t=m();n(s).style=t}else d("Aborting because element has been uninstalled")}function _(t,e,r){n(t).lastWidth=e,n(t).lastHeight=r}function v(){return 2*o.width+1}function y(){return 2*o.height+1}function x(t){return t+10+v()}function b(t){return t+10+y()}function E(t,e,r){var n=h(t),i=p(t),o=x(e),a=b(r),s=function(t){return 2*t+v()}(e),l=function(t){return 2*t+y()}(r);n.scrollLeft=o,n.scrollTop=a,i.scrollLeft=s,i.scrollTop=l}function T(){var t=n(s).container;if(!t){(t=document.createElement("div")).className=a,t.style.cssText=l(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),n(s).container=t,function(t){t.className+=" "+a+"_animation_active"}(t),s.appendChild(t);var e=function(){n(s).onRendered&&n(s).onRendered()};u(t,"animationstart",e),n(s).onAnimationStart=e}return t}function S(){if(d("Injecting elements"),n(s)){!function(){var r=n(s).style;if("static"===r.position){s.style.setProperty("position","relative",t.important?"important":"");var i=function(t,e,r,n){var i=r[n];"auto"!==i&&"0"!==function(t){return t.replace(/[^-\d\.]/g,"")}(i)&&(t.warn("An element that is positioned static has style."+n+"="+i+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+n+" will be set to 0. Element: ",e),e.style[n]=0)};i(e,s,r,"top"),i(e,s,r,"right"),i(e,s,r,"bottom"),i(e,s,r,"left")}}();var r=n(s).container;r||(r=T());var i,c,h,p,f=o.width,m=o.height,g=l(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),_=l(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat(["left: "+(i=(i=-(1+f))?i+"px":"0"),"top: "+(c=(c=-(1+m))?c+"px":"0"),"right: "+(p=(p=-f)?p+"px":"0"),"bottom: "+(h=(h=-m)?h+"px":"0")])),v=l(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),y=l(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),x=l(["position: absolute","left: 0","top: 0"]),b=l(["position: absolute","width: 200%","height: 200%"]),E=document.createElement("div"),S=document.createElement("div"),A=document.createElement("div"),w=document.createElement("div"),C=document.createElement("div"),R=document.createElement("div");E.dir="ltr",E.style.cssText=g,E.className=a,S.className=a,S.style.cssText=_,A.style.cssText=v,w.style.cssText=x,C.style.cssText=y,R.style.cssText=b,A.appendChild(w),C.appendChild(R),S.appendChild(A),S.appendChild(C),E.appendChild(S),r.appendChild(E),u(A,"scroll",L),u(C,"scroll",I),n(s).onExpandScroll=L,n(s).onShrinkScroll=I}else d("Aborting because element has been uninstalled");function L(){var t=n(s);t&&t.onExpand?t.onExpand():d("Aborting expand scroll handler: element has been uninstalled")}function I(){var t=n(s);t&&t.onShrink?t.onShrink():d("Aborting shrink scroll handler: element has been uninstalled")}}function A(){function o(e,r,n){var i=function(t){return h(t).childNodes[0]}(e),o=x(r),a=b(n);i.style.setProperty("width",o+"px",t.important?"important":""),i.style.setProperty("height",a+"px",t.important?"important":"")}function a(a){var u=s.offsetWidth,c=s.offsetHeight,h=u!==n(s).lastWidth||c!==n(s).lastHeight;d("Storing current size",u,c),_(s,u,c),r.add(0,(function(){if(h)if(n(s))if(l()){if(t.debug){var r=s.offsetWidth,a=s.offsetHeight;r===u&&a===c||e.warn(i.get(s),"Scroll: Size changed before updating detector elements.")}o(s,u,c)}else d("Aborting because element container has not been initialized");else d("Aborting because element has been uninstalled")})),r.add(1,(function(){n(s)?l()?E(s,u,c):d("Aborting because element container has not been initialized"):d("Aborting because element has been uninstalled")})),h&&a&&r.add(2,(function(){n(s)?l()?a():d("Aborting because element container has not been initialized"):d("Aborting because element has been uninstalled")}))}function l(){return!!n(s).container}function u(){d("notifyListenersIfNeeded invoked");var t=n(s);return void 0===n(s).lastNotifiedWidth&&t.lastWidth===t.startSize.width&&t.lastHeight===t.startSize.height?d("Not notifying: Size is the same as the start size, and there has been no notification yet."):t.lastWidth===t.lastNotifiedWidth&&t.lastHeight===t.lastNotifiedHeight?d("Not notifying: Size already notified"):(d("Current size not notified, notifying..."),t.lastNotifiedWidth=t.lastWidth,t.lastNotifiedHeight=t.lastHeight,void Ix(n(s).listeners,(function(t){t(s)})))}function c(){d("Scroll detected."),f(s)?d("Scroll event fired while unrendered. Ignoring..."):a(u)}if(d("registerListenersAndPositionElements invoked."),n(s)){n(s).onRendered=function(){if(d("startanimation triggered."),f(s))d("Ignoring since element is still unrendered...");else{d("Element rendered.");var t=h(s),e=p(s);0!==t.scrollLeft&&0!==t.scrollTop&&0!==e.scrollLeft&&0!==e.scrollTop||(d("Scrollbars out of sync. Updating detector elements..."),a(u))}},n(s).onExpand=c,n(s).onShrink=c;var m=n(s).style;o(s,m.width,m.height)}else d("Aborting because element has been uninstalled")}function w(){if(d("finalizeDomMutation invoked."),n(s)){var t=n(s).style;_(s,t.width,t.height),E(s,t.width,t.height)}else d("Aborting because element has been uninstalled")}function C(){c(s)}function R(){var t;d("Installing..."),n(s).listeners=[],t=m(),n(s).startSize={width:t.width,height:t.height},d("Element start size",n(s).startSize),r.add(0,g),r.add(1,S),r.add(2,A),r.add(3,w),r.add(4,C)}c||(c=s,s=t,t=null),t=t||{},d("Making detectable..."),!function(t){return!function(t){var e=t.getRootNode&&t.getRootNode().contains(t);return t===t.ownerDocument.body||t.ownerDocument.body.contains(t)||e}(t)||null===window.getComputedStyle(t)}(s)?R():(d("Element is detached"),T(),d("Waiting until element is attached..."),n(s).onRendered=function(){d("Element is now attached"),R()})},addListener:function(t,e){if(!n(t).listeners.push)throw new Error("Cannot add listener to an element that is not detectable.");n(t).listeners.push(e)},uninstall:function(t){var e=n(t);e&&(e.onExpandScroll&&c(h(t),"scroll",e.onExpandScroll),e.onShrinkScroll&&c(p(t),"scroll",e.onShrinkScroll),e.onAnimationStart&&c(e.container,"animationstart",e.onAnimationStart),e.container&&t.removeChild(e.container))},initDocument:s}};function jx(t){return Array.isArray(t)||void 0!==t.length}function Vx(t){if(Array.isArray(t))return t;var e=[];return Mx(t,(function(t){e.push(t)})),e}function Hx(t){return t&&1===t.nodeType}function Wx(t,e,r){var n=t[e];return null==n&&void 0!==r?r:n}class Xx extends Vd.exports.EventEmitter{get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get controlService(){return this.container.controlService}get configService(){return this.container.globalConfigService}get map(){return this.container.mapService}get coordinateSystemService(){return this.container.coordinateSystemService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get cameraService(){return this.container.cameraService}get interactionService(){return this.container.interactionService}get pickingService(){return this.container.pickingService}get shaderModuleService(){return this.container.shaderModuleService}get markerService(){return this.container.markerService}get popupService(){return this.container.popupService}constructor(t){super(),g_(this,"destroyed",!1),g_(this,"loaded",!1),g_(this,"id",void 0),g_(this,"inited",!1),g_(this,"rendering",!1),g_(this,"$container",void 0),g_(this,"canvas",void 0),g_(this,"markerContainer",void 0),g_(this,"resizeDetector",void 0),g_(this,"hooks",void 0),g_(this,"handleWindowResized",(()=>{this.emit("resize"),this.$container&&(this.initContainer(),this.coordinateSystemService.needRefresh=!0,this.render())})),g_(this,"handleMapCameraChanged",(t=>{this.cameraService.update(t),this.render()})),this.container=t,this.hooks={init:new gx},this.id=t.id}init(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(()=>this.render())),this.fontService.init(),this.hooks.init.tapPromise("initMap",Ev((function*(){e.debugService.log("map.mapInitStart",{type:e.map.version}),yield new Promise((t=>{e.map.onCameraChanged((r=>{e.cameraService.init(),e.cameraService.update(r),t()})),e.map.init()})),e.map.onCameraChanged(e.handleMapCameraChanged),e.map.addMarkerContainer(),e.markerService.addMarkers(),e.markerService.addMarkerLayers(),e.popupService.initPopup(),e.interactionService.init(),e.interactionService.on(tv.Drag,e.addSceneEvent.bind(e))}))),this.hooks.init.tapPromise("initRenderer",Ev((function*(){var r;const n=(null===(r=e.map)||void 0===r?void 0:r.getOverlayContainer())||void 0;if(e.$container=n||function(t){let e=t;if("string"==typeof t&&(e=document.getElementById(t)),e){const t=document.createElement("div");return t.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",t.id="l7-scene-"+yy++,t.classList.add("l7-scene"),e.appendChild(t),t}return null}(e.configService.getSceneConfig(e.id).id||""),e.$container){const{canvas:r}=t;var i;if(e.canvas=r||pd("canvas","",e.$container),e.setCanvas(),yield e.rendererService.init(e.canvas,e.configService.getSceneConfig(e.id),t.gl),e.registerContextLost(),e.initContainer(),e.resizeDetector=function(t){var e;if((t=t||{}).idHandler)e={get:function(e){return t.idHandler.get(e,!0)},set:t.idHandler.set};else{var r=Dx(),n=Bx({idGenerator:r,stateHandler:Ux});e=n}var i=t.reporter;i||(i=Nx(!1===i));var o=Wx(t,"batchProcessor",kx({reporter:i})),a={};a.callOnAdd=!!Wx(t,"callOnAdd",!0),a.debug=!!Wx(t,"debug",!1);var s,l=Px(e),u=Ox({stateHandler:Ux}),c=Wx(t,"strategy","object"),h=Wx(t,"important",!1),p={reporter:i,batchProcessor:o,stateHandler:Ux,idHandler:e,important:h};if("scroll"===c&&(Fx.isLegacyOpera()?(i.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),c="object"):Fx.isIE(9)&&(i.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),c="object")),"scroll"===c)s=Gx(p);else{if("object"!==c)throw new Error("Invalid strategy name: "+c);s=zx(p)}var d={};return{listenTo:function(t,r,n){function o(t){var e=l.get(t);Mx(e,(function(e){e(t)}))}function c(t,e,r){l.add(e,r),t&&r(e)}if(n||(n=r,r=t,t={}),!r)throw new Error("At least one element required.");if(!n)throw new Error("Listener required.");if(Hx(r))r=[r];else{if(!jx(r))return i.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");r=Vx(r)}var p=0,f=Wx(t,"callOnAdd",a.callOnAdd),m=Wx(t,"onReady",(function(){})),g=Wx(t,"debug",a.debug);Mx(r,(function(t){Ux.getState(t)||(Ux.initState(t),e.set(t));var a=e.get(t);if(g&&i.log("Attaching listener to element",a,t),!u.isDetectable(t))return g&&i.log(a,"Not detectable."),u.isBusy(t)?(g&&i.log(a,"System busy making it detectable"),c(f,t,n),d[a]=d[a]||[],void d[a].push((function(){++p===r.length&&m()}))):(g&&i.log(a,"Making detectable..."),u.markBusy(t,!0),s.makeDetectable({debug:g,important:h},t,(function(t){if(g&&i.log(a,"onElementDetectable"),Ux.getState(t)){u.markAsDetectable(t),u.markBusy(t,!1),s.addListener(t,o),c(f,t,n);var e=Ux.getState(t);if(e&&e.startSize){var l=t.offsetWidth,h=t.offsetHeight;e.startSize.width===l&&e.startSize.height===h||o(t)}d[a]&&Mx(d[a],(function(t){t()}))}else g&&i.log(a,"Element uninstalled before being detectable.");delete d[a],++p===r.length&&m()})));g&&i.log(a,"Already detecable, adding listener."),c(f,t,n),p++})),p===r.length&&m()},removeListener:l.removeListener,removeAllListeners:l.removeAllListeners,uninstall:function(t){if(!t)return i.error("At least one element is required.");if(Hx(t))t=[t];else{if(!jx(t))return i.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");t=Vx(t)}Mx(t,(function(t){l.removeAllListeners(t),s.uninstall(t),Ux.cleanState(t)}))},initDocument:function(t){s.initDocument&&s.initDocument(t)}}}({strategy:"scroll"}),e.resizeDetector.listenTo(e.$container,e.handleWindowResized),window.matchMedia)null===(i=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===i||i.addListener(e.handleWindowResized.bind("screen"))}else console.error("容器 id 不存在");e.pickingService.init(e.id)}))),this.render()}registerContextLost(){const t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",(()=>this.emit("webglcontextlost")))}addLayer(t){this.layerService.sceneService=this,this.layerService.add(t)}addMask(t){this.layerService.sceneService=this,this.layerService.addMask(t)}render(){var t=this;return Ev((function*(){t.rendering||t.destroyed||(t.rendering=!0,t.inited?(yield t.layerService.initLayers(),yield t.layerService.renderLayers()):(yield t.hooks.init.promise(),t.destroyed&&t.destroy(),yield t.layerService.initLayers(),t.layerService.renderLayers(),t.controlService.addControls(),t.loaded=!0,t.emit("loaded"),t.inited=!0),t.rendering=!1)}))()}addFontFace(t,e){this.fontService.addFontFace(t,e)}getSceneContainer(){return this.$container}exportPng(t){var e=this;return Ev((function*(){var r;const n=null===(r=e.$container)||void 0===r?void 0:r.getElementsByTagName("canvas")[0];yield e.render();return"jpg"===t?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}))()}getSceneConfig(){return this.configService.getSceneConfig(this.id)}getPointSizeRange(){return this.rendererService.getPointSizeRange()}addMarkerContainer(){const t=this.$container.parentElement;null!==t&&(this.markerContainer=pd("div","l7-marker-container",t))}getMarkerContainer(){return this.markerContainer}destroy(){var t;this.inited?(this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout((()=>{var t;null===(t=this.$container)||void 0===t||t.removeChild(this.canvas),this.canvas=null,this.rendererService.destroy()})),null===(t=this.$container)||void 0===t||null===(t=t.parentNode)||void 0===t||t.removeChild(this.$container),this.emit("destroy")):this.destroyed=!0}initContainer(){var t,e;const r=yd,n=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,i=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,o=this.canvas;o&&(o.width=n*r,o.height=i*r),this.rendererService.viewport({x:0,y:0,width:r*n,height:r*i})}setCanvas(){var t,e;const r=yd,n=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,i=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,o=this.canvas;o.width=n*r,o.height=i*r,o.style.width="100%",o.style.height="100%"}addSceneEvent(t){this.emit(t.type,t)}}const{uniq:Zx}=ld,qx="#define PI 3.14159265359",Yx="layout(std140) uniform PickingUniforms {\n  vec4 u_HighlightColor;\n  vec4 u_SelectColor;\n  vec3 u_PickingColor;\n  float u_PickingStage;\n  vec3 u_CurrentSelectedId;\n  float u_PickingThreshold;\n  float u_PickingBuffer;\n  float u_shaderPick;\n  float u_activeMix;\n};",Kx='#define TILE_SIZE (512.0)\n#define PI (3.1415926536)\n#define WORLD_SCALE (TILE_SIZE / (PI * 2.0))\n#define EARTH_CIRCUMFERENCE (40.03e6)\n\n#define COORDINATE_SYSTEM_LNGLAT (1.0) // mapbox\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET (2.0) // mapbox offset\n#define COORDINATE_SYSTEM_VECTOR_TILE (3.0)\n#define COORDINATE_SYSTEM_IDENTITY (4.0)\n#define COORDINATE_SYSTEM_METER_OFFSET (5.0)\n\n#pragma include "scene_uniforms"\n\nconst vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);\n\n// web mercator coords -> world coords\nvec2 project_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  return vec2(radians(x) + PI, PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5)));\n}\n\nfloat project_scale(float meters) {\n  return meters * u_PixelsPerMeter.z;\n}\n\n// offset coords -> world coords\nvec4 project_offset(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1.0, 1.0);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz * pixels_per_unit, offset.w);\n}\n\nvec3 project_normal(vec3 normal) {\n  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\n  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\n\nvec3 project_offset_normal(vec3 vector) {\n  if (\n    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&\n      u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01 ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * u_PixelsPerDegree);\n  }\n  return project_normal(vector);\n}\n\nvec4 project_position(vec4 position, vec2 position64xyLow) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float X = position.x - u_ViewportCenter.x;\n    float Y = position.y - u_ViewportCenter.y;\n    return project_offset(\n      vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w)\n    );\n  }\n  if (\n    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&\n    u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01\n  ) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  return position;\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_XY_LOW);\n}\n\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\n  return offset * u_FocalDistance;\n}\n\n// 适配纹理贴图的等像素大小\nfloat project_pixel_texture(float pixel) {\n  // mapbox zoom > 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    return pixel * pow(0.5, u_Zoom) * u_FocalDistance;\n  }\n\n  return pixel * 2.0 * u_FocalDistance;\n}\n\n// 在不论什么底图下需要统一处理的时候使用\nfloat project_float_pixel(float pixel) {\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // mapbox 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, 19.0 - u_Zoom) * u_FocalDistance;\n  }\n\n  return pixel * u_FocalDistance;\n}\n\n// Project meter into the unit of pixel which used in the camera world space\nfloat project_float_meter(float meter) {\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // Since the zoom level uniform is updated by mapservice and it\'s alread been subtracted by 1\n    // Not sure if we are supposed to do that again\n    return meter;\n  } else {\n    return project_float_pixel(meter);\n  }\n\n  // TODO: change the following code to make adaptations for amap\n  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;\n\n}\n\nfloat project_pixel(float pixel) {\n  return pixel * u_FocalDistance;\n}\n\nvec2 project_pixel(vec2 pixel) {\n  return pixel * -1.0 * u_FocalDistance;\n}\n\nvec3 project_pixel(vec3 pixel) {\n  return pixel * -1.0 * u_FocalDistance;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    position.w *= u_PixelsPerMeter.z;\n  }\n\n  return viewProjectionMatrix * position + center;\n}\n\n// Projects from common space coordinates to clip space\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(\n    position,\n    u_ViewProjectionMatrix,\n    u_ViewportCenterProjection\n  );\n}\n\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\n  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\n\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    pos.w = pos.w / u_PixelsPerMeter.z;\n  }\n  return pos;\n}\n\nbool isEqual(float a, float b) {\n  return a < b + 0.001 && a > b - 0.001;\n}\n\n',$x="layout(std140) uniform SceneUniforms {\n  mat4 u_ViewMatrix;\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewProjectionMatrix;\n  mat4 u_ModelMatrix;\n  vec4 u_ViewportCenterProjection;\n  vec3 u_PixelsPerDegree;\n  float u_Zoom;\n  vec3 u_PixelsPerDegree2;\n  float u_ZoomScale;\n  vec3 u_PixelsPerMeter;\n  float u_CoordinateSystem;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_ViewportCenter;\n  vec2 u_ViewportSize;\n  float u_FocalDistance;\n};\n",Qx=/precision\s+(high|low|medium)p\s+float/,Jx="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n",tb=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,eb=/void\s+main\s*\([^)]*\)\s*\{\n?/;class rb{constructor(){g_(this,"moduleCache",{}),g_(this,"rawContentCache",{})}registerBuiltinModules(){this.destroy(),this.registerModule("common",{vs:qx,fs:qx}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n",fs:""}),this.registerModule("scene_uniforms",{vs:$x,fs:$x}),this.registerModule("picking_uniforms",{vs:Yx,fs:Yx}),this.registerModule("projection",{vs:Kx,fs:Kx}),this.registerModule("project",{vs:"\n#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\n  float maxs=85.0511287798;\n  float lat=max(min(maxs,lnglat.y),-maxs);\n  float scale= 268435456.;\n  float d=PI/180.;\n  float x=lnglat.x*d;\n  float y=lat*d;\n  y=log(tan((PI/4.)+(y/2.)));\n\n  float a=.5/PI,\n  b=.5,\n  c=-.5/PI;\n  d=.5;\n  x=scale*(a*x+b);\n  y=scale*(c*y+d);\n  return vec2(x,y);\n}\n\nvec2 unProjectFlat(vec2 px){\n  float a=.5/PI;\n  float b=.5;\n  float c=-.5/PI;\n  float d=.5;\n  float scale = 268435456.;\n  float x=(px.x/scale-b)/a;\n  float y=(px.y/scale-d)/c;\n  y=(atan(pow(E,y))-(PI/4.))*2.;\n  d=PI/180.;\n  float lat=y/d;\n  float lng=x/d;\n  return vec2(lng,lat);\n}\n\nfloat pixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}\n\n// gaode2.0\nvec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标\n  float t = lnglat.x;\n  float e = lnglat.y;\n  float Sm = 180.0 / PI;\n  float Tm = 6378137.0;\n  float Rm = PI / 180.0;\n  float r = 85.0511287798;\n  e = max(min(r, e), -r);\n  t *= Rm;\n  e *= Rm;\n  e = log(tan(PI / 4.0 + e / 2.0));\n  return vec2(t * Tm, e * Tm);\n}\n\nvec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度\n  float Sm = 57.29577951308232; //180 / Math.PI\n  float Tm = 6378137.0;\n  float t = point.x;\n  float e = point.y;\n  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\n\n\nfloat customPixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}\n"}),this.registerModule("lighting",{vs:"// Blinn-Phong model\n// apply lighting in vertex shader instead of fragment shader\n// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n};\n\nstruct SpotLight {\n  vec3 position;\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n  float constant;\n  float linear;\n  float quadratic;\n  float angle;\n  float blur;\n  float exponent;\n};\n\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\n\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\n  vec3 lightDir = normalize(light.direction);\n  // diffuse shading\n  float diff = max(dot(normal, lightDir), 0.0);\n  // Blinn-Phong specular shading\n  vec3 halfwayDir = normalize(lightDir + viewDir);\n  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\n\n  vec3 ambient = light.ambient * u_Ambient;\n  vec3 diffuse = light.diffuse * diff * u_Diffuse;\n  vec3 specular = light.specular * spec * u_Specular;\n\n  return ambient + diffuse + specular;\n}\n\n\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\n  vec3 weight = vec3(0.0);\n  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\n    if (i >= u_NumOfDirectionalLights) {\n      break;\n    }\n    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n  }\n  return weight;\n}\n",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n      // //cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(vec3(1, -10.5, 12));\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n      // //lambert\n    float lambert = dot(worldNormal, lightDir);\n        //specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n        //sum to light weight\n    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\n\n    return lightWeight;\n}\n",fs:""}),this.registerModule("picking",{vs:'layout(location = ATTRIBUTE_LOCATION_PICKING_COLOR) in vec3 a_PickingColor;\nout vec4 v_PickingResult;\n\n#pragma include "picking_uniforms"\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\nbool isVertexPicked(vec3 vertexColor) {\n  return distance(vertexColor,u_PickingColor.rgb) < 0.01;\n}\n\n// 判断当前点是否已经被 select 选中\nbool isVertexSelected(vec3 vertexColor) {\n  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  if(u_shaderPick < 0.5) {\n    return;\n  }\n  // compares only in highlight stage\n\n  if(u_PickingStage == PICKING_HIGHLIGHT) {\n    if(isVertexPicked(pickingColor)) {\n       v_PickingResult = vec4(pickingColor.rgb * COLOR_SCALE,HIGHLIGHT);\n       return;\n    }\n    if(isVertexSelected(pickingColor)) {\n     v_PickingResult = vec4(u_CurrentSelectedId.rgb * COLOR_SCALE,SELECT);\n      return;\n    }\n\n  } else {\n      v_PickingResult= vec4(pickingColor.rgb * COLOR_SCALE,NORMAL);\n      return;\n  }\n\n  // // v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && (isVertexPicked(pickingColor) || isVertexPicked(u_CurrentSelectedId)));\n\n  // // Stores the picking color so that the fragment shader can render it during picking\n  // v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\n\nfloat setPickingOrder(float z) {\n   bool selected = bool(v_PickingResult.a);\n   return selected ? z + 1. : 0.;\n}\n',fs:'\nin vec4 v_PickingResult;\n\n#pragma include "picking_uniforms"\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color, float weight) {\n  float activeType = v_PickingResult.a;\n  if(activeType > 0.0) {\n    vec4 highLightColor =  activeType > 1.5 ? u_SelectColor : u_HighlightColor;\n    highLightColor = highLightColor * COLOR_SCALE;\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n  }\n  else {\n    return color;\n  }\n\n  \n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, 1.0));\n  }\n  \n}\n\nvec4 filterColorAlpha(vec4 color, float alpha) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, alpha));\n  }\n}\n\n'}),this.registerModule("rotation_2d",{vs:"vec2 rotate_matrix(vec2 v, float a) {\n    float b = a / 180.0 * 3.1415926535897932384626433832795;\n    float s = sin(b);\n    float c = cos(b);\n    mat2 m = mat2(c, s, -s, c);\n    return m * v;\n}",fs:""})}registerModule(t,e){e.vs=e.vs.replace(/\r\n/g,"\n"),e.fs=e.fs.replace(/\r\n/g,"\n");const{vs:r,fs:n,uniforms:i,defines:o,inject:a}=e,{content:s,uniforms:l}=C_(r),{content:u,uniforms:c}=C_(n);this.rawContentCache[t]={fs:u,defines:o,inject:a,uniforms:v_(v_(v_({},l),c),i),vs:s}}getModule(t){let e=this.rawContentCache[t].vs,r=this.rawContentCache[t].fs;const{defines:n={},inject:i={}}=this.rawContentCache[t];let o={};i["vs:#decl"]&&(e=i["vs:#decl"]+e,o=C_(i["vs:#decl"]).uniforms),i["vs:#main-start"]&&(e=e.replace(eb,(t=>t+i["vs:#main-start"]))),i["fs:#decl"]&&(r=i["fs:#decl"]+r);const a=function(t){const e=Object.keys(t).reduce(((e,r)=>e+`#define ${r.toUpperCase()} ${t[r]}\n`),"\n");return e}(n);e=a+e;const{content:s,includeList:l}=this.processModule(e,[],"vs"),{content:u,includeList:c}=this.processModule(r,[],"fs"),h=Zx(l.concat(c).concat(t)).reduce(((t,e)=>v_(v_({},t),this.rawContentCache[e].uniforms)),v_({},o)),p=(Qx.test(u)?"":Jx)+s,d=(Qx.test(u)?"":Jx)+u;return this.moduleCache[t]={vs:p.trim(),fs:d.trim(),uniforms:h},this.moduleCache[t]}destroy(){this.moduleCache={},this.rawContentCache={}}processModule(t,e,r){return{content:t.replace(tb,((t,n)=>{const i=n.split(" ")[0].replace(/"/g,"");if(e.indexOf(i)>-1)return"";const o=this.rawContentCache[i][r];e.push(i);const{content:a}=this.processModule(o,e,r);return a})),includeList:e}}}class nb{constructor(){g_(this,"shaderModuleService",void 0),g_(this,"rendererService",void 0),g_(this,"cameraService",void 0),g_(this,"mapService",void 0),g_(this,"interactionService",void 0),g_(this,"layerService",void 0),g_(this,"config",void 0)}getName(){return""}getType(){return y_.Normal}init(t,e){this.config=e,this.rendererService=t.getContainer().rendererService,this.cameraService=t.getContainer().cameraService,this.mapService=t.getContainer().mapService,this.interactionService=t.getContainer().interactionService,this.layerService=t.getContainer().layerService,this.shaderModuleService=t.getContainer().shaderModuleService}render(t){}}class ib extends nb{getName(){return"clear"}init(t,e){super.init(t,e)}render(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}class ob{constructor(t){g_(this,"passes",[]),g_(this,"layer",void 0),g_(this,"renderFlag",void 0),g_(this,"width",0),g_(this,"height",0),this.postProcessor=t}setLayer(t){this.layer=t}setRenderFlag(t){this.renderFlag=t}getRenderFlag(){return this.renderFlag}getPostProcessor(){return this.postProcessor}render(){var t=this;return Ev((function*(){for(const e of t.passes)yield e.render(t.layer);yield t.postProcessor.render(t.layer)}))()}resize(t,e){this.width===t&&this.height===e||(this.postProcessor.resize(t,e),this.width=t,this.height=e)}add(t,e){t.getType()===y_.PostProcessing?this.postProcessor.add(t,this.layer,e):(t.init(this.layer,e),this.passes.push(t))}insert(t,e,r){t.init(this.layer,e),this.passes.splice(r,0,t)}destroy(){this.passes.length=0}}class ab extends nb{constructor(...t){var e;super(...t),e=this,g_(this,"pickingFBO",void 0),g_(this,"layer",void 0),g_(this,"width",0),g_(this,"height",0),g_(this,"alreadyInRendering",!1),g_(this,"pickFromPickingFBO",(({x:t,y:r,lngLat:n,type:i})=>{if(!this.layer.isVisible()||!this.layer.needPick(i))return;const{getViewportSize:o,readPixelsAsync:a,useFramebuffer:s}=this.rendererService,{width:l,height:u}=o(),{enableHighlight:c,enableSelect:h}=this.layer.getLayerConfig(),p=t*yd,d=r*yd;if(p>l||p<0||d>u||d<0)return;let f;s(this.pickingFBO,Ev((function*(){var o;if(f=yield a({x:Math.round(p),y:Math.round(u-(r+1)*yd),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}),0!==f[0]||0!==f[1]||0!==f[2]){const o=Pe(f),a=e.layer.getSource().getFeatureById(o),s={x:t,y:r,type:i,lngLat:n,featureId:o,feature:a};a&&(e.layer.setCurrentPickId(o),e.triggerHoverOnLayer(s))}else{const o={x:t,y:r,lngLat:n,type:null===e.layer.getCurrentPickId()?"un"+i:"mouseout",featureId:null,feature:null};e.triggerHoverOnLayer(v_(v_({},o),{},{type:"unpick"})),e.triggerHoverOnLayer(o),e.layer.setCurrentPickId(null)}c&&e.highlightPickedFeature(f),h&&"click"===i&&(null===(o=f)||void 0===o?void 0:o.toString())!==[0,0,0,0].toString()&&e.selectFeature(f)})))}))}getType(){return y_.Normal}getName(){return"pixelPicking"}init(t,e){super.init(t,e),this.layer=t;const{createTexture2D:r,createFramebuffer:n,getViewportSize:i}=this.rendererService,{width:o,height:a}=i(),s=r({width:o,height:a,wrapS:x_.CLAMP_TO_EDGE,wrapT:x_.CLAMP_TO_EDGE,label:"Picking Texture"});this.pickingFBO=n({color:s}),this.interactionService.on(tv.Hover,this.pickFromPickingFBO),this.interactionService.on(tv.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(tv.Active,this.highlightFeatureHandle.bind(this))}render(t){if(this.alreadyInRendering)return;const{getViewportSize:e,useFramebuffer:r,clear:n}=this.rendererService,{width:i,height:o}=e();this.alreadyInRendering=!0,this.width===i&&this.height===o||(this.pickingFBO.resize({width:i,height:o}),this.width=i,this.height=o),r(this.pickingFBO,(()=>{n({framebuffer:this.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});const e=this.layer.multiPassRenderer.getRenderFlag();this.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),this.layer.multiPassRenderer.setRenderFlag(e),this.alreadyInRendering=!1}))}triggerHoverOnLayer(t){this.layer.emit(t.type,t)}highlightPickedFeature(t){const[e,r,n]=t;this.layer.hooks.beforeHighlight.call([e,r,n]),this.layerService.renderLayers()}selectFeature(t){const[e,r,n]=t;this.layer.hooks.beforeSelect.call([e,r,n]),this.layerService.renderLayers()}selectFeatureHandle({featureId:t}){const e=De(t);this.selectFeature(new Uint8Array(e))}highlightFeatureHandle({featureId:t}){const e=De(t);this.highlightPickedFeature(new Uint8Array(e))}}class sb{constructor(t){g_(this,"passes",[]),g_(this,"readFBO",void 0),g_(this,"writeFBO",void 0),this.rendererService=t,this.init()}getReadFBO(){return this.readFBO}getWriteFBO(){return this.writeFBO}getCurrentFBOTex(){const{getViewportSize:t,createTexture2D:e}=this.rendererService,{width:r,height:n}=t();return e({x:0,y:0,width:r,height:n,copy:!0})}getReadFBOTex(){var t=this;const{useFramebuffer:e}=this.rendererService;return new Promise((r=>{e(this.readFBO,Ev((function*(){r(t.getCurrentFBOTex())})))}))}renderBloomPass(t,e){var r=this;return Ev((function*(){const n=yield r.getReadFBOTex();let i=0;for(;i<4;)yield e.render(t,n),r.swap(),i++}))()}render(t){var e=this;return Ev((function*(){for(let r=0;r<e.passes.length;r++){const n=e.passes[r];n.setRenderToScreen(e.isLastEnabledPass(r)),"bloom"===n.getName()?yield e.renderBloomPass(t,n):(yield n.render(t),r!==e.passes.length-1&&e.swap())}}))()}resize(t,e){this.readFBO.resize({width:t,height:e}),this.writeFBO.resize({width:t,height:e})}add(t,e,r){t.init(e,r),this.passes.push(t)}insert(t,e,r,n){t.init(r,n),this.passes.splice(e,0,t)}getPostProcessingPassByName(t){return this.passes.find((e=>e.getName()===t))}init(){const{createFramebuffer:t,createTexture2D:e}=this.rendererService;this.readFBO=t({color:e({width:1,height:1,wrapS:x_.CLAMP_TO_EDGE,wrapT:x_.CLAMP_TO_EDGE,usage:xy.RENDER_TARGET})}),this.writeFBO=t({color:e({width:1,height:1,wrapS:x_.CLAMP_TO_EDGE,wrapT:x_.CLAMP_TO_EDGE,usage:xy.RENDER_TARGET})})}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].isEnabled())return!1;return!0}swap(){const t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}class lb extends nb{getType(){return y_.Normal}getName(){return"render"}init(t,e){super.init(t,e)}render(t){const{useFramebuffer:e,clear:r}=this.rendererService,n=t.multiPassRenderer.getPostProcessor().getReadFBO();e(n,(()=>{r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:n}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach((e=>{e.draw({uniforms:t.layerModel.getUninforms()})})),t.multiPassRenderer.setRenderFlag(!0)}))}}const{isNil:ub}=ld;class cb extends S_{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nfloat luminance(vec4 color) {\n  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\n\nvoid main() {\n  // vec4 baseColor = texture2D(u_Texture, v_UV);\n\n  float r = sqrt(u_radius);\n\n  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\n  // c1 *= luminance(c1);\n  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\n  // c2 *= luminance(c2);\n  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\n  // c3 *= luminance(c3);\n  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\n  // c4 *= luminance(c4);\n  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\n\n  // float lum = luminance(inbloomColor);\n  // inbloomColor.rgb *= lum;\n\n  if(u_BloomFinal > 0.0) {\n    vec4 baseColor = texture2D(u_Texture2, v_UV);\n    float baselum = luminance(baseColor);\n    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\n    if(baselum <= 0.2) {\n      gl_FragColor = inbloomColor * u_intensity;\n    }\n  } else {\n    gl_FragColor = inbloomColor;\n  }\n}"});const{vs:t,fs:e,uniforms:r}=this.shaderModuleService.getModule("blur-pass"),{width:n,height:i}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:v_(v_({},r),{},{u_ViewportSize:[n,i]})}}convertOptionsToUniforms(t){const e={};return ub(t.bloomRadius)||(e.u_radius=t.bloomRadius),ub(t.bloomIntensity)||(e.u_intensity=t.bloomIntensity),ub(t.bloomBaseRadio)||(e.u_baseRadio=t.bloomBaseRadio),e}}const{isNil:hb}=ld;class pb extends S_{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});const{vs:t,fs:e,uniforms:r}=this.shaderModuleService.getModule("blur-pass"),{width:n,height:i}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:v_(v_({},r),{},{u_ViewportSize:[n,i]})}}convertOptionsToUniforms(t){const e={};return hb(t.blurRadius)||(e.u_BlurDir=[t.blurRadius,0]),e}}const{isNil:db}=ld;class fb extends S_{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});const{vs:t,fs:e,uniforms:r}=this.shaderModuleService.getModule("blur-pass"),{width:n,height:i}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:v_(v_({},r),{},{u_ViewportSize:[n,i]})}}convertOptionsToUniforms(t){const e={};return db(t.blurRadius)||(e.u_BlurDir=[0,t.blurRadius]),e}}class mb extends S_{setupShaders(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:'varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n\n#pragma include "common"\n\nfloat scale = PI / u_Size;\n\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(u_Angle), c = cos(u_Angle);\n  vec2 tex = texCoord * texSize - u_Center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n    cmy * 10.0 - 3.0 + vec3(\n      pattern(u_Angle + 0.26179, texSize, texCoord),\n      pattern(u_Angle + 1.30899, texSize, texCoord),\n      pattern(u_Angle, texSize, texCoord)\n    ),\n    0.0,\n    1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});const{vs:t,fs:e,uniforms:r}=this.shaderModuleService.getModule("colorhalftone-pass"),{width:n,height:i}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:v_(v_({},r),{},{u_ViewportSize:[n,i]})}}}class gb extends S_{setupShaders(){return this.shaderModuleService.registerModule("copy-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}"}),this.shaderModuleService.getModule("copy-pass")}}class _b extends S_{setupShaders(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= u_Scale / texSize;\n  return texture2D(texture, choice + u_Center);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});const{vs:t,fs:e,uniforms:r}=this.shaderModuleService.getModule("hexagonalpixelate-pass"),{width:n,height:i}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:v_(v_({},r),{},{u_ViewportSize:[n,i]})}}}class vb extends S_{setupShaders(){this.shaderModuleService.registerModule("ink-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});const{vs:t,fs:e,uniforms:r}=this.shaderModuleService.getModule("ink-pass"),{width:n,height:i}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:v_(v_({},r),{},{u_ViewportSize:[n,i]})}}}class yb extends S_{setupShaders(){return this.shaderModuleService.registerModule("noise-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * u_Amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}class xb extends S_{setupShaders(){return this.shaderModuleService.registerModule("sepia-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform float u_Amount : 0.5;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\n  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\n  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}const bb=new class{constructor(){g_(this,"sceneConfigCache",{}),g_(this,"layerConfigCache",{}),g_(this,"layerAttributeConfigCache",{})}getSceneConfig(t){return this.sceneConfigCache[t]}getSceneWarninfo(t){return iy[t]}setSceneConfig(t,e){this.sceneConfigCache[t]=v_(v_({},ay),e)}getLayerConfig(t){return this.layerConfigCache[t]}setLayerConfig(t,e,r){this.layerConfigCache[e]=v_({},oy({},this.sceneConfigCache[t],sy,r))}getAttributeConfig(t){return this.layerAttributeConfigCache[t]}setAttributeConfig(t,e){this.layerAttributeConfigCache[t]=v_(v_({},this.layerAttributeConfigCache[t]),e)}clean(){this.sceneConfigCache={},this.layerConfigCache={}}};let Eb=0;function Tb(t){const e=v_({},t);return e.postProcessor=new sb(e.rendererService),e.multiPassRenderer=new ob(e.postProcessor),e.styleAttributeService=new My(e.rendererService),e}const Sb=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];let Ab=function(t){return t.IMAGE="image",t.CUSTOMIMAGE="customImage",t.ARRAYBUFFER="arraybuffer",t.RGB="rgb",t.TERRAINRGB="terrainRGB",t.CUSTOMRGB="customRGB",t.CUSTOMARRAYBUFFER="customArrayBuffer",t.CUSTOMTERRAINRGB="customTerrainRGB",t}({});var wb=(t,e,r)=>new Promise(((n,i)=>{var o=t=>{try{s(r.next(t))}catch(t){i(t)}},a=t=>{try{s(r.throw(t))}catch(t){i(t)}},s=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,a);s((r=r.apply(t,e)).next())})),Cb=(t,e)=>wb(void 0,null,(function*(){return new Promise(((r,n)=>{e({x:t.x,y:t.y,z:t.z},((t,e)=>{var i,o;!t&&e?e instanceof ArrayBuffer?(i=e,o=(t,e)=>{t&&n(t),r(e)},"function"==typeof createImageBitmap?Qt(i,o):$t(i,o)):e instanceof HTMLImageElement?r(e):n(t):n(t)}))}))}));function Rb(t,e){return Array.isArray(t)?"string"==typeof t[0]?t.map((t=>mf(t,e))):t.map((t=>({url:mf(t.url,e),bands:t.bands||[0]}))):mf(t,e)}function Lb(t,e){t.xhrCancel=()=>{e.map((t=>{t.abort()}))}}var Ib=Object.defineProperty,Mb=Object.defineProperties,Ob=Object.getOwnPropertyDescriptors,Pb=Object.getOwnPropertySymbols,Db=Object.prototype.hasOwnProperty,Bb=Object.prototype.propertyIsEnumerable,Nb=(t,e,r)=>e in t?Ib(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fb=(t,e)=>{for(var r in e||(e={}))Db.call(e,r)&&Nb(t,r,e[r]);if(Pb)for(var r of Pb(e))Bb.call(e,r)&&Nb(t,r,e[r]);return t},kb=(t,e)=>Mb(t,Ob(e)),Ub=(t,e,r)=>new Promise(((n,i)=>{var o=t=>{try{s(r.next(t))}catch(t){i(t)}},a=t=>{try{s(r.throw(t))}catch(t){i(t)}},s=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,a);s((r=r.apply(t,e)).next())})),zb=(t,e,r,n,i)=>Ub(void 0,null,(function*(){const o="string"==typeof(a=e.url)?[{url:a,bands:[0]}]:"string"==typeof a[0]?a.map((t=>({url:t,bands:[0]}))):a;var a;if(o.length>1){const{rasterFiles:a,xhrList:s,errList:l}=yield function(t,e){return Ub(this,null,(function*(){const r=[],n=[],i=[];for(let o=0;o<t.length;o++){const a=t[o],s=kb(Fb({},e),{url:a.url}),l=a.bands,{err:u,data:c,xhr:h}=yield Zt(kb(Fb({},s),{type:"arrayBuffer"}));u&&i.push(u),n.push(h),r.push({data:c,bands:l})}return{rasterFiles:r,xhrList:n,errList:i}}))}(o,e);if(Lb(t,s),l.length>0)return void r(l,null);d_(a,n,i,r)}else{const a=Yt(e,((t,e)=>{if(t)r(t);else if(e){d_([{data:e,bands:o[0].bands}],n,i,r)}}));Lb(t,[a])}}));var Gb=Object.defineProperty,jb=Object.defineProperties,Vb=Object.getOwnPropertyDescriptors,Hb=Object.getOwnPropertySymbols,Wb=Object.prototype.hasOwnProperty,Xb=Object.prototype.propertyIsEnumerable,Zb=(t,e,r)=>e in t?Gb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qb=(t,e)=>{for(var r in e||(e={}))Wb.call(e,r)&&Zb(t,r,e[r]);if(Hb)for(var r of Hb(e))Xb.call(e,r)&&Zb(t,r,e[r]);return t},Yb=(t,e)=>jb(t,Vb(e)),Kb=(t,e,r)=>new Promise(((n,i)=>{var o=t=>{try{s(r.next(t))}catch(t){i(t)}},a=t=>{try{s(r.throw(t))}catch(t){i(t)}},s=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,a);s((r=r.apply(t,e)).next())})),$b=(t,e,r,n)=>Kb(void 0,null,(function*(){let i;const o=Array.isArray(t)?t[0]:t;if(n.wmtsOptions){const t=(null==n?void 0:n.getURLFromTemplate)||gf;i=t(o,qb(qb({},e),n.wmtsOptions))}else{const t=(null==n?void 0:n.getURLFromTemplate)||mf;i=t(o,e)}return new Promise(((t,e)=>{var o;const a=Jt(Yb(qb({},null==n?void 0:n.requestParameters),{url:i,type:(null==(o=null==n?void 0:n.requestParameters)?void 0:o.type)||"arrayBuffer"}),((r,n)=>{r?e(r):n&&t(n)}),n.transformResponse);r.xhrCancel=()=>a.cancel()}))})),Qb=()=>({rasterData:new Uint8Array([0]),width:1,height:1}),Jb=Object.defineProperty,tE=Object.defineProperties,eE=Object.getOwnPropertyDescriptors,rE=Object.getOwnPropertySymbols,nE=Object.prototype.hasOwnProperty,iE=Object.prototype.propertyIsEnumerable,oE=(t,e,r)=>e in t?Jb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,aE=(t,e)=>{for(var r in e||(e={}))nE.call(e,r)&&oE(t,r,e[r]);if(rE)for(var r of rE(e))iE.call(e,r)&&oE(t,r,e[r]);return t},sE={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};Ab.ARRAYBUFFER,Ab.RGB;var lE=Object.defineProperty,uE=Object.defineProperties,cE=Object.getOwnPropertyDescriptors,hE=Object.getOwnPropertySymbols,pE=Object.prototype.hasOwnProperty,dE=Object.prototype.propertyIsEnumerable,fE=(t,e,r)=>e in t?lE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mE=(t,e)=>{for(var r in e||(e={}))pE.call(e,r)&&fE(t,r,e[r]);if(hE)for(var r of hE(e))dE.call(e,r)&&fE(t,r,e[r]);return t};var gE=Object.defineProperty,_E=Object.defineProperties,vE=Object.getOwnPropertyDescriptors,yE=Object.getOwnPropertySymbols,xE=Object.prototype.hasOwnProperty,bE=Object.prototype.propertyIsEnumerable,EE=(t,e,r)=>e in t?gE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,TE=(t,e)=>{for(var r in e||(e={}))xE.call(e,r)&&EE(t,r,e[r]);if(yE)for(var r of yE(e))bE.call(e,r)&&EE(t,r,e[r]);return t},SE=(t,e)=>_E(t,vE(e));var AE=Object.defineProperty,wE=Object.defineProperties,CE=Object.getOwnPropertyDescriptors,RE=Object.getOwnPropertySymbols,LE=Object.prototype.hasOwnProperty,IE=Object.prototype.propertyIsEnumerable,ME=(t,e,r)=>e in t?AE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,OE=(t,e)=>{for(var r in e||(e={}))LE.call(e,r)&&ME(t,r,e[r]);if(RE)for(var r of RE(e))IE.call(e,r)&&ME(t,r,e[r]);return t};var PE=Object.defineProperty,DE=Object.defineProperties,BE=Object.getOwnPropertyDescriptors,NE=Object.getOwnPropertySymbols,FE=Object.prototype.hasOwnProperty,kE=Object.prototype.propertyIsEnumerable,UE=(t,e,r)=>e in t?PE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zE=(t,e)=>{for(var r in e||(e={}))FE.call(e,r)&&UE(t,r,e[r]);if(NE)for(var r of NE(e))kE.call(e,r)&&UE(t,r,e[r]);return t},GE={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},jE=t=>{return e=void 0,r=null,n=function*(){return new Promise((e=>{const[r,n,i,o]=t.bounds;e({layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(r+i)/2,y:(n+o)/2},geometry:{type:"LineString",coordinates:[[i,o],[i,n],[r,n],[r,n]]}}]}}})}))},new Promise(((t,i)=>{var o=t=>{try{s(n.next(t))}catch(t){i(t)}},a=t=>{try{s(n.throw(t))}catch(t){i(t)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,a);s((n=n.apply(e,r)).next())}));var e,r,n};var VE={exports:{}};!function(t,e){t.exports=function(){function t(r,n,i,o,a,s){if(!(a-o<=i)){var l=o+a>>1;e(r,n,l,o,a,s%2),t(r,n,i,o,l-1,s+1),t(r,n,i,l+1,a,s+1)}}function e(t,n,i,o,a,s){for(;a>o;){if(a-o>600){var l=a-o+1,u=i-o+1,c=Math.log(l),h=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*h*(l-h)/l)*(u-l/2<0?-1:1);e(t,n,i,Math.max(o,Math.floor(i-u*h/l+p)),Math.min(a,Math.floor(i+(l-u)*h/l+p)),s)}var d=n[2*i+s],f=o,m=a;for(r(t,n,o,i),n[2*a+s]>d&&r(t,n,o,a);f<m;){for(r(t,n,f,m),f++,m--;n[2*f+s]<d;)f++;for(;n[2*m+s]>d;)m--}n[2*o+s]===d?r(t,n,o,m):r(t,n,++m,a),m<=i&&(o=m+1),i<=m&&(a=m-1)}}function r(t,e,r,i){n(t,r,i),n(e,2*r,2*i),n(e,2*r+1,2*i+1)}function n(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function i(t,e,r,n,i,o,a){for(var s,l,u=[0,t.length-1,0],c=[];u.length;){var h=u.pop(),p=u.pop(),d=u.pop();if(p-d<=a)for(var f=d;f<=p;f++)s=e[2*f],l=e[2*f+1],s>=r&&s<=i&&l>=n&&l<=o&&c.push(t[f]);else{var m=Math.floor((d+p)/2);s=e[2*m],l=e[2*m+1],s>=r&&s<=i&&l>=n&&l<=o&&c.push(t[m]);var g=(h+1)%2;(0===h?r<=s:n<=l)&&(u.push(d),u.push(m-1),u.push(g)),(0===h?i>=s:o>=l)&&(u.push(m+1),u.push(p),u.push(g))}}return c}function o(t,e,r,n,i,o){for(var s=[0,t.length-1,0],l=[],u=i*i;s.length;){var c=s.pop(),h=s.pop(),p=s.pop();if(h-p<=o)for(var d=p;d<=h;d++)a(e[2*d],e[2*d+1],r,n)<=u&&l.push(t[d]);else{var f=Math.floor((p+h)/2),m=e[2*f],g=e[2*f+1];a(m,g,r,n)<=u&&l.push(t[f]);var _=(c+1)%2;(0===c?r-i<=m:n-i<=g)&&(s.push(p),s.push(f-1),s.push(_)),(0===c?r+i>=m:n+i>=g)&&(s.push(f+1),s.push(h),s.push(_))}}return l}function a(t,e,r,n){var i=t-r,o=e-n;return i*i+o*o}var s=function(t){return t[0]},l=function(t){return t[1]},u=function(e,r,n,i,o){void 0===r&&(r=s),void 0===n&&(n=l),void 0===i&&(i=64),void 0===o&&(o=Float64Array),this.nodeSize=i,this.points=e;for(var a=e.length<65536?Uint16Array:Uint32Array,u=this.ids=new a(e.length),c=this.coords=new o(2*e.length),h=0;h<e.length;h++)u[h]=h,c[2*h]=r(e[h]),c[2*h+1]=n(e[h]);t(u,c,i,0,u.length-1,0)};u.prototype.range=function(t,e,r,n){return i(this.ids,this.coords,t,e,r,n,this.nodeSize)},u.prototype.within=function(t,e,r){return o(this.ids,this.coords,t,e,r,this.nodeSize)};var c={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},h=Math.fround||function(t){return function(e){return t[0]=+e,t[0]}}(new Float32Array(1)),p=function(t){this.options=b(Object.create(c),t),this.trees=new Array(this.options.maxZoom+1)};function d(t,e,r,n,i){return{x:h(t),y:h(e),zoom:1/0,id:r,parentId:-1,numPoints:n,properties:i}}function f(t,e){var r=t.geometry.coordinates,n=r[0],i=r[1];return{x:h(_(n)),y:h(v(i)),zoom:1/0,index:e,parentId:-1}}function m(t){return{type:"Feature",id:t.id,properties:g(t),geometry:{type:"Point",coordinates:[y(t.x),x(t.y)]}}}function g(t){var e=t.numPoints,r=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return b(b({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function _(t){return t/360+.5}function v(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function y(t){return 360*(t-.5)}function x(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function b(t,e){for(var r in e)t[r]=e[r];return t}function E(t){return t.x}function T(t){return t.y}return p.prototype.load=function(t){var e=this.options,r=e.log,n=e.minZoom,i=e.maxZoom,o=e.nodeSize;r&&console.time("total time");var a="prepare "+t.length+" points";r&&console.time(a),this.points=t;for(var s=[],l=0;l<t.length;l++)t[l].geometry&&s.push(f(t[l],l));this.trees[i+1]=new u(s,E,T,o,Float32Array),r&&console.timeEnd(a);for(var c=i;c>=n;c--){var h=+Date.now();s=this._cluster(s,c),this.trees[c]=new u(s,E,T,o,Float32Array),r&&console.log("z%d: %d clusters in %dms",c,s.length,+Date.now()-h)}return r&&console.timeEnd("total time"),this},p.prototype.getClusters=function(t,e){var r=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,i=180;else if(r>i){var a=this.getClusters([r,n,180,o],e),s=this.getClusters([-180,n,i,o],e);return a.concat(s)}for(var l=this.trees[this._limitZoom(e)],u=[],c=0,h=l.range(_(r),v(o),_(i),v(n));c<h.length;c+=1){var p=h[c],d=l.points[p];u.push(d.numPoints?m(d):this.points[d.index])}return u},p.prototype.getChildren=function(t){var e=this._getOriginId(t),r=this._getOriginZoom(t),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);var o=i.points[e];if(!o)throw new Error(n);for(var a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=[],l=0,u=i.within(o.x,o.y,a);l<u.length;l+=1){var c=u[l],h=i.points[c];h.parentId===t&&s.push(h.numPoints?m(h):this.points[h.index])}if(0===s.length)throw new Error(n);return s},p.prototype.getLeaves=function(t,e,r){e=e||10,r=r||0;var n=[];return this._appendLeaves(n,t,e,r,0),n},p.prototype.getTile=function(t,e,r){var n=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius/a,l=(r-s)/i,u=(r+1+s)/i,c={features:[]};return this._addTileFeatures(n.range((e-s)/i,l,(e+1+s)/i,u),n.points,e,r,i,c),0===e&&this._addTileFeatures(n.range(1-s/i,l,1,u),n.points,i,r,i,c),e===i-1&&this._addTileFeatures(n.range(0,l,s/i,u),n.points,-1,r,i,c),c.features.length?c:null},p.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id}return e},p.prototype._appendLeaves=function(t,e,r,n,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],l=s.properties;if(l&&l.cluster?i+l.point_count<=n?i+=l.point_count:i=this._appendLeaves(t,l.cluster_id,r,n,i):i<n?i++:t.push(s),t.length===r)break}return i},p.prototype._addTileFeatures=function(t,e,r,n,i,o){for(var a=0,s=t;a<s.length;a+=1){var l=e[s[a]],u=l.numPoints,c=void 0,h=void 0,p=void 0;if(u)c=g(l),h=l.x,p=l.y;else{var d=this.points[l.index];c=d.properties,h=_(d.geometry.coordinates[0]),p=v(d.geometry.coordinates[1])}var f={type:1,geometry:[[Math.round(this.options.extent*(h*i-r)),Math.round(this.options.extent*(p*i-n))]],tags:c},m=void 0;u?m=l.id:this.options.generateId?m=l.index:this.points[l.index].id&&(m=this.points[l.index].id),void 0!==m&&(f.id=m),o.features.push(f)}},p.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))},p.prototype._cluster=function(t,e){for(var r=[],n=this.options,i=n.radius,o=n.extent,a=n.reduce,s=n.minPoints,l=i/(o*Math.pow(2,e)),u=0;u<t.length;u++){var c=t[u];if(!(c.zoom<=e)){c.zoom=e;for(var h=this.trees[e+1],p=h.within(c.x,c.y,l),f=c.numPoints||1,m=f,g=0,_=p;g<_.length;g+=1){var v=_[g],y=h.points[v];y.zoom>e&&(m+=y.numPoints||1)}if(m>f&&m>=s){for(var x=c.x*f,b=c.y*f,E=a&&f>1?this._map(c,!0):null,T=(u<<5)+(e+1)+this.points.length,S=0,A=p;S<A.length;S+=1){var w=A[S],C=h.points[w];if(!(C.zoom<=e)){C.zoom=e;var R=C.numPoints||1;x+=C.x*R,b+=C.y*R,C.parentId=T,a&&(E||(E=this._map(c,!0)),a(E,this._map(C)))}}c.parentId=T,r.push(d(x/m,b/m,T,m,E))}else if(r.push(c),m>1)for(var L=0,I=p;L<I.length;L+=1){var M=I[L],O=h.points[M];O.zoom<=e||(O.zoom=e,r.push(O))}}}return r},p.prototype._getOriginId=function(t){return t-this.points.length>>5},p.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},p.prototype._map=function(t,e){if(t.numPoints)return e?b({},t.properties):t.properties;var r=this.points[t.index].properties,n=this.options.map(r);return e&&n===r?b({},n):n},p}()}(VE);var HE=VE.exports,WE=Object.defineProperty,XE=Object.getOwnPropertySymbols,ZE=Object.prototype.hasOwnProperty,qE=Object.prototype.propertyIsEnumerable,YE=(t,e,r)=>e in t?WE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,KE=(t,e)=>{for(var r in e||(e={}))ZE.call(e,r)&&YE(t,r,e[r]);if(XE)for(var r of XE(e))qE.call(e,r)&&YE(t,r,e[r]);return t};function $E(t,e){const{radius:r=40,maxZoom:n=18,minZoom:i=0,zoom:o=2}=e;if(t.pointIndex){const e=t.pointIndex.getClusters(t.extent,Math.floor(o));return t.dataArray=e.map(((t,e)=>KE({coordinates:t.geometry.coordinates,_id:e+1},t.properties))),t}const a=new HE({radius:r,minZoom:i,maxZoom:n}),s={type:"FeatureCollection",features:[]};return s.features=t.dataArray.map((t=>({type:"Feature",geometry:{type:"Point",coordinates:t.coordinates},properties:KE({},t)}))),a.load(s.features),a}function QE(t){if(0===t.length)return 0;let e,r=t[0],n=0;for(let i=1;i<t.length;i++)e=r+1*t[i],Math.abs(r)>=Math.abs(t[i])?n+=r-e+t[i]:n+=t[i]-e+r,r=e;return r+1*n}var JE={min:function(t){if(0===t.length)throw new Error("min requires at least one data point");let e=t[0];for(let r=1;r<t.length;r++)t[r]<e&&(e=t[r]);return e},max:function(t){if(0===t.length)throw new Error("max requires at least one data point");let e=t[0];for(let r=1;r<t.length;r++)t[r]>e&&(e=t[r]);return e},mean:function(t){if(0===t.length)throw new Error("mean requires at least one data point");return QE(t)/t.length},sum:QE},tT=Object.defineProperty,eT=Object.getOwnPropertySymbols,rT=Object.prototype.hasOwnProperty,nT=Object.prototype.propertyIsEnumerable,iT=(t,e,r)=>e in t?tT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oT=(t,e)=>{for(var r in e||(e={}))rT.call(e,r)&&iT(t,r,e[r]);if(eT)for(var r of eT(e))nT.call(e,r)&&iT(t,r,e[r]);return t},aT=(t,e,r)=>new Promise(((n,i)=>{var o=t=>{try{s(r.next(t))}catch(t){i(t)}},a=t=>{try{s(r.throw(t))}catch(t){i(t)}},s=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,a);s((r=r.apply(t,e)).next())})),{cloneDeep:sT,isFunction:lT,isString:uT,mergeWith:cT}=ld;function hT(t,e){if(Array.isArray(e))return e}var pT=class extends Vd.exports.EventEmitter{constructor(t,e){super(),this.type="source",this.isTile=!1,this.inited=!1,this.hooks={init:new cx},this.parser={type:"geojson"},this.transforms=[],this.cluster=!1,this.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},this.invalidExtent=!1,this.dataArrayChanged=!1,this.cfg={autoRender:!0},this.originData=t,this.initCfg(e),this.init().then((()=>{this.inited=!0,this.emit("update",{type:"inited"})}))}getSourceCfg(){return this.cfg}getClusters(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}getClustersLeaves(t){return this.clusterIndex.getLeaves(t,1/0)}getParserType(){return this.parser.type}updateClusterData(t){const{method:e="sum",field:r}=this.clusterOptions;let n=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,n.forEach((t=>{t.id||(t.properties.point_count=1)})),(r||lT(e))&&(n=n.map((t=>{const n=t.id;if(n){const i=this.clusterIndex.getLeaves(n,1/0).map((t=>t.properties));let o;if(uT(e)&&r){const t=function(t,e){return t.map((t=>1*t[e]))}(i,r);o=JE[e](t)}lT(e)&&(o=e(i)),t.properties.stat=o}else t.properties.point_count=1;return t}))),this.data=dt("geojson")({type:"FeatureCollection",features:n}),this.executeTrans()}getFeatureById(t){const{type:e="geojson",geometry:r}=this.parser;if("geojson"!==e||this.cluster)return"json"===e&&r?this.data.dataArray.find((e=>e._id===t)):t<this.data.dataArray.length?this.data.dataArray[t]:"null";{const e=t<this.originData.features.length?this.originData.features[t]:"null",r=sT(e);if((null==r?void 0:r.properties)&&(0!==this.transforms.length||this.dataArrayChanged)){const e=this.data.dataArray.find((e=>e._id===t));r.properties=e}return r}}updateFeaturePropertiesById(t,e){this.data.dataArray=this.data.dataArray.map((r=>r._id===t?oT(oT({},r),e):r)),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}getFeatureId(t,e){const r=this.data.dataArray.find((r=>r[t]===e));return null==r?void 0:r._id}setData(t,e){this.originData=t,this.dataArrayChanged=!1,this.initCfg(e),this.init().then((()=>{this.emit("update",{type:"update"})}))}reloadAllTile(){var t;null==(t=this.tileset)||t.reloadAll()}reloadTilebyId(t,e,r){var n;null==(n=this.tileset)||n.reloadTileById(t,e,r)}reloadTileByLnglat(t,e,r){var n;null==(n=this.tileset)||n.reloadTileByLnglat(t,e,r)}getTileExtent(t,e){var r;return null==(r=this.tileset)?void 0:r.getTileExtent(t,e)}getTileByZXY(t,e,r){var n;return null==(n=this.tileset)?void 0:n.getTileByZXY(t,e,r)}reloadTileByExtent(t,e){var r;null==(r=this.tileset)||r.reloadTileByExtent(t,e)}destroy(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null==(t=this.tileset)||t.destroy()}processData(){return aT(this,null,(function*(){return new Promise(((t,e)=>{try{this.excuteParser(),this.initCluster(),this.executeTrans(),t({})}catch(t){e(t)}}))}))}initCfg(t){this.cfg=cT(this.cfg,t,hT);const e=this.cfg;e&&(e.parser&&(this.parser=e.parser),e.transforms&&(this.transforms=e.transforms),this.cluster=e.cluster||!1,e.clusterOptions&&(this.cluster=!0,this.clusterOptions=oT(oT({},this.clusterOptions),e.clusterOptions)))}init(){return aT(this,null,(function*(){this.inited=!1,yield this.processData(),this.inited=!0}))}excuteParser(){const t=this.parser,e=t.type||"geojson",r=dt(e);this.data=r(this.originData,t),this.tileset=this.initTileset(),t.cancelExtent||(this.extent=Cd(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}setCenter(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}initTileset(){const{tilesetOptions:t}=this.data;if(!t)return;if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(t),this.tileset;return new df(oT({},t))}executeTrans(){this.transforms.forEach((t=>{const{type:e}=t,r=(t=>ht[t])(e)(this.data,t);Object.assign(this.data,r)}))}initCluster(){if(!this.cluster)return;const t=this.clusterOptions||{};this.clusterIndex=$E(this.data,t)}caculClusterExtent(t){let e=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(e=Pd(Bd(this.extent),t)),e[0].concat(e[1])}};var dT=6378e3;var fT=Math.PI/3,mT=[0,fT,2*fT,3*fT,4*fT,5*fT];function gT(t){return t[0]}function _T(t){return t[1]}var vT=Object.defineProperty,yT=Object.defineProperties,xT=Object.getOwnPropertyDescriptors,bT=Object.getOwnPropertySymbols,ET=Object.prototype.hasOwnProperty,TT=Object.prototype.propertyIsEnumerable,ST=(t,e,r)=>e in t?vT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var AT=Object.defineProperty,wT=Object.getOwnPropertySymbols,CT=Object.prototype.hasOwnProperty,RT=Object.prototype.propertyIsEnumerable,LT=(t,e,r)=>e in t?AT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,IT=(t,e)=>{for(var r in e||(e={}))CT.call(e,r)&&LT(t,r,e[r]);if(wT)for(var r of wT(e))RT.call(e,r)&&LT(t,r,e[r]);return t};ft("rasterTile",(function(t,e={}){if(r=t,Array.isArray(r)&&0===r.length||!Array.isArray(r)&&"string"!=typeof r)throw new Error("tile server url is error");var r;let n=(null==e?void 0:e.dataType)||Ab.IMAGE;n===Ab.RGB&&(n=Ab.ARRAYBUFFER);const i=(o=aE(aE({},sE),e),a={getTileData:(r,i)=>{switch(n){case Ab.IMAGE:return $b(t,r,i,e);case Ab.CUSTOMIMAGE:case Ab.CUSTOMTERRAINRGB:return Cb(i,null==e?void 0:e.getCustomData);case Ab.ARRAYBUFFER:return((t,e,r,n)=>Kb(void 0,null,(function*(){const{format:i=Qb,operation:o,requestParameters:a={}}=n,s=Yb(qb({},a),{url:Rb(t,e)});return new Promise(((t,e)=>{zb(r,s,((r,n)=>{r?e(r):n&&t(n)}),i,o)}))})))(t,r,i,e);case Ab.CUSTOMARRAYBUFFER:case Ab.CUSTOMRGB:return((t,e,r,n)=>wb(void 0,null,(function*(){return new Promise(((i,o)=>{e({x:t.x,y:t.y,z:t.z},((t,e)=>{t||0===e.length?o(t):e&&d_([{data:e,bands:[0]}],r,n,((t,e)=>{t?o(t):e&&i(e)}))}))}))})))(i,null==e?void 0:e.getCustomData,(null==e?void 0:e.format)||Qb,null==e?void 0:e.operation);default:return $b(t,r,i,e)}}},tE(o,eE(a)));var o,a;return{data:t,dataArray:[],tilesetOptions:i,isTile:!0}})),ft("mvt",(function(t,e){const r=Array.isArray(t)?t[0]:t,n=qg(Zg(Zg({},Yg),e),{getTileData:(t,n)=>Kg(r,t,n,null==e?void 0:e.requestParameters,null==e?void 0:e.getCustomData)});return{data:r,dataArray:[],tilesetOptions:n,isTile:!0}})),ft("geojsonvt",(function(t,e){const r=function(t){const e={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return void 0===t||void 0===t.geojsonvtOptions?e:Em(Em({},e),t.geojsonvtOptions)}(e),n=r.extent||4096,i=function(t,e){return new pm(t,e)}(t,r);var o;return{data:t,dataArray:[],tilesetOptions:(o=Em(Em({},Tm),e),gm(o,_m({getTileData:(t,e)=>Cm(e,i,t,n)}))),isTile:!0}})),ft("testTile",(function(t,e){var r;return{data:t,dataArray:[],tilesetOptions:(r=zE(zE({},GE),e),DE(r,BE({getTileData:t=>jE(t)}))),isTile:!0}})),ft("geojson",(function(t,e){const r=[],n={};return t.features?(t.features=t.features.filter((t=>{const e=t.geometry;return null!=t&&e&&e.type&&e.coordinates&&e.coordinates.length>0})),0===(t=Ef(t)).features.length?{dataArray:[],featureKeys:n}:(Pt(t,((t,n)=>{let i=function(t,e){return void 0===e?null:"number"==typeof(1*t.properties[e])?1*t.properties[e]:t.properties&&t.properties[e]?function(t){const e=t.toString();let r=5381,n=e.length;for(;n;)r=33*r^e.charCodeAt(--n);return r>>>0}(t.properties[e]+"")%1000019:null}(t,null==e?void 0:e.featureId);null===i&&(i=n);const o=i,a=It(t),s=(l=((t,e)=>{for(var r in e||(e={}))kf.call(e,r)&&zf(t,r,e[r]);if(Ff)for(var r of Ff(e))Uf.call(e,r)&&zf(t,r,e[r]);return t})({},t.properties),Bf(l,Nf({coordinates:a,_id:o})));var l;r.push(s)})),{dataArray:r,featureKeys:n})):(t.features=[],{dataArray:[]})})),ft("jsonTile",(function(t,e){return{dataArray:[],tilesetOptions:Xm(Wm({},e),{getTileData:(r,n)=>Zm(t,n,null==e?void 0:e.requestParameters,e.getCustomData)}),isTile:!0}})),ft("image",Fm),ft("csv",(function(t,e){return Pf(Tt(t),e)})),ft("json",Pf),ft("raster",(function(t,e){const{extent:r=[121.168,30.2828,121.384,30.4219],coordinates:n,width:i,height:o,min:a,max:s,format:l,operation:u}=e;let c,h,p;if(void 0===l||bf(t))c=Array.from(t),h=i,p=o;else{c=p_(Array.isArray(t)?t:[t],l,u)}return{_id:1,dataArray:[{_id:1,data:c,width:h,height:p,min:a,max:s,coordinates:Tf(n,r)}]}})),ft("rasterRgb",(function(t,e){const r=e,{extent:n,coordinates:i,min:o,max:a,width:s,height:l,format:u,operation:c}=r,h=((t,e)=>{var r={};for(var n in t)LE.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&RE)for(var n of RE(t))e.indexOf(n)<0&&IE.call(t,n)&&(r[n]=t[n]);return r})(r,["extent","coordinates","min","max","width","height","format","operation"]);let p;if(void 0===u||bf(t))p=Array.from(t);else{p=p_(Array.isArray(t)?t:[t],u,c)}const d=Tf(i,n);var f,m;return{_id:1,dataArray:[(f=OE({_id:1,data:p,width:s,height:l},h),m={min:o,max:a,coordinates:d},wE(f,CE(m)))]}})),ft("rgb",(function(t,e){const r=e,{extent:n,coordinates:i,width:o,height:a}=r,s=((t,e)=>{var r={};for(var n in t)xE.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&yE)for(var n of yE(t))e.indexOf(n)<0&&bE.call(t,n)&&(r[n]=t[n]);return r})(r,["extent","coordinates","width","height"]);t.length<3&&console.warn("RGB解析需要三个波段的数据");const[l,u,c]=s.bands||[0,1,2],h=[t[l],t[u],t[c]],p=[],[d,f]=(null==s?void 0:s.countCut)||[2,98],m=(null==s?void 0:s.RMinMax)||e_(h[0],d,f),g=(null==s?void 0:s.GMinMax)||e_(h[1],d,f),_=(null==s?void 0:s.BMinMax)||e_(h[2],d,f);for(let t=0;t<h[0].length;t++)p.push(Math.max(0,h[0][t]-m[0])),p.push(Math.max(0,h[1][t]-g[0])),p.push(Math.max(0,h[2][t]-_[0]));const v=Tf(i,n);return{_id:1,dataArray:[SE(TE({_id:1,data:p,width:o,height:a,rMinMax:m,gMinMax:g,bMinMax:_},s),{coordinates:v})]}})),ft("ndi",(function(t,e){const r=e,{extent:n=[121.168,30.2828,121.384,30.4219],coordinates:i,width:o,height:a}=r,s=((t,e)=>{var r={};for(var n in t)pE.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&hE)for(var n of hE(t))e.indexOf(n)<0&&dE.call(t,n)&&(r[n]=t[n]);return r})(r,["extent","coordinates","width","height"]);t.length<2&&console.warn("RGB解析需要2个波段的数据");const[l,u]=s.bands||[0,1],c=[t[l],t[u]],h=[];for(let t=0;t<c[0].length;t++)h.push((c[1][t]-c[0][t])/(c[1][t]+c[0][t]));const p=Tf(i,n);var d,f;return{_id:1,dataArray:[(d=mE({_id:1,data:h,width:o,height:a},s),f={coordinates:p},uE(d,cE(f)))]}})),mt("cluster",$E),mt("filter",(function(t,e){const{callback:r}=e;return r&&(t.dataArray=t.dataArray.filter(r)),t})),mt("join",(function(t,e){const{sourceField:r,targetField:n,data:i}=e,o={};return i.forEach((t=>{o[t[r]]=t})),t.dataArray=t.dataArray.map((t=>{const e=t[n];return IT(IT({},t),o[e])})),t})),mt("map",(function(t,e){const{callback:r}=e;return r&&(t.dataArray=t.dataArray.map(r)),t})),mt("grid",(function(t,e){const r=t.dataArray,{size:n=10}=e,i=n/(2*Math.PI*dT)*(256<<20)/2,{gridHash:o,gridOffset:a}=function(t,e){let r,n=1/0,i=-1/0;for(const e of t)r=e.coordinates[1],Number.isFinite(r)&&(n=r<n?r:n,i=r>i?r:i);const o=function(t,e){const r=(a=t,a/dT*(180/Math.PI)),n=(i=e,o=t,o/dT*(180/Math.PI)/Math.cos(i*Math.PI/180));var i,o;var a;return{yOffset:r,xOffset:n}}(e,(n+i)/2);if(o.xOffset<=0||o.yOffset<=0)return{gridHash:{},gridOffset:o};const a={};for(const e of t){const t=e.coordinates[1],r=e.coordinates[0];if(Number.isFinite(t)&&Number.isFinite(r)){const n=`${Math.floor((t+90)/o.yOffset)}-${Math.floor((r+180)/o.xOffset)}`;a[n]=a[n]||{count:0,points:[]},a[n].count+=1,a[n].points.push(e)}}return{gridHash:a,gridOffset:o}}(r,n),s=function(t,e,r){return Object.keys(t).reduce(((n,i,o)=>{const a=i.split("-"),s=parseInt(a[0],10),l=parseInt(a[1],10),u={};if(r.field&&r.method){const e=Gd(t[i].points,r.field);u[r.method]=zd[r.method](e)}return Object.assign(u,{_id:o,coordinates:Id([e.xOffset*(l+.5)-180,e.yOffset*(s+.5)-90]),rawData:t[i].points,count:t[i].count}),n.push(u),n}),[])}(o,a,e);return{yOffset:i,xOffset:i,radius:i,type:"grid",dataArray:s}})),mt("hexagon",(function(t,e){const r=t.dataArray,{size:n=10,method:i="sum"}=e,o=n/(2*Math.PI*6378e3)*(256<<20)/2,a=r.map((t=>{const[e,r]=Id(t.coordinates);return n=((t,e)=>{for(var r in e||(e={}))ET.call(e,r)&&ST(t,r,e[r]);if(bT)for(var r of bT(e))TT.call(e,r)&&ST(t,r,e[r]);return t})({},t),yT(n,xT({coordinates:[e,r]}));var n})),s=function(){var t,e,r,n=0,i=0,o=1,a=1,s=gT,l=_T;function u(t){var n,i={},o=[],a=t.length;for(n=0;n<a;++n)if(!isNaN(c=+s.call(null,u=t[n],n,t))&&!isNaN(h=+l.call(null,u,n,t))){var u,c,h,p=Math.round(h/=r),d=Math.round(c=c/e-(1&p)/2),f=h-p;if(3*Math.abs(f)>1){var m=c-d,g=d+(c<d?-1:1)/2,_=p+(h<p?-1:1),v=c-g,y=h-_;m*m+f*f>v*v+y*y&&(d=g+(1&p?1:-1)/2,p=_)}var x=d+"-"+p,b=i[x];b?b.push(u):(o.push(b=i[x]=[u]),b.x=(d+(1&p)/2)*e,b.y=p*r)}return o}function c(t){var e=0,r=0;return mT.map((function(n){var i=Math.sin(n)*t,o=-Math.cos(n)*t,a=i-e,s=o-r;return e=i,r=o,[a,s]}))}return u.hexagon=function(e){return"m"+c(null==e?t:+e).join("l")+"z"},u.centers=function(){for(var s=[],l=Math.round(i/r),u=Math.round(n/e),c=l*r;c<a+t;c+=r,++l)for(var h=u*e+(1&l)*e/2;h<o+e/2;h+=e)s.push([h,c]);return s},u.mesh=function(){var e=c(t).slice(0,4).join("l");return u.centers().map((function(t){return"M"+t+"m"+e})).join("")},u.x=function(t){return arguments.length?(s=t,u):s},u.y=function(t){return arguments.length?(l=t,u):l},u.radius=function(n){return arguments.length?(e=2*(t=+n)*Math.sin(fT),r=1.5*t,u):t},u.size=function(t){return arguments.length?(n=i=0,o=+t[0],a=+t[1],u):[o-n,a-i]},u.extent=function(t){return arguments.length?(n=+t[0][0],i=+t[0][1],o=+t[1][0],a=+t[1][1],u):[[n,i],[o,a]]},u.radius(1)}().radius(o).x((t=>t.coordinates[0])).y((t=>t.coordinates[1])),l={dataArray:s(a).map(((t,r)=>{if(e.field&&i){const r=Gd(t,e.field);t[i]=zd[i](r)}return{[e.method]:t[i],count:t.length,rawData:t,coordinates:[t.x,t.y],_id:r}})),radius:o,xOffset:o,yOffset:o,type:"hexagon"};return l}));var MT=pT;class OT extends Vd.exports.EventEmitter{getMarkerLayerContainerSize(){}constructor(t){var e;super(),g_(this,"markerOption",void 0),g_(this,"popup",void 0),g_(this,"mapsService",void 0),g_(this,"lngLat",void 0),g_(this,"scene",void 0),g_(this,"added",!1),g_(this,"preLngLat",{lng:0,lat:0}),g_(this,"onMarkerDragStart",(t=>{const e=this.mapsService.getContainer();if(!e)return;this.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});const{left:r,top:n}=e.getClientRects()[0],{x:i,y:o}=t;this.preLngLat=this.mapsService.containerToLngLat([i-r,o-n]),this.mapsService.on("mousemove",this.onMarkerDragMove),document.addEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragstart",this.lngLat)})),g_(this,"onMarkerDragMove",(t=>{const e=t.lngLat||t.lnglat,{lng:r,lat:n}=this.preLngLat,{lng:i,lat:o}=e,a={lng:this.lngLat.lng+i-r,lat:this.lngLat.lat+o-n};this.setLnglat(a),this.preLngLat=e,this.emit("dragging",a)})),g_(this,"onMarkerDragEnd",(()=>{this.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragend",this.lngLat)})),g_(this,"eventHandle",(t=>{this.polyfillEvent(t),this.emit(t.type,{target:t,data:this.markerOption.extData,lngLat:this.lngLat})})),g_(this,"touchStartTime",void 0),this.markerOption=v_(v_({},this.getDefault()),t),e=this,["update","onMove","onMapClick","updatePositionWhenZoom"].forEach((t=>{e[t]&&(e[t]=e[t].bind(e))})),this.init()}getDefault(){return{element:void 0,anchor:te.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}addTo(t){this.scene=t,this.mapsService=t.mapService;const{element:e}=this.markerOption;return this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.mapsService.on("camerachange",this.update),this.update(),this.updateDraggable(),this.added=!0,this.emit("added"),this}remove(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();const{element:t}=this.markerOption;return t&&dd(t),this.popup&&this.popup.remove(),this}setLnglat(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}getLnglat(){return this.lngLat}getElement(){return this.markerOption.element}setElement(t){if(!this.added)return this.once("added",(()=>{this.setElement(t)})),this;const{element:e}=this.markerOption;return e&&dd(e),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.updateDraggable(),this.update(),this}openPopup(){if(!this.added)return this.once("added",(()=>{this.openPopup()})),this;const t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}closePopup(){this.added||this.once("added",(()=>{this.closePopup()}));const t=this.popup;return t&&t.remove(),this}setPopup(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}togglePopup(){const t=this.popup;return t?(t.isOpen()?t.remove():t.addTo(this.scene),this):this}getPopup(){return this.popup}getOffset(){return this.markerOption.offsets}setDraggable(t){this.markerOption.draggable=t,this.updateDraggable()}getDraggable(){return this.markerOption.draggable}getExtData(){return this.markerOption.extData}setExtData(t){this.markerOption.extData=t}update(){if(!this.mapsService)return;const{element:t,anchor:e}=this.markerOption;var r,n;this.updatePosition(),r=t,n=`${ee[e]}`,r.style[vd]=n}updatePositionWhenZoom(t){if(!this.mapsService)return;const{element:e,offsets:r}=this.markerOption,{lng:n,lat:i}=this.lngLat;if(e){e.style.display="block",e.style.whiteSpace="nowrap";const{containerHeight:o,containerWidth:a,bounds:s}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!s)return;const l=t.map,u=t.center,c=t.zoom,h=l.DE(this.lngLat,c,u);if(h.x=Math.round(h.x+r[0]),h.y=Math.round(h.y-r[1]),Math.abs(s[0][0])>180||Math.abs(s[1][0])>180){if(h.x>a){const t=this.mapsService.lngLatToContainer([n-360,i]);h.x=t.x}if(h.x<0){const t=this.mapsService.lngLatToContainer([n+360,i]);h.x=t.x}}(h.x>a||h.x<0||h.y>o||h.y<0)&&(e.style.display="none"),e.style.left=h.x+"px",e.style.top=h.y+"px",e.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)"}}onMapClick(t){const{element:e}=this.markerOption;this.popup&&e&&this.togglePopup()}getCurrentContainerSize(){const t=this.mapsService.getContainer();return{containerHeight:(null==t?void 0:t.scrollHeight)||0,containerWidth:(null==t?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}updateDraggable(){const{element:t}=this.markerOption;null==t||t.removeEventListener("mousedown",this.onMarkerDragStart),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.markerOption.draggable&&(null==t||t.addEventListener("mousedown",this.onMarkerDragStart))}updatePosition(){if(!this.mapsService)return;const{element:t,offsets:e}=this.markerOption,{lng:r,lat:n}=this.lngLat,i=this.mapsService.lngLatToContainer([r,n]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";const{containerHeight:o,containerWidth:a,bounds:s}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!s)return;if(Math.abs(s[0][0])>180||Math.abs(s[1][0])>180){if(i.x>a){const t=this.mapsService.lngLatToContainer([r-360,n]);i.x=t.x}if(i.x<0){const t=this.mapsService.lngLatToContainer([r+360,n]);i.x=t.x}}(i.x>a||i.x<0||i.y>o||i.y<0)&&(t.style.display="none"),t.style.left=i.x+e[0]+"px",t.style.top=i.y-e[1]+"px"}}init(){let{element:t}=this.markerOption;const{color:e,anchor:r}=this.markerOption;if(!t){t=pd("div"),this.markerOption.element=t;const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height","48px"),r.setAttributeNS(null,"width","48px"),r.setAttributeNS(null,"viewBox","0 0 1024 1024");const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),n.setAttributeNS(null,"fill",e),r.appendChild(n),t.appendChild(r)}fd(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((e=>{var r,n;const i=(null===(r=this.markerOption)||void 0===r?void 0:r.style)&&(null===(n=this.markerOption)||void 0===n?void 0:n.style[e]);t&&(t.style[e]=i)})),function(t,e,r){const n=t.classList;for(const t in ee)ee.hasOwnProperty(t)&&n.remove(`l7-${r}-anchor-${t}`);n.add(`l7-${r}-anchor-${e}`)}(t,r,"marker")}registerMarkerEvent(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}unRegisterMarkerEvent(){const t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}polyfillEvent(t){this.mapsService&&"amap"===this.mapsService.getType()&&(function(){const t=Ed,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let r=!0;for(const n of e)if(t.indexOf(n)>0){r=!1;break}return r}()||("touchstart"===t.type&&(this.touchStartTime=Date.now()),"touchend"===t.type&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat})))}addDragHandler(t){return null}onUp(t){throw new Error("Method not implemented.")}}window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(t){try{var e,r=(e=(e=document.getElementsByTagName("script"))[e.length-1]).getAttribute("data-injectcss");if(!(e=e.getAttribute("data-disable-injectsvg"))){var n,i,o,a,s;if(r&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(e){console&&console.log(e)}}n=function(){var e,r=document.createElement("div");r.innerHTML=t._iconfont_svg_string_3580659,(r=r.getElementsByTagName("svg")[0])&&(r.setAttribute("aria-hidden","true"),r.style.position="absolute",r.style.width=0,r.style.height=0,r.style.overflow="hidden",(e=document.body).firstChild?function(t,e){e.parentNode.insertBefore(t,e)}(r,e.firstChild):e.appendChild(r))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(n,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),n()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(o=n,a=t.document,s=!1,u(),a.onreadystatechange=function(){"complete"==a.readyState&&(a.onreadystatechange=null,l())})}function l(){s||(s=!0,o())}function u(){try{a.documentElement.doScroll("left")}catch(t){return void setTimeout(u,50)}l()}}catch(i){}}(window);class PT extends Hd{constructor(t){super(),g_(this,"controlOption",void 0),g_(this,"container",void 0),g_(this,"isShow",void 0),g_(this,"sceneContainer",void 0),g_(this,"scene",void 0),g_(this,"mapsService",void 0),g_(this,"renderService",void 0),g_(this,"layerService",void 0),g_(this,"controlService",void 0),g_(this,"configService",void 0),PT.controlCount++,this.controlOption=v_(v_({},this.getDefault(t)),t||{})}getOptions(){return this.controlOption}setOptions(t){const e=this.getDefault(t);Object.entries(t).forEach((([r,n])=>{void 0===n&&(t[r]=e[r])})),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=v_(v_({},this.controlOption),t)}addTo(t){this.mapsService=t.mapService,this.renderService=t.rendererService,this.layerService=t.layerService,this.controlService=t.controlService,this.configService=t.globalConfigService,this.scene=t.sceneService,this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),fd(this.container,"l7-control");const{className:e,style:r}=this.controlOption;return e&&this.setClassName(e),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}remove(){if(!this.mapsService)return this;dd(this.container),this.onRemove(),this.emit("remove",this)}onAdd(){return pd("div")}onRemove(){}show(){md(this.container,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}hide(){fd(this.container,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}getDefault(t){return{position:N_.TOPRIGHT,name:`${PT.controlCount}`}}getContainer(){return this.container}getIsShow(){return this.isShow}_refocusOnMap(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){const t=this.mapsService.getContainer();null!==t&&t.focus()}}setPosition(t=N_.TOPLEFT){const e=this.controlService;return e&&e.removeControl(this),this.controlOption.position=t,e&&e.addControl(this,this.sceneContainer),this}setClassName(t){const e=this.container,{className:r}=this.controlOption;r&&md(e,r),t&&fd(e,t)}setStyle(t){const e=this.container;t?e.setAttribute("style",t):e.removeAttribute("style")}insertContainer(){const t=this.controlOption.position,e=this.container;if(t instanceof Element)t.appendChild(e);else{const r=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?r.insertBefore(e,r.firstChild):r.appendChild(e)}}checkUpdateOption(t,e){return e.some((e=>e in t))}}g_(PT,"controlCount",0);class DT extends Vd.exports.EventEmitter{get buttonRect(){return this.button.getBoundingClientRect()}constructor(t,e){super(),g_(this,"popperDOM",void 0),g_(this,"contentDOM",void 0),g_(this,"button",void 0),g_(this,"option",void 0),g_(this,"isShow",!1),g_(this,"content",void 0),g_(this,"timeout",null),g_(this,"show",(()=>(this.isShow||!this.contentDOM.innerHTML||(this.resetPopperPosition(),md(this.popperDOM,"l7-popper-hide"),this.isShow=!0,this.option.unique&&DT.conflictPopperList.forEach((t=>{t!==this&&t.isShow&&t.hide()})),this.emit("show"),window.addEventListener("pointerdown",this.onPopperUnClick)),this))),g_(this,"hide",(()=>this.isShow?(fd(this.popperDOM,"l7-popper-hide"),this.isShow=!1,this.emit("hide"),window.removeEventListener("pointerdown",this.onPopperUnClick),this):this)),g_(this,"setHideTimeout",(()=>{this.timeout||(this.timeout=window.setTimeout((()=>{this.isShow&&(this.hide(),this.timeout=null)}),300))})),g_(this,"clearHideTimeout",(()=>{this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null)})),g_(this,"onBtnClick",(()=>{this.isShow?this.hide():this.show()})),g_(this,"onPopperUnClick",(t=>{(function(t,e){var r;const n=Array.isArray(e)?e:[e];let i=t;for(;i instanceof Element&&i!==window.document.body;){if(n.find((t=>null==i?void 0:i.matches(t))))return i;i=null!=(r=null==i?void 0:i.parentElement)?r:null}})(t.target,[".l7-button-control",".l7-popper-content"])||this.hide()})),g_(this,"onBtnMouseLeave",(()=>{this.setHideTimeout()})),g_(this,"onBtnMouseMove",(()=>{this.clearHideTimeout(),this.isShow||this.show()})),this.button=t,this.option=e,this.init(),e.unique&&DT.conflictPopperList.push(this)}getPopperDOM(){return this.popperDOM}getIsShow(){return this.isShow}getContent(){return this.content}setContent(t){"string"==typeof t?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(bd(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}init(){const{trigger:t}=this.option;this.popperDOM=this.createPopper(),"click"===t?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}destroy(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),dd(this.popperDOM)}resetPopperPosition(){const t={},{container:e,offset:r=[0,0],placement:n}=this.option,[i,o]=r,a=this.button.getBoundingClientRect(),s=e.getBoundingClientRect(),{left:l,right:u,top:c,bottom:h}=(d=s,{left:(p=a).left-d.left,top:p.top-d.top,right:d.left+d.width-p.left-p.width,bottom:d.top+d.height-p.top-p.height});var p,d;let f=!1,m=!1;/^(left|right)/.test(n)?(n.includes("left")?t.right=`${a.width+u}px`:n.includes("right")&&(t.left=`${a.width+l}px`),n.includes("start")?t.top=`${c}px`:n.includes("end")?t.bottom=`${h}px`:(t.top=`${c+a.height/2}px`,m=!0,t.transform=`translate(${i}px, calc(${o}px - 50%))`)):/^(top|bottom)/.test(n)&&(n.includes("top")?t.bottom=`${a.height+h}px`:n.includes("bottom")&&(t.top=`${a.height+c}px`),n.includes("start")?t.left=`${l}px`:n.includes("end")?t.right=`${u}px`:(t.left=`${l+a.width/2}px`,f=!0,t.transform=`translate(calc(${i}px - 50%), ${o}px)`)),t.transform=`translate(calc(${i}px - ${f?"50%":"0%"}), calc(${o}px - ${m?"50%":"0%"})`;const g=n.split("-");g.length&&fd(this.popperDOM,g.map((t=>`l7-popper-${t}`)).join(" ")),xd(this.popperDOM,function(t){return Object.entries(t).map((([t,e])=>`${t}: ${e}`)).join(";")}(t))}createPopper(){const{container:t,className:e="",content:r}=this.option,n=pd("div",`l7-popper l7-popper-hide ${e}`),i=pd("div","l7-popper-content"),o=pd("div","l7-popper-arrow");return n.appendChild(i),n.appendChild(o),t.appendChild(n),this.popperDOM=n,this.contentDOM=i,r&&this.setContent(r),n}}g_(DT,"conflictPopperList",[]);const BT=t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("l7-iconfont"),e.setAttribute("aria-hidden","true");const r=document.createElementNS("http://www.w3.org/2000/svg","use");return r.setAttributeNS("http://www.w3.org/1999/xlink","href",`#${t}`),e.appendChild(r),e},NT=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],FT=(()=>{if("undefined"==typeof document)return!1;const t=NT[0],e={};for(const r of NT){if((null==r?void 0:r[1])in document){for(const[n,i]of r.entries())e[t[n]]=i;return e}}return!1})(),kT={change:FT.fullscreenchange,error:FT.fullscreenerror};let UT={request:(t=document.documentElement,e)=>new Promise(((r,n)=>{const i=()=>{UT.off("change",i),r()};UT.on("change",i);const o=t[FT.requestFullscreen](e);o instanceof Promise&&o.then(i).catch(n)})),exit:()=>new Promise(((t,e)=>{if(!UT.isFullscreen)return void t();const r=()=>{UT.off("change",r),t()};UT.on("change",r);const n=document[FT.exitFullscreen]();n instanceof Promise&&n.then(r).catch(e)})),toggle:(t,e)=>UT.isFullscreen?UT.exit():UT.request(t,e),onchange(t){UT.on("change",t)},onerror(t){UT.on("error",t)},on(t,e){const r=kT[t];r&&document.addEventListener(r,e,!1)},off(t,e){const r=kT[t];r&&document.removeEventListener(r,e,!1)},raw:FT};Object.defineProperties(UT,{isFullscreen:{get:()=>Boolean(document[FT.fullscreenElement])},element:{enumerable:!0,get:()=>{var t;return null!==(t=document[FT.fullscreenElement])&&void 0!==t?t:void 0}},isEnabled:{enumerable:!0,get:()=>Boolean(document[FT.fullscreenEnabled])}}),FT||(UT={isEnabled:!1});class zT extends PT{getDefault(){return{position:N_.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}onAdd(){const t=pd("div","l7-control-logo");return this.setLogoContent(t),t}onRemove(){return null}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["img","href"])&&(bd(this.container),this.setLogoContent(this.container))}setLogoContent(t){const{href:e,img:r}=this.controlOption,n=pd("img");if(n.setAttribute("src",r),n.setAttribute("aria-label","AntV logo"),n.setAttribute("draggable","false"),e){const r=pd("a","l7-control-logo-link");r.target="_blank",r.href=e,r.rel="noopener nofollow",r.setAttribute("rel","noopener nofollow"),r.appendChild(n),t.appendChild(r)}else t.appendChild(n)}}class GT extends PT{constructor(...t){super(...t),g_(this,"mScale",void 0),g_(this,"iScale",void 0),g_(this,"update",(()=>{const t=this.mapsService,{maxWidth:e}=this.controlOption,r=t.getSize()[1]/2,n=t.containerToLngLat([0,r]),i=t.containerToLngLat([e,r]),o=Od([n.lng,n.lat],[i.lng,i.lat]);this.updateScales(o)}))}getDefault(t){return v_(v_({},super.getDefault(t)),{},{name:"scale",position:N_.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}onAdd(){const t=pd("div","l7-control-scale");this.resetScaleLines(t);const{updateWhenIdle:e}=this.controlOption;return this.mapsService.on(e?"moveend":"mapmove",this.update),this.mapsService.on(e?"zoomend":"zoomchange",this.update),t}onRemove(){const{updateWhenIdle:t}=this.controlOption;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}updateScales(t){const{metric:e,imperial:r}=this.controlOption;e&&t&&this.updateMetric(t),r&&t&&this.updateImperial(t)}resetScaleLines(t){bd(t);const{metric:e,imperial:r,maxWidth:n,lockWidth:i}=this.controlOption;i&&xd(t,`width: ${n}px`),e&&(this.mScale=pd("div","l7-control-scale-line",t)),r&&(this.iScale=pd("div","l7-control-scale-line",t)),this.update()}updateScale(t,e,r){const{maxWidth:n}=this.controlOption;t.style.width=Math.round(n*r)+"px",t.innerHTML=e}getRoundNum(t){const e=Math.pow(10,(Math.floor(t)+"").length-1);let r=t/e;return r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:1,e*r}updateMetric(t){const e=this.getRoundNum(t),r=e<1e3?e+" m":e/1e3+" km";this.updateScale(this.mScale,r,e/t)}updateImperial(t){const e=3.2808399*t;let r,n,i;e>5280?(r=e/5280,n=this.getRoundNum(r),this.updateScale(this.iScale,n+" mi",n/r)):(i=this.getRoundNum(e),this.updateScale(this.iScale,i+" ft",i/e))}}class jT{constructor(){g_(this,"mapService",void 0),g_(this,"fontService",void 0)}apply(t,{styleAttributeService:e,mapService:r,fontService:n}){var i=this;this.mapService=r,this.fontService=n,t.hooks.init.tapPromise("DataMappingPlugin",Ev((function*(){t.log(K_,iv.INIT),i.generateMaping(t,{styleAttributeService:e}),t.log($_,iv.INIT)}))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var r=Ev((function*(r){if(!r)return r;t.dataState.dataMappingNeedUpdate=!1,t.log(K_,iv.UPDATE);const n=i.generateMaping(t,{styleAttributeService:e});return t.log($_,iv.UPDATE),n}));return function(t){return r.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",(()=>{const r=t.getSource();if(t.layerModelNeedUpdate||!r||!r.inited)return;const n=e.getLayerStyleAttributes()||[],i=e.getLayerStyleAttribute("filter"),{dataArray:o}=r.data;if(Array.isArray(o)&&0===o.length)return;const a=n.filter((t=>t.needRemapping));let s=o;if(null!=i&&i.needRemapping&&null!=i&&i.scale&&(s=o.filter((t=>this.applyAttributeMapping(i,t)[0]))),a.length){const e=this.mapping(t,a,s,t.getEncodedData());t.setEncodedData(e)}}))}generateMaping(t,{styleAttributeService:e}){const r=e.getLayerStyleAttributes()||[],n=e.getLayerStyleAttribute("filter"),{dataArray:i}=t.getSource().data;let o=i;null!=n&&n.scale&&(o=i.filter((t=>this.applyAttributeMapping(n,t)[0]))),o=t.processData(o);const a=this.mapping(t,r,o,void 0);return t.setEncodedData(a),t.emit("dataUpdate",null),!0}mapping(t,e,r,n){const i=e.filter((t=>void 0!==t.scale)).filter((t=>"filter"!==t.name)),o=r.map(((t,e)=>{const r=n?n[e]:{},o=v_({id:t._id,coordinates:t.coordinates},r);return i.forEach((e=>{let r=this.applyAttributeMapping(e,t);"color"!==e.name&&"stroke"!==e.name||(r=r.map((t=>Oe(t)))),o[e.name]=Array.isArray(r)&&1===r.length?r[0]:r,"shape"===e.name&&(o.shape=this.fontService.getIconFontKey(o[e.name]))})),o}));return e.forEach((t=>{t.needRemapping=!1})),this.adjustData2SimpleCoordinates(o),o}adjustData2SimpleCoordinates(t){t.length>0&&"SIMPLE"===this.mapService.version&&t.map((t=>{t.simpleCoordinate||(t.coordinates=this.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)}))}unProjectCoordinates(t){if("number"==typeof t[0])return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){const e=[];return t.map((t=>{const r=[];t.map((t=>{r.push(this.mapService.simpleMapCoord.unproject(t))})),e.push(r)})),e}{const e=[];return t.map((t=>{e.push(this.mapService.simpleMapCoord.unproject(t))})),e}}applyAttributeMapping(t,e){var r;if(!t.scale)return[];const n=(null==t||null===(r=t.scale)||void 0===r?void 0:r.scalers)||[],i=[];n.forEach((({field:r})=>{var n;(e.hasOwnProperty(r)||"variable"===(null===(n=t.scale)||void 0===n?void 0:n.type))&&i.push(e[r])}));return t.mapping?t.mapping(i):[]}getArrowPoints(t,e){const r=Nd([e[0]-t[0],e[1]-t[1]]);return[t[0]+1e-4*r[0],t[1]+1e-4*r[1]]}}class VT{constructor(){g_(this,"mapService",void 0)}apply(t){var e=this;this.mapService=t.getContainer().mapService,t.hooks.init.tapPromise("DataSourcePlugin",Ev((function*(){t.log(X_,iv.INIT);let r=t.getSource();if(!r){const{data:e,options:n}=t.sourceOption||t.defaultSourceConfig;r=new MT(e,n),t.setSource(r)}r.inited?(e.updateClusterData(t),t.log(Z_,iv.INIT)):yield new Promise((n=>{r.on("update",(r=>{"inited"===r.type&&(e.updateClusterData(t),t.log(Z_,iv.INIT)),n(null)}))}))}))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",Ev((function*(){const r=e.updateClusterData(t),n=t.dataState.dataSourceNeedUpdate;t.dataState.dataSourceNeedUpdate=!1;return r||n})))}updateClusterData(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;const e=t.getSource(),r=e.cluster,{zoom:n=0}=e.clusterOptions,i=this.mapService.getZoom()-1,o=t.dataState.dataSourceNeedUpdate;return r&&o&&e.updateClusterData(Math.floor(i)),!!(r&&Math.abs(t.clusterZoom-i)>=1)&&(n!==Math.floor(i)&&e.updateClusterData(Math.floor(i)),t.clusterZoom=i,!0)}}function HT(t,e){let r,n;if(void 0===e)for(const e of t)null!=e&&(void 0===r?e>=e&&(r=n=e):(r>e&&(r=e),n<e&&(n=e)));else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(void 0===r?o>=o&&(r=n=o):(r>o&&(r=o),n<o&&(n=o)))}return[r,n]}function WT(t){return function(){return t}}function XT(t){return 1==(t=+t)?ZT:function(e,r){return r-e?function(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}(e,r,t):WT(isNaN(e)?r:e)}}function ZT(t,e){var r=e-t;return r?function(t,e){return function(r){return t+r*e}}(t,r):WT(isNaN(t)?e:t)}var qT=function t(e){var r=XT(e);function n(t,e){var n=r((t=Te(t)).r,(e=Te(e)).r),i=r(t.g,e.g),o=r(t.b,e.b),a=ZT(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return n.gamma=t,n}(1);var YT,KT=(YT=function(t){var e=t.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),i=t[n],o=t[n+1],a=n>0?t[n-1]:2*i-o,s=n<e-1?t[n+2]:2*o-i;return function(t,e,r,n,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*r+(1+3*t+3*o-3*a)*n+a*i)/6}((r-n/e)*e,a,i,o,s)}},function(t){var e,r,n=t.length,i=new Array(n),o=new Array(n),a=new Array(n);for(e=0;e<n;++e)r=Te(t[e]),i[e]=r.r||0,o[e]=r.g||0,a[e]=r.b||0;return i=YT(i),o=YT(o),a=YT(a),r.opacity=1,function(t){return r.r=i(t),r.g=o(t),r.b=a(t),r+""}});function $T(t,e){e||(e=[]);var r,n=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(r=0;r<n;++r)i[r]=t[r]*(1-o)+e[r]*o;return i}}function QT(t,e){var r,n=e?e.length:0,i=t?Math.min(n,t.length):0,o=new Array(i),a=new Array(n);for(r=0;r<i;++r)o[r]=oS(t[r],e[r]);for(;r<n;++r)a[r]=e[r];return function(t){for(r=0;r<i;++r)a[r]=o[r](t);return a}}function JT(t,e){var r=new Date;return t=+t,e=+e,function(n){return r.setTime(t*(1-n)+e*n),r}}function tS(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function eS(t,e){var r,n={},i={};for(r in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)r in t?n[r]=oS(t[r],e[r]):i[r]=e[r];return function(t){for(r in n)i[r]=n[r](t);return i}}var rS=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,nS=new RegExp(rS.source,"g");function iS(t,e){var r,n,i,o=rS.lastIndex=nS.lastIndex=0,a=-1,s=[],l=[];for(t+="",e+="";(r=rS.exec(t))&&(n=nS.exec(e));)(i=n.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(r=r[0])===(n=n[0])?s[a]?s[a]+=n:s[++a]=n:(s[++a]=null,l.push({i:a,x:tS(r,n)})),o=nS.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var r,n=0;n<e;++n)s[(r=l[n]).i]=r.x(t);return s.join("")})}function oS(t,e){var r,n,i=typeof e;return null==e||"boolean"===i?WT(e):("number"===i?tS:"string"===i?(r=xe(e))?(e=r,qT):iS:e instanceof xe?qT:e instanceof Date?JT:(n=e,!ArrayBuffer.isView(n)||n instanceof DataView?Array.isArray(e)?QT:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?eS:tS:$T))(t,e)}function aS(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function sS(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function lS(t){var e;return 1===t.length&&(e=t,t=function(t,r){return sS(e(t),r)}),{left:function(e,r,n,i){for(null==n&&(n=0),null==i&&(i=e.length);n<i;){var o=n+i>>>1;t(e[o],r)<0?n=o+1:i=o}return n},right:function(e,r,n,i){for(null==n&&(n=0),null==i&&(i=e.length);n<i;){var o=n+i>>>1;t(e[o],r)>0?i=o:n=o+1}return n}}}var uS=lS(sS).right;function cS(t){return null===t?NaN:+t}var hS=Math.sqrt(50),pS=Math.sqrt(10),dS=Math.sqrt(2);function fS(t,e,r){var n,i,o,a,s=-1;if(r=+r,(t=+t)===(e=+e)&&r>0)return[t];if((n=e<t)&&(i=t,t=e,e=i),0===(a=mS(t,e,r))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),e=Math.floor(e/a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(t+s)*a;else for(t=Math.floor(t*a),e=Math.ceil(e*a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(t-s)/a;return n&&o.reverse(),o}function mS(t,e,r){var n=(e-t)/Math.max(0,r),i=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,i);return i>=0?(o>=hS?10:o>=pS?5:o>=dS?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=hS?10:o>=pS?5:o>=dS?2:1)}function gS(t,e,r){var n=Math.abs(e-t)/Math.max(0,r),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/i;return o>=hS?i*=10:o>=pS?i*=5:o>=dS&&(i*=2),e<t?-i:i}function _S(t,e,r){if(null==r&&(r=cS),n=t.length){if((e=+e)<=0||n<2)return+r(t[0],0,t);if(e>=1)return+r(t[n-1],n-1,t);var n,i=(n-1)*e,o=Math.floor(i),a=+r(t[o],o,t);return a+(+r(t[o+1],o+1,t)-a)*(i-o)}}function vS(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function yS(t,e){switch(arguments.length){case 0:break;case 1:this.interpolator(t);break;default:this.interpolator(e).domain(t)}return this}var xS="$";function bS(){}function ES(t,e){var r=new bS;if(t instanceof bS)t.each((function(t,e){r.set(e,t)}));else if(Array.isArray(t)){var n,i=-1,o=t.length;if(null==e)for(;++i<o;)r.set(i,t[i]);else for(;++i<o;)r.set(e(n=t[i],i,t),n)}else if(t)for(var a in t)r.set(a,t[a]);return r}function TS(){}bS.prototype=ES.prototype={constructor:bS,has:function(t){return xS+t in this},get:function(t){return this[xS+t]},set:function(t,e){return this[xS+t]=e,this},remove:function(t){var e=xS+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===xS&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===xS&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===xS&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===xS&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===xS&&++t;return t},empty:function(){for(var t in this)if(t[0]===xS)return!1;return!0},each:function(t){for(var e in this)e[0]===xS&&t(this[e],e.slice(1),this)}};var SS=ES.prototype;TS.prototype={constructor:TS,has:SS.has,add:function(t){return this[xS+(t+="")]=t,this},remove:SS.remove,clear:SS.clear,values:SS.keys,size:SS.size,empty:SS.empty,each:SS.each};var AS=Array.prototype,wS=AS.map,CS=AS.slice,RS={name:"implicit"};function LS(){var t=ES(),e=[],r=[],n=RS;function i(i){var o=i+"",a=t.get(o);if(!a){if(n!==RS)return n;t.set(o,a=e.push(i))}return r[(a-1)%r.length]}return i.domain=function(r){if(!arguments.length)return e.slice();e=[],t=ES();for(var n,o,a=-1,s=r.length;++a<s;)t.has(o=(n=r[a])+"")||t.set(o,e.push(n));return i},i.range=function(t){return arguments.length?(r=CS.call(t),i):r.slice()},i.unknown=function(t){return arguments.length?(n=t,i):n},i.copy=function(){return LS(e,r).unknown(n)},vS.apply(i,arguments),i}function IS(t){return+t}var MS=[0,1];function OS(t){return t}function PS(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:(r=isNaN(e)?NaN:.5,function(){return r});var r}function DS(t){var e,r=t[0],n=t[t.length-1];return r>n&&(e=r,r=n,n=e),function(t){return Math.max(r,Math.min(n,t))}}function BS(t,e,r){var n=t[0],i=t[1],o=e[0],a=e[1];return i<n?(n=PS(i,n),o=r(a,o)):(n=PS(n,i),o=r(o,a)),function(t){return o(n(t))}}function NS(t,e,r){var n=Math.min(t.length,e.length)-1,i=new Array(n),o=new Array(n),a=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<n;)i[a]=PS(t[a],t[a+1]),o[a]=r(e[a],e[a+1]);return function(e){var r=uS(t,e,1,n)-1;return o[r](i[r](e))}}function FS(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function kS(){var t,e,r,n,i,o,a=MS,s=MS,l=oS,u=OS;function c(){return n=Math.min(a.length,s.length)>2?NS:BS,i=o=null,h}function h(e){return isNaN(e=+e)?r:(i||(i=n(a.map(t),s,l)))(t(u(e)))}return h.invert=function(r){return u(e((o||(o=n(s,a.map(t),tS)))(r)))},h.domain=function(t){return arguments.length?(a=wS.call(t,IS),u===OS||(u=DS(a)),c()):a.slice()},h.range=function(t){return arguments.length?(s=CS.call(t),c()):s.slice()},h.rangeRound=function(t){return s=CS.call(t),l=aS,c()},h.clamp=function(t){return arguments.length?(u=t?DS(a):OS,h):u!==OS},h.interpolate=function(t){return arguments.length?(l=t,c()):l},h.unknown=function(t){return arguments.length?(r=t,h):r},function(r,n){return t=r,e=n,c()}}function US(t,e){return kS()(t,e)}function zS(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}function GS(t){return(t=zS(Math.abs(t)))?t[1]:NaN}var jS,VS=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function HS(t){if(!(e=VS.exec(t)))throw new Error("invalid format: "+t);var e;return new WS({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function WS(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function XS(t,e){var r=zS(t,e);if(!r)return t+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}HS.prototype=WS.prototype,WS.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var ZS={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return XS(100*t,e)},r:XS,s:function(t,e){var r=zS(t,e);if(!r)return t+"";var n=r[0],i=r[1],o=i-(jS=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=n.length;return o===a?n:o>a?n+new Array(o-a+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+zS(t,Math.max(0,e+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function qS(t){return t}var YS,KS,$S,QS=Array.prototype.map,JS=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function tA(t){var e,r,n=void 0===t.grouping||void 0===t.thousands?qS:(e=QS.call(t.grouping,Number),r=t.thousands+"",function(t,n){for(var i=t.length,o=[],a=0,s=e[0],l=0;i>0&&s>0&&(l+s+1>n&&(s=Math.max(1,n-l)),o.push(t.substring(i-=s,i+s)),!((l+=s+1)>n));)s=e[a=(a+1)%e.length];return o.reverse().join(r)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?qS:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(QS.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",u=void 0===t.minus?"-":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=HS(t)).fill,r=t.align,h=t.sign,p=t.symbol,d=t.zero,f=t.width,m=t.comma,g=t.precision,_=t.trim,v=t.type;"n"===v?(m=!0,v="g"):ZS[v]||(void 0===g&&(g=12),_=!0,v="g"),(d||"0"===e&&"="===r)&&(d=!0,e="0",r="=");var y="$"===p?i:"#"===p&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===p?o:/[%p]/.test(v)?l:"",b=ZS[v],E=/[defgprs%]/.test(v);function T(t){var i,o,l,p=y,T=x;if("c"===v)T=b(t)+T,t="";else{var S=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:b(Math.abs(t),g),_&&(t=function(t){t:for(var e,r=t.length,n=1,i=-1;n<r;++n)switch(t[n]){case".":i=e=n;break;case"0":0===i&&(i=n),e=n;break;default:if(!+t[n])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),S&&0==+t&&"+"!==h&&(S=!1),p=(S?"("===h?h:u:"-"===h||"("===h?"":h)+p,T=("s"===v?JS[8+jS/3]:"")+T+(S&&"("===h?")":""),E)for(i=-1,o=t.length;++i<o;)if(48>(l=t.charCodeAt(i))||l>57){T=(46===l?a+t.slice(i+1):t.slice(i))+T,t=t.slice(0,i);break}}m&&!d&&(t=n(t,1/0));var A=p.length+t.length+T.length,w=A<f?new Array(f-A+1).join(e):"";switch(m&&d&&(t=n(w+t,w.length?f-T.length:1/0),w=""),r){case"<":t=p+t+T+w;break;case"=":t=p+w+t+T;break;case"^":t=w.slice(0,A=w.length>>1)+p+t+T+w.slice(A);break;default:t=w+p+t+T}return s(t)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),T.toString=function(){return t+""},T}return{format:h,formatPrefix:function(t,e){var r=h(((t=HS(t)).type="f",t)),n=3*Math.max(-8,Math.min(8,Math.floor(GS(e)/3))),i=Math.pow(10,-n),o=JS[8+n/3];return function(t){return r(i*t)+o}}}}function eA(t,e,r,n){var i,o=gS(t,e,r);switch((n=HS(null==n?",f":n)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=n.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(GS(e)/3)))-GS(Math.abs(t)))}(o,a))||(n.precision=i),$S(n,a);case"":case"e":case"g":case"p":case"r":null!=n.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,GS(e)-GS(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(n.precision=i-("e"===n.type));break;case"f":case"%":null!=n.precision||isNaN(i=function(t){return Math.max(0,-GS(Math.abs(t)))}(o))||(n.precision=i-2*("%"===n.type))}return KS(n)}function rA(t){var e=t.domain;return t.ticks=function(t){var r=e();return fS(r[0],r[r.length-1],null==t?10:t)},t.tickFormat=function(t,r){var n=e();return eA(n[0],n[n.length-1],null==t?10:t,r)},t.nice=function(r){null==r&&(r=10);var n,i=e(),o=0,a=i.length-1,s=i[o],l=i[a];return l<s&&(n=s,s=l,l=n,n=o,o=a,a=n),(n=mS(s,l,r))>0?n=mS(s=Math.floor(s/n)*n,l=Math.ceil(l/n)*n,r):n<0&&(n=mS(s=Math.ceil(s*n)/n,l=Math.floor(l*n)/n,r)),n>0?(i[o]=Math.floor(s/n)*n,i[a]=Math.ceil(l/n)*n,e(i)):n<0&&(i[o]=Math.ceil(s*n)/n,i[a]=Math.floor(l*n)/n,e(i)),t},t}function nA(t,e){var r,n=0,i=(t=t.slice()).length-1,o=t[n],a=t[i];return a<o&&(r=n,n=i,i=r,r=o,o=a,a=r),t[n]=e.floor(o),t[i]=e.ceil(a),t}function iA(t){return Math.log(t)}function oA(t){return Math.exp(t)}function aA(t){return-Math.log(-t)}function sA(t){return-Math.exp(-t)}function lA(t){return isFinite(t)?+("1e"+t):t<0?0:t}function uA(t){return function(e){return-t(-e)}}function cA(t){var e,r,n=t(iA,oA),i=n.domain,o=10;function a(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(o),r=function(t){return 10===t?lA:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(o),i()[0]<0?(e=uA(e),r=uA(r),t(aA,sA)):t(iA,oA),n}return n.base=function(t){return arguments.length?(o=+t,a()):o},n.domain=function(t){return arguments.length?(i(t),a()):i()},n.ticks=function(t){var n,a=i(),s=a[0],l=a[a.length-1];(n=l<s)&&(p=s,s=l,l=p);var u,c,h,p=e(s),d=e(l),f=null==t?10:+t,m=[];if(!(o%1)&&d-p<f){if(p=Math.round(p)-1,d=Math.round(d)+1,s>0){for(;p<d;++p)for(c=1,u=r(p);c<o;++c)if(!((h=u*c)<s)){if(h>l)break;m.push(h)}}else for(;p<d;++p)for(c=o-1,u=r(p);c>=1;--c)if(!((h=u*c)<s)){if(h>l)break;m.push(h)}}else m=fS(p,d,Math.min(d-p,f)).map(r);return n?m.reverse():m},n.tickFormat=function(t,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=KS(i)),t===1/0)return i;null==t&&(t=10);var a=Math.max(1,o*t/n.ticks().length);return function(t){var n=t/r(Math.round(e(t)));return n*o<o-.5&&(n*=o),n<=a?i(t):""}},n.nice=function(){return i(nA(i(),{floor:function(t){return r(Math.floor(e(t)))},ceil:function(t){return r(Math.ceil(e(t)))}}))},n}function hA(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function pA(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function dA(t){return t<0?-t*t:t*t}function fA(t){var e=t(OS,OS),r=1;return e.exponent=function(e){return arguments.length?1===(r=+e)?t(OS,OS):.5===r?t(pA,dA):t(hA(r),hA(1/r)):r},rA(e)}YS=tA({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),KS=YS.format,$S=YS.formatPrefix;var mA=new Date,gA=new Date;function _A(t,e,r,n){function i(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return i.floor=function(e){return t(e=new Date(+e)),e},i.ceil=function(r){return t(r=new Date(r-1)),e(r,1),t(r),r},i.round=function(t){var e=i(t),r=i.ceil(t);return t-e<r-t?e:r},i.offset=function(t,r){return e(t=new Date(+t),null==r?1:Math.floor(r)),t},i.range=function(r,n,o){var a,s=[];if(r=i.ceil(r),o=null==o?1:Math.floor(o),!(r<n&&o>0))return s;do{s.push(a=new Date(+r)),e(r,o),t(r)}while(a<r&&r<n);return s},i.filter=function(r){return _A((function(e){if(e>=e)for(;t(e),!r(e);)e.setTime(e-1)}),(function(t,n){if(t>=t)if(n<0)for(;++n<=0;)for(;e(t,-1),!r(t););else for(;--n>=0;)for(;e(t,1),!r(t););}))},r&&(i.count=function(e,n){return mA.setTime(+e),gA.setTime(+n),t(mA),t(gA),Math.floor(r(mA,gA))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(n?function(e){return n(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var vA=_A((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));vA.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?_A((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,r){e.setTime(+e+r*t)}),(function(e,r){return(r-e)/t})):vA:null};var yA=vA;vA.range;var xA=1e3,bA=6e4,EA=36e5,TA=864e5,SA=6048e5,AA=_A((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+e*xA)}),(function(t,e){return(e-t)/xA}),(function(t){return t.getUTCSeconds()})),wA=AA;AA.range;var CA=_A((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*xA)}),(function(t,e){t.setTime(+t+e*bA)}),(function(t,e){return(e-t)/bA}),(function(t){return t.getMinutes()})),RA=CA;CA.range;var LA=_A((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*xA-t.getMinutes()*bA)}),(function(t,e){t.setTime(+t+e*EA)}),(function(t,e){return(e-t)/EA}),(function(t){return t.getHours()})),IA=LA;LA.range;var MA=_A((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*bA)/TA}),(function(t){return t.getDate()-1})),OA=MA;function PA(t){return _A((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*bA)/SA}))}MA.range;var DA=PA(0),BA=PA(1),NA=PA(2),FA=PA(3),kA=PA(4),UA=PA(5),zA=PA(6);DA.range,BA.range,NA.range,FA.range,kA.range,UA.range,zA.range;var GA=_A((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()})),jA=GA;GA.range;var VA=_A((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));VA.every=function(t){return isFinite(t=Math.floor(t))&&t>0?_A((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,r){e.setFullYear(e.getFullYear()+r*t)})):null};var HA=VA;VA.range;var WA=_A((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/TA}),(function(t){return t.getUTCDate()-1})),XA=WA;function ZA(t){return _A((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/SA}))}WA.range;var qA=ZA(0),YA=ZA(1),KA=ZA(2),$A=ZA(3),QA=ZA(4),JA=ZA(5),tw=ZA(6);qA.range,YA.range,KA.range,$A.range,QA.range,JA.range,tw.range;var ew=_A((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));ew.every=function(t){return isFinite(t=Math.floor(t))&&t>0?_A((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r*t)})):null};var rw=ew;function nw(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function iw(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function ow(t,e,r){return{y:t,m:e,d:r,H:0,M:0,S:0,L:0}}ew.range;var aw,sw,lw={"-":"",_:" ",0:"0"},uw=/^\s*\d+/,cw=/^%/,hw=/[\\^$*+?|[\]().{}]/g;function pw(t,e,r){var n=t<0?"-":"",i=(n?-t:t)+"",o=i.length;return n+(o<r?new Array(r-o+1).join(e)+i:i)}function dw(t){return t.replace(hw,"\\$&")}function fw(t){return new RegExp("^(?:"+t.map(dw).join("|")+")","i")}function mw(t){for(var e={},r=-1,n=t.length;++r<n;)e[t[r].toLowerCase()]=r;return e}function gw(t,e,r){var n=uw.exec(e.slice(r,r+1));return n?(t.w=+n[0],r+n[0].length):-1}function _w(t,e,r){var n=uw.exec(e.slice(r,r+1));return n?(t.u=+n[0],r+n[0].length):-1}function vw(t,e,r){var n=uw.exec(e.slice(r,r+2));return n?(t.U=+n[0],r+n[0].length):-1}function yw(t,e,r){var n=uw.exec(e.slice(r,r+2));return n?(t.V=+n[0],r+n[0].length):-1}function xw(t,e,r){var n=uw.exec(e.slice(r,r+2));return n?(t.W=+n[0],r+n[0].length):-1}function bw(t,e,r){var n=uw.exec(e.slice(r,r+4));return n?(t.y=+n[0],r+n[0].length):-1}function Ew(t,e,r){var n=uw.exec(e.slice(r,r+2));return n?(t.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function Tw(t,e,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(r,r+6));return n?(t.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function Sw(t,e,r){var n=uw.exec(e.slice(r,r+1));return n?(t.q=3*n[0]-3,r+n[0].length):-1}function Aw(t,e,r){var n=uw.exec(e.slice(r,r+2));return n?(t.m=n[0]-1,r+n[0].length):-1}function ww(t,e,r){var n=uw.exec(e.slice(r,r+2));return n?(t.d=+n[0],r+n[0].length):-1}function Cw(t,e,r){var n=uw.exec(e.slice(r,r+3));return n?(t.m=0,t.d=+n[0],r+n[0].length):-1}function Rw(t,e,r){var n=uw.exec(e.slice(r,r+2));return n?(t.H=+n[0],r+n[0].length):-1}function Lw(t,e,r){var n=uw.exec(e.slice(r,r+2));return n?(t.M=+n[0],r+n[0].length):-1}function Iw(t,e,r){var n=uw.exec(e.slice(r,r+2));return n?(t.S=+n[0],r+n[0].length):-1}function Mw(t,e,r){var n=uw.exec(e.slice(r,r+3));return n?(t.L=+n[0],r+n[0].length):-1}function Ow(t,e,r){var n=uw.exec(e.slice(r,r+6));return n?(t.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function Pw(t,e,r){var n=cw.exec(e.slice(r,r+1));return n?r+n[0].length:-1}function Dw(t,e,r){var n=uw.exec(e.slice(r));return n?(t.Q=+n[0],r+n[0].length):-1}function Bw(t,e,r){var n=uw.exec(e.slice(r));return n?(t.s=+n[0],r+n[0].length):-1}function Nw(t,e){return pw(t.getDate(),e,2)}function Fw(t,e){return pw(t.getHours(),e,2)}function kw(t,e){return pw(t.getHours()%12||12,e,2)}function Uw(t,e){return pw(1+OA.count(HA(t),t),e,3)}function zw(t,e){return pw(t.getMilliseconds(),e,3)}function Gw(t,e){return zw(t,e)+"000"}function jw(t,e){return pw(t.getMonth()+1,e,2)}function Vw(t,e){return pw(t.getMinutes(),e,2)}function Hw(t,e){return pw(t.getSeconds(),e,2)}function Ww(t){var e=t.getDay();return 0===e?7:e}function Xw(t,e){return pw(DA.count(HA(t)-1,t),e,2)}function Zw(t){var e=t.getDay();return e>=4||0===e?kA(t):kA.ceil(t)}function qw(t,e){return t=Zw(t),pw(kA.count(HA(t),t)+(4===HA(t).getDay()),e,2)}function Yw(t){return t.getDay()}function Kw(t,e){return pw(BA.count(HA(t)-1,t),e,2)}function $w(t,e){return pw(t.getFullYear()%100,e,2)}function Qw(t,e){return pw((t=Zw(t)).getFullYear()%100,e,2)}function Jw(t,e){return pw(t.getFullYear()%1e4,e,4)}function tC(t,e){var r=t.getDay();return pw((t=r>=4||0===r?kA(t):kA.ceil(t)).getFullYear()%1e4,e,4)}function eC(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+pw(e/60|0,"0",2)+pw(e%60,"0",2)}function rC(t,e){return pw(t.getUTCDate(),e,2)}function nC(t,e){return pw(t.getUTCHours(),e,2)}function iC(t,e){return pw(t.getUTCHours()%12||12,e,2)}function oC(t,e){return pw(1+XA.count(rw(t),t),e,3)}function aC(t,e){return pw(t.getUTCMilliseconds(),e,3)}function sC(t,e){return aC(t,e)+"000"}function lC(t,e){return pw(t.getUTCMonth()+1,e,2)}function uC(t,e){return pw(t.getUTCMinutes(),e,2)}function cC(t,e){return pw(t.getUTCSeconds(),e,2)}function hC(t){var e=t.getUTCDay();return 0===e?7:e}function pC(t,e){return pw(qA.count(rw(t)-1,t),e,2)}function dC(t){var e=t.getUTCDay();return e>=4||0===e?QA(t):QA.ceil(t)}function fC(t,e){return t=dC(t),pw(QA.count(rw(t),t)+(4===rw(t).getUTCDay()),e,2)}function mC(t){return t.getUTCDay()}function gC(t,e){return pw(YA.count(rw(t)-1,t),e,2)}function _C(t,e){return pw(t.getUTCFullYear()%100,e,2)}function vC(t,e){return pw((t=dC(t)).getUTCFullYear()%100,e,2)}function yC(t,e){return pw(t.getUTCFullYear()%1e4,e,4)}function xC(t,e){var r=t.getUTCDay();return pw((t=r>=4||0===r?QA(t):QA.ceil(t)).getUTCFullYear()%1e4,e,4)}function bC(){return"+0000"}function EC(){return"%"}function TC(t){return+t}function SC(t){return Math.floor(+t/1e3)}!function(t){aw=function(t){var e=t.dateTime,r=t.date,n=t.time,i=t.periods,o=t.days,a=t.shortDays,s=t.months,l=t.shortMonths,u=fw(i),c=mw(i),h=fw(o),p=mw(o),d=fw(a),f=mw(a),m=fw(s),g=mw(s),_=fw(l),v=mw(l),y={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return l[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:Nw,e:Nw,f:Gw,g:Qw,G:tC,H:Fw,I:kw,j:Uw,L:zw,m:jw,M:Vw,p:function(t){return i[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:TC,s:SC,S:Hw,u:Ww,U:Xw,V:qw,w:Yw,W:Kw,x:null,X:null,y:$w,Y:Jw,Z:eC,"%":EC},x={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return l[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:rC,e:rC,f:sC,g:vC,G:xC,H:nC,I:iC,j:oC,L:aC,m:lC,M:uC,p:function(t){return i[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:TC,s:SC,S:cC,u:hC,U:pC,V:fC,w:mC,W:gC,x:null,X:null,y:_C,Y:yC,Z:bC,"%":EC},b={a:function(t,e,r){var n=d.exec(e.slice(r));return n?(t.w=f[n[0].toLowerCase()],r+n[0].length):-1},A:function(t,e,r){var n=h.exec(e.slice(r));return n?(t.w=p[n[0].toLowerCase()],r+n[0].length):-1},b:function(t,e,r){var n=_.exec(e.slice(r));return n?(t.m=v[n[0].toLowerCase()],r+n[0].length):-1},B:function(t,e,r){var n=m.exec(e.slice(r));return n?(t.m=g[n[0].toLowerCase()],r+n[0].length):-1},c:function(t,r,n){return S(t,e,r,n)},d:ww,e:ww,f:Ow,g:Ew,G:bw,H:Rw,I:Rw,j:Cw,L:Mw,m:Aw,M:Lw,p:function(t,e,r){var n=u.exec(e.slice(r));return n?(t.p=c[n[0].toLowerCase()],r+n[0].length):-1},q:Sw,Q:Dw,s:Bw,S:Iw,u:_w,U:vw,V:yw,w:gw,W:xw,x:function(t,e,n){return S(t,r,e,n)},X:function(t,e,r){return S(t,n,e,r)},y:Ew,Y:bw,Z:Tw,"%":Pw};function E(t,e){return function(r){var n,i,o,a=[],s=-1,l=0,u=t.length;for(r instanceof Date||(r=new Date(+r));++s<u;)37===t.charCodeAt(s)&&(a.push(t.slice(l,s)),null!=(i=lw[n=t.charAt(++s)])?n=t.charAt(++s):i="e"===n?" ":"0",(o=e[n])&&(n=o(r,i)),a.push(n),l=s+1);return a.push(t.slice(l,s)),a.join("")}}function T(t,e){return function(r){var n,i,o=ow(1900,void 0,1);if(S(o,t,r+="",0)!=r.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(e&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(n=iw(ow(o.y,0,1))).getUTCDay(),n=i>4||0===i?YA.ceil(n):YA(n),n=XA.offset(n,7*(o.V-1)),o.y=n.getUTCFullYear(),o.m=n.getUTCMonth(),o.d=n.getUTCDate()+(o.w+6)%7):(i=(n=nw(ow(o.y,0,1))).getDay(),n=i>4||0===i?BA.ceil(n):BA(n),n=OA.offset(n,7*(o.V-1)),o.y=n.getFullYear(),o.m=n.getMonth(),o.d=n.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?iw(ow(o.y,0,1)).getUTCDay():nw(ow(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,iw(o)):nw(o)}}function S(t,e,r,n){for(var i,o,a=0,s=e.length,l=r.length;a<s;){if(n>=l)return-1;if(37===(i=e.charCodeAt(a++))){if(i=e.charAt(a++),!(o=b[i in lw?e.charAt(a++):i])||(n=o(t,r,n))<0)return-1}else if(i!=r.charCodeAt(n++))return-1}return n}return y.x=E(r,y),y.X=E(n,y),y.c=E(e,y),x.x=E(r,x),x.X=E(n,x),x.c=E(e,x),{format:function(t){var e=E(t+="",y);return e.toString=function(){return t},e},parse:function(t){var e=T(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=E(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=T(t+="",!0);return e.toString=function(){return t},e}}}(t),sw=aw.format,aw.parse,aw.utcFormat,aw.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var AC=1e3,wC=60*AC,CC=60*wC,RC=24*CC,LC=7*RC,IC=30*RC,MC=365*RC;function OC(t){return new Date(t)}function PC(t){return t instanceof Date?+t:+new Date(+t)}function DC(t,e,r,n,i,o,a,s,l){var u=US(OS,OS),c=u.invert,h=u.domain,p=l(".%L"),d=l(":%S"),f=l("%I:%M"),m=l("%I %p"),g=l("%a %d"),_=l("%b %d"),v=l("%B"),y=l("%Y"),x=[[a,1,AC],[a,5,5*AC],[a,15,15*AC],[a,30,30*AC],[o,1,wC],[o,5,5*wC],[o,15,15*wC],[o,30,30*wC],[i,1,CC],[i,3,3*CC],[i,6,6*CC],[i,12,12*CC],[n,1,RC],[n,2,2*RC],[r,1,LC],[e,1,IC],[e,3,3*IC],[t,1,MC]];function b(s){return(a(s)<s?p:o(s)<s?d:i(s)<s?f:n(s)<s?m:e(s)<s?r(s)<s?g:_:t(s)<s?v:y)(s)}function E(e,r,n,i){if(null==e&&(e=10),"number"==typeof e){var o=Math.abs(n-r)/e,a=lS((function(t){return t[2]})).right(x,o);a===x.length?(i=gS(r/MC,n/MC,e),e=t):a?(i=(a=x[o/x[a-1][2]<x[a][2]/o?a-1:a])[1],e=a[0]):(i=Math.max(gS(r,n,e),1),e=s)}return null==i?e:e.every(i)}return u.invert=function(t){return new Date(c(t))},u.domain=function(t){return arguments.length?h(wS.call(t,PC)):h().map(OC)},u.ticks=function(t,e){var r,n=h(),i=n[0],o=n[n.length-1],a=o<i;return a&&(r=i,i=o,o=r),r=(r=E(t,i,o,e))?r.range(i,o+1):[],a?r.reverse():r},u.tickFormat=function(t,e){return null==e?b:l(e)},u.nice=function(t,e){var r=h();return(t=E(t,r[0],r[r.length-1],e))?h(nA(r,t)):u},u.copy=function(){return FS(u,DC(t,e,r,n,i,o,a,s,l))},u}function BC(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}const{isNil:NC,isString:FC,uniq:kC}=ld,UC=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,zC={[ov.LINEAR]:function t(){var e=US(OS,OS);return e.copy=function(){return FS(e,t())},vS.apply(e,arguments),rA(e)},[ov.POWER]:function t(){var e=fA(kS());return e.copy=function(){return FS(e,t()).exponent(e.exponent())},vS.apply(e,arguments),e},[ov.LOG]:function t(){var e=cA(kS()).domain([1,10]);return e.copy=function(){return FS(e,t()).base(e.base())},vS.apply(e,arguments),e},[ov.IDENTITY]:function t(e){let r,n=[];function i(t){return null==t?r:t}return i.invert=i,i.domain=i.range=t=>t?(n=t,t):n,i.unknown=t=>t?(r=t,t):r,i.copy=()=>t().unknown(r),i},[ov.SEQUENTIAL]:function t(){var e=rA(function(){var t,e,r,n,i,o=0,a=1,s=OS,l=!1;function u(e){return isNaN(e=+e)?i:s(0===r?.5:(e=(n(e)-t)*r,l?Math.max(0,Math.min(1,e)):e))}return u.domain=function(i){return arguments.length?(t=n(o=+i[0]),e=n(a=+i[1]),r=t===e?0:1/(e-t),u):[o,a]},u.clamp=function(t){return arguments.length?(l=!!t,u):l},u.interpolator=function(t){return arguments.length?(s=t,u):s},u.unknown=function(t){return arguments.length?(i=t,u):i},function(i){return n=i,t=i(o),e=i(a),r=t===e?0:1/(e-t),u}}()(OS));return e.copy=function(){return BC(e,t())},yS.apply(e,arguments)},[ov.TIME]:function(){return vS.apply(DC(HA,jA,DA,OA,IA,RA,wA,yA,sw).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},[ov.QUANTILE]:function t(){var e,r=[],n=[],i=[];function o(){var t=0,e=Math.max(1,n.length);for(i=new Array(e-1);++t<e;)i[t-1]=_S(r,t/e);return a}function a(t){return isNaN(t=+t)?e:n[uS(i,t)]}return a.invertExtent=function(t){var e=n.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:r[0],e<i.length?i[e]:r[r.length-1]]},a.domain=function(t){if(!arguments.length)return r.slice();r=[];for(var e,n=0,i=t.length;n<i;++n)null==(e=t[n])||isNaN(e=+e)||r.push(e);return r.sort(sS),o()},a.range=function(t){return arguments.length?(n=CS.call(t),o()):n.slice()},a.unknown=function(t){return arguments.length?(e=t,a):e},a.quantiles=function(){return i.slice()},a.copy=function(){return t().domain(r).range(n).unknown(e)},vS.apply(a,arguments)},[ov.QUANTIZE]:function t(){var e,r=0,n=1,i=1,o=[.5],a=[0,1];function s(t){return t<=t?a[uS(o,t,0,i)]:e}function l(){var t=-1;for(o=new Array(i);++t<i;)o[t]=((t+1)*n-(t-i)*r)/(i+1);return s}return s.domain=function(t){return arguments.length?(r=+t[0],n=+t[1],l()):[r,n]},s.range=function(t){return arguments.length?(i=(a=CS.call(t)).length-1,l()):a.slice()},s.invertExtent=function(t){var e=a.indexOf(t);return e<0?[NaN,NaN]:e<1?[r,o[0]]:e>=i?[o[i-1],n]:[o[e-1],o[e]]},s.unknown=function(t){return arguments.length?(e=t,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return t().domain([r,n]).range(a).unknown(e)},vS.apply(rA(s),arguments)},[ov.THRESHOLD]:function t(){var e,r=[.5],n=[0,1],i=1;function o(t){return t<=t?n[uS(r,t,0,i)]:e}return o.domain=function(t){return arguments.length?(r=CS.call(t),i=Math.min(r.length,n.length-1),o):r.slice()},o.range=function(t){return arguments.length?(n=CS.call(t),i=Math.min(r.length,n.length-1),o):n.slice()},o.invertExtent=function(t){var e=n.indexOf(t);return[r[e-1],r[e]]},o.unknown=function(t){return arguments.length?(e=t,o):e},o.copy=function(){return t().domain(r).range(n).unknown(e)},vS.apply(o,arguments)},[ov.CAT]:LS,[ov.DIVERGING]:function t(){var e=rA(function(){var t,e,r,n,i,o,a,s=0,l=.5,u=1,c=OS,h=!1;function p(t){return isNaN(t=+t)?a:(t=.5+((t=+o(t))-e)*(t<e?n:i),c(h?Math.max(0,Math.min(1,t)):t))}return p.domain=function(a){return arguments.length?(t=o(s=+a[0]),e=o(l=+a[1]),r=o(u=+a[2]),n=t===e?0:.5/(e-t),i=e===r?0:.5/(r-e),p):[s,l,u]},p.clamp=function(t){return arguments.length?(h=!!t,p):h},p.interpolator=function(t){return arguments.length?(c=t,p):c},p.unknown=function(t){return arguments.length?(a=t,p):a},function(a){return o=a,t=a(s),e=a(l),r=a(u),n=t===e?0:.5/(e-t),i=e===r?0:.5/(r-e),p}}()(OS));return e.copy=function(){return BC(e,t())},yS.apply(e,arguments)}};class GC{constructor(){g_(this,"scaleOptions",{})}apply(t,{styleAttributeService:e}){var r=this;t.hooks.init.tapPromise("FeatureScalePlugin",Ev((function*(){var n;t.log(q_,iv.INIT),r.scaleOptions=t.getScaleOptions();const i=e.getLayerStyleAttributes(),o=null===(n=t.getSource())||void 0===n?void 0:n.data.dataArray;Array.isArray(o)&&0===o.length||(r.caculateScalesForAttributes(i||[],o),t.log(Y_,iv.INIT))}))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var n=Ev((function*(n){if(!n)return n;t.log(q_,iv.UPDATE),r.scaleOptions=t.getScaleOptions();const i=e.getLayerStyleAttributes(),o=t.getSource().data.dataArray;return Array.isArray(o)&&0===o.length||(r.caculateScalesForAttributes(i||[],o),t.log(Y_,iv.UPDATE),t.layerModelNeedUpdate=!0),!0}));return function(t){return n.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",(()=>{if(t.layerModelNeedUpdate)return;this.scaleOptions=t.getScaleOptions();const r=e.getLayerStyleAttributes(),n=t.getSource().data.dataArray;if((!Array.isArray(n)||0!==n.length)&&r){const t=r.filter((t=>t.needRescale));t.length&&this.caculateScalesForAttributes(t,n)}}))}isNumber(t){return!isNaN(parseFloat(t))&&isFinite(t)}caculateScalesForAttributes(t,e){t.forEach((t=>{if(t.scale){const r=t.scale,n=t.scale.field;r.names=this.parseFields(NC(n)?[]:n);const i=[];r.names.forEach((r=>{var n;i.push(this.createScale(r,t.name,null===(n=t.scale)||void 0===n?void 0:n.values,e))})),i.some((t=>t.type===av.VARIABLE))?(r.type=av.VARIABLE,i.forEach((t=>{var e,n;if(!r.callback&&"text"!==r.values)switch(null===(e=t.option)||void 0===e?void 0:e.type){case ov.LOG:case ov.LINEAR:case ov.POWER:if(r.values&&r.values.length>2){const e=t.scale.ticks(r.values.length);t.scale.domain(e)}r.values?t.scale.range(r.values):t.scale.range(t.option.domain);break;case ov.QUANTILE:case ov.QUANTIZE:case ov.THRESHOLD:t.scale.range(r.values);break;case ov.IDENTITY:break;case ov.CAT:r.values?t.scale.range(r.values):t.scale.range(t.option.domain);break;case ov.DIVERGING:case ov.SEQUENTIAL:t.scale.interpolator(KT(r.values))}"text"===r.values&&t.scale.range(null===(n=t.option)||void 0===n?void 0:n.domain)}))):(r.type=av.CONSTANT,r.defaultValues=i.map(((t,e)=>t.scale(r.names[e])))),r.scalers=i.map((t=>({field:t.field,func:t.scale,option:t.option}))),t.needRescale=!1}}))}parseFields(t){return Array.isArray(t)?t:FC(t)?t.split("*"):[t]}createScale(t,e,r,n){var i,o;const a=this.scaleOptions[e]&&(null===(i=this.scaleOptions[e])||void 0===i?void 0:i.field)===t?this.scaleOptions[e]:this.scaleOptions[t],s={field:t,scale:void 0,type:av.VARIABLE,option:a};if(!n||!n.length)return a&&a.type?s.scale=this.createDefaultScale(a):(s.scale=LS([t]),s.type=av.CONSTANT),s;const l=null===(o=n.find((e=>!NC(e[t]))))||void 0===o?void 0:o[t];if(this.isNumber(t)||NC(l)&&!a)s.scale=LS([t]),s.type=av.CONSTANT;else{let e=a&&a.type||this.getDefaultType(l);"text"===r&&(e=ov.CAT),void 0===r&&(e=ov.IDENTITY);const i=this.createScaleConfig(e,t,a,n);s.scale=this.createDefaultScale(i),s.option=i}return s}getDefaultType(t){let e=ov.LINEAR;return"string"==typeof t&&(e=UC.test(t)?ov.TIME:ov.CAT),e}createScaleConfig(t,e,r,n){const i={type:t};let o=[];if(t===ov.QUANTILE){const t=new Map;null==n||n.forEach((r=>{t.set(r._id,r[e])})),o=Array.from(t.values())}else o=(null==n?void 0:n.map((t=>t[e])))||[];if(null!=r&&r.domain)i.domain=null==r?void 0:r.domain;else if(t===ov.CAT||t===ov.IDENTITY)i.domain=kC(o);else if(t===ov.QUANTILE)i.domain=o;else if(t===ov.DIVERGING){const t=HT(o),e=void 0!==(null==r?void 0:r.neutral)?null==r?void 0:r.neutral:(t[0]+t[1])/2;i.domain=[t[0],e,t[1]]}else i.domain=HT(o);return v_(v_({},i),r)}createDefaultScale({type:t,domain:e,unknown:r,clamp:n,nice:i}){const o=zC[t]();return e&&o.domain&&o.domain(e),r&&o.unknown(r),void 0!==n&&o.clamp&&o.clamp(n),void 0!==i&&o.nice&&o.nice(i),o}}class jC{apply(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",(()=>{t.animateStatus&&t.models.forEach((e=>{e.addUniforms(v_({},t.layerModel.getAnimateUniforms()))}))}))}}class VC{apply(t){t.hooks.afterInit.tap("LayerMaskPlugin",(()=>{const{maskLayers:e,enableMask:r}=t.getLayerConfig();!t.tileLayer&&e&&e.length>0&&t.updateLayerConfig({mask:r})}))}}class HC{build(t){return Ev((function*(){t.prepareBuildModel(),yield t.buildModels()}))()}initLayerModel(t){var e=this;return Ev((function*(){yield e.build(t),t.styleNeedUpdate=!1}))()}prepareLayerModel(t){var e=this;return Ev((function*(){yield e.build(t),t.styleNeedUpdate=!1}))()}apply(t){var e=this;t.hooks.init.tapPromise("LayerModelPlugin",Ev((function*(){t.getSource().isTile?t.prepareBuildModel():(t.log(Q_,iv.INIT),yield e.initLayerModel(t),t.log(J_,iv.INIT))}))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var r=Ev((function*(r){return!!r&&(!t.getSource().isTile&&(t.log(Q_,iv.UPDATE),yield e.prepareLayerModel(t),t.log(J_,iv.UPDATE),!0))}));return function(t){return r.apply(this,arguments)}}())}}class WC{apply(t){t.hooks.afterInit.tap("LayerStylePlugin",(()=>{const{autoFit:e,fitBoundsOptions:r}=t.getLayerConfig();e&&t.fitBounds(r),t.styleNeedUpdate=!1}))}}const XC=["type"],ZC={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},qC={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},YC={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},KC={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};class $C{apply(t){t.hooks.beforeRender.tap("LightingPlugin",(()=>{const{enableLighting:e}=t.getLayerConfig();e&&t.models.forEach((t=>t.addUniforms(v_({},function(t){const e={u_DirectionalLights:new Array(3).fill(v_({},YC)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(v_({},KC)),u_NumOfSpotLights:0};return t&&t.length||(t=[qC]),t.forEach((t=>{let{type:r="directional"}=t,n=Ay(t,XC);const i=ZC[r].lights,o=ZC[r].num,a=e[o];e[i][a]=v_(v_({},e[i][a]),n),e[o]++})),e}()))))}))}}function QC(t){return t.map((t=>("string"==typeof t&&(t=[t,{}]),t)))}function JC(t,e,r,n){const i=t.multiPassRenderer;return i.add(n("render")),QC(e).forEach((t=>{const[e,n]=t;i.add(r(e),n)})),i.add(r("copy")),i}class tR{constructor(){g_(this,"enabled",void 0)}apply(t,{rendererService:e,postProcessingPassFactory:r,normalPassFactory:n}){t.hooks.init.tapPromise("MultiPassRendererPlugin",(()=>{const{enableMultiPassRenderer:e,passes:i=[]}=t.getLayerConfig();this.enabled=!!e&&!1!==t.getLayerConfig().enableMultiPassRenderer,this.enabled&&(t.multiPassRenderer=JC(t,i,r,n),t.multiPassRenderer.setRenderFlag(!0))})),t.hooks.beforeRender.tap("MultiPassRendererPlugin",(()=>{if(this.enabled){const{width:r,height:n}=e.getViewportSize();t.multiPassRenderer.resize(r,n)}}))}}const eR={POSITION:0,POSITION_64LOW:1,COLOR:2,PICKING_COLOR:3,STROKE:4,OPACITY:5,OFFSETS:6,ROTATION:7,MAX:8};const{isNumber:rR}=ld,nR=1,iR=2;class oR{constructor(){g_(this,"pickingUniformMap",void 0)}pickOption2Array(){const t=[];return this.pickingUniformMap.forEach((e=>{rR(e)?t.push(e):t.push(...e)})),t}updatePickOption(t,e){Object.keys(t).forEach((e=>{this.pickingUniformMap.set(e,t[e])}));const r=e.getLayerConfig().pickingBuffer||0,n=Number(e.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",r),this.pickingUniformMap.set("u_shaderPick",n);e.getPickingUniformBuffer().subData({offset:0,data:this.pickOption2Array()})}apply(t,{styleAttributeService:e}){this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_activeMix",0]]),t.hooks.init.tapPromise("PixelPickingPlugin",(()=>{const{enablePicking:r}=t.getLayerConfig();e.registerStyleAttribute({name:"pickingColor",type:sv.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:eR.PICKING_COLOR,buffer:{data:[],type:x_.FLOAT},size:3,update:t=>{const{id:e}=t;return r?De(e):[0,0,0]}}})})),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",(()=>{const{enablePicking:e}=t.getLayerConfig();e&&t.isVisible()&&(this.updatePickOption({u_PickingStage:nR},t),t.models.forEach((t=>t.addUniforms({u_PickingStage:nR}))))})),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",(()=>{const{enablePicking:e}=t.getLayerConfig();e&&t.isVisible()&&(this.updatePickOption({u_PickingStage:iR},t),t.models.forEach((t=>t.addUniforms({u_PickingStage:iR}))))})),t.hooks.beforeHighlight.tap("PixelPickingPlugin",(e=>{const{highlightColor:r,activeMix:n=0}=t.getLayerConfig(),i="string"==typeof r?Oe(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Pe(new Uint8Array(e))});const o={u_PickingStage:iR,u_PickingColor:e,u_HighlightColor:i.map((t=>255*t)),u_activeMix:n};this.updatePickOption(o,t),t.models.forEach((t=>t.addUniforms(o)))})),t.hooks.beforeSelect.tap("PixelPickingPlugin",(e=>{const{selectColor:r,selectMix:n=0}=t.getLayerConfig(),i="string"==typeof r?Oe(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Pe(new Uint8Array(e))});const o={u_PickingStage:iR,u_PickingColor:e,u_HighlightColor:i.map((t=>255*t)),u_activeMix:n,u_CurrentSelectedId:e,u_SelectColor:i.map((t=>255*t))};this.updatePickOption(o,t),t.models.forEach((t=>t.addUniforms(o)))}))}}const aR=["mvt","geojsonvt","testTile"];class sR{apply(t,{styleAttributeService:e}){t.hooks.init.tapPromise("RegisterStyleAttributePlugin",(()=>{(function(t){const e=t.getSource();return aR.includes(e.parser.type)})(t)||this.registerBuiltinAttributes(e,t)}))}registerBuiltinAttributes(t,e){"MaskLayer"!==e.type?(this.registerPositionAttribute(t),this.registerColorAttribute(t)):this.registerPositionAttribute(t)}registerPositionAttribute(t){t.registerStyleAttribute({name:"position",type:sv.Attribute,descriptor:{name:"a_Position",shaderLocation:eR.POSITION,buffer:{data:[],type:x_.FLOAT},size:3,update:(t,e,r)=>2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}})}registerColorAttribute(t){t.registerStyleAttribute({name:"color",type:sv.Attribute,descriptor:{name:"a_Color",shaderLocation:eR.COLOR,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:4,update:t=>{const{color:e}=t;return e&&e.length?e:[1,1,1,1]}}})}}class lR{constructor(){g_(this,"cameraService",void 0),g_(this,"coordinateSystemService",void 0),g_(this,"rendererService",void 0),g_(this,"mapService",void 0),g_(this,"layerService",void 0)}apply(t,{rendererService:e,mapService:r,layerService:n,coordinateSystemService:i,cameraService:o}){let a;this.rendererService=e,this.mapService=r,this.layerService=n,this.coordinateSystemService=i,this.cameraService=o,this.rendererService.uniformBuffers[0]||(a=this.rendererService.createBuffer({data:new Float32Array(92),isUBO:!0,label:"renderUniformBuffer"}),this.rendererService.uniformBuffers[0]=a),t.hooks.beforeRender.tap("ShaderUniformPlugin",(()=>{const e=t.getLayerConfig().tileOrigin;this.coordinateSystemService.refresh(e);const{width:r,height:n}=this.rendererService.getViewportSize(),{data:i,uniforms:o}=this.generateUBO(r,n);if(this.layerService.alreadyInRendering&&this.rendererService.uniformBuffers[0]){this.rendererService.uniformBuffers[0].subData({offset:0,data:i})}"WebGL1"===this.rendererService.queryVerdorInfo()&&t.models.forEach((e=>{e.addUniforms(v_(v_({},o),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))}))}))}generateUBO(t,e){const r=this.cameraService.getProjectionMatrix(),n=this.cameraService.getViewMatrix(),i=this.cameraService.getViewProjectionMatrix(),o=this.cameraService.getModelMatrix(),a=this.coordinateSystemService.getViewportCenterProjection(),s=this.coordinateSystemService.getPixelsPerDegree(),l=this.cameraService.getZoom(),u=this.coordinateSystemService.getPixelsPerDegree2(),c=this.cameraService.getZoomScale(),h=this.coordinateSystemService.getPixelsPerMeter(),p=this.coordinateSystemService.getCoordinateSystem(),d=this.cameraService.getCameraPosition(),f=window.devicePixelRatio,m=this.coordinateSystemService.getViewportCenter(),g=[t,e],_=this.cameraService.getFocalDistance();return{data:[...n,...r,...i,...o,...a,...s,l,...u,c,...h,p,...d,f,...m,...g,_,0,0,0],uniforms:{[L_]:r,[I_]:n,[M_]:i,[O_]:l,[P_]:c,[D_]:_,[B_]:d,[k_]:p,[U_]:m,[z_]:a,[G_]:s,[j_]:u,[V_]:h,u_ViewportSize:g,u_ModelMatrix:o,u_DevicePixelRatio:f}}}}class uR{apply(t){t.hooks.beforeRender.tap("UpdateModelPlugin",(()=>{t.layerModel&&t.layerModel.needUpdate().then((e=>{e&&t.renderLayers()}))})),t.hooks.afterRender.tap("UpdateModelPlugin",(()=>{t.layerModelNeedUpdate=!1}))}}class cR{apply(t,{styleAttributeService:e}){t.hooks.init.tapPromise("UpdateStyleAttributePlugin",(()=>{this.initStyleAttribute(t,{styleAttributeService:e})})),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(()=>{t.layerModelNeedUpdate||t.inited&&this.updateStyleAttribute(t,{styleAttributeService:e})}))}updateStyleAttribute(t,{styleAttributeService:e}){const r=e.getLayerStyleAttributes()||[],n=e.getLayerStyleAttribute("filter");if(n&&n.needRegenerateVertices)return t.layerModelNeedUpdate=!0,void r.forEach((t=>t.needRegenerateVertices=!1));r.filter((t=>t.needRegenerateVertices)).forEach((r=>{e.updateAttributeByFeatureRange(r.name,t.getEncodedData(),r.featureRange.startIndex,r.featureRange.endIndex,t),r.needRegenerateVertices=!1}))}initStyleAttribute(t,{styleAttributeService:e}){(e.getLayerStyleAttributes()||[]).filter((t=>t.needRegenerateVertices)).forEach((r=>{e.updateAttributeByFeatureRange(r.name,t.getEncodedData(),r.featureRange.startIndex,r.featureRange.endIndex),r.needRegenerateVertices=!1}))}}const hR={[ev.additive]:{enable:!0,func:{srcRGB:x_.ONE,dstRGB:x_.ONE,srcAlpha:1,dstAlpha:1}},[ev.none]:{enable:!1},[ev.normal]:{enable:!0,func:{srcRGB:x_.SRC_ALPHA,dstRGB:x_.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}},[ev.subtractive]:{enable:!0,func:{srcRGB:x_.ONE,dstRGB:x_.ONE,srcAlpha:x_.ZERO,dstAlpha:x_.ONE_MINUS_SRC_COLOR},equation:{rgb:x_.FUNC_SUBTRACT,alpha:x_.FUNC_SUBTRACT}},[ev.max]:{enable:!0,func:{srcRGB:x_.ONE,dstRGB:x_.ONE},equation:{rgb:x_.MAX_EXT}},[ev.min]:{enable:!0,func:{srcRGB:x_.ONE,dstRGB:x_.ONE},equation:{rgb:x_.MIN_EXT}}};class pR{constructor(t){g_(this,"layer",void 0),this.layer=t}pickRender(t){const e=this.layer.getContainer().layerService,r=this.layer;if(r.tileLayer)return r.tileLayer.pickRender(t);r.hooks.beforePickingEncode.call(),e.renderTileLayerMask(r),r.renderModels({ispick:!0}),r.hooks.afterPickingEncode.call()}pick(t,e){var r=this;return Ev((function*(){const n=r.layer.getContainer().pickingService;return"RasterLayer"===t.type?r.pickRasterLayer(t,e):(r.pickRender(e),n.pickFromPickingFBO(t,e))}))()}pickRasterLayer(t,e,r){const n=this.layer.getContainer(),i=n.pickingService,o=n.mapService,a=this.layer.getSource().extent,s=function(t,e){const[r,n,i,o]=e;return t.lng>r&&t.lng<=i&&t.lat>n&&t.lat<=o}(e.lngLat,a),l={x:e.x,y:e.y,type:e.type,lngLat:e.lngLat,target:e,rasterValue:null},u=r||t;if(s){const r=this.readRasterValue(t,a,o,e.x,e.y);return l.rasterValue=r,i.triggerHoverOnLayer(u,l),!0}return l.type="mousemove"===e.type?"mouseout":"un"+e.type,i.triggerHoverOnLayer(u,v_(v_({},l),{},{type:"unpick"})),i.triggerHoverOnLayer(u,l),!1}readRasterValue(t,e,r,n,i){const o=t.getSource().data.dataArray[0],[a=0,s=0,l=10,u=-10]=e,c=r.lngLatToContainer([a,s]),h=r.lngLatToContainer([l,u]),p=h.x-c.x,d=c.y-h.y,f=[(n-c.x)/p,(i-h.y)/d],m=o.width||1,g=o.height||1,_=Math.floor(f[0]*m),v=Math.floor(f[1]*g),y=Math.max(0,v-1)*m+_;return o.data[y]}selectFeature(t){const e=this.layer,[r,n,i]=t;e.hooks.beforeSelect.call([r,n,i])}highlightPickedFeature(t){const[e,r,n]=t;this.layer.hooks.beforeHighlight.call([e,r,n])}getFeatureById(t){return this.layer.getSource().getFeatureById(t)}}class dR{constructor(t){g_(this,"layer",void 0),g_(this,"rendererService",void 0),g_(this,"colorTexture",void 0),g_(this,"key",void 0),this.layer=t;const e=this.layer.getContainer();this.rendererService=e.rendererService}getColorTexture(t,e){const r=this.getTextureKey(t,e);return this.key===r||(this.createColorTexture(t,e),this.key=r),this.colorTexture}createColorTexture(t,e){const{createTexture2D:r}=this.rendererService,n=this.getColorRampBar(t,e),i=r({data:new Uint8Array(n.data),width:n.width,height:n.height,flipY:!1,unorm:!0});return this.colorTexture=i,i}setColorTexture(t,e,r){this.key=this.getTextureKey(e,r),this.colorTexture=t}destroy(){var t;null===(t=this.colorTexture)||void 0===t||t.destroy()}getColorRampBar(t,e){switch(t.type){case"cat":return function(t){let e=window.document.createElement("canvas"),r=e.getContext("2d");e.width=256,e.height=1;const n=r.createImageData(256,1);return n.data.fill(0),t.positions.forEach(((e,r)=>{const i=Oe(t.colors[r]);n.data[4*e+0]=255*i[0],n.data[4*e+1]=255*i[1],n.data[4*e+2]=255*i[2],n.data[4*e+3]=255*i[3]})),e=null,r=null,n}(t);case"quantize":return function(t){let e=window.document.createElement("canvas"),r=e.getContext("2d");r.globalAlpha=1,e.width=256,e.height=1;const n=256/t.colors.length;for(let e=0;e<t.colors.length;e++)r.beginPath(),r.lineWidth=2,r.strokeStyle=t.colors[e],r.moveTo(e*n,0),r.lineTo((e+1)*n,0),r.stroke();const i=r.getImageData(0,0,256,1).data,o=Ne(r,i);return e=null,r=null,o}(t);case"custom":return function(t,e){let r=window.document.createElement("canvas"),n=r.getContext("2d");n.globalAlpha=1,r.width=256,r.height=1;const i=e[1]-e[0];t.positions.length-t.colors.length!=1&&console.warn("positions 的数字个数应当比 colors 的样式多一个,poisitions 的首尾值一般为数据的最大最新值");for(let r=0;r<t.colors.length;r++)n.beginPath(),n.lineWidth=2,n.strokeStyle=t.colors[r],n.moveTo((t.positions[r]-e[0])/i*255,0),n.lineTo((t.positions[r+1]-e[0])/i*255,0),n.stroke();const o=n.getImageData(0,0,256,1).data,a=Ne(n,o);return r=null,n=null,a}(t,e);case"linear":return function(t,e){let r=window.document.createElement("canvas"),n=r.getContext("2d");r.width=256,r.height=1;const i=n.createLinearGradient(0,0,256,1),o=e[1]-e[0];for(let r=0;r<t.colors.length;++r){const n=Math.max((t.positions[r]-e[0])/o,0);i.addColorStop(n,t.colors[r])}n.fillStyle=i,n.fillRect(0,0,256,1);const a=n.getImageData(0,0,256,1).data,s=Ne(n,a);return r=null,n=null,s}(t,e);default:return Be(t)}}getTextureKey(t,e){var r;return`${t.colors.join("_")}_${null==t||null===(r=t.positions)||void 0===r?void 0:r.join("_")}_${t.type}_${null==e?void 0:e.join("_")}`}}const fR=["passes"],mR=["moduleName","vertexShader","fragmentShader","defines","inject","triangulation","styleOption","pickingEnabled"],{isEqual:gR,isFunction:_R,isNumber:vR,isObject:yR,isPlainObject:xR,isUndefined:bR}=ld;let ER=0;class TR extends Vd.exports.EventEmitter{get shaderModuleService(){return this.container.shaderModuleService}get cameraService(){return this.container.cameraService}get coordinateService(){return this.container.coordinateSystemService}get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get pickingService(){return this.container.pickingService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get interactionService(){return this.container.interactionService}get mapService(){var t;return null===(t=this.container)||void 0===t?void 0:t.mapService}get normalPassFactory(){return this.container.normalPassFactory}constructor(t={}){super(),g_(this,"id",""+ER++),g_(this,"name",`${ER}`),g_(this,"parent",void 0),g_(this,"coordCenter",void 0),g_(this,"type",void 0),g_(this,"visible",!0),g_(this,"zIndex",0),g_(this,"minZoom",void 0),g_(this,"maxZoom",void 0),g_(this,"inited",!1),g_(this,"layerModelNeedUpdate",!1),g_(this,"pickedFeatureID",null),g_(this,"selectedFeatureID",null),g_(this,"styleNeedUpdate",!1),g_(this,"rendering",void 0),g_(this,"forceRender",!1),g_(this,"clusterZoom",0),g_(this,"layerType",void 0),g_(this,"triangulation",void 0),g_(this,"layerPickService",void 0),g_(this,"textureService",void 0),g_(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),g_(this,"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),g_(this,"hooks",{init:new _x,afterInit:new mx,beforeRender:new mx,beforeRenderData:new vx,afterRender:new cx,beforePickingEncode:new cx,afterPickingEncode:new cx,beforeHighlight:new cx(["pickedColor"]),afterHighlight:new cx,beforeSelect:new cx(["pickedColor"]),afterSelect:new cx,beforeDestroy:new cx,afterDestroy:new cx}),g_(this,"models",[]),g_(this,"multiPassRenderer",void 0),g_(this,"plugins",void 0),g_(this,"startInit",!1),g_(this,"sourceOption",void 0),g_(this,"layerModel",void 0),g_(this,"shapeOption",void 0),g_(this,"tileLayer",void 0),g_(this,"layerChildren",[]),g_(this,"masks",[]),g_(this,"configService",bb),g_(this,"styleAttributeService",void 0),g_(this,"layerSource",void 0),g_(this,"postProcessingPassFactory",void 0),g_(this,"animateOptions",{enable:!1}),g_(this,"container",void 0),g_(this,"encodedData",void 0),g_(this,"currentPickId",null),g_(this,"rawConfig",void 0),g_(this,"needUpdateConfig",void 0),g_(this,"encodeStyleAttribute",{}),g_(this,"enableShaderEncodeStyles",[]),g_(this,"enableDataEncodeStyles",[]),g_(this,"pendingStyleAttributes",[]),g_(this,"scaleOptions",{}),g_(this,"animateStartTime",void 0),g_(this,"animateStatus",!1),g_(this,"isDestroyed",!1),g_(this,"uniformBuffers",[]),g_(this,"encodeDataLength",0),g_(this,"sourceEvent",(()=>{this.dataState.dataSourceNeedUpdate=!0;const t=this.getLayerConfig();t&&t.autoFit&&this.fitBounds(t.fitBoundsOptions);this.layerSource.getSourceCfg().autoRender&&setTimeout((()=>{this.reRender()}),10)})),this.name=t.name||this.id,this.zIndex=t.zIndex||0,this.rawConfig=t,this.masks=t.maskLayers||[]}addMask(t){this.masks.push(t),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}removeMask(t){const e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1),this.updateLayerConfig({maskLayers:this.masks})}disableMask(){this.updateLayerConfig({enableMask:!1})}enableMask(){this.updateLayerConfig({enableMask:!0})}addMaskLayer(t){this.masks.push(t)}removeMaskLayer(t){const e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1),t.destroy()}getAttribute(t){return this.styleAttributeService.getLayerStyleAttribute(t)}getLayerConfig(){return this.configService.getLayerConfig(this.id)}updateLayerConfig(t){if(Object.keys(t).map((e=>{e in this.rawConfig&&(this.rawConfig[e]=t[e])})),this.startInit){const e=this.container.id;this.configService.setLayerConfig(e,this.id,v_(v_(v_({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}else this.needUpdateConfig=v_(v_({},this.needUpdateConfig),t)}setContainer(t){this.container=t}getContainer(){return this.container}addPlugin(t){return this.plugins.push(t),this}init(){var t=this;return Ev((function*(){const e=t.container.id;t.startInit=!0,t.configService.setLayerConfig(e,t.id,t.rawConfig),t.layerType=t.rawConfig.layerType;const{enableMultiPassRenderer:r,passes:n}=t.getLayerConfig();r&&null!=n&&n.length&&n.length>0&&t.mapService.on("mapAfterFrameChange",(()=>{t.renderLayers()})),t.postProcessingPassFactory=t.container.postProcessingPassFactory,t.styleAttributeService=t.container.styleAttributeService,r&&(t.multiPassRenderer=t.container.multiPassRenderer,t.multiPassRenderer.setLayer(t)),t.pendingStyleAttributes.forEach((({attributeName:e,attributeField:r,attributeValues:n,updateOptions:i})=>{t.styleAttributeService.updateStyleAttribute(e,{scale:v_({field:r},t.splitValuesAndCallbackInAttribute(n,r?void 0:t.getLayerConfig()[e]))},i)})),t.pendingStyleAttributes=[],t.plugins=[new VT,new sR,new GC,new jT,new WC,new VC,new cR,new uR,new tR,new lR,new jC,new $C,new oR,new HC];for(const e of t.plugins)e.apply(t,t.container);t.layerPickService=new pR(t),t.textureService=new dR(t),t.log(H_),yield t.hooks.init.promise(),t.log(W_),t.inited=!0,t.emit("inited",{target:t,type:"inited"}),t.emit("add",{target:t,type:"add"}),t.hooks.afterInit.call()}))()}log(t,e="init"){var r;if(this.tileLayer||this.isTileLayer)return;const n=`${this.id}.${e}.${t}`,i={id:this.id,type:this.type};null===(r=this.debugService)||void 0===r||r.log(n,i)}updateModelData(t){t.attributes&&t.elements?this.models.map((e=>{e.updateAttributesAndElements(t.attributes,t.elements)})):console.warn("data error")}setLayerPickService(t){this.layerPickService=t}prepareBuildModel(){0!==Object.keys(this.needUpdateConfig||{}).length&&this.updateLayerConfig({});const{animateOption:t}=this.getLayerConfig();null!=t&&t.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}color(t,e,r){return this.updateStyleAttribute("color",t,e,r),this}texture(t,e,r){return this.updateStyleAttribute("texture",t,e,r),this}rotate(t,e,r){return this.updateStyleAttribute("rotate",t,e,r),this}size(t,e,r){return this.updateStyleAttribute("size",t,e,r),this}filter(t,e,r){const n=this.updateStyleAttribute("filter",t,e,r);return this.dataState.dataSourceNeedUpdate=n&&this.inited,this}shape(t,e,r){this.shapeOption={field:t,values:e};const n=this.updateStyleAttribute("shape",t,e,r);return this.dataState.dataSourceNeedUpdate=n&&this.inited,this}label(t,e,r){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:e,updateOptions:r}),this}animate(t){let e={};return yR(t)?(e.enable=!0,e=v_(v_({},e),t)):e.enable=t,this.updateLayerConfig({animateOption:e}),this}source(t,e){return"source"===(null==t?void 0:t.type)?(this.setSource(t),this):(this.sourceOption={data:t,options:e},this.clusterZoom=0,this)}setData(t,e){return this.inited?(this.dataUpdatelog(),this.layerSource.setData(t,e)):this.on("inited",(()=>{this.dataUpdatelog(),this.layerSource.setData(t,e)})),this}dataUpdatelog(){this.log(X_,iv.UPDATE),this.layerSource.once("update",(()=>{this.log(Z_,iv.UPDATE)}))}style(t){const{passes:e}=t,r=Ay(t,fR);e&&QC(e).forEach((t=>{const e=this.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(t[0]);e&&e.updateOptions(t[1])})),r.borderColor&&(r.stroke=r.borderColor),r.borderWidth&&(r.strokeWidth=r.borderWidth);const n=r;return Object.keys(r).forEach((t=>{const e=r[t];!Array.isArray(e)||2!==e.length||vR(e[0])||vR(e[1])||(n[t]={field:e[0],value:e[1]})})),this.encodeStyle(n),this.updateLayerConfig(n),this}encodeStyle(t){Object.keys(t).forEach((e=>{[...this.enableShaderEncodeStyles,...this.enableDataEncodeStyles].includes(e)&&xR(t[e])&&(t[e].field||t[e].value)&&!gR(this.encodeStyleAttribute[e],t[e])?(this.encodeStyleAttribute[e]=t[e],this.updateStyleAttribute(e,t[e].field,t[e].value),this.inited&&(this.dataState.dataMappingNeedUpdate=!0)):this.encodeStyleAttribute[e]&&(delete this.encodeStyleAttribute[e],this.dataState.dataSourceNeedUpdate=!0)}))}scale(t,e){const r=v_({},this.scaleOptions);if(yR(t)?this.scaleOptions=v_(v_({},this.scaleOptions),t):this.scaleOptions[t]=e,this.styleAttributeService&&!gR(r,this.scaleOptions)){const r=yR(t)?t:{[t]:e};this.styleAttributeService.updateScaleAttribute(r)}return this}renderLayers(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}prerender(){}render(t={}){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender||this.renderModels(t),this)}renderMultiPass(){var t=this;return Ev((function*(){t.encodeDataLength<=0&&!t.forceRender||(t.multiPassRenderer&&t.multiPassRenderer.getRenderFlag()?yield t.multiPassRenderer.render():t.renderModels())}))()}active(t){const e={};return e.enableHighlight=!!yR(t)||t,yR(t)?(e.enableHighlight=!0,t.color&&(e.highlightColor=t.color),t.mix&&(e.activeMix=t.mix)):e.enableHighlight=!!t,this.updateLayerConfig(e),this}setActive(t,e){if(yR(t)){const{x:r=0,y:n=0}=t;this.updateLayerConfig({highlightColor:yR(e)?e.color:this.getLayerConfig().highlightColor,activeMix:yR(e)?e.mix:this.getLayerConfig().activeMix}),this.pick({x:r,y:n})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:yR(e)?e.color:this.getLayerConfig().highlightColor,activeMix:yR(e)?e.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(De(t)).then((()=>{setTimeout((()=>{this.reRender()}),1)}))}select(t){const e={};return e.enableSelect=!!yR(t)||t,yR(t)?(e.enableSelect=!0,t.color&&(e.selectColor=t.color),t.mix&&(e.selectMix=t.mix)):e.enableSelect=!!t,this.updateLayerConfig(e),this}setSelect(t,e){if(yR(t)){const{x:r=0,y:n=0}=t;this.updateLayerConfig({selectColor:yR(e)?e.color:this.getLayerConfig().selectColor,selectMix:yR(e)?e.mix:this.getLayerConfig().selectMix}),this.pick({x:r,y:n})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:yR(e)?e.color:this.getLayerConfig().selectColor,selectMix:yR(e)?e.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(De(t)).then((()=>{setTimeout((()=>{this.reRender()}),1)}))}setBlend(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}show(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}hide(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}setIndex(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}setCurrentPickId(t){this.currentPickId=t}getCurrentPickId(){return this.currentPickId}setCurrentSelectedId(t){this.selectedFeatureID=t}getCurrentSelectedId(){return this.selectedFeatureID}isVisible(){const t=this.mapService.getZoom(),{visible:e,minZoom:r=-1/0,maxZoom:n=1/0}=this.getLayerConfig();return!!e&&t>=r&&t<n}setMultiPass(t,e){if(this.updateLayerConfig({enableMultiPassRenderer:t}),e&&this.updateLayerConfig({passes:e}),t){const{passes:t=[]}=this.getLayerConfig();this.multiPassRenderer=JC(this,t,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);const{width:e,height:r}=this.rendererService.getViewportSize();this.multiPassRenderer.resize(e,r)}return this}setMinZoom(t){return this.updateLayerConfig({minZoom:t}),this}getMinZoom(){const{minZoom:t}=this.getLayerConfig();return t}getMaxZoom(){const{maxZoom:t}=this.getLayerConfig();return t}get(t){return this.getLayerConfig()[t]}setMaxZoom(t){return this.updateLayerConfig({maxZoom:t}),this}setAutoFit(t){return this.updateLayerConfig({autoFit:t}),this}fitBounds(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;const e=this.getSource().extent;return e.some((t=>Math.abs(t)===1/0))||this.mapService.fitBounds([[e[0],e[1]],[e[2],e[3]]],t),this}destroy(t=!0){var e,r,n,i,o;if(this.isDestroyed)return;null===(e=this.layerModel)||void 0===e||e.uniformBuffers.forEach((t=>{t.destroy()})),this.layerChildren.map((t=>t.destroy(!1))),this.layerChildren=[];const{maskfence:a}=this.getLayerConfig();a&&(this.masks.map((t=>t.destroy(!1))),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(r=this.multiPassRenderer)||void 0===r||r.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(n=this.layerModel)||void 0===n||n.clearModels(t),null===(i=this.tileLayer)||void 0===i||i.destroy(),this.models=[],null===(o=this.debugService)||void 0===o||o.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}clear(){this.styleAttributeService.clearAllAttributes()}clearModels(){var t;this.models.forEach((t=>t.destroy())),null===(t=this.layerModel)||void 0===t||t.clearModels(),this.models=[]}isDirty(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((t=>t.needRescale||t.needRemapping||t.needRegenerateVertices)).length}setSource(t){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){const t=this.mapService.getZoom();this.layerSource.updateClusterData(t)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",(({type:t})=>{if(void 0===this.coordCenter){const t=this.layerSource.center;this.coordCenter=t}if("update"===t){if(this.tileLayer)return void this.tileLayer.reload();this.sourceEvent()}}))}getSource(){return this.layerSource}getScaleOptions(){return this.scaleOptions}setEncodedData(t){this.encodedData=t,this.encodeDataLength=t.length}getEncodedData(){return this.encodedData}getScale(t){return this.styleAttributeService.getLayerAttributeScale(t)}getLegend(t){var e,r,n;const i=this.styleAttributeService.getLayerStyleAttribute(t);return{type:null===(r=((null==i||null===(e=i.scale)||void 0===e?void 0:e.scalers)||[])[0])||void 0===r||null===(r=r.option)||void 0===r?void 0:r.type,field:null==i||null===(n=i.scale)||void 0===n?void 0:n.field,items:this.getLegendItems(t)}}getLegendItems(t){const e=this.styleAttributeService.getLayerAttributeScale(t);if(!e)return[];if(e.invertExtent){return e.range().map((r=>({value:e.invertExtent(r),[t]:r})))}if(e.ticks){return e.ticks().map((r=>({value:r,[t]:e(r)})))}if(null!=e&&e.domain){return e.domain().filter((t=>!bR(t))).map((r=>({value:r,[t]:e(r)})))}return[]}pick({x:t,y:e}){this.interactionService.triggerHover({x:t,y:e})}boxSelect(t,e){this.pickingService.boxPickLayer(this,t,e)}buildLayerModel(t){var e=this;return Ev((function*(){const{moduleName:r,vertexShader:n,fragmentShader:i,defines:o,inject:a,triangulation:s,styleOption:l,pickingEnabled:u=!0}=t,c=Ay(t,mR);e.shaderModuleService.registerModule(r,{vs:n,fs:i,defines:o,inject:a});const{vs:h,fs:p,uniforms:d}=e.shaderModuleService.getModule(r),{createModel:f}=e.rendererService;return new Promise((t=>{const{attributes:r,elements:n,count:i}=e.styleAttributeService.createAttributesAndIndices(e.encodedData,s,l,e),o=[...e.layerModel.uniformBuffers,...e.rendererService.uniformBuffers];u&&o.push(e.getPickingUniformBuffer());const a=v_({attributes:r,uniforms:d,fs:p,vs:h,elements:n,blend:hR[ev.normal],uniformBuffers:o,textures:e.layerModel.textures},c);i&&(a.count=i);t(f(a))}))}))()}createAttributes(t){const{triangulation:e}=t,{attributes:r}=this.styleAttributeService.createAttributes(this.encodedData,e);return r}getTime(){return this.layerService.clock.getDelta()}setAnimateStartTime(){this.animateStartTime=this.layerService.clock.getElapsedTime()}stopAnimate(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}getLayerAnimateTime(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}needPick(t){const{enableHighlight:e=!0,enableSelect:r=!0}=this.getLayerConfig();let n=-1!==this.eventNames().indexOf(t)||-1!==this.eventNames().indexOf("un"+t);return"click"!==t&&"dblclick"!==t||!r||(n=!0),"mousemove"!==t||!e&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(n=!0),this.isVisible()&&n}buildModels(){return Ev((function*(){throw new Error("Method not implemented.")}))()}rebuildModels(){var t=this;return Ev((function*(){yield t.buildModels()}))()}renderMulPass(t){return Ev((function*(){yield t.render()}))()}renderModels(t={}){return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach((e=>{e.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t),textures:this.layerModel.textures},(null==t?void 0:t.ispick)||!1)})),this.hooks.afterRender.call(),this)}updateStyleAttribute(t,e,r,n){const i=this.configService.getAttributeConfig(this.id)||{};return!gR(i[t],{field:e,values:r})&&(-1!==["color","size","texture","rotate","filter","label","shape"].indexOf(t)&&this.configService.setAttributeConfig(this.id,{[t]:{field:e,values:r}}),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:v_({field:e},this.splitValuesAndCallbackInAttribute(r,this.getLayerConfig()[e]))},n):this.pendingStyleAttributes.push({attributeName:t,attributeField:e,attributeValues:r,updateOptions:n}),!0)}getLayerAttributeConfig(){return this.configService.getAttributeConfig(this.id)}getShaderPickStat(){return this.layerService.getShaderPickStat()}setEarthTime(t){console.warn("empty fn")}processData(t){return t}getModelType(){throw new Error("Method not implemented.")}getDefaultConfig(){return{}}initLayerModels(){var t=this;return Ev((function*(){t.models.forEach((t=>t.destroy())),t.models=[],t.uniformBuffers.forEach((t=>{t.destroy()})),t.uniformBuffers=[];const e=t.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0,label:"pickingUniforms"});t.uniformBuffers.push(e),t.models=yield t.layerModel.initModels()}))()}getPickingUniformBuffer(){return this.uniformBuffers[0]}reRender(){this.inited&&this.layerService.reRender()}splitValuesAndCallbackInAttribute(t){return{values:_R(t)?void 0:t,callback:_R(t)?t:void 0}}}function SR(t){return t.maskOperation===nv.OR?{enable:!0,mask:255,func:{cmp:x_.ALWAYS,ref:1,mask:255},opFront:{fail:x_.KEEP,zfail:x_.REPLACE,zpass:x_.REPLACE}}:{enable:!0,mask:255,func:{cmp:t.stencilType===rv.SINGLE||0===t.stencilIndex?x_.ALWAYS:x_.LESS,ref:t.stencilType===rv.SINGLE?1:0===t.stencilIndex?2:1,mask:255},opFront:{fail:x_.KEEP,zfail:x_.REPLACE,zpass:x_.REPLACE}}}const AR={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},wR={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};var CR={exports:{}};function RR(t,e,r){r=r||2;var n,i,o,a,s,l,u,c=e&&e.length,h=c?e[0]*r:t.length,p=LR(t,0,h,r,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(t,e,r,n){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=LR(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),s.push(zR(a));for(s.sort(NR),i=0;i<s.length;i++)r=FR(s[i],r);return r}(t,e,p,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var f=r;f<h;f+=r)(s=t[f])<n&&(n=s),(l=t[f+1])<i&&(i=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-n,a-i))?32767/u:0}return MR(p,d,r,n,i,u,0),d}function LR(t,e,r,n,i){var o,a;if(i===JR(t,e,r,n)>0)for(o=e;o<r;o+=n)a=KR(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=KR(o,t[o],t[o+1],a);return a&&HR(a,a.next)&&($R(a),a=a.next),a}function IR(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!HR(n,n.next)&&0!==VR(n.prev,n,n.next))n=n.next;else{if($R(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function MR(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;do{0===i.z&&(i.z=UR(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,l,u=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<u&&(s++,n=n.nextZ);e++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,u*=2}while(a>1)}(i)}(t,n,i,o);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?PR(t,n,i,o):OR(t))e.push(s.i/r|0),e.push(t.i/r|0),e.push(l.i/r|0),$R(t),t=l.next,u=l.next;else if((t=l)===u){a?1===a?MR(t=DR(IR(t),e,r),e,r,n,i,o,2):2===a&&BR(t,e,r,n,i,o):MR(IR(t),e,r,n,i,o,1);break}}}function OR(t){var e=t.prev,r=t,n=t.next;if(VR(e,r,n)>=0)return!1;for(var i=e.x,o=r.x,a=n.x,s=e.y,l=r.y,u=n.y,c=i<o?i<a?i:a:o<a?o:a,h=s<l?s<u?s:u:l<u?l:u,p=i>o?i>a?i:a:o>a?o:a,d=s>l?s>u?s:u:l>u?l:u,f=n.next;f!==e;){if(f.x>=c&&f.x<=p&&f.y>=h&&f.y<=d&&GR(i,s,o,l,a,u,f.x,f.y)&&VR(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function PR(t,e,r,n){var i=t.prev,o=t,a=t.next;if(VR(i,o,a)>=0)return!1;for(var s=i.x,l=o.x,u=a.x,c=i.y,h=o.y,p=a.y,d=s<l?s<u?s:u:l<u?l:u,f=c<h?c<p?c:p:h<p?h:p,m=s>l?s>u?s:u:l>u?l:u,g=c>h?c>p?c:p:h>p?h:p,_=UR(d,f,e,r,n),v=UR(m,g,e,r,n),y=t.prevZ,x=t.nextZ;y&&y.z>=_&&x&&x.z<=v;){if(y.x>=d&&y.x<=m&&y.y>=f&&y.y<=g&&y!==i&&y!==a&&GR(s,c,l,h,u,p,y.x,y.y)&&VR(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,x.x>=d&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==a&&GR(s,c,l,h,u,p,x.x,x.y)&&VR(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;y&&y.z>=_;){if(y.x>=d&&y.x<=m&&y.y>=f&&y.y<=g&&y!==i&&y!==a&&GR(s,c,l,h,u,p,y.x,y.y)&&VR(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=v;){if(x.x>=d&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==a&&GR(s,c,l,h,u,p,x.x,x.y)&&VR(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function DR(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!HR(i,o)&&WR(i,n,n.next,o)&&qR(i,o)&&qR(o,i)&&(e.push(i.i/r|0),e.push(n.i/r|0),e.push(o.i/r|0),$R(n),$R(n.next),n=t=o),n=n.next}while(n!==t);return IR(n)}function BR(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&jR(a,s)){var l=YR(a,s);return a=IR(a,a.next),l=IR(l,l.next),MR(a,e,r,n,i,o,0),void MR(l,e,r,n,i,o,0)}s=s.next}a=a.next}while(a!==t)}function NR(t,e){return t.x-e.x}function FR(t,e){var r=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a&&(a=s,r=n.x<n.next.x?n:n.next,s===i))return r}n=n.next}while(n!==e);if(!r)return null;var l,u=r,c=r.x,h=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&GR(o<h?i:a,o,c,h,o<h?a:i,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(i-n.x),qR(n,t)&&(l<p||l===p&&(n.x>r.x||n.x===r.x&&kR(r,n)))&&(r=n,p=l)),n=n.next}while(n!==u);return r}(t,e);if(!r)return e;var n=YR(r,t);return IR(n,n.next),IR(r,r.next)}function kR(t,e){return VR(t.prev,t,e.prev)<0&&VR(e.next,t,t.next)<0}function UR(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function zR(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function GR(t,e,r,n,i,o,a,s){return(i-a)*(e-s)>=(t-a)*(o-s)&&(t-a)*(n-s)>=(r-a)*(e-s)&&(r-a)*(o-s)>=(i-a)*(n-s)}function jR(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&WR(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(qR(t,e)&&qR(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(VR(t.prev,t,e.prev)||VR(t,e.prev,e))||HR(t,e)&&VR(t.prev,t,t.next)>0&&VR(e.prev,e,e.next)>0)}function VR(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function HR(t,e){return t.x===e.x&&t.y===e.y}function WR(t,e,r,n){var i=ZR(VR(t,e,r)),o=ZR(VR(t,e,n)),a=ZR(VR(r,n,t)),s=ZR(VR(r,n,e));return i!==o&&a!==s||(!(0!==i||!XR(t,r,e))||(!(0!==o||!XR(t,n,e))||(!(0!==a||!XR(r,t,n))||!(0!==s||!XR(r,e,n)))))}function XR(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function ZR(t){return t>0?1:t<0?-1:0}function qR(t,e){return VR(t.prev,t,t.next)<0?VR(t,e,t.next)>=0&&VR(t,t.prev,e)>=0:VR(t,e,t.prev)<0||VR(t,t.next,e)<0}function YR(t,e){var r=new QR(t.i,t.x,t.y),n=new QR(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function KR(t,e,r,n){var i=new QR(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function $R(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function QR(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function JR(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}CR.exports=RR,CR.exports.default=RR,RR.deviation=function(t,e,r,n){var i=e&&e.length,o=i?e[0]*r:t.length,a=Math.abs(JR(t,0,o,r));if(i)for(var s=0,l=e.length;s<l;s++){var u=e[s]*r,c=s<l-1?e[s+1]*r:t.length;a-=Math.abs(JR(t,u,c,r))}var h=0;for(s=0;s<n.length;s+=3){var p=n[s]*r,d=n[s+1]*r,f=n[s+2]*r;h+=Math.abs((t[p]-t[f])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[f+1]-t[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},RR.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r};var tL=CR.exports;function eL(t){return Math.max(4*Math.ceil(t/4),4)}function rL(t,e,r,n=!0){const i=3===r;if(n){t=t.slice();const e=[];for(let n=0;n<t.length;n+=r){e[0]=t[n],e[1]=t[n+1],i&&(e[2]=t[n+2]);const r=Ld(e,!0,{enable:!1,decimal:1});t[n]=r[0],t[n+1]=r[1],i&&(t[n+2]=r[2])}}return tL(t,e,r)}const nL="ATTRIBUTE_LOCATION_";class iL{get attributeLocation(){return v_({},eR)}constructor(t){g_(this,"triangulation",void 0),g_(this,"uniformBuffers",[]),g_(this,"textures",[]),g_(this,"createTexture2D",void 0),g_(this,"preStyleAttribute",{}),g_(this,"encodeStyleAttribute",{}),g_(this,"layer",void 0),g_(this,"dataTexture",void 0),g_(this,"DATA_TEXTURE_WIDTH",void 0),g_(this,"dataTextureTest",void 0),g_(this,"configService",void 0),g_(this,"shaderModuleService",void 0),g_(this,"rendererService",void 0),g_(this,"iconService",void 0),g_(this,"fontService",void 0),g_(this,"styleAttributeService",void 0),g_(this,"mapService",void 0),g_(this,"cameraService",void 0),g_(this,"layerService",void 0),g_(this,"pickingService",void 0),g_(this,"attributeUnifoms",void 0),g_(this,"commonUnifoms",void 0),this.layer=t,this.configService=t.getContainer().globalConfigService,this.rendererService=t.getContainer().rendererService,this.pickingService=t.getContainer().pickingService,this.shaderModuleService=t.getContainer().shaderModuleService,this.styleAttributeService=t.getContainer().styleAttributeService,this.mapService=t.getContainer().mapService,this.iconService=t.getContainer().iconService,this.fontService=t.getContainer().fontService,this.cameraService=t.getContainer().cameraService,this.layerService=t.getContainer().layerService,this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();const{createTexture2D:e}=this.rendererService;this.createTexture2D=e}getBlend(){const{blend:t="normal"}=this.layer.getLayerConfig();return hR[ev[t]]}getStencil(t){const{mask:e=!1,maskInside:r=!0,enableMask:n,maskOperation:i=nv.AND}=this.layer.getLayerConfig();if("MaskLayer"===this.layer.type)return SR({isStencil:!0,stencilType:rv.SINGLE});if(t.isStencil)return SR(v_(v_({},t),{},{maskOperation:i}));return function(t,e){return{enable:t,mask:255,func:{cmp:x_.EQUAL,ref:e?1:0,mask:1}}}(e||n&&0!==this.layer.masks.length||void 0!==this.layer.tileMask,r)}getDefaultStyle(){return{}}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();const r=v_(v_({},e.uniformsOption),t.uniformsOption);return Object.keys(r).forEach((t=>{"boolean"==typeof r[t]&&(r[t]=r[t]?1:0)})),!this.rendererService.hasOwnProperty("device")&&this.textures&&1===this.textures.length&&(r.u_texture=this.textures[0]),r}getAnimateUniforms(){return{}}needUpdate(){return Ev((function*(){return!1}))()}buildModels(){return Ev((function*(){throw new Error("Method not implemented.")}))()}initModels(){return Ev((function*(){throw new Error("Method not implemented.")}))()}clearModels(t=!0){}getAttribute(){throw new Error("Method not implemented.")}prerender(){}render(t){throw new Error("Method not implemented.")}registerBuiltinAttributes(){throw new Error("Method not implemented.")}animateOption2Array(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}startModelAnimate(){const{animateOption:t}=this.layer.getLayerConfig();t.enable&&this.layer.setAnimateStartTime()}getInject(){return function(t,e){const r=[];let n="";t.forEach((t=>{const i=t.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase(),o=nL+i;e[t]?n+=`#define USE_ATTRIBUTE_${i} 0.0 \n`:r.push(`  ${wR[t]} u_${t};`),n+=`\n#ifdef USE_ATTRIBUTE_${i}\nlayout(location = ${o}) in ${wR[t]} a_${t.charAt(0).toUpperCase()+t.slice(1)};\n#endif \n`}));const i=r.length?`\nlayout(std140) uniform AttributeUniforms {\n  ${r.join("\n")}\n};\n`:"";n+=i;let o="";return t.forEach((t=>{const e=t.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase();o+=`\n  #ifdef USE_ATTRIBUTE_${e}\n    ${wR[t]} ${t} = a_${t.charAt(0).toUpperCase()+t.slice(1)};\n  #else\n    ${wR[t]} ${t} = u_${t};\n  #endif\n  `})),{"vs:#decl":n,"fs:#decl":i,"vs:#main-start":o}}(this.layer.enableShaderEncodeStyles,this.layer.encodeStyleAttribute)}getDefines(){return v_({},Object.keys(this.attributeLocation).reduce(((t,e)=>(t[nL+e]=this.attributeLocation[e],t)),{}))}getStyleAttribute(){const t={};return this.layer.enableShaderEncodeStyles.forEach((e=>{if(!this.layer.encodeStyleAttribute[e]){const r=this.layer.getLayerConfig()[e];let n=void 0===r?AR[e]:r;"stroke"===e&&(n=Oe(n)),t["u_"+e]=n}})),t}registerStyleAttribute(){Object.keys(this.layer.encodeStyleAttribute).forEach((t=>{const e=function(t){switch(t){case"rotation":return{name:"Rotation",type:sv.Attribute,descriptor:{name:"a_Rotation",shaderLocation:eR.ROTATION,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{rotation:e=0}=t;return Array.isArray(e)?[e[0]]:[e]}}};case"stroke":return{name:"stroke",type:sv.Attribute,descriptor:{name:"a_Stroke",shaderLocation:eR.STROKE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:4,update:t=>{const{stroke:e=[1,1,1,1]}=t;return e}}};case"opacity":return{name:"opacity",type:sv.Attribute,descriptor:{name:"a_Opacity",shaderLocation:eR.OPACITY,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{opacity:e=1}=t;return[e]}}};case"offsets":return{name:"offsets",type:sv.Attribute,descriptor:{name:"a_Offsets",shaderLocation:eR.OFFSETS,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:2,update:t=>{const{offsets:e}=t;return e}}};default:return}}(t);e&&this.styleAttributeService.registerStyleAttribute(e)}))}registerPosition64LowAttribute(t=!0){this.styleAttributeService.registerStyleAttribute({name:"position64Low",type:sv.Attribute,descriptor:{name:"a_Position64Low",shaderLocation:this.attributeLocation.POSITION_64LOW,buffer:{data:[],type:x_.FLOAT},size:2,update:(e,r,n)=>t?[Ad(n[0]),Ad(n[1])]:[0,0]}})}updateEncodeAttribute(t,e){this.encodeStyleAttribute[t]=e}initUniformsBuffer(){const t=this.getUniformsBufferInfo(this.getStyleAttribute()),e=this.getCommonUniformsInfo();0!==t.uniformsLength&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(eL(t.uniformsLength)).fill(0),isUBO:!0,label:"layerModelAttributeUnifoms"}),this.uniformBuffers.push(this.attributeUnifoms)),0!==e.uniformsLength&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(eL(e.uniformsLength)).fill(0),isUBO:!0,label:"layerModelCommonUnifoms"}),this.uniformBuffers.push(this.commonUnifoms))}getUniformsBufferInfo(t){let e=0;const r=[];return Object.values(t).forEach((t=>{Array.isArray(t)?(r.push(...t),e+=t.length):"number"==typeof t?(r.push(t),e+=1):"boolean"==typeof t&&(r.push(Number(t)),e+=1)})),{uniformsOption:t,uniformsLength:e,uniformsArray:r}}getCommonUniformsInfo(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}updateStyleUnifoms(){var t,e;const{uniformsArray:r}=this.getUniformsBufferInfo(this.getStyleAttribute()),{uniformsArray:n}=this.getCommonUniformsInfo();null===(t=this.attributeUnifoms)||void 0===t||t.subData({offset:0,data:new Uint8Array(new Float32Array(r).buffer)}),null===(e=this.commonUnifoms)||void 0===e||e.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)})}}let oL=function(t){return t.VERTICAL="vertical",t.HORIZONTAL="horizontal",t}({}),aL=function(t){return t.NORMAL="normal",t.REPLACE="replace",t}({}),sL=function(t){return t[t.pixel=0]="pixel",t[t.meter=1]="meter",t}({});const lL=100;function uL(t){return t/180*Math.acos(-1)}function cL(t){const e=uL(t[0])+Math.PI/2,r=uL(t[1]),n=lL+.4*Math.random(),i=n*Math.cos(r)*Math.cos(e);return[n*Math.cos(r)*Math.sin(e),n*Math.sin(r),i]}const hL=Wv();Wv();const pL=Wv(),dL=Wv(),fL=Wv();function mL(t,e,r,n,i){qv(t,r,n),Kv(t,t);return[i/$v(e=Xv(-t[1],t[0]),Xv(-r[1],r[0])),e]}function gL(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function _L(t,e,r){return Qv(t,e,r),Kv(t,t),t}function vL(t,e){return t[0]===e[0]&&t[1]===e[1]}class yL{constructor(t={}){g_(this,"complex",void 0),g_(this,"join",void 0),g_(this,"cap",void 0),g_(this,"miterLimit",void 0),g_(this,"thickness",void 0),g_(this,"normal",void 0),g_(this,"lastFlip",-1),g_(this,"miter",Xv(0,0)),g_(this,"started",!1),g_(this,"dash",!1),g_(this,"totalDistance",0),g_(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}simpleExtrude(t){const e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const r=t.length;let n=e.startIndex;for(let i=1;i<r;i++){const r=t[i-1],o=t[i],a=i<t.length-1?t[i+1]:null;n+=this.simpleSegment(e,n,r,o,a)}if(this.dash)for(let t=0;t<e.positions.length/6;t++)e.positions[6*t+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}extrude(t){const e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const r=t.length;let n=e.startIndex;for(let i=1;i<r;i++){const r=t[i-1],o=t[i],a=i<t.length-1?t[i+1]:null;n+=this.segment(e,n,r,o,a)}if(this.dash)for(let t=0;t<e.positions.length/6;t++)e.positions[6*t+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}simpleSegment(t,e,r,n,i){let o=0;const a=t.indices,s=t.positions,l=t.normals,u=Id([n[0],n[1]]),c=Id([r[0],r[1]]);_L(pL,u,c);let h=0;if(this.dash&&(h=this.lineSegmentDistance(u,c),this.totalDistance+=h),this.normal||(this.normal=Wv(),gL(this.normal,pL)),this.started||(this.started=!0,this.extrusions(s,l,r,this.normal,this.thickness,this.totalDistance-h)),a.push(e+0,e+1,e+2),i){const t=Id([i[0],i[1]]);vL(u,t)&&qv(t,u,Kv(t,Yv(t,u,c))),_L(dL,t,u);const[r,h]=mL(fL,Wv(),pL,dL,this.thickness);let p=$v(fL,this.normal)<0?-1:1;this.extrusions(s,l,n,h,r,this.totalDistance),a.push(...1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3]),p=-1,Zv(this.normal,h),o+=2,this.lastFlip=p}else gL(this.normal,pL),this.extrusions(s,l,n,this.normal,this.thickness,this.totalDistance),a.push(...1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3]),o+=2;return o}segment(t,e,r,n,i){let o=0;const a=t.indices,s=t.positions,l=t.normals,u="square"===this.cap,c="bevel"===this.join,h=Id([n[0],n[1]]),p=Id([r[0],r[1]]);_L(pL,h,p);let d=0;if(this.dash&&(d=this.lineSegmentDistance(h,p),this.totalDistance+=d),this.normal||(this.normal=Wv(),gL(this.normal,pL)),!this.started)if(this.started=!0,u){const t=Wv(),e=Wv();qv(t,this.normal,pL),qv(e,this.normal,pL),l.push(e[0],e[1],0),l.push(t[0],t[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance-d,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance-d,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,l,r,this.normal,this.thickness,this.totalDistance-d);if(a.push(e+0,e+1,e+2),i){const t=Id([i[0],i[1]]);vL(h,t)&&qv(t,h,Kv(t,Yv(t,h,p))),_L(dL,t,h);const[r,u]=mL(fL,Wv(),pL,dL,this.thickness);let d=$v(fL,this.normal)<0?-1:1,f=c;if(!f&&"miter"===this.join){r>this.miterLimit&&(f=!0)}f?(l.push(this.normal[0],this.normal[1],0),l.push(u[0],u[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*d,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*d,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push(...this.lastFlip!==-d?[e,e+2,e+3]:[e+2,e+1,e+3]),a.push(e+2,e+3,e+4),gL(hL,dL),Zv(this.normal,hL),l.push(this.normal[0],this.normal[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*d,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,l,n,u,r,this.totalDistance),a.push(...1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3]),d=-1,Zv(this.normal,u),o+=2),this.lastFlip=d}else{if(gL(this.normal,pL),u){const t=Wv(),e=Wv();Qv(e,pL,this.normal),qv(t,pL,this.normal),l.push(e[0],e[1],0),l.push(t[0],t[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,l,n,this.normal,this.thickness,this.totalDistance);a.push(...1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3]),o+=2}return o}extrusions(t,e,r,n,i,o){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],o,-i,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],o,i,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}lineSegmentDistance(t,e){const r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}let xL=function(t){return t.CYLINDER="cylinder",t.SQUARECOLUMN="squareColumn",t.TRIANGLECOLUMN="triangleColumn",t.HEXAGONCOLUMN="hexagonColumn",t.PENTAGONCOLUMN="pentagonColumn",t}({}),bL=function(t){return t.CIRCLE="circle",t.SQUARE="square",t.TRIANGLE="triangle",t.HEXAGON="hexagon",t.PENTAGON="pentagon",t}({});function EL(t,e=0){const r=2*Math.PI/t,n=[];for(let i=0;i<t;i++)n.push(r*i+e*Math.PI/12);return n.map((t=>[Math.sin(t+Math.PI/4),Math.cos(t+Math.PI/4),0]))}function TL(){return EL(30)}function SL(){return EL(4)}function AL(){return EL(3)}function wL(){return EL(6,1)}function CL(){return EL(5)}const RL={[bL.CIRCLE]:TL,[bL.HEXAGON]:wL,[bL.TRIANGLE]:AL,[bL.SQUARE]:SL,[bL.PENTAGON]:CL,[xL.CYLINDER]:TL,[xL.HEXAGONCOLUMN]:wL,[xL.TRIANGLECOLUMN]:AL,[xL.SQUARECOLUMN]:SL,[xL.PENTAGONCOLUMN]:CL};function LL(t,e=!1){const r=t[0][0],n=t[0][t[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(t[0]=t[0].slice(0,t[0].length-1));const i=t[0].length,o=tL.flatten(t),{vertices:a,dimensions:s,holes:l}=o,u=[],c=[],h=[];for(let t=0;t<a.length/s;t++)u.push(a[t*s],a[t*s+1],1,-1,-1),h.push(0,0,1);const p=rL(a,l,s,e);c.push(...p);for(let t=0;t<i;t++){const r=o.vertices.slice(t*s,(t+1)*s);let n=o.vertices.slice((t+1)*s,(t+2)*s);0===n.length&&(n=o.vertices.slice(0,s));const i=u.length/5;u.push(r[0],r[1],1,0,0,n[0],n[1],1,.1,0,r[0],r[1],0,0,.8,n[0],n[1],0,.1,.8);const a=IL([n[0],n[1],1],[r[0],r[1],0],[r[0],r[1],1],e);h.push(...a,...a,...a,...a),c.push(...[1,2,0,3,2,1].map((t=>t+i)))}return{positions:u,index:c,normals:h}}function IL(t,e,r,n=!1){const i=Fv(),o=Fv(),a=Fv();n&&(t=Ld(t),e=Ld(e),r=Ld(r));const s=kv(...t),l=kv(...e),u=kv(...r);var c,h,p,d,f,m,g,_,v;jv(i,u,l),jv(o,s,l),c=a,p=o,d=(h=i)[0],f=h[1],m=h[2],g=p[0],_=p[1],v=p[2],c[0]=f*v-m*_,c[1]=m*g-d*v,c[2]=d*_-f*g;const y=Fv();return Uv(y,a),y}const ML={};function OL(t){const e=Fd(t.coordinates);return{vertices:[...e,...e,...e,...e],indices:[0,1,2,2,3,0],size:e.length}}function PL(t){const e=cL(Fd(t.coordinates));return{vertices:[...e,...e,...e,...e],indices:[0,1,2,2,3,0],size:e.length}}function DL(t){const{shape:e}=t,{positions:r,index:n,normals:i}=function(t,e=!1){if(ML&&ML[t])return ML[t];const r=RL[t]?RL[t]():RL.cylinder(),n=LL([r],e);return ML[t]=n,n}(e,!1);return{vertices:r,indices:n,normals:i,size:5}}function BL(t){const e=Fd(t.coordinates);return{vertices:[...e],indices:[0],size:e.length}}function NL(t){const{coordinates:e}=t,r=new yL({dash:!0,join:"bevel"});let n=e;n[0]&&!Array.isArray(n[0][0])&&(n=[e]),n.forEach((t=>{r.extrude(t)}));const i=r.complex;return{vertices:i.positions,indices:i.indices,normals:i.normals,indexes:i.indexes,size:6}}function FL(t){const{coordinates:e}=t,r=[];if(!Array.isArray(e[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};const{results:n,totalDistance:i}=function(t){let e=t;Array.isArray(e)&&Array.isArray(e[0])&&Array.isArray(e[0][0])&&(e=t.flat());let r=0;if(e.length<2)return{results:e,totalDistance:0};{const t=[],n=UL(e[0],r);t.push(n);for(let n=1;n<e.length-1;n++){r+=kL(Id(e[n-1]),Id(e[n]));const i=UL(e[n],r);t.push(i),t.push(i)}return r+=kL(Id(e[e.length-2]),Id(e[e.length-1])),t.push(UL(e[e.length-1],r)),{results:t,totalDistance:r}}}(e);return n.map((t=>{r.push(t[0],t[1],t[2],t[3],0,i)})),{vertices:r,indices:[],normals:[],size:6,count:n.length}}function kL(t,e){const r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}function UL(t,e){return t.length<3&&t.push(0),void 0!==e&&t.push(e),t}function zL(t){const{coordinates:e}=t,r=tL.flatten(e),{vertices:n,dimensions:i,holes:o}=r;return{indices:rL(n,o,i),vertices:n,size:i}}function GL(t){const{indices:e,vertices:r,size:n}=zL(t);return{indices:e,vertices:jL(r),size:n+4}}function jL(t){const e=[],{center:r,radius:n}=function(t){let e=t[0],r=t[1],n=t[0],i=t[1],o=0,a=0,s=0;for(let l=0;l<t.length;l+=2){const u=t[l],c=t[l+1];u&&c&&(e=Math.max(u,e),r=Math.max(c,r),n=Math.min(u,n),i=Math.min(c,i),o+=u,a+=c,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(e-n,2)+Math.pow(r-i,2))/2}}(t);for(let i=0;i<t.length;i+=2){const o=t[i],a=t[i+1];e.push(o,a,0,...r,n)}return e}function VL(t){const e=t.coordinates,{positions:r,index:n,normals:i}=LL(e,!0);return{vertices:r,indices:n,normals:i,size:5}}function HL(t){const{shape:e}=t,{positions:r,index:n}=function(t){const e=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=RL[t]?RL[t]():RL.circle(),n=-1===e.indexOf(t)?function(t){const e=tL.flatten(t),r=tL(e.vertices,e.holes,e.dimensions);return{positions:e.vertices,index:r}}([r]):function(t){const e=t[0][0],r=t[0][t[0].length-1];e[0]===r[0]&&e[1]===r[1]&&(t[0]=t[0].slice(0,t[0].length-1));const n=t[0].length,i=tL.flatten(t),{vertices:o,dimensions:a}=i,s=[],l=[];for(let t=0;t<o.length/a;t++)2===a?s.push(o[2*t],o[2*t+1],1):s.push(o[3*t],o[3*t+1],1);const u=tL(i.vertices,i.holes,i.dimensions);l.push(...u);for(let t=0;t<n;t++){const e=i.vertices.slice(t*a,(t+1)*a);let r=i.vertices.slice((t+1)*a,(t+2)*a);0===r.length&&(r=i.vertices.slice(0,a));const n=s.length/3;s.push(e[0],e[1],1,r[0],r[1],1,e[0],e[1],0,r[0],r[1],0),l.push(...[0,2,1,2,3,1].map((t=>t+n)))}return{positions:s,index:l}}([r]);return n}(e);return{vertices:r,indices:n,size:3}}function WL(t){const e=t.coordinates;return{vertices:[...e[0],0,0,0,...e[1],0,1,0,...e[2],0,1,1,...e[3],0,0,1],indices:[0,1,2,0,2,3],size:5}}function XL(t,e){const{segmentNumber:r=30}=e,n=t.coordinates,i=[],o=[];for(let t=0;t<r;t++)i.push(t,1,t,n[0][0],n[0][1],n[1][0],n[1][1],t,-1,t,n[0][0],n[0][1],n[1][0],n[1][1]),t!==r-1&&o.push(...[0,1,2,1,3,2].map((e=>2*t+e)));return{vertices:i,indices:o,size:7}}function ZL(t){const e=t.coordinates;2===e.length&&e.push(0);const r=qL(-1,1),n=qL(1,1),i=qL(-1,-1),o=qL(1,-1);return{vertices:[...e,...r,...e,...i,...e,...o,...e,...n],indices:[0,1,2,3,0,2],size:5}}function qL(t,e){return[(t+1)/2,(e+1)/2]}function YL(t,e){return{type:t.type,field:"value",items:t.positions.map(((r,n)=>({[e]:n>=t.colors.length?null:t.colors[n],value:r})))}}const{isEqual:KL}=ld;class $L extends iL{constructor(...t){super(...t),g_(this,"texture",void 0),g_(this,"colorTexture",void 0),g_(this,"heatmapFramerBuffer",void 0),g_(this,"heatmapTexture",void 0),g_(this,"intensityModel",void 0),g_(this,"colorModel",void 0),g_(this,"shapeType",void 0),g_(this,"preRampColors",void 0),g_(this,"colorModelUniformBuffer",[]),g_(this,"heat3DModelUniformBuffer",[])}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10,DIR:11})}prerender(){const{clear:t,useFramebuffer:e}=this.rendererService;e(this.heatmapFramerBuffer,(()=>{t({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.heatmapFramerBuffer}),this.drawIntensityMode()}))}render(t){const{rampColors:e}=this.layer.getLayerConfig();KL(this.preRampColors,e)||this.updateColorTexture(),"heatmap"===this.shapeType?this.drawHeatMap(t):this.draw3DHeatMap(t)}getUninforms(){throw new Error("Method not implemented.")}initModels(){var t=this;return Ev((function*(){var e;const{createFramebuffer:r,getViewportSize:n,createTexture2D:i}=t.rendererService,o=t.styleAttributeService.getLayerStyleAttribute("shape"),a=(null==o||null===(e=o.scale)||void 0===e?void 0:e.field)||"heatmap";t.shapeType=a,t.intensityModel=yield t.buildHeatMapIntensity(),t.colorModel="heatmap"===a?t.buildHeatmap():t.build3dHeatMap();const{width:s,height:l}=n();return t.heatmapTexture=i({width:Math.floor(s/4),height:Math.floor(l/4),wrapS:x_.CLAMP_TO_EDGE,wrapT:x_.CLAMP_TO_EDGE,min:x_.LINEAR,mag:x_.LINEAR,usage:xy.RENDER_TARGET}),t.heatmapFramerBuffer=r({color:t.heatmapTexture,depth:!0,width:Math.floor(s/4),height:Math.floor(l/4)}),t.updateColorTexture(),[t.intensityModel,t.colorModel]}))()}buildModels(){var t=this;return Ev((function*(){return t.initModels()}))()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:sv.Attribute,descriptor:{name:"a_Dir",shaderLocation:this.attributeLocation.DIR,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:(t,e,r)=>[r[3],r[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=1}=t;return[e]}}})}buildHeatMapIntensity(){var t=this;return Ev((function*(){t.uniformBuffers=[t.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],t.layer.triangulation=ZL;return yield t.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_DIR) in vec2 a_Dir;\n\nlayout(std140) uniform commonUniforms {\n  float u_radius;\n  float u_intensity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n};\n\nout vec2 v_extrude;\nout float v_weight;\n\n#define GAUSS_COEF (0.3989422804014327)\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 picking_color_placeholder = u_PickingColor;\n\n  v_weight = a_Size;\n  float ZERO = 1.0 / 255.0 / 16.0;\n  float extrude_x = a_Dir.x * 2.0 - 1.0;\n  float extrude_y = a_Dir.y * 2.0 - 1.0;\n  vec2 extrude_dir = normalize(vec2(extrude_x, extrude_y));\n  float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n  v_extrude = extrude_dir * S;\n\n  vec2 offset = project_pixel(v_extrude * u_radius);\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n}\n',fragmentShader:"layout(std140) uniform commonUniforms {\n  float u_radius;\n  float u_intensity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n};\n\nin vec2 v_extrude;\nin float v_weight;\nout vec4 outputColor;\n#define GAUSS_COEF  0.3989422804014327\n\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    outputColor = vec4(val, 1., 1., 1.);\n}\n",triangulation:ZL,defines:t.getDefines(),depth:{enable:!1},cull:{enable:!0,face:x_.FRONT}})}))()}buildHeatmap(){this.shaderModuleService.registerModule("heatmapColor",{vs:'layout(location = 0) in vec3 a_Position;\nlayout(location = 10) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\n\n#pragma include "scene_uniforms"\n\nout vec2 v_texCoord;\nvoid main() {\n  v_texCoord = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n  v_texCoord.y = 1.0 - v_texCoord.y;\n  #endif\n\n  gl_Position = vec4(a_Position.xy, 0, 1.0);\n}\n',fs:'uniform sampler2D u_texture;        // 热力强度图\nuniform sampler2D u_colorTexture;   // 根据强度分布的色带\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\nin vec2 v_texCoord;\nout vec4 outputColor;\n\n#pragma include "scene_uniforms"\n\nfloat getBlurIndusty() {\n    float vW = 2.0/ u_ViewportSize.x;\n    float vH = 2.0/ u_ViewportSize.y;\n    vec2 vUv = v_texCoord;\n    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;\n    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n    return(\n        i11 + \n        i12 + \n        i13 + \n        i21 + \n        i21 + \n        i22 + \n        i23 + \n        i31 + \n        i32 + \n        i33\n        )/9.0;\n}\n\n\nvoid main(){\n    // float intensity = texture(u_texture, v_texCoord).r;\n    float intensity = getBlurIndusty();\n    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));\n    outputColor = color;\n    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n'}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];const{vs:t,fs:e,uniforms:r}=this.shaderModuleService.getModule("heatmapColor"),{createAttribute:n,createElements:i,createBuffer:o,createModel:a}=this.rendererService;return a({vs:t,fs:e,uniformBuffers:[...this.colorModelUniformBuffer,...this.rendererService.uniformBuffers],attributes:{a_Position:n({shaderLocation:this.attributeLocation.POSITION,buffer:o({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:x_.FLOAT}),size:3}),a_Uv:n({shaderLocation:this.attributeLocation.UV,buffer:o({data:[0,1,1,1,0,0,1,0],type:x_.FLOAT}),size:2})},uniforms:v_({},r),depth:{enable:!1},elements:i({data:[0,2,1,2,3,1],type:x_.UNSIGNED_INT,count:6})})}build3dHeatMap(){const{getViewportSize:t}=this.rendererService,{width:e,height:r}=t(),n=function(t,e){const r=[],n=[],i=[],o=t+1,a=e+1,s=t/2,l=e/2;for(let r=0;r<a;r++){const a=r-l;for(let u=0;u<o;u++){const o=u-s;n.push(o/s,-a/l,0),i.push(u/t),i.push(1-r/e)}}for(let n=0;n<e;n++)for(let e=0;e<t;e++){const t=e+o*n,i=e+o*(n+1),a=e+1+o*(n+1),s=e+1+o*n;r.push(t,i,s),r.push(i,a,s)}return{vertices:n,indices:r,uvs:i}}(e/4,r/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'layout(location = 0) in vec3 a_Position;\nlayout(location = 10) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  mat4 u_ViewProjectionMatrixUncentered;\n  mat4 u_InverseViewProjectionMatrix;\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nout vec2 v_texCoord;\nout float v_intensity;\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n  float t2 = t * t;\n  float one_minus_t = 1.0 - t;\n  float one_minus_t2 = one_minus_t * one_minus_t;\n  return P0 * one_minus_t2 * one_minus_t +\n  P1 * 3.0 * t * one_minus_t2 +\n  P2 * 3.0 * t2 * one_minus_t +\n  P3 * t2 * t;\n}\nvec2 toBezier(float t, vec4 p) {\n  return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点\n  vec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点\n\n  vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）\n  vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）\n  inverseP2 = inverseP2 / inverseP2.w;\n\n  float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n  vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b = vec4(0.5, 0.0, 1.0, 0.5);\n  float fh;\n\n  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.0), 1.0);\n\n}\n',fs:"layout(std140) uniform commonUniforms {\n  mat4 u_ViewProjectionMatrixUncentered;\n  mat4 u_InverseViewProjectionMatrix;\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nin vec2 v_texCoord;\nin float v_intensity;\nout vec4 outputColor;\n\nvoid main(){\n   \n    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;\n    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));\n    outputColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n"}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(36).fill(0),isUBO:!0})];const{vs:i,fs:o,uniforms:a}=this.shaderModuleService.getModule("heatmap3dColor"),{createAttribute:s,createElements:l,createBuffer:u,createModel:c}=this.rendererService;return c({vs:i,fs:o,attributes:{a_Position:s({shaderLocation:this.attributeLocation.POSITION,buffer:u({data:n.vertices,type:x_.FLOAT}),size:3}),a_Uv:s({shaderLocation:this.attributeLocation.UV,buffer:u({data:n.uvs,type:x_.FLOAT}),size:2})},primitive:x_.TRIANGLES,uniformBuffers:[...this.heat3DModelUniformBuffer,...this.rendererService.uniformBuffers],uniforms:v_({},a),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:x_.SRC_ALPHA,srcAlpha:1,dstRGB:x_.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:l({data:n.indices,type:x_.UNSIGNED_INT,count:n.indices.length})})}drawIntensityMode(){var t;const{intensity:e=10,radius:r=5}=this.layer.getLayerConfig(),n={u_radius:r,u_intensity:e};this.uniformBuffers[0].subData({offset:0,data:[r,e]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),null===(t=this.intensityModel)||void 0===t||t.draw({uniforms:n,blend:{enable:!0,func:{srcRGB:x_.ONE,srcAlpha:1,dstRGB:x_.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}drawHeatMap(t){var e;const{opacity:r=1}=this.layer.getLayerConfig(),n={u_opacity:r,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},i=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[r]}),null===(e=this.colorModel)||void 0===e||e.draw({uniforms:n,textures:i,blend:this.getBlend(),stencil:this.getStencil(t)})}draw3DHeatMap(t){var e;const{opacity:r=1}=this.layer.getLayerConfig(),n=wv();Rv(n,this.cameraService.getViewProjectionMatrixUncentered());const i={u_opacity:r,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:[...n]};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[...i.u_ViewProjectionMatrixUncentered,...i.u_InverseViewProjectionMatrix,r]});const o=[this.heatmapTexture,this.colorTexture];null===(e=this.colorModel)||void 0===e||e.draw({uniforms:i,textures:o,blend:{enable:!0,func:{srcRGB:x_.SRC_ALPHA,srcAlpha:1,dstRGB:x_.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}updateColorTexture(){const{createTexture2D:t}=this.rendererService;this.texture&&this.texture.destroy();const{rampColors:e}=this.layer.getLayerConfig(),r=Be(e);this.colorTexture=t({data:r.data,usage:xy.SAMPLED,width:r.width,height:r.height,wrapS:x_.CLAMP_TO_EDGE,wrapT:x_.CLAMP_TO_EDGE,min:x_.NEAREST,mag:x_.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=e}}const QL={heatmap:$L,heatmap3d:$L,grid:class extends iL{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:e,angle:r}=this.layer.getLayerConfig(),n={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:e||.9,u_angle:r||0};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location =  ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;\n\nlayout(std140) uniform commonUniforms {\n    vec2 u_radius;\n    float u_opacity;\n    float u_coverage;\n    float u_angle;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n  v_color.a *= u_opacity;\n\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage;\n\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  gl_Position = project_common_position_to_clipspace(project_pos);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec4 v_color;\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',defines:t.getDefines(),triangulation:HL,primitive:x_.TRIANGLES,depth:{enable:!1}})]}))()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:sv.Attribute,descriptor:{shaderLocation:this.attributeLocation.POS,name:"a_Pos",buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:3,update:t=>{const e=t.coordinates;return[e[0],e[1],0]}}})}},grid3d:class extends iL{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:e,angle:r}=this.layer.getLayerConfig(),n={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:e||.9,u_angle:r||0};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_radius;\n  float u_opacity;\n  float u_coverage;\n  float u_angle;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);\n\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n  vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n\n  float lightWeight = calc_lighting(project_pos);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  gl_Position = project_common_position_to_clipspace(project_pos);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec4 v_color;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_radius;\n  float u_opacity;\n  float u_coverage;\n  float u_angle;\n};\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',defines:t.getDefines(),triangulation:DL,primitive:x_.TRIANGLES,depth:{enable:!0}})]}))()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sv.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r,n,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:sv.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:3,update:t=>{const e=t.coordinates;return[e[0],e[1],0]}}})}},hexagon:class extends iL{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:e,angle:r}=this.layer.getLayerConfig(),n={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:e||.9,u_angle:r||0};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_radius;\n  float u_opacity;\n  float u_coverage;\n  float u_angle;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n  v_color.a *= u_opacity;\n\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n\n  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec4 v_color;\n\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',defines:t.getDefines(),triangulation:HL,depth:{enable:!1},primitive:x_.TRIANGLES})]}))()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:sv.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:3,update:t=>{const e=t.coordinates;return[e[0],e[1],0]}}})}}};var JL=QL;class tI extends TR{constructor(...t){super(...t),g_(this,"type","HeatMapLayer")}buildModels(){var t=this;return Ev((function*(){const e=t.getModelType();t.layerModel=new JL[e](t),yield t.initLayerModels()}))()}prerender(){"heatmap"===this.getModelType()&&this.layerModel&&this.layerModel.prerender()}renderModels(t={}){return"heatmap"===this.getModelType()?(this.layerModel&&this.layerModel.render(t),this):(this.encodeDataLength<=0&&!this.forceRender||(this.hooks.beforeRender.call(),this.models.forEach((e=>e.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t)}))),this.hooks.afterRender.call()),this)}updateModelData(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}getModelType(){var t;const e=this.styleAttributeService.getLayerStyleAttribute("shape"),{shape3d:r}=this.getLayerConfig(),n=this.getSource().data.type,i=(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===n?-1===(null==r?void 0:r.indexOf(i))?"hexagon":"grid3d":"grid"===n?-1===(null==r?void 0:r.indexOf(i))?"grid":"grid3d":"heatmap"}getLegend(t){if("heatmap"===this.getModelType()){if("color"!==t)return{type:void 0,field:void 0,items:[]};return YL(this.getLayerConfig().rampColors,t)}return super.getLegend(t)}}const eI={image:class extends iL{constructor(...t){super(...t),g_(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){const{opacity:t,brightness:e,contrast:r,saturation:n,gamma:i}=this.layer.getLayerConfig(),o={u_opacity:_f(t,1),u_brightness:_f(e,1),u_contrast:_f(r,1),u_saturation:_f(n,1),u_gamma:_f(i,1)};this.textures=[this.texture];return this.getUniformsBufferInfo(o)}initModels(){var t=this;return Ev((function*(){return yield t.loadTexture(),t.buildModels()}))()}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy()}loadTexture(){var t=this;return Ev((function*(){const{createTexture2D:e}=t.rendererService,r=t.layer.getSource(),n=yield r.data.images;t.texture=e({data:n[0],width:n[0].width,height:n[0].height,mag:x_.LINEAR,min:x_.LINEAR})}))()}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n    float u_opacity:1.0;\n    float u_brightness:1.0;\n    float u_contrast:1.0;\n    float u_saturation:1.0;\n    float u_gamma:1.0;\n};\n\nout vec2 v_texCoord;\n#pragma include "projection"\n\nvoid main() {\n  v_texCoord = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n}\n',fragmentShader:"uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n    float u_opacity:1.0;\n    float u_brightness:1.0;\n    float u_contrast:1.0;\n    float u_saturation:1.0;\n    float u_gamma:1.0;\n};\n\nin vec2 v_texCoord;\nout vec4 outputColor;\nvec3 setContrast(vec3 rgb, float contrast) {\n  vec3 color = mix(vec3(0.5), rgb, contrast);\n  color = clamp(color, 0.0, 1.0);\n  return color;\n}\nvec3 setSaturation(vec3 rgb, float adjustment) {\n  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);\n  vec3 intensity = vec3(dot(rgb, grayVector));\n  vec3 color = mix(intensity, rgb, adjustment);\n  color = clamp(color, 0.0, 1.0);\n  return color;\n}\nvoid main() {\n  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));\n  //brightness\n  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);\n  //contrast\n  color.rgb = setContrast(color.rgb, u_contrast);\n  // saturation\n  color.rgb = setSaturation(color.rgb, u_saturation);\n  // gamma\n  color.rgb = pow(color.rgb, vec3(u_gamma));\n  outputColor = color;\n  outputColor.a *= u_opacity;\n  if(outputColor.a < 0.01)\n    discard;\n}\n",defines:t.getDefines(),triangulation:WL,primitive:x_.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1})]}))()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sv.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:(t,e,r)=>[r[3],r[4]]}})}}};var rI=eI;class nI extends TR{constructor(...t){super(...t),g_(this,"type","ImageLayer")}buildModels(){var t=this;return Ev((function*(){const e=t.getModelType();t.layerModel=new rI[e](t),yield t.initLayerModels()}))()}getDefaultConfig(){return{image:{}}[this.getModelType()]}getModelType(){return"image"}}const iI={solid:0,dash:1};const oI={solid:0,dash:1};class aI extends iL{constructor(...t){super(...t),g_(this,"texture",void 0),g_(this,"updateTexture",(()=>{const{createTexture2D:t}=this.rendererService;if(this.texture)return this.texture.update({data:this.iconService.getCanvas()}),void this.layer.render();this.texture=t({data:this.iconService.getCanvas(),mag:x_.NEAREST,min:x_.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:r="normal",lineType:n="solid",dashArray:i=[10,5],lineTexture:o=!1,iconStep:a=100,segmentNumber:s=30,globalArcHeight:l=10}=this.layer.getLayerConfig(),{animateOption:u}=this.layer.getLayerConfig();2===i.length&&i.push(0,0);let c=0,h=[0,0,0,0],p=[0,0,0,0];var d;(t&&e&&(h=Oe(t),p=Oe(e),c=1),this.rendererService.getDirty())&&(null===(d=this.texture)||void 0===d||d.bind());const f={u_animate:this.animateOption2Array(u),u_dash_array:i,u_sourceColor:h,u_targetColor:p,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:lL,u_global_height:l,segmentNumber:s,u_line_type:oI[n]||0,u_icon_step:a,u_line_texture:o?1:0,u_textureBlend:"normal"===r?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:c};return this.getUniformsBufferInfo(f)}initModels(){var t=this;return Ev((function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()}))()}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform sampler2D u_texture;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_globel;\n  float u_globel_radius;\n  float u_global_height: 10;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0.0;\n};\n\nin vec4 v_color;\nin vec4 v_dash_array;\nin float v_segmentIndex;\nin vec2 v_iconMapUV;\nin vec4 v_line_data;\n\nout vec4 outputColor;\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例\n  outputColor = v_color;\n\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    outputColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      outputColor.a *= alpha;\n\n      // u_animate\n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          outputColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;\n\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_globel;\n  float u_globel_radius;\n  float u_global_height: 10;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0.0;\n};\nout vec4 v_color;\nout vec4 v_dash_array;\nout float v_segmentIndex;\nout vec2 v_iconMapUV;\nout vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return dir_screenspace.xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  //vs中计算渐变色\n  if(u_linearColor==1.0){\n    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  }\n  else{\n    v_color = a_Color;\n  }\n  v_color.a = v_color.a * opacity;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0), a_Instance64Low.xy).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0), a_Instance64Low.zw).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    float total_Distance = pixelDistance(source, target) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式\n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n\n  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n\n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}buildModels(){var t=this;return Ev((function*(){const{segmentNumber:e=30}=t.layer.getLayerConfig(),{frag:r,vert:n,type:i}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc3d"+i,vertexShader:n,fragmentShader:r,defines:t.getDefines(),inject:t.getInject(),triangulation:XL,styleOption:{segmentNumber:e}})]}))()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:sv.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:4,update:(t,e,r)=>[r[3],r[4],r[5],r[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:sv.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:4,update:(t,e,r)=>[Ad(r[3]),Ad(r[4]),Ad(r[5]),Ad(r[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sv.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:r}=t,{x:n,y:i}=e[r]||{x:0,y:0};return[n,i]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:sv.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{thetaOffset:e=1}=t;return[e]}}})}}const sI={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},lI=.5;function uI(t,e){const r="source"===e?1:-1,n="object"==typeof t?t:{};switch("object"==typeof t?t.type:t){case"circle":return function(t,e){const{width:r=2,height:n=2}=e,i=TL(),o=tL.flatten([i]),a=tL(o.vertices,o.holes,o.dimensions),s=i.map((e=>[e[0]*r*t,e[1]*n])).flat();return{vertices:[...s,...s],dimensions:2,indices:a.map((t=>t+i.length)),outLineIndices:a,normals:[...i.map((e=>[e[1]*n,e[0]*r*t,1])).flat(),...new Array(3*i.length).fill(0)]}}(r,n);case"triangle":return function(t,e){const{width:r=2,height:n=3}=e;return{vertices:[0,0,1*t*r,1*n,1*t*r,-1*n,0,0,1*t*r,1*n,1*t*r,-1*n],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*t,1,2,1*t,1,-2,1*t,1,0,0,0,0,0,0,0,0,0],dimensions:2}}(r,n);case"diamond":return function(t,e){const{width:r=2,height:n=3}=e;return{vertices:[0,0,1*r*t,.5*n,2*r*t,0,1*r*t,-.5*n,0,0,1*r*t,.5*n,2*r*t,0,1*r*t,-.5*n],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-t,1,1,0,1,0,-t,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}(r,n);case"rect":return function(t,e){const{width:r=2,height:n=2}=e;return{vertices:[0,n/2,t*r*1,n/2,t*r*1,-n/2,0,-n/2,0,n/2,t*r*1,n/2,t*r*1,-n/2,0,-n/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-t,1,1,0,1,0,-t,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}(r,n);case"classic":return function(t,e){const{width:r=2,height:n=3}=e;return{vertices:[0,0,2*t*r,1*n,1.5*t*r,0,2*t*r,-1*n,0,0,2*t*r,1*n,1.5*t*r,0,2*t*r,-1*n],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-t,1,1,0,1,0,-t,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}(r,n);case"halfTriangle":return function(t,e){const{width:r=2,height:n=1}=e;return{vertices:[0,lI*t,1*t*r,-(n+lI)*t,1*t*r,(n-lI)*t,0,lI*t,1*t*r,-(n+lI)*t,1*t*r,(n-lI)*t],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*t,-2*t,1,-2*t,1.5*t,1,1*t,1.5*t,1,0,0,0,0,0,0,0,0,0],dimensions:2}}(r,n);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function cI(t,e){return e?function(t,e){const r=t.coordinates.flat(),{target:n="classic",source:i="circle"}=e,o=hI(uI(i,"source"),r,0,0),a=function(t,e=0,r){const n="object"==typeof r.source?r.source.type:r.source,i="object"==typeof r.target?r.target.type:r.target,{width:o=(n?sI[n]:0)}="object"==typeof r.source?r.source:{},{width:a=(i?sI[i]:0)}="object"==typeof r.target?r.target:{};return{vertices:[0,lI,1*o,...t,1,lI,-1*a,...t,1,-lI,-1*a,...t,0,-lI,1*o,...t,0,lI,1*o,...t,1,lI,-1*a,...t,1,-lI,-1*a,...t,0,-lI,1*o,...t],outLineIndices:[0,1,2,0,2,3].map((t=>t+e)),indices:[4,5,6,4,6,7].map((t=>t+e)),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}(r,o.vertices.length/7,e),s=hI(uI(n,"target"),r,1,o.vertices.length/7+a.vertices.length/7);return{vertices:[...o.vertices,...a.vertices,...s.vertices],indices:[...o.outLineIndices,...a.outLineIndices,...s.outLineIndices,...o.indices,...a.indices,...s.indices],normals:[...o.normals,...a.normals,...s.normals],size:7}}(t,e):function(t){const e=t.coordinates.flat();return{vertices:[1,0,0,...e,1,2,-3,...e,1,1,-3,...e,0,1,0,...e,0,0,0,...e,1,0,0,...e,1,2,-3,...e,1,1,-3,...e,0,1,0,...e,0,0,0,...e],normals:[-1,2,1,2,-1,1,1,-1,1,1,-1,1,-1,-1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}(t)}function hI(t,e,r=1,n=0){const i=[],{vertices:o,indices:a,dimensions:s,outLineIndices:l}=t;for(let t=0;t<o.length;t+=s)i.push(r,o[t+1],o[t],...e);return v_(v_({},t),{},{vertices:i,indices:a.map((t=>t+n)),outLineIndices:l.map((t=>t+n))})}const pI={solid:0,dash:1};class dI extends iL{constructor(...t){super(...t),g_(this,"textureEventFlag",!1),g_(this,"texture",this.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),g_(this,"updateTexture",(()=>{const{createTexture2D:t}=this.rendererService;if(0===this.textures.length&&(this.textures=[this.texture]),this.texture)return this.texture.update({data:this.iconService.getCanvas()}),void this.layer.render();this.texture=t({data:this.iconService.getCanvas(),mag:x_.NEAREST,min:x_.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128})}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,DISTANCE_INDEX:10,NORMAL:11,UV:12})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:r="normal",lineType:n="solid",dashArray:i=[10,5,0,0],lineTexture:o=!1,iconStep:a=100,vertexHeightScale:s=20,strokeWidth:l=0,raisingHeight:u=0,heightfixed:c=!1,linearDir:h=oL.VERTICAL,blur:p=[1,1,1,0]}=this.layer.getLayerConfig();let d=i;var f;("dash"!==n&&(d=[0,0,0,0]),2===d.length&&d.push(0,0),this.rendererService.getDirty()&&this.texture)&&(null===(f=this.texture)||void 0===f||f.bind());const{animateOption:m}=this.layer.getLayerConfig();let g=0,_=[0,0,0,0],v=[0,0,0,0];t&&e&&(_=Oe(t),v=Oe(e),g=1);const y={u_animate:this.animateOption2Array(m),u_dash_array:d,u_blur:p,u_sourceColor:_,u_targetColor:v,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:a,u_heightfixed:Number(c),u_vertexScale:s,u_raisingHeight:Number(u),u_strokeWidth:l,u_textureBlend:r===aL.NORMAL?0:1,u_line_texture:o?1:0,u_linearDir:h===oL.VERTICAL?1:0,u_linearColor:g,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(y)}initModels(){var t=this;return Ev((function*(){return t.initUniformsBuffer(),t.textureEventFlag||(t.textureEventFlag=!0,t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture)),t.buildModels()}))()}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return Ev((function*(){const{depth:e=!1}=t.layer.getLayerConfig(),{frag:r,vert:n,type:i}=t.getShaders();t.layer.triangulation=NL;return[yield t.layer.buildLayerModel({moduleName:"line"+i,vertexShader:n,fragmentShader:r,triangulation:NL,defines:t.getDefines(),inject:t.getInject(),depth:{enable:e}})]}))()}getShaders(){return{frag:'// #extension GL_OES_standard_derivatives : enable\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_blur;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed: 0.0;\n  float u_vertexScale: 1.0;\n  float u_raisingHeight: 0.0;\n  float u_strokeWidth: 0.0;\n  float u_textureBlend;\n  float u_line_texture;\n  float u_linearDir: 1.0;\n  float u_linearColor: 0;\n  float u_time;\n};\n\nin vec4 v_color;\nin vec4 v_stroke;\n// dash\nin vec4 v_dash_array;\nin float v_d_distance_ratio;\nin vec2 v_iconMapUV;\nin vec4 v_texture_data;\n\nout vec4 outputColor;\n#pragma include "picking"\n\n// [animate, duration, interval, trailLength],\nvoid main() {\n  if(u_dash_array!=vec4(0.0)){\n    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {\n      // 虚线部分\n      discard;\n    };\n  }\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    d_distance_ratio = v_texture_data.a;\n  }\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);\n    outputColor.a *= v_color.a;\n  } else { // 使用 color 方法传入的颜色\n     outputColor = v_color;\n  }\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      outputColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_texture_data.g;      // 当前顶点的距离\n    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor += pattern;\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = pattern;\n    }\n  } \n\n  float v = v_texture_data.a;\n  float strokeWidth = min(0.5, u_strokeWidth);\n  // 绘制 border\n  if(strokeWidth > 0.01) {\n    float borderOuterWidth = strokeWidth / 2.0;\n\n\n    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {\n      if(v > strokeWidth) { // 外侧\n        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);\n        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);\n        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);\n      } else if(v <= strokeWidth) {\n        float linear = smoothstep(0.0, 1.0, v/strokeWidth);\n        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);\n      }\n    }\n\n    if(v < borderOuterWidth) {\n      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);\n    } else if(v > 1.0 - borderOuterWidth) {\n      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n    }\n  }\n\n  // blur\n  float blurV = v_texture_data.a;\n  if(blurV < 0.5) {\n    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n  } else {\n    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n  }\n  \n  outputColor = filterColor(outputColor);\n}\n',vert:'#define Animate (0.0)\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;\nlayout(location = ATTRIBUTE_LOCATION_DISTANCE_INDEX) in vec3 a_DistanceAndIndexAndMiter;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec4 a_Normal_Total_Distance;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_blur;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed: 0.0;\n  float u_vertexScale: 1.0;\n  float u_raisingHeight: 0.0;\n  float u_strokeWidth: 0.0;\n  float u_textureBlend;\n  float u_line_texture;\n  float u_linearDir: 1.0;\n  float u_linearColor: 0;\n  float u_time;\n};\n\nout vec4 v_color;\nout vec4 v_stroke;\n//dash\nout vec4 v_dash_array;\nout float v_d_distance_ratio;\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nout vec2 v_iconMapUV;\nout vec4 v_texture_data;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;\n  float a_Miter = a_DistanceAndIndexAndMiter.z;\n  vec3 a_Normal = a_Normal_Total_Distance.xyz;\n  float a_Total_Distance = a_Normal_Total_Distance.w;\n  //dash输出\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  float d_texPixelLen; // 贴图的像素长度，根据地图层级缩放\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_float_pixel(u_icon_step);\n\n  v_color = a_Color;\n  v_color.a *= opacity;\n  v_stroke = stroke;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * a_Normal;\n\n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0; // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值\n\n  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);\n  // 设置数据集的参数\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  // 兼容 mapbox 在线高度上的效果表现基本一致\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // mapbox\n    // 保持高度相对不变\n    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n    h *= mapboxZoomScale;\n    h += u_raisingHeight * mapboxZoomScale;\n    if (u_heightfixed > 0.0) {\n      lineHeight *= mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace(\n    vec4(project_pos.xy + offset, lineHeight + h, 1.0)\n  );\n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:sv.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:this.attributeLocation.DISTANCE_INDEX,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r,n,i,o)=>void 0===o?[r[3],10,r[4]]:[r[3],o,r[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0],e[1]]:[e,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:sv.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:4,update:(t,e,r,n,i)=>[...i,r[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sv.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:r}=t,{x:n,y:i}=e[r]||{x:0,y:0};return[n,i]}}})}}const fI={arc:class extends iL{constructor(...t){super(...t),g_(this,"texture",void 0),g_(this,"updateTexture",(()=>{const{createTexture2D:t}=this.rendererService;if(this.texture)return this.texture.update({data:this.iconService.getCanvas()}),void this.layer.render();this.texture=t({data:this.iconService.getCanvas(),mag:x_.NEAREST,min:x_.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:r="normal",lineType:n="solid",dashArray:i=[10,5],forward:o=!0,lineTexture:a=!1,iconStep:s=100,segmentNumber:l=30}=this.layer.getLayerConfig(),{animateOption:u}=this.layer.getLayerConfig();let c=i;"dash"!==n&&(c=[0,0]),2===c.length&&c.push(0,0);let h=0,p=[0,0,0,0],d=[0,0,0,0];var f;(t&&e&&(p=Oe(t),d=Oe(e),h=1),this.rendererService.getDirty())&&(null===(f=this.texture)||void 0===f||f.bind());const m={u_animate:this.animateOption2Array(u),u_dash_array:c,u_sourceColor:p,u_targetColor:d,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:l,u_lineDir:o?1:-1,u_icon_step:s,u_line_texture:a?1:0,u_textureBlend:"normal"===r?0:1,u_blur:.9,u_line_type:iI[n||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:h};return this.getUniformsBufferInfo(m)}initModels(){var t=this;return Ev((function*(){return t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()}))()}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:'\n#define Animate 0.0\n#define LineTexture 1.0\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_lineDir: 1.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_blur : 0.9;\n  float u_line_type: 0.0;\n  float u_time;\n  float u_linearColor: 0.0;\n};\n\nin vec4 v_color;\nin vec2 v_iconMapUV;\nin vec4 v_lineData;\n//dash\nin vec4 v_dash_array;\nin float v_distance_ratio;\n\nout vec4 outputColor;\n#pragma include "picking"\n\nvoid main() {\n  if(u_dash_array!=vec4(0.0)){\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {\n      discard;\n    };\n  }\n  float animateSpeed = 0.0; // 运动速度\n  outputColor = v_color;\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      outputColor.a *= alpha;\n  }\n\n  // 当存在贴图时在底色上贴上贴图\n  if(u_line_texture == LineTexture) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = v_lineData.g; // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = v_lineData.a; // 横向 v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = filterColor(pattern);\n    }\n    \n  } else {\n     outputColor = filterColor(outputColor);\n  }\n}',vert:'#define Animate (0.0)\n#define LineTexture (1.0)\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_lineDir: 1.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_blur : 0.9;\n  float u_line_type: 0.0;\n  float u_time;\n  float u_linearColor: 0.0;\n};\n\nout vec4 v_color;\nout vec2 v_iconMapUV;\nout vec4 v_lineData;\n//dash\nout vec4 v_dash_array;\nout float v_distance_ratio;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1.0 - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);\n  if (u_lineDir == 1.0) {\n    // 正向\n    return mid;\n  } else {\n    // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n  // dash: index / (segmentNumber - 1.);\n  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n  //  return index / (segmentNumber - 1.);\n}\nvec2 interpolate(vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x, t), bezier3(y, t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return dir_screenspace.xy * sign(offset_direction);\n}\n\nvoid main() {\n  //vs中计算渐变色\n  if (u_linearColor == 1.0) {\n    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex / segmentNumber);\n  } else {\n    v_color = a_Color;\n  }\n  v_color.a = v_color.a * opacity;\n\n  vec2 source_world = a_Instance.rg; // 起始点\n  vec2 target_world = a_Instance.ba; // 终点\n\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  // 计算 dashArray 和 distanceRatio 输出到片元\n  float total_Distance = pixelDistance(source_world, target_world) / 2.0 * PI;\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  v_distance_ratio = segmentIndex / segmentNumber;\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n\n  if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n  v_lineData.b = d_distance_ratio;\n\n  vec4 source = project_position(vec4(source_world, 0, 1.), a_Instance64Low.xy);\n  vec4 target = project_position(vec4(target_world, 0, 1.), a_Instance64Low.zw);\n\n  vec2 currPos = interpolate(source.xy, target.xy, segmentRatio, thetaOffset);\n  vec2 nextPos = interpolate(source.xy, target.xy, nextSegmentRatio, thetaOffset);\n\n  vec2 offset = project_pixel(\n    getExtrusionOffset((nextPos.xy - currPos.xy) * indexDir, a_Position.y)\n  );\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n  v_lineData.r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // 开启贴图模式\n    float arcDistrance = length(source - target); // 起始点和终点的距离\n    arcDistrance = project_pixel(arcDistrance);\n\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变\n    float texCount = floor(arcDistrance / pixelLen); // 贴图在弧线上重复的数量\n    v_lineData.g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移\n    v_lineData.a = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(currPos.xy + offset, 0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();const{segmentNumber:e=30}=t.layer.getLayerConfig(),{frag:r,vert:n,type:i}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc2d"+i,vertexShader:n,fragmentShader:r,defines:t.getDefines(),inject:t.getInject(),triangulation:XL,depth:{enable:!1},styleOption:{segmentNumber:e}})]}))()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:sv.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:4,update:(t,e,r)=>[r[3],r[4],r[5],r[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:sv.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:4,update:(t,e,r)=>[Ad(r[3]),Ad(r[4]),Ad(r[5]),Ad(r[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sv.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:r}=t,{x:n,y:i}=e[r]||{x:0,y:0};return[n,i]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:sv.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{thetaOffset:e=1}=t;return[e]}}})}},arc3d:aI,greatcircle:class extends iL{constructor(...t){super(...t),g_(this,"texture",void 0),g_(this,"updateTexture",(()=>{const{createTexture2D:t}=this.rendererService;if(this.texture)return this.texture.update({data:this.iconService.getCanvas()}),void this.layer.render();this.texture=t({data:this.iconService.getCanvas(),mag:x_.NEAREST,min:x_.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:r="normal",lineType:n="solid",dashArray:i=[10,5],lineTexture:o=!1,iconStep:a=100,segmentNumber:s=30}=this.layer.getLayerConfig(),{animateOption:l}=this.layer.getLayerConfig();var u;(2===i.length&&i.push(0,0),this.rendererService.getDirty())&&(null===(u=this.texture)||void 0===u||u.bind());let c=0,h=[0,0,0,0],p=[0,0,0,0];t&&e&&(h=Oe(t),p=Oe(e),c=1);let d=this.layer.getLayerAnimateTime();isNaN(d)&&(d=0);const f={u_animate:this.animateOption2Array(l),u_dash_array:i,u_sourceColor:h,u_targetColor:p,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:s,u_line_type:pI[n]||0,u_icon_step:a,u_line_texture:o?1:0,u_textureBlend:"normal"===r?0:1,u_time:d,u_linearColor:c};return this.getUniformsBufferInfo(f)}initModels(){var t=this;return Ev((function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()}))()}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return Ev((function*(){const{segmentNumber:e=30}=t.layer.getLayerConfig();return[yield t.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:'#define LineTypeSolid (0.0)\n#define LineTypeDash (1.0)\n#define Animate (0.0)\n#define LineTexture (1.0)\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0;\n};\n\nout vec4 v_dash_array;\nout vec4 v_color;\nout vec2 v_iconMapUV;\nout vec4 v_line_data;\nout float v_distance_ratio;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps(float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return index / (segmentNumber - 1.0);\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(mix(source, target, segmentRatio), sqrt(max(0.0, vertex_height)));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return dir_screenspace.xy * sign(offset_direction);\n}\nfloat getAngularDist(vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) * sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1.0 - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate(vec2 source, vec2 target, float angularDist, float t) {\n  if (abs(angularDist - PI) < 0.001) {\n    return (1.0 - t) * source + t * target;\n  }\n  float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n  float b = sin(t * angularDist) / sin(angularDist);\n  vec2 sin_source = sin(source);\n  vec2 cos_source = cos(source);\n  vec2 sin_target = sin(target);\n  vec2 cos_target = cos(target);\n  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n  float z = a * sin_source.y + b * sin_target.y;\n  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n\n}\n\nvoid main() {\n  v_color = a_Color;\n  v_color.a = v_color.a * opacity;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  if (u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    float total_Distance = pixelDistance(source, target) / 2.0 * PI;\n    total_Distance = total_Distance * 16.0; // total_Distance*16.0 调整默认的效果\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  }\n\n  if (u_animate.x == Animate) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n\n  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0), a_Instance64Low.xy);\n  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0), a_Instance64Low.zw);\n\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n\n  v_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序\n  if (LineTexture == u_line_texture) {\n    float d_arcDistrance = length(source - target);\n    d_arcDistrance = project_pixel(d_arcDistrance);\n\n    float d_pixelLen = project_pixel(u_icon_step) / 8.0;\n    v_line_data.b = floor(d_arcDistrance / d_pixelLen); // 贴图在弧线上重复的数量\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0;\n};\n\nin vec4 v_dash_array;\nin vec4 v_color;\nin vec2 v_iconMapUV;\nin vec4 v_line_data;\nin float v_distance_ratio;\n\nout vec4 outputColor;\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n\n  float animateSpeed = 0.0;\n  float d_segmentIndex = v_line_data.g;\n\n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n    outputColor.a *= v_color.a;\n  } else { // 使用 color 方法传入的颜色\n    outputColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  if(u_line_type == LineTypeDash) {\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      // 实线部分\n    } else {\n      // 虚线部分\n      discard;\n    };\n  }\n\n  // 设置弧线的动画模式\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      outputColor.a *= alpha;\n  }\n\n  // 设置弧线的贴图\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) {\n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // 贴图在弧线上重复的数量\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_animate.x == Animate) {\n      u = outputColor.a/v_color.a;\n    }\n\n    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    // 设置贴图和底色的叠加模式\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = filterColor(pattern);\n    }\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:XL,styleOption:{segmentNumber:e},defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}})]}))()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:sv.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:4,update:(t,e,r)=>[r[3],r[4],r[5],r[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:sv.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:4,update:(t,e,r)=>[Ad(r[3]),Ad(r[4]),Ad(r[5]),Ad(r[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sv.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:r}=t,{x:n,y:i}=e[r]||{x:0,y:0};return[n,i]}}})}},wall:class extends iL{constructor(...t){super(...t),g_(this,"texture",void 0),g_(this,"updateTexture",(()=>{const{createTexture2D:t}=this.rendererService;if(this.texture)return this.texture.update({data:this.iconService.getCanvas()}),void this.layer.render();this.texture=t({data:this.iconService.getCanvas(),mag:x_.NEAREST,min:x_.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:12,UV:13,DISTANCE_MITER_TOTAL:15})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:r="normal",heightfixed:n=!1,lineTexture:i=!1,iconStep:o=100,iconStepCount:a=1}=this.layer.getLayerConfig(),{animateOption:s}=this.layer.getLayerConfig();var l;this.rendererService.getDirty()&&(null===(l=this.texture)||void 0===l||l.bind());let u=0,c=[0,0,0,0],h=[0,0,0,0];t&&e&&(c=Oe(t),h=Oe(e),u=1);const p={u_animate:this.animateOption2Array(s),u_sourceColor:c,u_targetColor:h,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:o,u_heightfixed:Number(n),u_linearColor:u,u_line_texture:i?1:0,u_textureBlend:"normal"===r?0:1,u_iconStepCount:a,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(p)}initModels(){var t=this;return Ev((function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()}))()}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return Ev((function*(){return[yield t.layer.buildLayerModel({moduleName:"lineWall",vertexShader:'#define Animate 0.0\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;\nlayout(location = ATTRIBUTE_LOCATION_DISTANCE_MITER_TOTAL) in vec3 a_Distance_Total_Miter;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed;\n  float u_linearColor: 0;\n  float u_line_texture;\n  float u_textureBlend;\n  float u_iconStepCount;\n  float u_time;\n};\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nout vec2 v_iconMapUV;\nout vec4 v_color;\nout float v_blur;\nout vec4 v_dataset;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  float a_Distance = a_Distance_Total_Miter.x;\n  float a_Miter = a_Distance_Total_Miter.y;\n  float a_Total_Distance = a_Distance_Total_Miter.z;\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  float d_texPixelLen; // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  if (u_heightfixed < 1.0) {\n    // 高度随 zoom 调整\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n\n  if (u_animate.x == Animate || u_linearColor == 1.0) {\n    d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0) / 2.0;\n  // 设置数据集的参数\n  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例\n  v_dataset[1] = a_Distance; // 当前顶点的距离\n  v_dataset[2] = d_texPixelLen; // 贴图的像素长度，根据地图层级缩放\n  v_dataset[3] = miter; // 线图层贴图部分的 v 坐标值 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);\n\n  float originSize = a_Size.x; // 固定高度\n  if (u_heightfixed < 1.0) {\n    originSize = project_float_meter(a_Size.x); // 高度随 zoom 调整\n  }\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n\n  // 兼容 mapbox 在线高度上的效果表现基本一致\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // mapbox\n    // 保持高度相对不变\n    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n    if (u_heightfixed > 0.0) {\n      wallHeight *= mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define Animate 0.0\n#define LineTexture 1.0\n\n// line texture\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed;\n  float u_linearColor: 0;\n  float u_line_texture;\n  float u_textureBlend;\n  float u_iconStepCount;\n  float u_time;\n};\n\n\nin vec2 v_iconMapUV;\nin vec4 v_color;\nin float v_blur;\nin vec4 v_dataset;\n\nout vec4 outputColor;\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例\n  float v = v_dataset.a;\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    outputColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // 使用 color 方法传入的颜色\n     outputColor = v_color;\n  }\n\n  outputColor.a *= v_color.a; // 全局透明度\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      outputColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_dataset.g;      // 当前顶点的距离\n    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值\n\n    // 计算纹理间隔 start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // 计算纹理间隔 end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    // Tip: 判断纹理间隔\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = filterColor(pattern);\n    }\n  }\n\n\n  // blur - AA\n  if(v < v_blur) {\n    outputColor.a = mix(0.0, outputColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  outputColor = filterColor(outputColor);\n}\n',triangulation:NL,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},blend:t.getBlend()})]}))()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0],e[1]]:[e,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sv.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r,n,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:"distanceAndTotalAndMiter",type:sv.Attribute,descriptor:{name:"a_Distance_Total_Miter",shaderLocation:this.attributeLocation.DISTANCE_MITER_TOTAL,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r)=>[r[3],r[4],r[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sv.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:r}=t,{x:n,y:i}=e[r]||{x:0,y:0};return[n,i]}}})}},line:dI,simple:class extends iL{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,lineType:r="solid",dashArray:n=[10,5,0,0],vertexHeightScale:i=20}=this.layer.getLayerConfig();let o=n;"dash"!==r&&(o=[0,0,0,0]),2===o.length&&o.push(0,0);let a=0,s=[0,0,0,0],l=[0,0,0,0];t&&e&&(s=Oe(t),l=Oe(e),a=1);const u={u_sourceColor:s,u_targetColor:l,u_dash_array:o,u_vertexScale:i,u_linearColor:a};return this.getUniformsBufferInfo(u)}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}getShaders(){return{frag:"\nlayout(std140) uniform commonUniorm {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec4 u_dash_array;\n  float u_vertexScale: 1.0;\n  float u_linearColor: 0;\n};\nin float v_distanceScale;\nin vec4 v_color;\n//dash\nin vec4 v_dash_array;\n\nout vec4 outputColor;\nvoid main() {\n  if(u_dash_array!=vec4(0.0)){\n    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {\n      // 虚线部分\n      discard;\n    };\n  }\n  if(u_linearColor==1.0){\n    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);\n    outputColor.a *= v_color.a; // 全局透明度\n  }\n  else{\n    outputColor = v_color;\n  }\n}\n",vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in vec4 a_SizeDistanceAndTotalDistance;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec4 u_dash_array;\n  float u_vertexScale: 1.0;\n  float u_linearColor: 0;\n};\n\n#pragma include "projection"\n#pragma include "picking"\n\nout vec4 v_color;\nout float v_distanceScale;\nout vec4 v_dash_array;\n\nvoid main() {\n  //dash输出\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;\n\n  v_color = a_Color;\n  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;\n  v_color.a = v_color.a * opacity;\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况\n\n  float lineHeight = a_SizeDistanceAndTotalDistance.y;\n  // 兼容 mapbox 在线高度上的效果表现基本一致\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // 保持高度相对不变\n    h *= 2.0 / pow(2.0, 20.0 - u_Zoom);\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n  gl_PointSize = 10.0;\n\n}\n',type:"lineSimpleNormal"}}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();const{frag:e,vert:r,type:n}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:n,vertexShader:r,fragmentShader:e,triangulation:FL,defines:t.getDefines(),inject:t.getInject(),primitive:x_.LINES,depth:{enable:!1},pick:!1})]}))()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:sv.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:4,update:(t,e,r)=>{const{size:n=1}=t,i=Array.isArray(n)?[n[0],n[1]]:[n,0];return[i[0],i[1],r[3],r[5]]}}})}},flowline:class extends iL{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,NORMAL:12})}getCommonUniformsInfo(){const{gapWidth:t=2,strokeWidth:e=1,strokeOpacity:r=1}=this.layer.getLayerConfig(),n={u_gap_width:t,u_stroke_width:e,u_stroke_opacity:r};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return Ev((function*(){return t.initUniformsBuffer(),t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){return[yield t.layer.buildLayerModel({moduleName:"flow_line",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniorm {\n  float u_gap_width: 1.0;\n  float u_stroke_width: 1.0;\n  float u_stroke_opacity: 1.0;\n};\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nout vec4 v_color;\n\nvec2 project_pixel_offset(vec2 offsets) {\n  vec2 data = project_pixel(offsets);\n\n  return vec2(data.x, -data.y);\n}\n\nvec2 line_dir(vec2 target, vec2 source) {\n  return normalize(ProjectFlat(target) - ProjectFlat(source));\n}\n\n\nvoid main() {\n  // 透明度计算\n  vec2 source_world = a_Instance.rg; // 起点\n  vec2 target_world = a_Instance.ba; // 终点\n  vec2 flowlineDir = line_dir(target_world, source_world);\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);\n\n  vec2 position = mix(source_world, target_world, a_Position.x);\n  vec2 position64Low = mix(a_Instance64Low.rg, a_Instance64Low.ba, a_Position.x);\n\n  float lengthCommon = length(\n    project_position(vec4(target_world, 0, 1)) - project_position(vec4(source_world, 0, 1))\n  );\n  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || 高德\n  vec2 limitedOffsetDistances = clamp(\n    offsetDistances,\n    project_pixel(-lengthCommon * 0.2),\n    project_pixel(lengthCommon * 0.2)\n  );\n\n  float startOffsetCommon = project_pixel(offsets[0]);\n  float endOffsetCommon = project_pixel(offsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon * 0.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon * 0.2),\n    a_Position.x\n  );\n\n  vec2 normalsCommon = u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y));\n\n  float gapCommon = -1. * project_pixel(u_gap_width);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n      perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n\n  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0), position64Low);\n\n  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);\n  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'// #extension GL_OES_standard_derivatives : enable\n\nin vec4 v_color;\nout vec4 outputColor;\n\n\n// line texture\n\n#pragma include "picking"\n\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',defines:t.getDefines(),inject:t.getInject(),triangulation:cI,styleOption:t.layer.getLayerConfig().symbol,primitive:x_.TRIANGLES,depth:{enable:!1},pick:!1})]}))()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0],e[1]]:[e,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:sv.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:4,update:(t,e,r)=>[r[3],r[4],r[5],r[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:sv.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:4,update:(t,e,r)=>[Ad(r[3]),Ad(r[4]),Ad(r[5]),Ad(r[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sv.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r,n,i)=>i}})}},earthArc3d:aI};var mI=fI;class gI extends TR{constructor(...t){super(...t),g_(this,"type","LineLayer"),g_(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),g_(this,"arrowInsertCount",0),g_(this,"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}})}buildModels(){var t=this;return Ev((function*(){const e=t.getModelType();t.layerModel=new mI[e](t),yield t.initLayerModels()}))()}getDefaultConfig(){return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}}[this.getModelType()]}getModelType(){var t;if(this.layerType)return this.layerType;const e=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==e||null===(t=e.scale)||void 0===t?void 0:t.field)||"line"}processData(t){if("simple"!==this.getModelType())return t;const e=[];return t.map((t=>{if(Array.isArray(t.coordinates)&&Array.isArray(t.coordinates[0])&&Array.isArray(t.coordinates[0][0])){const r=v_({},t);t.coordinates.map((t=>{e.push(v_(v_({},r),{},{coordinates:t}))}))}else e.push(t)})),e}}function _I(t){const e=t.coordinates;return{vertices:[...e],indices:[0],size:e.length}}const{isNumber:vI}=ld;class yI extends iL{constructor(...t){super(...t),g_(this,"raiseCount",0),g_(this,"raiseRepeat",0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,NORMAL:11})}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},sourceColor:e,targetColor:r,pickLight:n=!1,heightfixed:i=!1,opacityLinear:o={enable:!1,dir:"up"},lightEnable:a=!0}=this.layer.getLayerConfig();let s=0,l=[0,0,0,0],u=[0,0,0,0];if(e&&r&&(l=Oe(e),u=Oe(r),s=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:e=.01}=t;this.raiseCount+=e,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const c={u_pickLight:Number(n),u_heightfixed:Number(i),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:s,u_sourceColor:l,u_targetColor:u,u_opacitylinear:Number(o.enable),u_opacitylinear_dir:"up"===o.dir?1:0,u_lightEnable:Number(a)};return this.getUniformsBufferInfo(c)}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){const{depth:e=!0,animateOption:{repeat:r=1}}=t.layer.getLayerConfig();t.raiseRepeat=r,t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:'#define pi (3.1415926535)\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;\nlayout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec4 a_Extrude;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniforms {\n  float u_pickLight;\n  float u_heightfixed;\n  float u_r;\n  float u_linearColor;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_opacitylinear;\n  float u_opacitylinear_dir;\n  float u_lightEnable;\n};\nout vec4 v_color;\nout float v_lightWeight;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if (x > 0.0 && z > 0.0) {\n    return atan(x / z);\n  } else if (x > 0.0 && z <= 0.0) {\n    return atan(-z / x) + pi / 2.0;\n  } else if (x <= 0.0 && z <= 0.0) {\n    return pi + atan(x / z); //atan(x/z) +\n  } else {\n    return atan(z / -x) + pi * 3.0 / 2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y / r);\n}\n\nvoid main() {\n  vec3 size = a_Size * a_Position;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n\n  if (u_heightfixed < 1.0) {\n    // 圆柱体不固定高度\n  } else {\n    // 圆柱体固定高度 （ 处理 mapbox ）\n    if (\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    ) {\n      offset *= 4.0 / pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n  vec2 positions = a_Extrude.xy;\n  vec2 positions64Low = a_Extrude.zw;\n  vec4 project_pos = project_position(vec4(positions, 0.0, 1.0), positions64Low);\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // // 圆柱光照效果\n  float lightWeight = 1.0;\n\n  if (u_lightEnable > 0.0) {\n    // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n\n  v_lightWeight = lightWeight;\n\n  v_color = a_Color;\n\n  // 设置圆柱的底色\n  if (u_linearColor == 1.0) {\n    // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);\n    v_color.a = v_color.a * opacity;\n  } else {\n    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n  }\n\n  if (u_opacitylinear > 0.0) {\n    v_color.a *= u_opacitylinear_dir > 0.0 ? 1.0 - a_Position.z : a_Position.z;\n  }\n\n  gl_Position = project_common_position_to_clipspace(pos);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nin vec4 v_color;\nin float v_lightWeight;\nout vec4 outputColor;\n\nlayout(std140) uniform commonUniforms {\n  float u_pickLight;\n  float u_heightfixed;\n  float u_r;\n  float u_linearColor;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_opacitylinear;\n  float u_opacitylinear_dir;\n  float u_lightEnable;\n};\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nvoid main() {\n\n  outputColor = v_color;\n  // 开启透明度渐变\n  // picking\n  if(u_pickLight > 0.0) {\n    outputColor = filterColorAlpha(outputColor, v_lightWeight);\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n}\n',triangulation:DL,defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:x_.FRONT},depth:{enable:e}})]}))()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:3,update:t=>{const{size:e}=t;if(e){let t=[];return Array.isArray(e)&&(t=2===e.length?[e[0],e[0],e[1]]:e),Array.isArray(e)||(t=[e,e,e]),t}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sv.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r,n,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:sv.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:4,update:t=>{const e=Fd(t.coordinates);return[e[0],e[1],Ad(e[0]),Ad(e[1])]}}})}}class xI extends iL{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:e=0,blend:r,blur:n=0,raisingHeight:i=0,heightfixed:o=!1,unit:a="pixel"}=this.layer.getLayerConfig();let s=this.getAnimateUniforms().u_time;isNaN(s)&&(s=-1);const l={u_blur_height_fixed:[n,Number(i),Number(o)],u_stroke_width:e,u_additive:"additive"===r?1:0,u_stroke_opacity:t,u_size_unit:sL[a],u_time:s,u_animate:this.getAnimateUniforms().u_animate};return this.getUniformsBufferInfo(l)}getAnimateUniforms(){const{animateOption:t={enable:!1}}=this.layer.getLayerConfig();return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),OL)}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){const{frag:e,vert:r,type:n}=t.getShaders();t.layer.triangulation=OL,t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:n,vertexShader:r,fragmentShader:e,defines:t.getDefines(),inject:t.getInject(),triangulation:OL,depth:{enable:!1}})]}))()}getShaders(){return{frag:"\nlayout(std140) uniform commonUniforms {\n  vec3 u_blur_height_fixed;\n  float u_stroke_width;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_size_unit;\n  float u_time;\n  vec4 u_animate;\n};\n\nin vec4 v_color;\nin vec4 v_stroke;\nin vec4 v_data;\nin float v_radius;\n\n#pragma include \"scene_uniforms\"\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nout vec4 outputColor;\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n  if(u_stroke_width < 0.01) {\n    outputColor = v_color;\n  } else {\n    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);\n  }\n  float intensity = 1.0;\n  if(u_time!=-1.0){\n    //wave相关逻辑\n    float d = length(v_data.xy);\n    if(d > 0.5) {\n      discard;\n    }\n    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\n  }\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n    outputColor *= intensity;//wave\n    outputColor = filterColorAlpha(outputColor, outputColor.a);\n  } else {\n    outputColor.a *= opacity_t;\n    outputColor.a *= intensity;//wave \n    outputColor = filterColor(outputColor);\n  }\n   // 作为 mask 模板时需要丢弃透明的像素\n  if(outputColor.a < 0.01) {\n    discard;\n  } \n}\n",vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;\nlayout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;\n\nlayout(std140) uniform commonUniforms {\n  vec3 u_blur_height_fixed;\n  float u_stroke_width;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_size_unit;\n  float u_time;\n  vec4 u_animate;\n};\n\nout vec4 v_color;\nout vec4 v_stroke;\nout vec4 v_data;\nout float v_radius;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  // 透明度计算\n   v_stroke = stroke;\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  *  u_meter2coord 在等面积大小的时候设置单位\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n\n\n  // unpack color(vec2)\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if(u_size_unit == 1.0) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n   v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);\n\n  offset = project_pixel(offset);\n  offset = rotate_matrix(offset,rotation);\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  float raisingHeight = u_blur_height_fixed.y;\n\n  if(u_blur_height_fixed.z < 1.0) { // false\n    raisingHeight = project_pixel(u_blur_height_fixed.y);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"pointFill"}}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){const t=this.layer.getLayerConfig().shape2d;this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:sv.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r,n)=>{const i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=n%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:sv.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:e=>{const{shape:r=2}=e;return[t.indexOf(r)]}}})}}class bI extends iL{constructor(...t){super(...t),g_(this,"texture",void 0),g_(this,"updateTexture",(()=>{const{createTexture2D:t}=this.rendererService;if(this.texture)return this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void setTimeout((()=>{this.layerService.throttleRenderLayers()}));this.texture=t({data:this.iconService.getCanvas(),mag:x_.LINEAR,min:x_.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0})}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10})}getUninforms(){var t;this.rendererService.getDirty()&&(null===(t=this.texture)||void 0===t||t.bind());const e=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_({},e.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:e=!1}=this.layer.getLayerConfig(),r={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(t),u_heightfixed:Number(e),u_texture:this.texture};this.textures=[this.texture];return this.getUniformsBufferInfo(r)}initModels(){var t=this;return Ev((function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()}))()}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_textSize;\n  float u_raisingHeight;\n  float u_heightfixed;\n};\n\nout vec4 v_color;\nout vec2 v_uv;\nout float v_opacity;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  v_color = a_Color;\n  v_opacity = opacity;\n  v_uv = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n\n  vec2 offset = project_pixel(offsets);\n\n  float raisingHeight = u_raisingHeight;\n  if (u_heightfixed < 1.0) {\n    // false\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n    if (\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    ) {\n      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'layout(std140) uniform commonUniforms {\n  vec2 u_textSize;\n  float u_raisingHeight;\n  float u_heightfixed;\n};\n\nuniform sampler2D u_texture;\n\nin vec4 v_color;\nin vec2 v_uv;\nin float v_opacity;\n\n#pragma include "picking"\n\nout vec4 outputColor;\n\nvoid main(){\n  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n  vec4 textureColor;\n\n  // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n  \n  textureColor = texture(SAMPLER_2D(u_texture), pos);\n\n  // Tip: 去除边缘部分 mipmap 导致的混合变暗\n  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n  if(fragmengTocenter >= 0.5) {\n        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n        textureColor.a *= luma;\n  }\n  \n  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n        outputColor= textureColor;\n  }else {\n        outputColor= step(0.01, textureColor.z) * v_color;\n  }\n  outputColor.a *= v_opacity;\n  if (outputColor.a < 0.01) {\n      discard;\n  }\n  outputColor = filterColor(outputColor);\n}\n',triangulation:BL,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},primitive:x_.POINTS})]}))()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sv.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{shape:r}=t,{x:n,y:i}=e[r]||{x:-64,y:-64};return[n,i]}}})}}function EI(t){const e=t.coordinates;return{vertices:[...e],indices:[0],size:e.length}}class TI extends iL{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){return this.getUniformsBufferInfo({u_size_scale:.5})}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){t.layer.triangulation=EI,t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\n\nlayout(std140) uniform u_Common {\n  float u_size_scale;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(project_pos);\n\n  gl_PointSize = a_Size * u_size_scale * 2.0 * u_DevicePixelRatio;\n}\n',fragmentShader:"in vec4 v_color;\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n}",triangulation:EI,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},primitive:x_.POINTS,pick:!1})]}))()}clearModels(){}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}})}}var SI=class{constructor(t,e,r){g_(this,"boxCells",[]),g_(this,"xCellCount",void 0),g_(this,"yCellCount",void 0),g_(this,"boxKeys",void 0),g_(this,"bboxes",void 0),g_(this,"width",void 0),g_(this,"height",void 0),g_(this,"xScale",void 0),g_(this,"yScale",void 0),g_(this,"boxUid",void 0);const n=this.boxCells;this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(e/r);for(let t=0;t<this.xCellCount*this.yCellCount;t++)n.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0}insert(t,e,r,n,i){this.forEachCell(e,r,n,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)}query(t,e,r,n,i){return this.queryHitTest(t,e,r,n,!1,i)}hitTest(t,e,r,n,i){return this.queryHitTest(t,e,r,n,!0,i)}insertBoxCell(t,e,r,n,i,o){this.boxCells[i].push(o)}queryHitTest(t,e,r,n,i,o){if(r<0||t>this.width||n<0||e>this.height)return!i&&[];const a=[];if(t<=0&&e<=0&&this.width<=r&&this.height<=n){if(i)return!0;for(let t=0;t<this.boxKeys.length;t++)a.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});return o?a.filter(o):a}const s={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(t,e,r,n,this.queryCell,a,s,o),i?a.length>0:a}queryCell(t,e,r,n,i,o,a,s){const l=a.seenUids,u=this.boxCells[i];if(null!==u){const i=this.bboxes;for(const c of u)if(!l.box[c]){l.box[c]=!0;const u=4*c;if(t<=i[u+2]&&e<=i[u+3]&&r>=i[u+0]&&n>=i[u+1]&&(!s||s(this.boxKeys[c]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[c],x1:i[u],y1:i[u+1],x2:i[u+2],y2:i[u+3]})}}}return!1}forEachCell(t,e,r,n,i,o,a,s){const l=this.convertToXCellCoord(t),u=this.convertToYCellCoord(e),c=this.convertToXCellCoord(r),h=this.convertToYCellCoord(n);for(let p=l;p<=c;p++)for(let l=u;l<=h;l++){const u=this.xCellCount*l+p;if(i.call(this,t,e,r,n,u,o,a,s))return}}convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}};class AI{constructor(t,e){g_(this,"width",void 0),g_(this,"height",void 0),g_(this,"grid",void 0),g_(this,"viewportPadding",100),g_(this,"screenRightBoundary",void 0),g_(this,"screenBottomBoundary",void 0),g_(this,"gridRightBoundary",void 0),g_(this,"gridBottomBoundary",void 0),this.width=t,this.height=e,this.viewportPadding=Math.max(t,e),this.grid=new SI(t+this.viewportPadding,e+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=e+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=e+2*this.viewportPadding}placeCollisionBox(t){const e=t.x1+t.anchorPointX+this.viewportPadding,r=t.y1+t.anchorPointY+this.viewportPadding,n=t.x2+t.anchorPointX+this.viewportPadding,i=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(e,r,n,i)||this.grid.hitTest(e,r,n,i)?{box:[]}:{box:[e,r,n,i]}}insertCollisionBox(t,e){const r={featureIndex:e};this.grid.insert(r,t[0],t[1],t[2],t[3])}project(t,e,r){const n=function(t,e,r,n){var i=new Av(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}(e,r,0,1),i=Vv(),o=function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m){var g=new Av(16);return g[0]=t,g[1]=e,g[2]=r,g[3]=n,g[4]=i,g[5]=o,g[6]=a,g[7]=s,g[8]=l,g[9]=u,g[10]=c,g[11]=h,g[12]=p,g[13]=d,g[14]=f,g[15]=m,g}(...t);return Hv(i,n,o),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}isInsideGrid(t,e,r,n){return r>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary}}function wI(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0;break;default:e=.5}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:e,verticalAlign:r}}function CI(t,e,r,n,i){if(!i)return;const o=t[n],a=o.glyph;if(a){const s=e[a].advance*o.scale,l=(t[n].x+s)*i;for(let e=r;e<=n;e++)t[e].x-=l}}function RI(t,e,r,n,i,o,a){const s=(e-r)*i,l=(-n*a+.5)*o;for(const e of t)e.x+=s,e.y+=l}function LI(t,e,r,n,i,o,a=[0,0],s){const l=t.split("\n"),u=[],c={positionedGlyphs:u,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:l.length,text:t};return s?function(t,e,r,n,i,o,a){let s=0,l=-8,u=0;const c=t.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,p=c.length;r.forEach((t=>{const r=e[t];if(r&&(c.push({glyph:t,x:r.advance/2,y:l+0,vertical:!1,scale:1,metrics:r}),s+=r.advance+a),c.length!==p){const t=s-a;u=Math.max(t,u),CI(c,e,p,c.length-1,h)}s=0,l-=n+5}));const{horizontalAlign:d,verticalAlign:f}=wI(i);RI(c,h,d,f,u,n,r.length);const m=l- -8;t.top+=-f*m,t.bottom=t.top-m,t.left+=-d*u,t.right=t.left+u}(c,e,l,r,n,i,o):function(t,e,r,n,i,o,a){let s=0,l=-8,u=0;const c=t.positionedGlyphs,h="right"===o?1:"left"===o?0:.5,p=c.length;r.forEach((t=>{if(t.split("").forEach((t=>{const r=e[t];r&&(c.push({glyph:t,x:s,y:l+0,vertical:!1,scale:1,metrics:r}),s+=r.advance+a)})),c.length!==p){const t=s-a;u=Math.max(t,u),CI(c,e,p,c.length-1,h)}s=0,l-=n+5}));const{horizontalAlign:d,verticalAlign:f}=wI(i);RI(c,h,d,f,u,n,r.length);const m=l- -8;t.top+=-f*m,t.bottom=t.top-m,t.left+=-d*u,t.right=t.left+u}(c,e,l,r,n,i,o),!!u.length&&c}const II='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\n\nuniform sampler2D u_sdf_map;\nlayout(std140) uniform commonUniforms {\n  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n  vec2 u_sdf_map_size;\n  float u_raisingHeight: 0.0;\n  float u_stroke_width : 2;\n  float u_gamma_scale : 0.5;\n  float u_halo_blur : 0.5;\n};\n\nin vec2 v_uv;\nin float v_gamma_scale;\nin vec4 v_color;\nin vec4 v_stroke_color;\nin float v_fontScale;\n\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n\n  // get sdf from atlas\n  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;\n\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\n\n  outputColor.a *= alpha;\n   // 作为 mask 模板时需要丢弃透明的像素\n  if (outputColor.a < 0.01) {\n    discard;\n  }\n  outputColor = filterColor(outputColor);\n}\n',MI='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_TEXT_OFFSETS) in vec2 a_textOffsets;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_tex;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n  vec2 u_sdf_map_size;\n  float u_raisingHeight: 0.0;\n  float u_stroke_width : 2;\n  float u_gamma_scale : 0.5;\n  float u_halo_blur : 0.5;\n};\n\nout vec2 v_uv;\nout float v_gamma_scale;\nout vec4 v_color;\nout vec4 v_stroke_color;\nout float v_fontScale;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_uv = a_tex / u_sdf_map_size;\n\n\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\n\n  // 文本缩放比例\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  vec2 offset = rotate_matrix(a_textOffsets,rotation);\n\n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  vec4 projected_position = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n',{isEqual:OI}=ld;function PI(t){const e=this,r=t.id,n=[],i=[];if(!e.glyphInfoMap||!e.glyphInfoMap[r])return{vertices:[],indices:[],size:7};const o=e.glyphInfoMap[r].centroid,a=2===o.length?[o[0],o[1],0]:o;return e.glyphInfoMap[r].glyphQuads.forEach(((t,e)=>{n.push(...a,t.tex.x,t.tex.y+t.tex.height,t.tl.x,t.tl.y,...a,t.tex.x+t.tex.width,t.tex.y+t.tex.height,t.tr.x,t.tr.y,...a,t.tex.x+t.tex.width,t.tex.y,t.br.x,t.br.y,...a,t.tex.x,t.tex.y,t.bl.x,t.bl.y),i.push(0+4*e,1+4*e,2+4*e,2+4*e,3+4*e,0+4*e)})),{vertices:n,indices:i,size:7}}class DI extends iL{constructor(...t){var e;super(...t),e=this,g_(this,"glyphInfo",void 0),g_(this,"glyphInfoMap",{}),g_(this,"rawEncodeData",void 0),g_(this,"texture",void 0),g_(this,"currentZoom",-1),g_(this,"extent",void 0),g_(this,"textureHeight",0),g_(this,"textCount",0),g_(this,"preTextStyle",{}),g_(this,"mapping",Ev((function*(){e.initGlyph(),e.updateTexture(),yield e.reBuildModel()})))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,TEXT_OFFSETS:10,UV:11})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_(v_({},t.uniformsOption),e.uniformsOption),{u_sdf_map:this.textures[0]})}getCommonUniformsInfo(){const{stroke:t="#fff",strokeWidth:e=0,halo:r=.5,gamma:n=2,raisingHeight:i=0}=this.layer.getLayerConfig(),o=this.getFontServiceMapping(),a=this.getFontServiceCanvas();o&&Object.keys(o).length!==this.textCount&&a&&(this.updateTexture(),this.textCount=Object.keys(o).length),this.preTextStyle=this.getTextStyle();const s={u_stroke_color:Oe(t),u_sdf_map_size:[(null==a?void 0:a.width)||1,(null==a?void 0:a.height)||1],u_raisingHeight:Number(i),u_stroke_width:e,u_gamma_scale:n,u_halo_blur:r};return this.getUniformsBufferInfo(s)}initModels(){var t=this;return Ev((function*(){return t.bindEvent(),t.extent=t.textExtent(),t.rawEncodeData=t.layer.getEncodedData(),t.preTextStyle=t.getTextStyle(),t.initUniformsBuffer(),t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){const{textAllowOverlap:e=!1}=t.layer.getLayerConfig();t.initGlyph(),t.updateTexture(),e||t.filterGlyphs();return[yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:MI,fragmentShader:II,defines:t.getDefines(),inject:t.getInject(),triangulation:PI.bind(t),depth:{enable:!1}})]}))()}needUpdate(){var t=this;return Ev((function*(){const{textAllowOverlap:e=!1,textAnchor:r="center",textOffset:n,padding:i,fontFamily:o,fontWeight:a}=t.getTextStyle();if(!(OI(i,t.preTextStyle.padding)&&OI(n,t.preTextStyle.textOffset)&&OI(r,t.preTextStyle.textAnchor)&&OI(o,t.preTextStyle.fontFamily)&&OI(a,t.preTextStyle.fontWeight)))return yield t.mapping(),!0;if(e)return!1;const s=t.mapService.getZoom(),l=t.mapService.getBounds(),u=Dd(t.extent,l);return(Math.abs(t.currentZoom-s)>.5||!u||e!==t.preTextStyle.textAllowOverlap)&&(yield t.reBuildModel(),!0)}))()}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.layer.off("remapping",this.mapping)}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:sv.Attribute,descriptor:{shaderLocation:this.attributeLocation.TEXT_OFFSETS,name:"a_textOffsets",buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:2,update:(t,e,r)=>[r[5],r[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:sv.Attribute,descriptor:{name:"a_tex",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:(t,e,r)=>[r[3],r[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=12}=t;return Array.isArray(e)?[e[0]]:[e]}}})}bindEvent(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}textExtent(){return Pd(this.mapService.getBounds(),.5)}initTextFont(){const{fontWeight:t,fontFamily:e}=this.getTextStyle(),r=this.rawEncodeData,n=[];r.forEach((t=>{let{shape:e=""}=t;e=e.toString();for(const t of e)-1===n.indexOf(t)&&n.push(t)})),this.fontService.setFontOptions({characterSet:n,fontWeight:t,fontFamily:e,iconfont:!1})}initIconFontTex(){const{fontWeight:t,fontFamily:e}=this.getTextStyle(),r=this.rawEncodeData,n=[];r.forEach((t=>{let{shape:e=""}=t;e=`${e}`,-1===n.indexOf(e)&&n.push(e)})),this.fontService.setFontOptions({characterSet:n,fontWeight:t,fontFamily:e,iconfont:!0})}getTextStyle(){const{fontWeight:t="400",fontFamily:e="sans-serif",textAllowOverlap:r=!1,padding:n=[0,0],textAnchor:i="center",textOffset:o=[0,0],opacity:a=1,strokeOpacity:s=1,strokeWidth:l=0,stroke:u="#000"}=this.layer.getLayerConfig();return{fontWeight:t,fontFamily:e,textAllowOverlap:r,padding:n,textAnchor:i,textOffset:o,opacity:a,strokeOpacity:s,strokeWidth:l,stroke:u}}generateGlyphLayout(t){const e=this.getFontServiceMapping(),{spacing:r=2,textAnchor:n="center",textOffset:i}=this.layer.getLayerConfig(),o=this.rawEncodeData;this.glyphInfo=o.map((o=>{const{shape:a="",id:s,size:l=1}=o,u=o.textOffset?o.textOffset:i||[0,0],c=o.textAnchor?o.textAnchor:n||"center",h=LI(a.toString(),e,l,c,"left",r,u,t),p=function(t,e=[0,0],r){const{positionedGlyphs:n=[]}=t,i=[];for(const t of n){const n=t.metrics,o=4,a=n.advance*t.scale/2,s=r?[t.x+a,t.y]:[0,0],l=r?[0,0]:[t.x+a+e[0],t.y+e[1]],u=(0-o)*t.scale-a+l[0],c=(0-o)*t.scale+l[1],h=u+n.width*t.scale,p=c+n.height*t.scale,d={x:u,y:c},f={x:h,y:c},m={x:u,y:p},g={x:h,y:p};i.push({tl:d,tr:f,bl:m,br:g,tex:n,glyphOffset:s})}return i}(h,u,!1);return o.shaping=h,o.glyphQuads=p,o.centroid=Fd(o.coordinates),this.glyphInfoMap[s]={shaping:h,glyphQuads:p,centroid:Fd(o.coordinates)},o}))}getFontServiceMapping(){const{fontWeight:t="400",fontFamily:e="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getMappingByKey(`${e}_${t}`)}getFontServiceCanvas(){const{fontWeight:t="400",fontFamily:e="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getCanvasByKey(`${e}_${t}`)}filterGlyphs(){const{padding:t=[0,0],textAllowOverlap:e=!1}=this.layer.getLayerConfig();if(e)return;this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();const{width:r,height:n}=this.rendererService.getViewportSize(),i=new AI(r,n),o=this.glyphInfo.filter((e=>{const{shaping:r,id:n=0}=e,o=e.centroid,a=e.size/16,s=this.mapService.lngLatToContainer(o),{box:l}=i.placeCollisionBox({x1:r.left*a-t[0],x2:r.right*a+t[0],y1:r.top*a-t[1],y2:r.bottom*a+t[1],anchorPointX:s.x,anchorPointY:s.y});return!(!l||!l.length)&&(i.insertCollisionBox(l,n),!0)}));o.forEach((t=>{this.glyphInfoMap[t.id]=t}))}initGlyph(){const{iconfont:t=!1}=this.layer.getLayerConfig();t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}updateTexture(){const{createTexture2D:t}=this.rendererService,e=this.getFontServiceCanvas();this.textureHeight=e.height,this.texture&&this.texture.destroy(),this.texture=t({data:e,mag:x_.LINEAR,min:x_.LINEAR,width:e.width,height:e.height}),this.textures=[this.texture]}reBuildModel(){var t=this;return Ev((function*(){t.filterGlyphs();const e=yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:MI,fragmentShader:II,triangulation:PI.bind(t),defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}});t.layer.models=[e]}))()}}const BI={fillImage:class extends iL{constructor(...t){super(...t),g_(this,"meter2coord",1),g_(this,"texture",void 0),g_(this,"isMeter",!1),g_(this,"radian",0),g_(this,"updateTexture",(()=>{const{createTexture2D:t}=this.rendererService;if(this.texture)return this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void this.layerService.throttleRenderLayers();this.texture=t({data:this.iconService.getCanvas(),mag:x_.LINEAR,min:x_.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0}),this.textures=[this.texture]}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,UV:11})}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:e=!1,unit:r="pixel"}=this.layer.getLayerConfig();var n;this.rendererService.getDirty()&&(null===(n=this.texture)||void 0===n||n.bind());const i={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(e),u_raisingHeight:Number(t),u_size_unit:sL[r]};return this.getUniformsBufferInfo(i)}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),OL)}initModels(){var t=this;return Ev((function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniform {\n  vec2 u_textSize;\n  float u_heightfixed;\n  float u_raisingHeight;\n  float u_size_unit;\n};\n\nout vec2 v_uv;\nout vec2 v_Iconuv;\nout float v_opacity;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  v_uv = (a_Extrude.xy + 1.0) / 2.0;\n  v_uv.y = 1.0 - v_uv.y;\n  v_Iconuv = a_Uv;\n  v_opacity = opacity;\n  float newSize = a_Size;\n  if (u_size_unit == 1.0) {\n    newSize = newSize * u_PixelsPerMeter.z;\n  }\n\n  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec2 offset = extrude.xy * newSize + offsets;\n\n  offset = rotate_matrix(offset, rotation);\n\n  offset = project_pixel(offset);\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec2 v_uv;// 本身的 uv 坐标\nin vec2 v_Iconuv;\nin float v_opacity;\nout vec4 outputColor;\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniform {\n  vec2 u_textSize;\n  float u_heightfixed: 0.0;\n  float u_raisingHeight: 0.0;\n  float u_size_unit;\n};\n\n#pragma include "scene_uniforms"\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nvoid main() {\n  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\n  outputColor = texture(SAMPLER_2D(u_texture), pos);\n  outputColor.a *= v_opacity;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:OL,depth:{enable:!1},defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:x_.FRONT}})]}))()}clearModels(){var t;this.iconService.off("imageUpdate",this.updateTexture),null===(t=this.texture)||void 0===t||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sv.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{shape:r}=t,{x:n,y:i}=e[r]||{x:-64,y:-64};return[n,i]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:sv.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r,n)=>{const i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=n%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}})}},fill:xI,radar:class extends iL{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10})}getCommonUniformsInfo(){const{blend:t,speed:e=1,unit:r="pixel"}=this.layer.getLayerConfig(),n={u_additive:"additive"===t?1:0,u_size_unit:sL[r],u_speed:e,u_time:this.layer.getLayerAnimateTime()};return this.getUniformsBufferInfo(n)}getAnimateUniforms(){return{}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),OL)}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;\n\nlayout(std140) uniform commonUniorm {\n  float u_additive;\n  float u_size_unit;\n  float u_speed: 1.0;\n  float u_time;\n};\n\nout vec4 v_data;\nout vec4 v_color;\nout float v_radius;\nout vec2 v_extrude;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  float newSize = setPickingSize(a_Size);\n\n  float time = u_time * u_speed;\n  mat2 rotateMatrix = mat2(\n    cos(time), sin(time),\n    -sin(time), cos(time)\n  );\n  v_extrude = rotateMatrix * a_Extrude.xy;\n\n  v_color = a_Color;\n  v_color.a *= opacity;\n\n  float blur = 0.0;\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\n\n  if(u_size_unit == 1.) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  v_radius = newSize;\n\n  vec2 offset = (a_Extrude.xy * (newSize));\n\n  offset = project_pixel(offset);\n\n  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nlayout(std140) uniform commonUniorm{\n  float u_additive;\n  float u_size_unit;\n  float u_speed: 1.0;\n  float u_time;\n};\nin vec4 v_data;\nin vec4 v_color;\nin float v_radius;\nin vec2 v_extrude;\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nout vec4 outputColor;\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df = sdCircle(v_data.xy, 1.0);\n  float inner_df = sdCircle(v_data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  outputColor = vec4(v_color.rgb, v_color.a);\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n  } else {\n    outputColor.a *= opacity_t;\n  }\n\n  if(outputColor.a > 0.0) {\n    outputColor = filterColor(outputColor);\n  }\n\n  vec2 extrude =  v_extrude;\n  vec2 dir = normalize(extrude);\n  vec2 baseDir = vec2(1.0, 0.0);\n  float pi = 3.14159265359;\n  float flag = sign(dir.y);\n  float rades = dot(dir, baseDir);\n  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\n  // simple AA\n  if(radar_v > 0.99) {\n    radar_v = 1.0 - (radar_v - 0.99)/0.01;\n  }\n\n  outputColor.a *= radar_v;\n}\n',triangulation:OL,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}})]}))()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:sv.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r,n)=>{const i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=n%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}})}},image:bI,normal:TI,simplePoint:class extends iL{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const{blend:t,strokeOpacity:e=1,strokeWidth:r=0,stroke:n="#fff"}=this.layer.getLayerConfig(),i={u_stroke_color:Oe(n),u_additive:"additive"===t?1:0,u_stroke_opacity:e,u_stroke_width:r};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){t.layer.triangulation=_I,t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:'\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_stroke_color;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_stroke_width;\n};\n\nout vec4 v_color;\nout float v_blur;\nout float v_innerRadius;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_blur = 1.0 - max(2.0 / a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n\n  vec2 offset = project_pixel(u_offsets);\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nlayout(std140) uniform commonUniorm {\n  vec4 u_stroke_color;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_stroke_width;\n};\n\nin vec4 v_color;\nin float v_blur;\nin float v_innerRadius;\n\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  // Tip: 片元到中心点的距离 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: 片元的剪切成圆形\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // 当存在 stroke 且 stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      outputColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      outputColor = mix(v_color, stroke, mixR);\n    } else {\n      outputColor = v_color;\n    }\n  } else {\n    // 当不存在 stroke 或 stroke <= 0.01\n    outputColor = v_color;\n  }\n\n  outputColor = filterColor(outputColor);\n  \n  if(u_additive > 0.0) {\n    outputColor *= circleClipOpacity;\n  } else {\n    outputColor.a *= circleClipOpacity;\n  }\n\n}\n',defines:t.getDefines(),inject:t.getInject(),triangulation:_I,depth:{enable:!1},primitive:x_.POINTS})]}))()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}})}},extrude:yI,text:DI,earthFill:class extends iL{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:e=0,blend:r,blur:n=0}=this.layer.getLayerConfig();this.layer.getLayerConfig();const i={u_additive:"additive"===r?1:0,u_stroke_opacity:t,u_stroke_width:e,u_blur:n};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return Ev((function*(){return t.initUniformsBuffer(),t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){t.layer.triangulation=PL;return[yield t.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;\nlayout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;\n\nlayout(std140) uniform commonUniform {\n  float u_additive;\n  float u_stroke_opacity : 1;\n  float u_stroke_width : 2;\n  float u_blur : 0.0;\n};\nout vec4 v_data;\nout vec4 v_color;\nout float v_radius;\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:"in vec4 v_data;\nin vec4 v_color;\nin float v_radius;\n\nlayout(std140) uniform commonUniform {\n  float u_additive;\n  float u_stroke_opacity : 1;\n  float u_stroke_width : 2;\n  float u_blur : 0.0;\n};\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nout vec4 outputColor;\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(outer_df > antialiasblur + 0.018) discard;\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(u_stroke_width < 0.01) {\n    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);\n  } else {\n    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n    outputColor = filterColorAlpha(outputColor, outputColor.a);\n  } else {\n    outputColor.a *= opacity_t;\n    outputColor = filterColor(outputColor);\n  }\n}\n",triangulation:PL,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!0},blend:t.getBlend()})]}))()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:sv.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r,n)=>{const[i,o,a]=r,s=kv(0,0,1),l=kv(i,0,a),u=i>=0?Gv(s,l):2*Math.PI-Gv(s,l),c=2*Math.PI-Math.asin(o/100),h=wv();Pv(h,h,u),Ov(h,h,c);const p=kv(1,1,0);zv(p,p,h),Uv(p,p);const d=kv(-1,1,0);zv(d,d,h),Uv(d,d);const f=kv(-1,-1,0);zv(f,f,h),Uv(f,f);const m=kv(1,-1,0);zv(m,m,h),Uv(m,m);const g=[...p,...d,...f,...m],_=n%4*3;return[g[_],g[_+1],g[_+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:sv.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{shape:e=2}=t;return[this.layer.getLayerConfig().shape2d.indexOf(e)]}}})}},earthExtrude:class extends iL{constructor(...t){super(...t),g_(this,"raiseCount",0),g_(this,"raiseRepeat",0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},opacity:e=1,sourceColor:r,targetColor:n,pickLight:i=!1,heightfixed:o=!0,opacityLinear:a={enable:!1,dir:"up"},lightEnable:s=!0}=this.layer.getLayerConfig();let l=0,u=[0,0,0,0],c=[0,0,0,0];if(r&&n&&(u=Oe(r),c=Oe(n),l=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:e=.01}=t;this.raiseCount+=e,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const h={u_sourceColor:u,u_targetColor:c,u_linearColor:l,u_pickLight:Number(i),u_heightfixed:Number(o),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:vI(e)?e:1,u_opacitylinear:Number(a.enable),u_opacitylinear_dir:"up"===a.dir?1:0,u_lightEnable:Number(s)};return this.getUniformsBufferInfo(h)}initModels(){var t=this;return Ev((function*(){return t.initUniformsBuffer(),t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){const{animateOption:{repeat:e=1}}=t.layer.getLayerConfig();t.raiseRepeat=e;return[yield t.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;\nlayout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniform {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor: 0;\n  float u_heightfixed: 0.0; // 默认不固定\n  float u_globel;\n  float u_r;\n  float u_pickLight: 0.0;\n  float u_opacitylinear: 0.0;\n  float u_opacitylinear_dir: 1.0;\n  float u_lightEnable: 1.0;\n};\n\nout vec4 v_color;\nout float v_lightWeight;\nout float v_barLinearZ;\n// 用于将在顶点着色器中计算好的样式值传递给片元\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) +\n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值\n  v_barLinearZ =  a_Position.z;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    //\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // 圆柱光照效果\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n  v_lightWeight = lightWeight;\n  // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);\n    v_color.rgb *= lightWeight;\n  } else { // 使用 color 方法传入的颜色\n     v_color = a_Color;\n  }\n  v_color.a *= u_opacity;\n\n\n  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度\n  //旋转矩阵mx，创建绕x轴旋转矩阵\n  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n  float xRadian = getXRadian(a_Pos.y, r);\n  float xcos = cos(xRadian);//求解旋转角度余弦值\n  float xsin = sin(xRadian);//求解旋转角度正弦值\n  mat4 mx = mat4(\n    1,0,0,0,\n    0,xcos,-xsin,0,\n    0,xsin,xcos,0,\n    0,0,0,1);\n\n  //旋转矩阵my，创建绕y轴旋转矩阵\n  float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n  float ycos = cos(yRadian);//求解旋转角度余弦值\n  float ysin = sin(yRadian);//求解旋转角度正弦值\n  mat4 my = mat4(\n    ycos,0,-ysin,0,\n    0,1,0,0,\n    ysin,0,ycos,0,\n    0,0,0,1);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nin vec4 v_color;\n\n#pragma include "picking"\n\nlayout(std140) uniform commonUniform {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor: 0;\n  float u_heightfixed: 0.0; // 默认不固定\n  float u_globel;\n  float u_r;\n  float u_pickLight: 0.0;\n  float u_opacitylinear: 0.0;\n  float u_opacitylinear_dir: 1.0;\n  float u_lightEnable: 1.0;\n};\nin float v_lightWeight;\nin float v_barLinearZ;\nout vec4 outputColor;\nvoid main() {\n\n   outputColor = v_color;\n\n  // 开启透明度渐变\n  if(u_opacitylinear > 0.0) {\n    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    outputColor = filterColorAlpha(outputColor, v_lightWeight);\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n}\n',triangulation:DL,depth:{enable:!0},defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:x_.FRONT},blend:t.getBlend()})]}))()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:3,update:t=>{const{size:e}=t;if(e){let t=[];return Array.isArray(e)&&(t=2===e.length?[e[0],e[0],e[1]]:e),Array.isArray(e)||(t=[e,e,e]),t}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sv.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r,n,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:sv.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:3,update:t=>{const e=Fd(t.coordinates);return cL([e[0],e[1]])}}})}}};var NI=BI;class FI extends TR{constructor(...t){super(...t),g_(this,"type","PointLayer"),g_(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),g_(this,"enableDataEncodeStyles",["textOffset","textAnchor"]),g_(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}})}buildModels(){var t=this;return Ev((function*(){const e=t.getModelType();t.layerModel&&t.layerModel.clearModels(),t.layerModel=new NI[e](t),yield t.initLayerModels()}))()}rebuildModels(){var t=this;return Ev((function*(){yield t.buildModels()}))()}getModelTypeWillEmptyData(){if(this.shapeOption){const{field:t,values:e}=this.shapeOption,{shape2d:r}=this.getLayerConfig(),n=this.iconService.getIconMap();if(t&&-1!==(null==r?void 0:r.indexOf(t)))return"fill";if("text"===e)return"text";if(e&&e instanceof Array)for(const t of e)if("string"==typeof t&&n.hasOwnProperty(t))return"image"}return"normal"}getDefaultConfig(){return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[this.getModelType()]}getModelType(){const t=this.getEncodedData(),{shape2d:e,shape3d:r,billboard:n=!0}=this.getLayerConfig(),i=this.iconService.getIconMap(),o=t.find((t=>t.hasOwnProperty("shape")));if(o){const t=o.shape;return"dot"===t?"normal":"simple"===t?"simplePoint":"radar"===t?"radar":"fillImage"===this.layerType||!1===n?"fillImage":-1!==(null==e?void 0:e.indexOf(t))?"GLOBEL"===this.mapService.version?"earthFill":"fill":-1!==(null==r?void 0:r.indexOf(t))?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":i.hasOwnProperty(t)?"image":"text"}return this.getModelTypeWillEmptyData()}}function kI(){return kI=Ev((function*(t){if(window.createImageBitmap){const e=yield fetch(t);return yield createImageBitmap(yield e.blob())}{const e=new window.Image;return new Promise((r=>{e.onload=()=>r(e),e.src=t,e.crossOrigin="Anonymous"}))}})),kI.apply(this,arguments)}const UI={fill:class extends iL{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,LINEAR:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,opacityLinear:e={enable:!1,dir:"in"}}=this.layer.getLayerConfig(),r={u_raisingHeight:Number(t),u_opacitylinear:Number(e.enable),u_dir:"in"===e.dir?1:0};return this.getUniformsBufferInfo(r)}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){const{frag:e,vert:r,triangulation:n,type:i}=t.getModelParams();t.initUniformsBuffer(),t.layer.triangulation=n;return[yield t.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:e,defines:t.getDefines(),inject:t.getInject(),triangulation:n,primitive:x_.TRIANGLES,depth:{enable:!1}})]}))()}registerBuiltinAttributes(){this.registerPosition64LowAttribute();const{opacityLinear:t={enable:!1,dir:"in"}}=this.layer.getLayerConfig();t.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:sv.Attribute,descriptor:{name:"a_linear",shaderLocation:this.attributeLocation.LINEAR,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r)=>[r[3],r[4],r[5]]}})}getModelParams(){const{opacityLinear:t={enable:!1}}=this.layer.getLayerConfig();return t.enable?{frag:'\nlayout(std140) uniform commonUniforms {\n  float u_raisingHeight;\n  float u_opacitylinear;\n  float u_dir;\n};\n\nin vec4 v_color;\nin vec3 v_linear;\nin vec2 v_pos;\nout vec4 outputColor;\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nvoid main() {\n  outputColor = v_color;\n  if (u_opacitylinear > 0.0) {\n    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_LINEAR) in vec3 a_linear;\n\nlayout(std140) uniform commonUniforms {\n  float u_raisingHeight;\n  float u_opacitylinear;\n  float u_dir;\n};\n\nout vec4 v_color;\nout vec3 v_linear;\nout vec2 v_pos;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  if (u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  project_pos.z += u_raisingHeight;\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonLinear",triangulation:GL}:{frag:'in vec4 v_color;\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\n\nlayout(std140) uniform commonUniforms {\n  float u_raisingHeight;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n\n  project_pos.z += u_raisingHeight;\n\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n\n',type:"polygonFill",triangulation:zL}}},line:dI,extrude:class extends iL{constructor(...t){super(...t),g_(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,UV:11})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{mapTexture:t,heightfixed:e=!1,raisingHeight:r=0,topsurface:n=!0,sidesurface:i=!0,sourceColor:o,targetColor:a}=this.layer.getLayerConfig();let s=0,l=[1,1,1,1],u=[1,1,1,1];o&&a&&(l=Oe(o),u=Oe(a),s=1);const c={u_sourceColor:l,u_targetColor:u,u_linearColor:s,u_topsurface:Number(n),u_sidesurface:Number(i),u_heightfixed:Number(e),u_raisingHeight:Number(r)};t&&this.texture&&(c.u_texture=this.texture,this.textures=[this.texture]);return this.getUniformsBufferInfo(c)}initModels(){var t=this;return Ev((function*(){return yield t.loadTexture(),t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){const{frag:e,vert:r,type:n}=t.getShaders();t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:n,vertexShader:r,fragmentShader:e,depth:{enable:!0},defines:t.getDefines(),inject:t.getInject(),triangulation:VL})]}))()}getShaders(){const{pickLight:t,mapTexture:e}=this.layer.getLayerConfig();return e?{frag:'uniform sampler2D u_texture;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nin vec4 v_Color;\nin vec3 v_uvs;\nin vec2 v_texture_data;\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nout vec4 outputColor;\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide = v_texture_data.x;\n  float lightWeight = v_texture_data.y;\n  float topU = v_uvs[0];\n  float topV = 1.0 - v_uvs[1];\n  float sidey = v_uvs[2];\n\n  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));\n  // Tip: 部分机型 GPU 计算精度兼容\n  if (isSide < 0.999) {// 是否是边缘\n    // side face\n    if (u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if (u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      outputColor = linearColor;\n    } else {\n      outputColor = v_Color;\n    }\n  } else {\n     // top face\n    if (u_topsurface < 1.0) {\n      discard;\n    }\n  }\n  \n  outputColor.a *= opacity;\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nout vec4 v_Color;\nout vec3 v_uvs;\nout vec2 v_texture_data;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos, a_Position64Low);\n  float lightWeight = calc_lighting(project_pos);\n  v_uvs = a_uvs;\n  v_Color = a_Color;\n  v_Color.a *= opacity;\n\n  v_texture_data = vec2(a_Position.z, lightWeight);\n\n  if (u_heightfixed > 0.0) {\n    // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if (\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    ) {\n      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudeTexture"}:t?{frag:'\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nin vec4 v_Color;\nin vec3 v_uvs;\nin vec2 v_texture_data;\nout vec4 outputColor;\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nvoid main() {\n  float isSide =  v_texture_data.x;\n  float sidey = v_uvs[2];\n  float lightWeight = v_texture_data.y;\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n    \n    if( u_linearColor == 1.0) {\n      // side use linear\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      outputColor = linearColor;\n    } else {\n      // side notuse linear\n       outputColor = v_Color;\n    }\n  } else {\n    // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n    outputColor = v_Color;\n  }\n\n  outputColor = filterColorAlpha(outputColor, lightWeight);\n}\n',vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nout vec4 v_Color;\nout vec3 v_uvs;\nout vec2 v_texture_data;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  v_uvs = a_uvs;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos, a_Position64Low);\n\n  if (u_heightfixed > 0.0) {\n    // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n    if (\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    ) {\n      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  float lightWeight = calc_lighting(project_pos);\n  v_texture_data = vec2(a_Position.z, lightWeight);\n\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudePickLight"}:{frag:'layout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nin vec4 v_Color;\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    outputColor = v_Color;\n  \n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nout vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  float isSide = a_Position.z;\n  float topU = a_uvs[0];\n  float topV = 1.0 - a_uvs[1];\n  float sidey = a_uvs[2];\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n\n  vec4 project_pos = project_position(pos, a_Position64Low);\n  float lightWeight = calc_lighting(project_pos);\n\n  if (u_heightfixed > 0.0) {\n    // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if (\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    ) {\n      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if (isSide < 0.999) {\n    // side face\n    // if(u_sidesurface < 1.0) {\n    //   discard;\n    // }\n\n    if (u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      v_Color = linearColor;\n    } else {\n      v_Color = a_Color;\n    }\n\n  } else {\n    v_Color = a_Color;\n  }\n\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.textures=[]}registerBuiltinAttributes(){const t=this.layer.getSource().extent,e=t[2]-t[0],r=t[3]-t[1];this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uvs",type:sv.Attribute,descriptor:{name:"a_uvs",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(n,i,o)=>{const a=o[0],s=o[1];return[(a-t[0])/e,(s-t[1])/r,o[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sv.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r,n,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=10}=t;return Array.isArray(e)?[e[0]]:[e]}}})}loadTexture(){var t=this;return Ev((function*(){const{mapTexture:e}=t.layer.getLayerConfig(),{createTexture2D:r}=t.rendererService;if(t.texture=r({height:1,width:1}),e){const n=yield function(t){return kI.apply(this,arguments)}(e);t.texture=r({data:n,width:n.width,height:n.height,wrapS:x_.CLAMP_TO_EDGE,wrapT:x_.CLAMP_TO_EDGE,min:x_.LINEAR,mag:x_.LINEAR})}}))()}},text:DI,point_fill:xI,point_image:bI,point_normal:TI,point_extrude:yI,water:class extends iL{constructor(...t){super(...t),g_(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{speed:t=.5}=this.layer.getLayerConfig(),e={u_speed:t,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};this.textures=[this.texture];return this.getUniformsBufferInfo(e)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return Ev((function*(){return t.loadTexture(),t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;\n\nlayout(std140) uniform commonUniforms {\n  float u_speed;\n  float u_time;\n};\nout vec4 v_Color;\nout vec2 v_uv;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n  v_Color = a_Color;\n  v_Color.a *= opacity;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n\n',fragmentShader:"uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n  float u_speed;\n  float u_time;\n};\n\nout vec4 outputColor;\n\n\nin vec4 v_Color;\nin vec2 v_uv;\n\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\n\nfloat water(vec3 p) {\n  float t = u_time * u_speed;\n  p.z += t * 2.; p.x += t * 2.;\n  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;\n  p.z += t * 3.; p.x += t * 0.52;\n  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;\n  p.z += t * 4.; p.x += t * 0.8;\n  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;\n  c1 += c2 - c3;\n  float z = (c1.x + c1.y + c1.z) / 3.;\n  return p.y + z / 4.;\n}\n\nfloat map(vec3 p) {\n  float d = 100.0;\n  d = water(p);\n  return d;\n}\n\nfloat intersect(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i <= 100; i++) {\n    float h = map(ro + rd * d);\n    if (h < 0.1) return  d;\n    d += h;\n  }\n  return 0.0;\n}\n\nvec3 norm(vec3 p) {\n  float eps = .1;\n  return normalize(vec3(\n    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\n    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\n    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n  ));\n} \n\nfloat calSpc() {\n  vec3 l1 = normalize(vec3(1, 1, 1));\n  vec3 ro = vec3(-3, 20, -8);\n  vec3 rc = vec3(0, 0, 0);\n  vec3 ww = normalize(rc - ro);\n  vec3 uu = normalize(cross(vec3(0,1,0), ww));\n  vec3 vv = normalize(cross(rc - ro, uu));\n  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\n  float d = intersect(ro, rd);\n  vec3 p = ro + rd * d;\n  vec3 n = norm(p);\n  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\n  return spc;\n}\n\nvoid main() {\n\n  outputColor = v_Color;\n  float spc = calSpc();\n  outputColor += spc * 0.4;\n}\n",triangulation:zL,defines:t.getDefines(),inject:t.getInject(),primitive:x_.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1})]}))()}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[e,r,n,i]=t,o=n-e,a=i-r;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:sv.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:2,update:(t,n,i)=>{const[s,l]=i;return[(s-e)/o,(l-r)/a]}}})}loadTexture(){const{waterTexture:t}=this.layer.getLayerConfig(),{createTexture2D:e}=this.rendererService;this.texture=e({height:1,width:1});const r=new Image;r.crossOrigin="",t?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),r.src=t):r.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",r.onload=()=>{this.texture=e({data:r,width:r.width,height:r.height,wrapS:x_.MIRRORED_REPEAT,wrapT:x_.MIRRORED_REPEAT,min:x_.LINEAR,mag:x_.LINEAR}),this.layerService.reRender()}}},ocean:class extends iL{constructor(...t){super(...t),g_(this,"texture1",void 0),g_(this,"texture2",void 0),g_(this,"texture3",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{watercolor:t="#6D99A8",watercolor2:e="#0F121C"}=this.layer.getLayerConfig(),r={u_watercolor:Oe(t),u_watercolor2:Oe(e),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};this.textures=[this.texture1,this.texture2,this.texture3];return this.getUniformsBufferInfo(r)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return Ev((function*(){return t.loadTexture(),t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_watercolor;\n  vec4 u_watercolor2;\n  float u_time;\n};\n\nout vec2 v_uv;\nout float v_opacity;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n  v_opacity = opacity;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n\n',fragmentShader:"\nlayout(std140) uniform commonUniforms {\n  vec4 u_watercolor;\n  vec4 u_watercolor2;\n  float u_time;\n};\n\nin vec2 v_uv;\nin float v_opacity;\nout vec4 outputColor;\n\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750; // change to adjust the \"heavy\" waves\nfloat large_wavesize        = 3.4;  // factor to adjust the large wave size\nfloat small_waveheight      = 0.6;  // change to adjust the small random waves\nfloat small_wavesize        = 0.5;   // factor to ajust the small wave size\nfloat water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)\nfloat water_glossylight_fact= 120.; // range [1..200]\nfloat particle_amount       = 70.;\n\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\n  \n\nfloat hash( float n ) {\n    return fract(sin(n)*43758.5453123);\n}\n\n// 2d noise function\nfloat noise1( in vec2 x ) {\n  vec2 p  = floor(x);\n  vec2 f  = smoothstep(0.0, 1.0, fract(x));\n  float n = p.x + p.y*57.0;\n  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n\nfloat noise(vec2 p) {\n    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;\n}\n\nvec4 highness(vec2 p) {\n    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));\n    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\n    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\n\nfloat height_map( vec2 p ) {\n    vec4 height=highness(p);\n    /*\n    height = -0.5+\n        0.5*smoothstep(-100.,0.,-height)+\n        2.75*smoothstep(0.,2.,height)+\n        1.75*smoothstep(2.,4.,height)+\n        2.75*smoothstep(4.,16.,height)+\n        1.5*smoothstep(16.,1000.,height);\n    */\n\n    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\n    //p = p*6.;\n    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;\n    f += 0.2500*noise( p ); p = m*p*1.32;\n    f += 0.1666*noise( p ); p = m*p*1.11;\n    f += 0.0834*noise( p ); p = m*p*1.12;\n    f += 0.0634*noise( p ); p = m*p*1.13;\n    f += 0.0444*noise( p ); p = m*p*1.14;\n    f += 0.0274*noise( p ); p = m*p*1.15;\n    f += 0.0134*noise( p ); p = m*p*1.16;\n    f += 0.0104*noise( p ); p = m*p*1.17;\n    f += 0.0084*noise( p );\n    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\n        const float FLAT_LEVEL = 0.92525;\n        //f = f*0.25+height*0.75;\n    if (f<FLAT_LEVEL)\n        f = f;\n    else\n        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase\n    return clamp(f, 0., 10.);\n}\n\nvec3 plasma_quintic( float x ) {\n    x = clamp( x, 0.0, 1.0);\n    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3\n    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7\n    return vec3(\n        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\n        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\n        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\n\nvec4 color(vec2 p){\n    vec4 c1 = vec4(1.7,1.6,.9,1);\n    vec4 c2 = vec4(.2,.94,.1,1);\n    vec4 c3 = vec4(.3,.2,.0,1);\n    vec4 c4 = vec4(.99,.99,1.6,1);\n    vec4 v = highness(p);\n    float los = smoothstep(0.1,1.1,v.b);\n    float his = smoothstep(3.5,6.5,v.b);\n    float ces = smoothstep(1.,5.,v.a);\n    vec4 lo = mix(c1,c2,los);\n    vec4 hi = mix(c3,c4,his);\n    vec4 ce = mix(lo,hi,ces);\n\n    return vec4(plasma_quintic(ces),1).ragb;\n}\n\nvec3 terrain_map( vec2 p )\n{\n  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'\n}\n\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\n\nfloat water_map( vec2 p, float height ) {\n    vec2 p2 = p*large_wavesize;\n    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\n    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\n\n    // coarse crossing 'ocean' waves...\n    float f = 0.6000*noise( p );\n    f += 0.2500*noise( p*m );\n    f += 0.1666*noise( p*m*m );\n    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\n\n    p *= small_wavesize;\n    f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<9; i++)\n    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\n    \n    return wave+f*small_waveheight;\n}\n\nfloat nautic(vec2 p) {\n    p *= 18.;\n    float f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\n    return pow(1.-f, 5.);\n}\n\nfloat particles(vec2 p) {\n    p *= 200.;\n    float f = 0.;\n    float amp = 1.0, s = 1.5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\n    return pow(f*.35, 7.)*particle_amount;\n}\n\nfloat test_shadow( vec2 xy, float height) {\n    vec3 r0 = vec3(xy, height);\n    vec3 rd = normalize( light - r0 );\n    \n    float hit = 1.0;\n    float t   = 0.001;\n    for (int j=1; j<25; j++)\n    {\n        vec3 p = r0 + t*rd;\n        float h = height_map( p.xy );\n        float height_diff = p.z - h;\n        if (height_diff<0.0)\n        {\n            return 0.0;\n        }\n        t += 0.01+height_diff*.02;\n        hit = min(hit, 2.*height_diff/t); // soft shaddow   \n    }\n    return hit;\n}\n\nvec3 CalcTerrain(vec2 uv, float height) {\n    vec3 col = terrain_map( uv );\n    vec2 iResolution = vec2(512.);\n    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\n    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\n    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\n    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\n    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\n    vec3 r0 = vec3(uv, height);\n    vec3 rd = normalize( light - r0 );\n    float grad = dot(norm, rd);\n    col *= grad+pow(grad, 8.);\n    float terrainshade = test_shadow( uv, height );\n    col = mix(col*.25, col, terrainshade);\n    return col;\n}\n\n\nvoid main() {\n  vec3 watercolor = u_watercolor.rgb;\n  vec3 watercolor2 = u_watercolor2.rgb;\n  vec2 uv = v_uv;\n  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)\n  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\n  float height = height_map( uv );\n  vec3 col;\n\n    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\n    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\n    if (height > level)\n    {\n        col = CalcTerrain(uv, height);\n    }\n    if (height <= level)\n    {\n        vec2 dif = vec2(.0, .01);\n        vec2 pos = uv*15. + vec2(u_time*.01);\n        float h1 = water_map(pos-dif,waveheight);\n        float h2 = water_map(pos+dif,waveheight);\n        float h3 = water_map(pos-dif.yx,waveheight);\n        float h4 = water_map(pos+dif.yx,waveheight);\n        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane\n        uv += normwater.xy*.002*(level-height);\n        \n        col = CalcTerrain(uv, height);\n\n        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\n        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\n        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;\n        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\n\n        vec3 r0 = vec3(uv, WATER_LEVEL);\n        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position\n        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction\n        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          \n        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights\n        float gradpos  = dot(vec3(0., 0., 1.), rd);\n        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          \n        float watershade  = test_shadow( uv, level );\n        watercolor *= 2.2+watershade;\n        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\n        watercolor /= (1.+specular1*1.25);\n        watercolor += watershade*specular2*water_specularcolor;\n        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\n        \n        col = mix(col, watercolor, coastfade);\n    }\n    \n  outputColor = vec4(col, v_opacity);  \n}\n",defines:t.getDefines(),inject:t.getInject(),triangulation:zL,primitive:x_.TRIANGLES,depth:{enable:!1}})]}))()}clearModels(){var t,e,r;null===(t=this.texture1)||void 0===t||t.destroy(),null===(e=this.texture2)||void 0===e||e.destroy(),null===(r=this.texture3)||void 0===r||r.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[e,r,n,i]=t,o=n-e,a=i-r;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:sv.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:2,update:(t,n,i)=>{const[s,l]=i;return[(s-e)/o,(l-r)/a]}}})}loadTexture(){const{createTexture2D:t}=this.rendererService,e={height:0,width:0};function r(e){return t({data:e,width:e.width,height:e.height,wrapS:x_.MIRRORED_REPEAT,wrapT:x_.MIRRORED_REPEAT,min:x_.LINEAR,mag:x_.LINEAR})}this.texture1=t(e),this.texture2=t(e),this.texture3=t(e),function(t){let e=0;const r=[];["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map((n=>{const i=new Image;i.crossOrigin="",i.src=n,r.push(i),i.onload=()=>{e++,3===e&&t(r)}}))}((t=>{this.texture1=r(t[0]),this.texture2=r(t[1]),this.texture3=r(t[2]),this.layerService.reRender()}))}},extrusion:class extends iL{constructor(...t){super(...t),g_(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,EXTRUSION_BASE:11})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){return this.getUniformsBufferInfo({})}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){const{frag:e,vert:r,type:n}=t.getShaders();t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:n,vertexShader:r,fragmentShader:e,defines:t.getDefines(),inject:t.getInject(),triangulation:VL,depth:{enable:!0}})]}))()}getShaders(){return{frag:'\nin vec4 v_Color;\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n\n  outputColor = v_Color;\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\n\nout vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);\n\n  vec4 project_pos = project_position(pos, a_Position64Low);\n  float lightWeight = calc_lighting(project_pos);\n  v_Color = a_Color;\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"normal",type:sv.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:3,update:(t,e,r,n,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:sv.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{size:e=10}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrusionBase",type:sv.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:this.attributeLocation.EXTRUSION_BASE,buffer:{usage:x_.STATIC_DRAW,data:[],type:x_.FLOAT},size:1,update:t=>{const{extrusionBase:e=0}=t;return[e]}}})}}};var zI=UI;class GI extends TR{constructor(...t){super(...t),g_(this,"type","PolygonLayer"),g_(this,"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"])}buildModels(){var t=this;return Ev((function*(){const e=t.getModelType();t.layerModel=new zI[e](t),yield t.initLayerModels()}))()}getModelType(){var t;const e=this.styleAttributeService.getLayerStyleAttribute("shape"),r=null==e||null===(t=e.scale)||void 0===t?void 0:t.field;return"fill"!==r&&r?"extrude"===r?"extrude":"extrusion"===r?"extrusion":"water"===r?"water":"ocean"===r?"ocean":"line"===r?"line":this.getPointModelType():"fill"}getPointModelType(){const t=this.getEncodedData(),{shape2d:e,shape3d:r}=this.getLayerConfig(),n=this.iconService.getIconMap(),i=t.find((t=>t.hasOwnProperty("shape")));if(i){const t=i.shape;return"dot"===t?"point_normal":-1!==(null==e?void 0:e.indexOf(t))?"point_fill":-1!==(null==r?void 0:r.indexOf(t))?"point_extrude":n.hasOwnProperty(t)?"point_image":"text"}return"fill"}}class jI extends iL{constructor(...t){super(...t),g_(this,"texture",void 0),g_(this,"colorTexture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,clampLow:e=!0,clampHigh:r=!0,noDataValue:n=-9999999,domain:i,rampColors:o}=this.layer.getLayerConfig(),a=i||Fe(o);this.colorTexture=this.layer.textureService.getColorTexture(o,a);const s={u_domain:a,u_opacity:t||1,u_noDataValue:n,u_clampLow:e?1:0,u_clampHigh:(void 0!==r?r:e)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};this.textures=[this.texture,this.colorTexture];return this.getUniformsBufferInfo(s)}getRasterData(t){return Ev((function*(){if(Array.isArray(t.data))return{data:t.data,width:t.width,height:t.height};{const{rasterData:e,width:r,height:n}=yield t.data;return{data:Array.from(e),width:r,height:n}}}))()}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();const e=t.layer.getSource(),{createTexture2D:r,queryVerdorInfo:n}=t.rendererService,i=e.data.dataArray[0],{data:o,width:a,height:s}=yield t.getRasterData(i);t.texture=r({data:new Float32Array(o),width:a,height:s,format:"WebGL1"===n()?x_.LUMINANCE:x_.RED,type:x_.FLOAT,alignment:1});return[yield t.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_domain;\n  float u_opacity;\n  float u_noDataValue;\n  float u_clampLow;\n  float u_clampHigh;\n};\n\nout vec2 v_texCoord;\n\n#pragma include "projection"\n\nvoid main() {\n  v_texCoord = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n}\n',fragmentShader:"layout(std140) uniform commonUniforms {\n  vec2 u_domain;\n  float u_opacity;\n  float u_noDataValue;\n  float u_clampLow;\n  float u_clampHigh;\n};\n\nuniform sampler2D u_rasterTexture;\nuniform sampler2D u_colorTexture;\n\nin vec2 v_texCoord;\n\nbool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }\n\nout vec4 outputColor;\n\nvoid main() {\n  // Can use any component here since u_rasterTexture is under luminance format.\n  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;\n  if (value == u_noDataValue || isnan_emu(value)) {\n    discard;\n  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {\n    discard;\n  } else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));\n    \n    outputColor = color;\n    outputColor.a = outputColor.a * u_opacity ;\n    if (outputColor.a < 0.01)\n      discard;\n  }\n}\n",defines:t.getDefines(),triangulation:WL,primitive:x_.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]}))()}clearModels(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.colorTexture)||void 0===e||e.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sv.Attribute,descriptor:{shaderLocation:this.attributeLocation.UV,name:"a_Uv",buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:(t,e,r)=>[r[3],r[4]]}})}}const VI=["data"],HI=["rasterData"];var WI={raster:jI,rasterRgb:class extends iL{constructor(...t){super(...t),g_(this,"texture",void 0),g_(this,"dataOption",{})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,noDataValue:e=0}=this.layer.getLayerConfig(),{rMinMax:r=[0,255],gMinMax:n=[0,255],bMinMax:i=[0,255]}=this.dataOption,o={u_rminmax:r,u_gminmax:n,u_bminmax:i,u_opacity:t||1,u_noDataValue:e,u_texture:this.texture};this.textures=[this.texture];return this.getUniformsBufferInfo(o)}getRasterData(t){var e=this;return Ev((function*(){if(Array.isArray(t.data)){const{data:r}=t,n=Ay(t,VI);return e.dataOption=n,v_({data:r},n)}const r=yield t.data,{rasterData:n}=r,i=Ay(r,HI);return e.dataOption=i,Array.isArray(n)?v_({data:n},i):v_({data:Array.from(n)},i)}))()}initModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();const e=t.layer.getSource(),{createTexture2D:r}=t.rendererService,n=e.data.dataArray[0],{data:i,width:o,height:a}=yield t.getRasterData(n);t.texture=r({data:new Float32Array(i),width:o,height:a,format:x_.RGB,type:x_.FLOAT});return[yield t.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_rminmax;\n  vec2 u_gminmax;\n  vec2 u_bminmax;\n  float u_opacity;\n  float u_noDataValue;\n};\n\nout vec2 v_texCoord;\n\n#pragma include "projection"\n\nvoid main() {\n  v_texCoord = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n}\n',fragmentShader:"uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n vec2 u_rminmax;\n vec2 u_gminmax;\n vec2 u_bminmax;\n float u_opacity;\n float u_noDataValue;\n};\n\nin vec2 v_texCoord;\n\nout vec4 outputColor;\n\nvoid main() {\n\n  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;\n\n  if(rgb == vec3(u_noDataValue)) {\n    outputColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);\n  }\n\n  if(outputColor.a < 0.01)\n    discard;\n \n}",defines:t.getDefines(),triangulation:WL,primitive:x_.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]}))()}buildModels(){var t=this;return Ev((function*(){return t.initModels()}))()}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sv.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:(t,e,r)=>[r[3],r[4]]}})}},raster3d:jI,rasterTerrainRgb:class extends iL{constructor(...t){super(...t),g_(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){const{opacity:t,clampLow:e=!0,clampHigh:r=!0,noDataValue:n=-9999999,domain:i,rampColors:o,colorTexture:a,rScaler:s=6553.6,gScaler:l=25.6,bScaler:u=.1,offset:c=1e4}=this.layer.getLayerConfig(),h=i||Fe(o);let p=a;a?this.layer.textureService.setColorTexture(a,o,h):p=this.layer.textureService.getColorTexture(o,h);const d={u_unpack:[s,l,u,c],u_domain:h,u_opacity:t||1,u_noDataValue:n,u_clampLow:e,u_clampHigh:void 0!==r?r:e,u_texture:this.texture,u_colorTexture:p};this.textures=[this.texture,p];return this.getUniformsBufferInfo(d)}initModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();const e=t.layer.getSource(),{createTexture2D:r}=t.rendererService,n=yield e.data.images;t.texture=r({data:n[0],width:n[0].width,height:n[0].height,min:x_.LINEAR,mag:x_.LINEAR});return[yield t.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_unpack;\n  vec2 u_domain;\n  float u_opacity;\n  float u_noDataValue;\n  float u_clampLow;\n  float u_clampHigh;\n};\nout vec2 v_texCoord;\n#pragma include "projection"\n\nvoid main() {\n  v_texCoord = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n}\n',fragmentShader:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nlayout(std140) uniform commonUniforms {\n vec4 u_unpack;\n vec2 u_domain;\n float u_opacity;\n float u_noDataValue;\n float u_clampLow;\n float u_clampHigh;\n};\n\nin vec2 v_texCoord;\nout vec4 outputColor;\n\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;\n    data.a = -1.0;\n    return dot(data, u_unpack);\n}\n\nvec4 getColor(float value) {\n   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec2 coord = vec2(normalisedValue, 0);\n    return  texture(SAMPLER_2D(u_colorTexture), coord);\n}\n\nvoid main() {\n  float value = getElevation(v_texCoord,0.0);\n  if (value == u_noDataValue) {\n    outputColor = vec4(0.0, 0, 0, 0.0);\n  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {\n     outputColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n   \n    outputColor = getColor(value);\n    outputColor.a =  outputColor.a * u_opacity ;\n      if(outputColor.a < 0.01)\n      discard;\n  }\n}\n",defines:t.getDefines(),triangulation:WL,primitive:x_.TRIANGLES,depth:{enable:!1}})]}))()}clearModels(){var t;null===(t=this.texture)||void 0===t||t.destroy()}buildModels(){var t=this;return Ev((function*(){return t.initModels()}))()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:sv.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:x_.DYNAMIC_DRAW,data:[],type:x_.FLOAT},size:2,update:(t,e,r)=>[r[3],r[4]]}})}}};class XI extends TR{constructor(...t){super(...t),g_(this,"type","RasterLayer")}buildModels(){var t=this;return Ev((function*(){const e=t.getModelType();t.layerModel=new WI[e](t),yield t.initLayerModels()}))()}getDefaultConfig(){return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[this.getModelType()]}getModelType(){switch(this.layerSource.getParserType()){case"raster":default:return"raster";case"rasterRgb":case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb"}}getLegend(t){if("color"!==t)return{type:void 0,field:void 0,items:[]};return YL(this.getLayerConfig().rampColors,t)}}class ZI{constructor({rendererService:t,layerService:e,parent:r}){g_(this,"tileResource",new Map),g_(this,"rendererService",void 0),g_(this,"layerService",void 0),g_(this,"parent",void 0),g_(this,"layerTiles",[]),this.rendererService=t,this.layerService=e,this.parent=r}get tiles(){return this.layerTiles}hasTile(t){return this.layerTiles.some((e=>e.key===t))}addTile(t){this.layerTiles.push(t)}getTile(t){return this.layerTiles.find((e=>e.key===t))}getVisibleTileBylngLat(t){return this.layerTiles.find((e=>e.isLoaded&&e.visible&&e.lnglatInBounds(t)))}removeTile(t){const e=this.layerTiles.findIndex((e=>e.key===t)),r=this.layerTiles.splice(e,1);r[0]&&r[0].destroy()}updateTileVisible(t){const e=this.getTile(t.key);if(t.isVisible)if(t.parent){const r=this.isChildrenLoaded(t.parent);null==e||e.updateVisible(r)}else null==e||e.updateVisible(!0);else if(t.parent){const r=this.isChildrenLoaded(t.parent);null==e||e.updateVisible(!r)}else null==e||e.updateVisible(!1)}isParentLoaded(t){const e=t.parent;if(!e)return!0;const r=this.getTile(null==e?void 0:e.key);return!(null==r||!r.isLoaded)}isChildrenLoaded(t){const e=null==t?void 0:t.children;return 0===e.length||e.every((t=>{const e=this.getTile(null==t?void 0:t.key);return!e||!0===(null==e?void 0:e.isLoaded)}))}render(){var t=this;return Ev((function*(){const e=t.getRenderLayers().map(function(){var e=Ev((function*(e){yield t.layerService.renderTileLayer(e)}));return function(t){return e.apply(this,arguments)}}());yield Promise.all(e)}))()}getRenderLayers(){const t=this.layerTiles.filter((t=>t.visible&&t.isLoaded)),e=[];return t.map((t=>e.push(...t.getLayers()))),e}getLayers(){const t=this.layerTiles.filter((t=>t.isLoaded)),e=[];return t.map((t=>e.push(...t.getLayers()))),e}getTiles(){return this.layerTiles}destroy(){this.layerTiles.forEach((t=>t.destroy())),this.tileResource.clear()}}var qI={exports:{}};!function(t,e){t.exports=function(){
/**
         * splaytree v3.1.2
         * Fast Splay tree for Node and browser
         *
         * @author Alexander Milevski <info@w8r.name>
         * @license MIT
         * @preserve
         */
/*! *****************************************************************************
        Copyright (c) Microsoft Corporation. All rights reserved.
        Licensed under the Apache License, Version 2.0 (the "License"); you may not use
        this file except in compliance with the License. You may obtain a copy of the
        License at http://www.apache.org/licenses/LICENSE-2.0

        THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
        KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
        WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
        MERCHANTABLITY OR NON-INFRINGEMENT.

        See the Apache Version 2.0 License for specific language governing permissions
        and limitations under the License.
        ***************************************************************************** */
function t(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(t){return function(e){return l([t,e])}}function l(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}var e=function(){function t(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null}return t}();function r(t,e){return t>e?1:t<e?-1:0}function n(t,r,n){for(var i=new e(null,null),o=i,a=i;;){var s=n(t,r.key);if(s<0){if(null===r.left)break;if(n(t,r.left.key)<0){var l=r.left;if(r.left=l.right,l.right=r,null===(r=l).left)break}a.left=r,a=r,r=r.left}else{if(!(s>0))break;if(null===r.right)break;if(n(t,r.right.key)>0&&(l=r.right,r.right=l.left,l.left=r,null===(r=l).right))break;o.right=r,o=r,r=r.right}}return o.right=r.left,a.left=r.right,r.left=i.right,r.right=i.left,r}function i(t,r,i,o){var a=new e(t,r);if(null===i)return a.left=a.right=null,a;var s=o(t,(i=n(t,i,o)).key);return s<0?(a.left=i.left,a.right=i,i.left=null):s>=0&&(a.right=i.right,a.left=i,i.right=null),a}function o(t,e,r){var i=null,o=null;if(e){var a=r((e=n(t,e,r)).key,t);0===a?(i=e.left,o=e.right):a<0?(o=e.right,e.right=null,i=e):(i=e.left,e.left=null,o=e)}return{left:i,right:o}}function a(t,e,r){return null===e?t:(null===t||((e=n(t.key,e,r)).left=t),e)}function s(t,e,r,n,i){if(t){n(e+(r?"└── ":"├── ")+i(t)+"\n");var o=e+(r?"    ":"│   ");t.left&&s(t.left,o,!1,n,i),t.right&&s(t.right,o,!0,n,i)}}var l=function(){function l(t){void 0===t&&(t=r),this._root=null,this._size=0,this._comparator=t}return l.prototype.insert=function(t,e){return this._size++,this._root=i(t,e,this._root,this._comparator)},l.prototype.add=function(t,r){var i=new e(t,r);null===this._root&&(i.left=i.right=null,this._size++,this._root=i);var o=this._comparator,a=n(t,this._root,o),s=o(t,a.key);return 0===s?this._root=a:(s<0?(i.left=a.left,i.right=a,a.left=null):s>0&&(i.right=a.right,i.left=a,a.right=null),this._size++,this._root=i),this._root},l.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},l.prototype._remove=function(t,e,r){var i;return null===e?null:0===r(t,(e=n(t,e,r)).key)?(null===e.left?i=e.right:(i=n(t,e.left,r)).right=e.right,this._size--,i):e},l.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=n(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},l.prototype.findStatic=function(t){for(var e=this._root,r=this._comparator;e;){var n=r(t,e.key);if(0===n)return e;e=n<0?e.left:e.right}return null},l.prototype.find=function(t){return this._root&&(this._root=n(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},l.prototype.contains=function(t){for(var e=this._root,r=this._comparator;e;){var n=r(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1},l.prototype.forEach=function(t,e){for(var r=this._root,n=[],i=!1;!i;)null!==r?(n.push(r),r=r.left):0!==n.length?(r=n.pop(),t.call(e,r),r=r.right):i=!0;return this},l.prototype.range=function(t,e,r,n){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,e)>0)break;if(o(a.key,t)>=0&&r.call(n,a))return this;a=a.right}return this},l.prototype.keys=function(){var t=[];return this.forEach((function(e){var r=e.key;return t.push(r)})),t},l.prototype.values=function(){var t=[];return this.forEach((function(e){var r=e.data;return t.push(r)})),t},l.prototype.min=function(){return this._root?this.minNode(this._root).key:null},l.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},l.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},l.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},l.prototype.at=function(t){for(var e=this._root,r=!1,n=0,i=[];!r;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),n===t)return e;n++,e=e.right}else r=!0;return null},l.prototype.next=function(t){var e=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}for(var n=this._comparator;e;){var i=n(t.key,e.key);if(0===i)break;i<0?(r=e,e=e.left):e=e.right}return r},l.prototype.prev=function(t){var e=this._root,r=null;if(null!==t.left){for(r=t.left;r.right;)r=r.right;return r}for(var n=this._comparator;e;){var i=n(t.key,e.key);if(0===i)break;i<0?e=e.left:(r=e,e=e.right)}return r},l.prototype.clear=function(){return this._root=null,this._size=0,this},l.prototype.toList=function(){return h(this._root)},l.prototype.load=function(t,e,r){void 0===e&&(e=[]),void 0===r&&(r=!1);var n=t.length,i=this._comparator;if(r&&f(t,e,0,n-1,i),null===this._root)this._root=u(t,e,0,n),this._size=n;else{var o=d(this.toList(),c(t,e),i);n=this._size+n,this._root=p({head:o},0,n)}return this},l.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(l.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),l.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return s(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},l.prototype.update=function(t,e,r){var n=this._comparator,s=o(t,this._root,n),l=s.left,u=s.right;n(t,e)<0?u=i(e,r,u,n):l=i(e,r,l,n),this._root=a(l,u,n)},l.prototype.split=function(t){return o(t,this._root,this._comparator)},l.prototype[Symbol.iterator]=function(){var e,r,n;return t(this,(function(t){switch(t.label){case 0:e=this._root,r=[],n=!1,t.label=1;case 1:return n?[3,6]:null===e?[3,2]:(r.push(e),e=e.left,[3,5]);case 2:return 0===r.length?[3,4]:[4,e=r.pop()];case 3:return t.sent(),e=e.right,[3,5];case 4:n=!0,t.label=5;case 5:return[3,1];case 6:return[2]}}))},l}();function u(t,r,n,i){var o=i-n;if(o>0){var a=n+Math.floor(o/2),s=t[a],l=r[a],c=new e(s,l);return c.left=u(t,r,n,a),c.right=u(t,r,a+1,i),c}return null}function c(t,r){for(var n=new e(null,null),i=n,o=0;o<t.length;o++)i=i.next=new e(t[o],r[o]);return i.next=null,n.next}function h(t){for(var r=t,n=[],i=!1,o=new e(null,null),a=o;!i;)r?(n.push(r),r=r.left):n.length>0?r=(r=a=a.next=n.pop()).right:i=!0;return a.next=null,o.next}function p(t,e,r){var n=r-e;if(n>0){var i=e+Math.floor(n/2),o=p(t,e,i),a=t.head;return a.left=o,t.head=t.head.next,a.right=p(t,i+1,r),a}return null}function d(t,r,n){for(var i=new e(null,null),o=i,a=t,s=r;null!==a&&null!==s;)n(a.key,s.key)<0?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),i.next}function f(t,e,r,n,i){if(!(r>=n)){for(var o=t[r+n>>1],a=r-1,s=n+1;;){do{a++}while(i(t[a],o)<0);do{s--}while(i(t[s],o)>0);if(a>=s)break;var l=t[a];t[a]=t[s],t[s]=l,l=e[a],e[a]=e[s],e[s]=l}f(t,e,r,s,i),f(t,e,s+1,n,i)}}const m=(t,e)=>t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y,g=(t,e)=>{if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;const r=t.ll.x<e.ll.x?e.ll.x:t.ll.x,n=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:r,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:n,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}};let _=Number.EPSILON;void 0===_&&(_=Math.pow(2,-52));const v=_*_,y=(t,e)=>{if(-_<t&&t<_&&-_<e&&e<_)return 0;const r=t-e;return r*r<v*t*e?0:t<e?-1:1};class x{constructor(){this.reset()}reset(){this.xRounder=new b,this.yRounder=new b}round(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}class b{constructor(){this.tree=new l,this.round(0)}round(t){const e=this.tree.add(t),r=this.tree.prev(e);if(null!==r&&0===y(e.key,r.key))return this.tree.remove(t),r.key;const n=this.tree.next(e);return null!==n&&0===y(e.key,n.key)?(this.tree.remove(t),n.key):t}}const E=new x,T=11102230246251565e-32,S=134217729,A=(3+8*T)*T;function w(t,e,r,n,i){let o,a,s,l,u=e[0],c=n[0],h=0,p=0;c>u==c>-u?(o=u,u=e[++h]):(o=c,c=n[++p]);let d=0;if(h<t&&p<r)for(c>u==c>-u?(a=u+o,s=o-(a-u),u=e[++h]):(a=c+o,s=o-(a-c),c=n[++p]),o=a,0!==s&&(i[d++]=s);h<t&&p<r;)c>u==c>-u?(a=o+u,l=a-o,s=o-(a-l)+(u-l),u=e[++h]):(a=o+c,l=a-o,s=o-(a-l)+(c-l),c=n[++p]),o=a,0!==s&&(i[d++]=s);for(;h<t;)a=o+u,l=a-o,s=o-(a-l)+(u-l),u=e[++h],o=a,0!==s&&(i[d++]=s);for(;p<r;)a=o+c,l=a-o,s=o-(a-l)+(c-l),c=n[++p],o=a,0!==s&&(i[d++]=s);return 0===o&&0!==d||(i[d++]=o),d}function C(t,e){let r=e[0];for(let n=1;n<t;n++)r+=e[n];return r}function R(t){return new Float64Array(t)}const L=(3+16*T)*T,I=(2+12*T)*T,M=(9+64*T)*T*T,O=R(4),P=R(8),D=R(12),B=R(16),N=R(4);function F(t,e,r,n,i,o,a){let s,l,u,c,h,p,d,f,m,g,_,v,y,x,b,E,T,R;const L=t-i,F=r-i,k=e-o,U=n-o;x=L*U,p=S*L,d=p-(p-L),f=L-d,p=S*U,m=p-(p-U),g=U-m,b=f*g-(x-d*m-f*m-d*g),E=k*F,p=S*k,d=p-(p-k),f=k-d,p=S*F,m=p-(p-F),g=F-m,T=f*g-(E-d*m-f*m-d*g),_=b-T,h=b-_,O[0]=b-(_+h)+(h-T),v=x+_,h=v-x,y=x-(v-h)+(_-h),_=y-E,h=y-_,O[1]=y-(_+h)+(h-E),R=v+_,h=R-v,O[2]=v-(R-h)+(_-h),O[3]=R;let z=C(4,O),G=I*a;if(z>=G||-z>=G)return z;if(h=t-L,s=t-(L+h)+(h-i),h=r-F,u=r-(F+h)+(h-i),h=e-k,l=e-(k+h)+(h-o),h=n-U,c=n-(U+h)+(h-o),0===s&&0===l&&0===u&&0===c)return z;if(G=M*a+A*Math.abs(z),z+=L*c+U*s-(k*u+F*l),z>=G||-z>=G)return z;x=s*U,p=S*s,d=p-(p-s),f=s-d,p=S*U,m=p-(p-U),g=U-m,b=f*g-(x-d*m-f*m-d*g),E=l*F,p=S*l,d=p-(p-l),f=l-d,p=S*F,m=p-(p-F),g=F-m,T=f*g-(E-d*m-f*m-d*g),_=b-T,h=b-_,N[0]=b-(_+h)+(h-T),v=x+_,h=v-x,y=x-(v-h)+(_-h),_=y-E,h=y-_,N[1]=y-(_+h)+(h-E),R=v+_,h=R-v,N[2]=v-(R-h)+(_-h),N[3]=R;const j=w(4,O,4,N,P);x=L*c,p=S*L,d=p-(p-L),f=L-d,p=S*c,m=p-(p-c),g=c-m,b=f*g-(x-d*m-f*m-d*g),E=k*u,p=S*k,d=p-(p-k),f=k-d,p=S*u,m=p-(p-u),g=u-m,T=f*g-(E-d*m-f*m-d*g),_=b-T,h=b-_,N[0]=b-(_+h)+(h-T),v=x+_,h=v-x,y=x-(v-h)+(_-h),_=y-E,h=y-_,N[1]=y-(_+h)+(h-E),R=v+_,h=R-v,N[2]=v-(R-h)+(_-h),N[3]=R;const V=w(j,P,4,N,D);x=s*c,p=S*s,d=p-(p-s),f=s-d,p=S*c,m=p-(p-c),g=c-m,b=f*g-(x-d*m-f*m-d*g),E=l*u,p=S*l,d=p-(p-l),f=l-d,p=S*u,m=p-(p-u),g=u-m,T=f*g-(E-d*m-f*m-d*g),_=b-T,h=b-_,N[0]=b-(_+h)+(h-T),v=x+_,h=v-x,y=x-(v-h)+(_-h),_=y-E,h=y-_,N[1]=y-(_+h)+(h-E),R=v+_,h=R-v,N[2]=v-(R-h)+(_-h),N[3]=R;const H=w(V,D,4,N,B);return B[H-1]}function k(t,e,r,n,i,o){const a=(e-o)*(r-i),s=(t-i)*(n-o),l=a-s,u=Math.abs(a+s);return Math.abs(l)>=L*u?l:-F(t,e,r,n,i,o,u)}const U=(t,e)=>t.x*e.y-t.y*e.x,z=(t,e)=>t.x*e.x+t.y*e.y,G=(t,e,r)=>{const n=k(t.x,t.y,e.x,e.y,r.x,r.y);return n>0?-1:n<0?1:0},j=t=>Math.sqrt(z(t,t)),V=(t,e,r)=>{const n={x:e.x-t.x,y:e.y-t.y},i={x:r.x-t.x,y:r.y-t.y};return U(i,n)/j(i)/j(n)},H=(t,e,r)=>{const n={x:e.x-t.x,y:e.y-t.y},i={x:r.x-t.x,y:r.y-t.y};return z(i,n)/j(i)/j(n)},W=(t,e,r)=>0===e.y?null:{x:t.x+e.x/e.y*(r-t.y),y:r},X=(t,e,r)=>0===e.x?null:{x:r,y:t.y+e.y/e.x*(r-t.x)},Z=(t,e,r,n)=>{if(0===e.x)return X(r,n,t.x);if(0===n.x)return X(t,e,r.x);if(0===e.y)return W(r,n,t.y);if(0===n.y)return W(t,e,r.y);const i=U(e,n);if(0==i)return null;const o={x:r.x-t.x,y:r.y-t.y},a=U(o,e)/i,s=U(o,n)/i;return{x:(t.x+s*e.x+(r.x+a*n.x))/2,y:(t.y+s*e.y+(r.y+a*n.y))/2}};class q{static compare(t,e){const r=q.comparePoints(t.point,e.point);return 0!==r?r:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:K.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}constructor(t,e){void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let t=0,r=e.length;t<r;t++){const r=e[t];this.point.events.push(r),r.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const r=this.point.events[e];if(void 0===r.segment.consumedBy)for(let n=e+1;n<t;n++){const t=this.point.events[n];void 0===t.consumedBy&&r.otherSE.point.events===t.otherSE.point.events&&r.segment.consume(t.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,r=this.point.events.length;e<r;e++){const r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}getLeftmostComparator(t){const e=new Map,r=r=>{const n=r.otherSE;e.set(r,{sine:V(this.point,t.point,n.point),cosine:H(this.point,t.point,n.point)})};return(t,n)=>{e.has(t)||r(t),e.has(n)||r(n);const{sine:i,cosine:o}=e.get(t),{sine:a,cosine:s}=e.get(n);return i>=0&&a>=0?o<s?1:o>s?-1:0:i<0&&a<0?o<s?-1:o>s?1:0:a<i?-1:a>i?1:0}}}let Y=0;class K{static compare(t,e){const r=t.leftSE.point.x,n=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<r)return 1;if(i<n)return-1;const a=t.leftSE.point.y,s=e.leftSE.point.y,l=t.rightSE.point.y,u=e.rightSE.point.y;if(r<n){if(s<a&&s<l)return 1;if(s>a&&s>l)return-1;const r=t.comparePoint(e.leftSE.point);if(r<0)return 1;if(r>0)return-1;const n=e.comparePoint(t.rightSE.point);return 0!==n?n:-1}if(r>n){if(a<s&&a<u)return-1;if(a>s&&a>u)return 1;const r=e.comparePoint(t.leftSE.point);if(0!==r)return r;const n=t.comparePoint(e.rightSE.point);return n<0?1:n>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){const r=e.comparePoint(t.rightSE.point);if(0!==r)return r}if(i>o){const r=t.comparePoint(e.rightSE.point);if(r<0)return 1;if(r>0)return-1}if(i!==o){const t=l-a,e=i-r,c=u-s,h=o-n;if(t>e&&c<h)return 1;if(t<e&&c>h)return-1}return i>o?1:i<o||l<u?-1:l>u?1:t.id<e.id?-1:t.id>e.id?1:0}constructor(t,e,r,n){this.id=++Y,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=r,this.windings=n}static fromRing(t,e,r){let n,i,o;const a=q.comparePoints(t,e);if(a<0)n=t,i=e,o=1;else{if(!(a>0))throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);n=e,i=t,o=-1}const s=new q(n,!0),l=new q(i,!1);return new K(s,l,[r],[o])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const e=this.leftSE.point,r=this.rightSE.point,n=this.vector();if(e.x===r.x)return t.x===e.x?0:t.x<e.x?1:-1;const i=(t.y-e.y)/n.y,o=e.x+i*n.x;if(t.x===o)return 0;const a=(t.x-e.x)/n.x,s=e.y+a*n.y;return t.y===s?0:t.y<s?-1:1}getIntersection(t){const e=this.bbox(),r=t.bbox(),n=g(e,r);if(null===n)return null;const i=this.leftSE.point,o=this.rightSE.point,a=t.leftSE.point,s=t.rightSE.point,l=m(e,a)&&0===this.comparePoint(a),u=m(r,i)&&0===t.comparePoint(i),c=m(e,s)&&0===this.comparePoint(s),h=m(r,o)&&0===t.comparePoint(o);if(u&&l)return h&&!c?o:!h&&c?s:null;if(u)return c&&i.x===s.x&&i.y===s.y?null:i;if(l)return h&&o.x===a.x&&o.y===a.y?null:a;if(h&&c)return null;if(h)return o;if(c)return s;const p=Z(i,this.vector(),a,t.vector());return null===p?null:m(n,p)?E.round(p.x,p.y):null}split(t){const e=[],r=void 0!==t.events,n=new q(t,!0),i=new q(t,!1),o=this.rightSE;this.replaceRightSE(i),e.push(i),e.push(n);const a=new K(n,o,this.rings.slice(),this.windings.slice());return q.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),q.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(n.checkForConsuming(),i.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,e=this.windings.length;t<e;t++)this.windings[t]*=-1}consume(t){let e=this,r=t;for(;e.consumedBy;)e=e.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const n=K.compare(e,r);if(0!==n){if(n>0){const t=e;e=r,r=t}if(e.prev===r){const t=e;e=r,r=t}for(let t=0,n=r.rings.length;t<n;t++){const n=r.rings[t],i=r.windings[t],o=e.rings.indexOf(n);-1===o?(e.rings.push(n),e.windings.push(i)):e.windings[o]+=i}r.rings=null,r.windings=null,r.consumedBy=e,r.leftSE.consumedBy=e.leftSE,r.rightSE.consumedBy=e.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,r=this._afterState.windings,n=this._afterState.multiPolys;for(let t=0,n=this.rings.length;t<n;t++){const n=this.rings[t],i=this.windings[t],o=e.indexOf(n);-1===o?(e.push(n),r.push(i)):r[o]+=i}const i=[],o=[];for(let t=0,n=e.length;t<n;t++){if(0===r[t])continue;const n=e[t],a=n.poly;if(-1===o.indexOf(a))if(n.isExterior)i.push(a);else{-1===o.indexOf(a)&&o.push(a);const t=i.indexOf(n.poly);-1!==t&&i.splice(t,1)}}for(let t=0,e=i.length;t<e;t++){const e=i[t].multiPoly;-1===n.indexOf(e)&&n.push(e)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(st.type){case"union":{const r=0===t.length,n=0===e.length;this._isInResult=r!==n;break}case"intersection":{let r,n;t.length<e.length?(r=t.length,n=e.length):(r=e.length,n=t.length),this._isInResult=n===st.numMultiPolys&&r<n;break}case"xor":{const r=Math.abs(t.length-e.length);this._isInResult=r%2==1;break}case"difference":{const r=t=>1===t.length&&t[0].isSubject;this._isInResult=r(t)!==r(e);break}default:throw new Error(`Unrecognized operation type found ${st.type}`)}return this._isInResult}}class ${constructor(t,e,r){if(!Array.isArray(t)||0===t.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=r,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const n=E.round(t[0][0],t[0][1]);this.bbox={ll:{x:n.x,y:n.y},ur:{x:n.x,y:n.y}};let i=n;for(let e=1,r=t.length;e<r;e++){if("number"!=typeof t[e][0]||"number"!=typeof t[e][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let r=E.round(t[e][0],t[e][1]);r.x===i.x&&r.y===i.y||(this.segments.push(K.fromRing(i,r,this)),r.x<this.bbox.ll.x&&(this.bbox.ll.x=r.x),r.y<this.bbox.ll.y&&(this.bbox.ll.y=r.y),r.x>this.bbox.ur.x&&(this.bbox.ur.x=r.x),r.y>this.bbox.ur.y&&(this.bbox.ur.y=r.y),i=r)}n.x===i.x&&n.y===i.y||this.segments.push(K.fromRing(i,n,this))}getSweepEvents(){const t=[];for(let e=0,r=this.segments.length;e<r;e++){const r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}class Q{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new $(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,r=t.length;e<r;e++){const r=new $(t[e],this,!1);r.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=r.bbox.ur.y),this.interiorRings.push(r)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,r=this.interiorRings.length;e<r;e++){const r=this.interiorRings[e].getSweepEvents();for(let e=0,n=r.length;e<n;e++)t.push(r[e])}return t}}class J{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let e=0,r=t.length;e<r;e++){const r=new Q(t[e],this);r.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=r.bbox.ur.y),this.polys.push(r)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,r=this.polys.length;e<r;e++){const r=this.polys[e].getSweepEvents();for(let e=0,n=r.length;e<n;e++)t.push(r[e])}return t}}class tt{static factory(t){const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];if(!n.isInResult()||n.ringOut)continue;let i=null,o=n.leftSE,a=n.rightSE;const s=[o],l=o.point,u=[];for(;i=o,o=a,s.push(o),o.point!==l;)for(;;){const t=o.getAvailableLinkedEvents();if(0===t.length){const t=s[0].point,e=s[s.length-1].point;throw new Error(`Unable to complete output ring starting at [${t.x}, ${t.y}]. Last matching segment found ends at [${e.x}, ${e.y}].`)}if(1===t.length){a=t[0].otherSE;break}let r=null;for(let t=0,e=u.length;t<e;t++)if(u[t].point===o.point){r=t;break}if(null!==r){const t=u.splice(r)[0],n=s.splice(t.index);n.unshift(n[0].otherSE),e.push(new tt(n.reverse()));continue}u.push({index:s.length,point:o.point});const n=o.getLeftmostComparator(i);a=t.sort(n)[0].otherSE;break}e.push(new tt(s))}return e}constructor(t){this.events=t;for(let e=0,r=t.length;e<r;e++)t[e].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const e=[t];for(let r=1,n=this.events.length-1;r<n;r++){const n=this.events[r].point,i=this.events[r+1].point;0!==G(n,t,i)&&(e.push(n),t=n)}if(1===e.length)return null;const r=e[0],n=e[1];0===G(r,t,n)&&e.shift(),e.push(e[0]);const i=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:e.length-1,a=this.isExteriorRing()?e.length:-1,s=[];for(let t=o;t!=a;t+=i)s.push([e[t].x,e[t].y]);return s}isExteriorRing(){if(void 0===this._isExteriorRing){const t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let e=1,r=this.events.length;e<r;e++){const r=this.events[e];q.compare(t,r)>0&&(t=r)}let e=t.segment.prevInResult(),r=e?e.prevInResult():null;for(;;){if(!e)return null;if(!r)return e.ringOut;if(r.ringOut!==e.ringOut)return r.ringOut.enclosingRing()!==e.ringOut?e.ringOut:e.ringOut.enclosingRing();e=r.prevInResult(),r=e?e.prevInResult():null}}}class et{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(let e=0,r=this.interiorRings.length;e<r;e++){const r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}class rt{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,r=this.polys.length;e<r;e++){const r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}_composePolys(t){const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];if(!n.poly)if(n.isExteriorRing())e.push(new et(n));else{const t=n.enclosingRing();t.poly||e.push(new et(t)),t.poly.addInterior(n)}}return e}}class nt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K.compare;this.queue=t,this.tree=new l(e),this.segments=[]}process(t){const e=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),r;const n=t.isLeft?this.tree.add(e):this.tree.find(e);if(!n)throw new Error(`Unable to find segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] in SweepLine tree.`);let i,o,a=n,s=n;for(;void 0===i;)a=this.tree.prev(a),null===a?i=null:void 0===a.key.consumedBy&&(i=a.key);for(;void 0===o;)s=this.tree.next(s),null===s?o=null:void 0===s.key.consumedBy&&(o=s.key);if(t.isLeft){let n=null;if(i){const t=i.getIntersection(e);if(null!==t&&(e.isAnEndpoint(t)||(n=t),!i.isAnEndpoint(t))){const e=this._splitSafely(i,t);for(let t=0,n=e.length;t<n;t++)r.push(e[t])}}let a=null;if(o){const t=o.getIntersection(e);if(null!==t&&(e.isAnEndpoint(t)||(a=t),!o.isAnEndpoint(t))){const e=this._splitSafely(o,t);for(let t=0,n=e.length;t<n;t++)r.push(e[t])}}if(null!==n||null!==a){let t=null;t=null===n?a:null===a||q.comparePoints(n,a)<=0?n:a,this.queue.remove(e.rightSE),r.push(e.rightSE);const i=e.split(t);for(let t=0,e=i.length;t<e;t++)r.push(i[t])}r.length>0?(this.tree.remove(e),r.push(t)):(this.segments.push(e),e.prev=i)}else{if(i&&o){const t=i.getIntersection(o);if(null!==t){if(!i.isAnEndpoint(t)){const e=this._splitSafely(i,t);for(let t=0,n=e.length;t<n;t++)r.push(e[t])}if(!o.isAnEndpoint(t)){const e=this._splitSafely(o,t);for(let t=0,n=e.length;t<n;t++)r.push(e[t])}}}this.tree.remove(e)}return r}_splitSafely(t,e){this.tree.remove(t);const r=t.rightSE;this.queue.remove(r);const n=t.split(e);return n.push(r),void 0===t.consumedBy&&this.tree.add(t),n}}const it="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ot="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class at{run(t,e,r){st.type=t,E.reset();const n=[new J(e,!0)];for(let t=0,e=r.length;t<e;t++)n.push(new J(r[t],!1));if(st.numMultiPolys=n.length,"difference"===st.type){const t=n[0];let e=1;for(;e<n.length;)null!==g(n[e].bbox,t.bbox)?e++:n.splice(e,1)}if("intersection"===st.type)for(let t=0,e=n.length;t<e;t++){const e=n[t];for(let r=t+1,i=n.length;r<i;r++)if(null===g(e.bbox,n[r].bbox))return[]}const i=new l(q.compare);for(let t=0,e=n.length;t<e;t++){const e=n[t].getSweepEvents();for(let t=0,r=e.length;t<r;t++)if(i.insert(e[t]),i.size>it)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const o=new nt(i);let a=i.size,s=i.pop();for(;s;){const t=s.key;if(i.size===a){const e=t.segment;throw new Error(`Unable to pop() ${t.isLeft?"left":"right"} SweepEvent [${t.point.x}, ${t.point.y}] from segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] from queue.`)}if(i.size>it)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(o.segments.length>ot)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const e=o.process(t);for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0===r.consumedBy&&i.insert(r)}a=i.size,s=i.pop()}E.reset();const u=tt.factory(o.segments);return new rt(u).getGeom()}}const st=new at,lt=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return st.run("union",t,r)},ut=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return st.run("intersection",t,r)},ct=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return st.run("xor",t,r)},ht=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return st.run("difference",t,r)};var pt={union:lt,intersection:ut,xor:ct,difference:ht};return pt}()}(qI);var YI=qI.exports;function KI(t,e,r){void 0===r&&(r={});var n=Mt(t),i=Mt(e),o=YI.union(n.coordinates,i.coordinates);return 0===o.length?null:1===o.length?Ct(o[0],r.properties):function(t,e,r){return void 0===r&&(r={}),wt({type:"MultiPolygon",coordinates:t},e,r)}(o,r.properties)}class $I{getCombineFeature(t){let e=null;const r=t[0];return t.map((t=>{const r=Ct(t.coordinates);e=null===e?r:KI(e,r)})),r&&(e.properties=v_({},r)),e}}const QI="select",JI="active";class tM{constructor({layerService:t,tileLayerService:e,parent:r}){g_(this,"layerService",void 0),g_(this,"tileLayerService",void 0),g_(this,"tileSourceService",void 0),g_(this,"parent",void 0),g_(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=e,this.parent=r,this.tileSourceService=new $I}pickRender(t){const e=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(e){const r=e.getMainLayer();null==r||r.layerPickService.pickRender(t)}}pick(t,e){var r=this;return Ev((function*(){const n=r.parent.getContainer().pickingService;if("RasterLayer"===t.type){const t=r.tileLayerService.getVisibleTileBylngLat(e.lngLat);if(t&&void 0!==t.getMainLayer()){const n=t.getMainLayer();return n.layerPickService.pickRasterLayer(n,e,r.parent)}return!1}return r.pickRender(e),n.pickFromPickingFBO(t,e)}))()}selectFeature(t){const[e,r,n]=t,i=this.color2PickId(e,r,n);this.tilePickID.set(QI,i),this.updateHighLight(e,r,n,QI)}highlightPickedFeature(t){const[e,r,n]=t,i=this.color2PickId(e,r,n);this.tilePickID.set(JI,i),this.updateHighLight(e,r,n,JI)}updateHighLight(t,e,r,n){this.tileLayerService.tiles.map((i=>{const o=i.getMainLayer();switch(n){case QI:null==o||o.hooks.beforeSelect.call([t,e,r]);break;case JI:null==o||o.hooks.beforeHighlight.call([t,e,r])}}))}setPickState(){const t=this.tilePickID.get(QI),e=this.tilePickID.get(JI);if(t){const[e,r,n]=this.pickId2Color(t);this.updateHighLight(e,r,n,QI)}else if(e){const[t,r,n]=this.pickId2Color(e);this.updateHighLight(t,r,n,JI)}else;}color2PickId(t,e,r){return Pe(new Uint8Array([t,e,r]))}pickId2Color(t){return De(t)}getFeatureById(t){const e=this.tileLayerService.getTiles().filter((t=>t.visible)),r=[];return e.forEach((e=>{r.push(...e.getFeatureById(t))})),r}pickRasterLayer(){return!1}}class eM extends Vd.exports.EventEmitter{constructor(t,e){super(),g_(this,"x",void 0),g_(this,"y",void 0),g_(this,"z",void 0),g_(this,"key",void 0),g_(this,"parent",void 0),g_(this,"sourceTile",void 0),g_(this,"visible",!0),g_(this,"layers",[]),g_(this,"isLoaded",!1),g_(this,"tileMaskLayers",[]),g_(this,"tileMask",void 0),this.parent=e,this.sourceTile=t,this.x=t.x,this.y=t.y,this.z=t.z,this.key=`${this.x}_${this.y}_${this.z}`}getLayers(){return this.layers}styleUpdate(...t){}lnglatInBounds(t){const[e,r,n,i]=this.sourceTile.bounds,{lng:o,lat:a}=t;return o>=e&&o<=n&&a>=r&&a<=i}getLayerOptions(){var t;const e=this.parent.getLayerConfig();return v_(v_({},e),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:(r=this.parent.type,-1!==["PolygonLayer","LineLayer"].indexOf(r)),mask:e.mask||0!==(null===(t=e.maskLayers)||void 0===t?void 0:t.length)&&e.enableMask});var r}getMaskLayer(){const{maskLayers:t}=this.parent.getLayerConfig(),e=[];return null==t||t.forEach((t=>{if(!t.tileLayer)return e.push(t),t;const r=t.tileLayer.getTile(this.sourceTile.key),n=null==r?void 0:r.getLayers()[0];n&&e.push(n)})),e}addTileMask(){var t=this;return Ev((function*(){const e=new GI({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[t.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),r=Tb(t.parent.container);e.setContainer(r),yield e.init(),t.tileMask=e;const n=t.getMainLayer();return void 0!==n&&(n.tileMask=e),e}))()}addMask(t,e){var r=this;return Ev((function*(){const n=Tb(r.parent.container);e.setContainer(n),yield e.init(),t.addMask(e),r.tileMaskLayers.push(e)}))()}addLayer(t){var e=this;return Ev((function*(){t.isTileLayer=!0;const r=Tb(e.parent.container);t.setContainer(r),e.layers.push(t),yield t.init()}))()}updateVisible(t){this.visible=t,this.updateOptions("visible",t)}updateOptions(t,e){this.layers.forEach((r=>{r.updateLayerConfig({[t]:e})}))}getMainLayer(){return this.layers[0]}getFeatures(t){return[]}getFeatureById(t){return[]}destroy(){var t;null===(t=this.tileMask)||void 0===t||t.destroy(),this.layers.forEach((t=>t.destroy()))}}class rM extends eM{initTileLayer(){var t=this;return Ev((function*(){const e=t.getSourceOption(),r=e.data.features[0].properties,n=(new gI).source(e.data,e.options).size(1).shape("line").color("red"),i=new FI({minZoom:t.z-1,maxZoom:t.z+1,textAllowOverlap:!0}).source([r],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(t.key).style({stroke:"#fff",strokeWidth:2});yield t.addLayer(n),yield t.addLayer(i),t.isLoaded=!0}))()}getSourceOption(){const t=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:t.transforms}}}}class nM extends eM{initTileLayer(){var t=this;return Ev((function*(){const e=t.parent.getLayerAttributeConfig(),r=t.getLayerOptions(),n=t.getSourceOption(),i=new nI(v_({},r)).source(n.data,n.options);e&&Object.keys(e).forEach((t=>{var r,n;const o=t;i[o](null===(r=e[o])||void 0===r?void 0:r.field,null===(n=e[o])||void 0===n?void 0:n.values)})),yield t.addLayer(i),t.isLoaded=!0}))()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const iM={fill:class extends iL{getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),v_(v_({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,color:e="#000"}=this.layer.getLayerConfig(),r={u_color:Oe(e),u_opacity:t||1};return this.getUniformsBufferInfo(r)}initModels(){var t=this;return Ev((function*(){return t.buildModels()}))()}buildModels(){var t=this;return Ev((function*(){t.initUniformsBuffer();return[yield t.layer.buildLayerModel({moduleName:"mask",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_color;\n  float u_opacity;\n};\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n\n',fragmentShader:"layout(std140) uniform commonUniorm {\n  vec4 u_color;\n  float u_opacity;\n};\n\nout vec4 outputColor;\n\nvoid main() {\n  outputColor = u_color;\n  outputColor.a *= u_opacity;\n}\n",defines:t.getDefines(),triangulation:zL,depth:{enable:!1},pick:!1})]}))()}clearModels(t=!0){t&&this.layerService.clear()}registerBuiltinAttributes(){return""}}};var oM=iM;class aM extends TR{constructor(...t){super(...t),g_(this,"type","MaskLayer")}buildModels(){var t=this;return Ev((function*(){const e=t.getModelType();t.layerModel=new oM[e](t),yield t.initLayerModels()}))()}getModelType(){return"fill"}}class sM extends eM{initTileLayer(){var t=this;return Ev((function*(){const e=t.parent.getLayerAttributeConfig(),r=t.getLayerOptions(),n=t.getSourceOption(),i=new aM(v_({},r)).source(n.data,n.options);e&&Object.keys(e).forEach((t=>{var r,n;const o=t;i[o](null===(r=e[o])||void 0===r?void 0:r.field,null===(n=e[o])||void 0===n?void 0:n.values)})),yield t.addLayer(i),t.isLoaded=!0}))()}getFeatures(t){if(!t)return[];return this.sourceTile.data.getTileData(t)}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:e,featureId:r}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(e)},options:{parser:{type:"geojson",featureId:r},transforms:t.transforms}}}}const lM=["rasterData"];class uM extends eM{initTileLayer(){var t=this;return Ev((function*(){const e=t.parent.getLayerAttributeConfig(),r=t.getLayerOptions(),n=t.getSourceOption(),i=new XI(v_({},r)).source(n.data,n.options);e&&Object.keys(e).forEach((t=>{var r,n;const o=t;i[o](null===(r=e[o])||void 0===r?void 0:r.field,null===(n=e[o])||void 0===n?void 0:n.values)})),yield t.addLayer(i),t.isLoaded=!0}))()}getSourceOption(){const t=this.parent.getSource(),e=this.sourceTile.data.data,{rasterData:r}=e,n=Ay(e,lM);return{data:r,options:{parser:v_({type:"rasterRgb",extent:this.sourceTile.bounds},n),transforms:t.transforms}}}}class cM extends eM{initTileLayer(){var t=this;return Ev((function*(){const e=t.parent.getLayerAttributeConfig(),r=t.getLayerOptions(),n=t.getSourceOption(),i=new XI(v_({},r)).source(n.data,n.options);e&&Object.keys(e).forEach((t=>{var r,n;const o=t;i[o](null===(r=e[o])||void 0===r?void 0:r.field,null===(n=e[o])||void 0===n?void 0:n.values)})),yield t.addLayer(i),t.isLoaded=!0}))()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const hM=["rasterData"],pM={positions:[0,1],colors:["#000","#fff"]};class dM extends eM{constructor(...t){super(...t),g_(this,"colorTexture",void 0)}initTileLayer(){var t=this;return Ev((function*(){const e=t.parent.getLayerAttributeConfig(),r=t.getLayerOptions(),n=t.getSourceOption(),{rampColors:i,domain:o}=t.getLayerOptions();t.colorTexture=t.parent.textureService.getColorTexture(i,o);const a=new XI(v_(v_({},r),{},{colorTexture:t.colorTexture})).source(n.data,n.options);e&&Object.keys(e).forEach((t=>{var r,n;const i=t;a[i](null===(r=e[i])||void 0===r?void 0:r.field,null===(n=e[i])||void 0===n?void 0:n.values)})),yield t.addLayer(a),t.isLoaded=!0}))()}getSourceOption(){const t=this.parent.getSource(),e=this.sourceTile.data.data,{rasterData:r}=e,n=Ay(e,hM);return{data:r,options:{parser:v_({type:"raster",extent:this.sourceTile.bounds},n),transforms:t.transforms}}}styleUpdate(...t){const{rampColors:e=pM,domain:r}=t;this.colorTexture=this.parent.textureService.getColorTexture(e,r||Fe(e)),this.layers.forEach((t=>t.style({colorTexture:this.colorTexture})))}destroy(){this.layers.forEach((t=>t.destroy()))}}class fM extends eM{initTileLayer(){var t=this;return Ev((function*(){const e=t.parent.getLayerAttributeConfig(),r=t.getLayerOptions(),n="PolygonLayer"===(i=t.parent.type)?GI:"LineLayer"===i?gI:FI;var i;const o=t.getSourceOption();if(!o)return t.isLoaded=!0,void t.emit("loaded");const a=new n(v_({},r)).source(o.data,o.options);Object.keys(e).forEach((t=>{var r,n;const i=t;a[i](null===(r=e[i])||void 0===r?void 0:r.field,null===(n=e[i])||void 0===n?void 0:n.values)})),yield t.addLayer(a),r.tileMask&&(yield t.addTileMask()),t.setLayerMinMaxZoom(a),t.isLoaded=!0,t.emit("loaded")}))()}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:e="defaultLayer",featureId:r="id"}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(e)},options:{parser:{type:"geojson",featureId:r},transforms:t.transforms}}}setLayerMinMaxZoom(t){"text"===t.getModelType()&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}getFeatures(t){return this.sourceTile.data.getTileData(t)}getFeatureById(t){const e=this.getMainLayer();if(!e)return[];return e.getSource().data.dataArray.filter((e=>e._id===t))}}const mM=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],{debounce:gM}=ld;class _M{constructor(t){g_(this,"parent",void 0),g_(this,"tileLayerService",void 0),g_(this,"mapService",void 0),g_(this,"layerService",void 0),g_(this,"rendererService",void 0),g_(this,"pickingService",void 0),g_(this,"tilePickService",void 0),g_(this,"tilesetManager",void 0),g_(this,"initedTileset",!1),g_(this,"lastViewStates",void 0),g_(this,"mapchange",(()=>{var t;if(!1===this.parent.isVisible())return;const{latLonBounds:e,zoom:r}=this.getCurrentView();this.lastViewStates&&this.lastViewStates.zoom===r&&this.lastViewStates.latLonBounds.toString()===e.toString()||(this.lastViewStates={zoom:r,latLonBounds:e},null===(t=this.tilesetManager)||void 0===t||t.throttleUpdate(r,e))})),g_(this,"viewchange",gM(this.mapchange,24)),this.parent=t;const e=this.parent.getContainer();this.rendererService=e.rendererService,this.layerService=e.layerService,this.mapService=e.mapService,this.pickingService=e.pickingService,this.tileLayerService=new ZI({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new tM({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}initTileSetManager(){var t;const e=this.parent.getSource();if(this.tilesetManager=e.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),!1===this.parent.isVisible())return;const{latLonBounds:r,zoom:n}=this.getCurrentView();null===(t=this.tilesetManager)||void 0===t||t.update(n,r)}getCurrentView(){const t=this.mapService.getBounds();return{latLonBounds:[t[0][0],t[0][1],t[1][0],t[1][1]],zoom:this.mapService.getZoom()}}bindTilesetEvent(){this.tilesetManager.on("tile-loaded",(t=>{})),this.tilesetManager.on("tile-unload",(t=>{this.tileUnLoad(t)})),this.tilesetManager.on("tile-error",((t,e)=>{this.tileError(t)})),this.tilesetManager.on("tile-update",(()=>{this.tileUpdate()})),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}render(){this.tileLayerService.render()}getLayers(){return this.tileLayerService.getLayers()}getTiles(){return this.tileLayerService.getTiles()}getTile(t){return this.tileLayerService.getTile(t)}tileLoaded(t){}tileError(t){console.warn("error:",t)}destroy(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),null===(t=this.tilesetManager)||void 0===t||t.destroy(),this.tileLayerService.destroy()}reload(){var t;this.tilesetManager.clear();const{latLonBounds:e,zoom:r}=this.getCurrentView();null===(t=this.tilesetManager)||void 0===t||t.update(r,e)}tileUnLoad(t){this.tileLayerService.removeTile(t.key)}tileUpdate(){var t=this;return Ev((function*(){if(!t.tilesetManager)return;const e=t.parent.getMinZoom(),r=t.parent.getMaxZoom(),n=t.tilesetManager.tiles.filter((t=>t.isLoaded)).filter((t=>t.isVisibleChange)).filter((t=>t.data)).filter((t=>t.z>=e&&t.z<r));yield Promise.all(n.map(function(){var e=Ev((function*(e){if(t.tileLayerService.hasTile(e.key))t.tileLayerService.updateTileVisible(e),t.tilePickService.setPickState(),t.layerService.reRender();else{const r=new(function(t){switch(t.type){case"PolygonLayer":case"LineLayer":case"PointLayer":return fM;case"TileDebugLayer":return rM;case"MaskLayer":return sM;case"RasterLayer":const{dataType:e}=t.getSource().parser;switch(e){case Ab.RGB:case Ab.CUSTOMRGB:return uM;case Ab.ARRAYBUFFER:case Ab.CUSTOMARRAYBUFFER:return dM;case Ab.TERRAINRGB:case Ab.CUSTOMTERRAINRGB:return cM;default:return nM}default:return fM}}(t.parent))(e,t.parent);yield r.initTileLayer(),t.tilePickService.setPickState(),0!==r.getLayers().length&&(t.tileLayerService.addTile(r),t.tileLayerService.updateTileVisible(e),t.layerService.reRender())}}));return function(t){return e.apply(this,arguments)}}())),t.tilesetManager.isLoaded&&t.parent.emit("tiles-loaded",t.tilesetManager.currentTiles)}))()}setPickState(t){}pickRender(t){this.tilePickService.pickRender(t)}selectFeature(t){this.tilePickService.selectFeature(t)}highlightPickedFeature(t){this.tilePickService.highlightPickedFeature(t)}proxy(t){mM.forEach((e=>{const r=t[e].bind(t);t[e]=(...n)=>(r(...n),this.getLayers().map((t=>{t[e](...n)})),"style"===e&&this.getTiles().forEach((t=>t.styleUpdate(...n))),t)}))}}class vM extends PT{constructor(...t){super(...t),g_(this,"disabled",void 0),g_(this,"zoomInButton",void 0),g_(this,"zoomOutButton",void 0),g_(this,"zoomNumDiv",void 0),g_(this,"zoomIn",(()=>{!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()})),g_(this,"zoomOut",(()=>{!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()})),g_(this,"updateDisabled",(()=>{const t=this.mapsService;this.zoomInButton.removeAttribute("disabled"),this.zoomOutButton.removeAttribute("disabled"),(this.disabled||t.getZoom()<=t.getMinZoom())&&this.zoomOutButton.setAttribute("disabled","true"),this.controlOption.showZoom&&this.zoomNumDiv&&(this.zoomNumDiv.innerText=String(Math.floor(t.getZoom()))),(this.disabled||t.getZoom()>=t.getMaxZoom())&&this.zoomInButton.setAttribute("disabled","true")}))}getDefault(t){return v_(v_({},super.getDefault(t)),{},{position:N_.BOTTOMRIGHT,name:"zoom",zoomInText:BT("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:BT("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}onAdd(){const t=pd("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}onRemove(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}disable(){return this.disabled=!0,this.updateDisabled(),this}enable(){return this.disabled=!1,this.updateDisabled(),this}resetButtonGroup(t){bd(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",t)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}createButton(t,e,r,n,i){const o=pd("button",r,n);return"string"==typeof t?o.innerHTML=t:o.append(t),o.title=e,i&&o.addEventListener("click",i),o}}!function(t,e){var r="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,n="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!r&&!n&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-marker-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font:\n    12px 'Helvetica Neue',\n    Arial,\n    Helvetica,\n    sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 999;\n  box-sizing: border-box;\n}\n.l7-control-container {\n  font:\n    12px/1.5 'Helvetica Neue',\n    Arial,\n    Helvetica,\n    sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 999;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 0 6px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  -webkit-transform: scale(0.83333);\n          transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  display: flex;\n  align-items: center;\n  height: 24px;\n  padding: 0 16px;\n  font-size: 12px;\n  line-height: 24px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  width: 14px;\n  height: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: flex-start;\n  box-sizing: content-box;\n  max-width: 460px;\n  max-height: 400px;\n  margin: 12px 0 0 12px;\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.l7-select-control--image .l7-select-control-item {\n  position: relative;\n  display: flex;\n  flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);\n  flex-direction: column;\n  justify-content: center;\n  box-sizing: content-box;\n  margin-right: 12px;\n  margin-bottom: 12px;\n  overflow: hidden;\n  font-size: 12px;\n  border: 1px solid #fff;\n  border-radius: 2px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 100%;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  top: 0;\n  right: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  overflow: hidden;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-control-zoom .l7-button-control {\n  font-size: 16px;\n  border-bottom: 1px solid #f0f0f0;\n  border-radius: 0;\n  box-shadow: 0 0 0;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:last-child {\n  border-bottom: 0;\n}\n.l7-control-zoom .l7-control-zoom__number {\n  color: #595959;\n  padding: 0;\n}\n.l7-control-zoom .l7-control-zoom__number:hover {\n  background-color: #fff;\n}\n.l7-control-scale {\n  display: flex;\n  flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: flex;\n  align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  font-size: 14px;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  margin-bottom: 8px;\n  font-weight: bold;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button,\n.l7-popup .l7-popup-content .l7-popup-content__title,\n.l7-popup .l7-popup-content .l7-popup-content__panel {\n  white-space: normal;\n  -webkit-user-select: text;\n     -moz-user-select: text;\n      -ms-user-select: text;\n          user-select: text;\n  pointer-events: initial;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  padding: 0;\n  font-size: 14px;\n  line-height: 18px;\n  text-align: center;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n}\n.l7-popup .l7-popup-tip {\n  position: relative;\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {\n  bottom: 1px;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-top .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {\n  top: 1px;\n}\n.l7-popup.l7-popup-anchor-left {\n  flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  position: relative;\n  align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  right: 1px;\n  align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n.l7-control-swipe {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  z-index: 6;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  touch-action: none;\n}\n.l7-control-swipe_hide {\n  display: none;\n}\n.l7-control-swipe:before {\n  position: absolute;\n  top: -5000px;\n  bottom: -5000px;\n  left: 50%;\n  z-index: -1;\n  width: 4px;\n  background: #fff;\n  -webkit-transform: translate(-2px, 0);\n          transform: translate(-2px, 0);\n  content: '';\n}\n.l7-control-swipe.horizontal:before {\n  top: 50%;\n  right: -5000px;\n  bottom: auto;\n  left: -5000px;\n  width: auto;\n  height: 4px;\n}\n.l7-control-swipe__button {\n  display: block;\n  width: 28px;\n  height: 28px;\n  margin: 0;\n  padding: 0;\n  color: #595959;\n  font-weight: bold;\n  font-size: inherit;\n  text-align: center;\n  text-decoration: none;\n  background-color: #fff;\n  border: none;\n  border-radius: 2px;\n  outline: none;\n}\n.l7-control-swipe,\n.l7-control-swipe__button {\n  cursor: ew-resize;\n}\n.l7-control-swipe.horizontal,\n.l7-control-swipe.horizontal button {\n  cursor: ns-resize;\n}\n.l7-control-swipe:after,\n.l7-control-swipe__button:before,\n.l7-control-swipe__button:after {\n  position: absolute;\n  top: 25%;\n  bottom: 25%;\n  left: 50%;\n  width: 2px;\n  background: currentColor;\n  -webkit-transform: translate(-1px, 0);\n          transform: translate(-1px, 0);\n  content: '';\n}\n.l7-control-swipe__button:after {\n  -webkit-transform: translateX(4px);\n          transform: translateX(4px);\n}\n.l7-control-swipe__button:before {\n  -webkit-transform: translateX(-6px);\n          transform: translateX(-6px);\n}\n");class yM{constructor(t){g_(this,"configService",void 0),g_(this,"config",void 0),this.config=t}setContainer(t,e){this.configService=t.globalConfigService,t.mapConfig=v_(v_({},this.config),{},{id:e}),t.mapService=new(this.getServiceConstructor())(t)}getServiceConstructor(){throw new Error("Method not implemented.")}}var xM={exports:{}};!function(t,e){t.exports=function(){function t(t){var n=[];return t.AMapUI&&n.push(e(t.AMapUI)),t.Loca&&n.push(r(t.Loca)),Promise.all(n)}function e(t){return new Promise((function(e,r){var i=[];if(t.plugins)for(var l=0;l<t.plugins.length;l+=1)-1==o.AMapUI.plugins.indexOf(t.plugins[l])&&i.push(t.plugins[l]);if(a.AMapUI===n.failed)r("前次请求 AMapUI 失败");else if(a.AMapUI===n.notload){a.AMapUI=n.loading,o.AMapUI.version=t.version||o.AMapUI.version,l=o.AMapUI.version;var u=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+l+"/main.js",c.onerror=function(t){a.AMapUI=n.failed,r("请求 AMapUI 失败")},c.onload=function(){if(a.AMapUI=n.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var t=0,r=i.length;t<r;t++){var n=i[t].split("/").slice(-1)[0];window.AMapUI[n]=arguments[t]}for(e();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(e();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},u.appendChild(c)}else a.AMapUI===n.loaded?t.version&&t.version!==o.AMapUI.version?r("不允许多个版本 AMapUI 混用"):i.length?window.AMapUI.loadUI(i,(function(){for(var t=0,r=i.length;t<r;t++){var n=i[t].split("/").slice(-1)[0];window.AMapUI[n]=arguments[t]}e()})):e():t.version&&t.version!==o.AMapUI.version?r("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(t){t?r(t):i.length?window.AMapUI.loadUI(i,(function(){for(var t=0,r=i.length;t<r;t++){var n=i[t].split("/").slice(-1)[0];window.AMapUI[n]=arguments[t]}e()})):e()}))}))}function r(t){return new Promise((function(e,r){if(a.Loca===n.failed)r("前次请求 Loca 失败");else if(a.Loca===n.notload){a.Loca=n.loading,o.Loca.version=t.version||o.Loca.version;var i=o.Loca.version,l=o.AMap.version.startsWith("2"),u=i.startsWith("2");if(l&&!u||!l&&u)r("JSAPI 与 Loca 版本不对应！！");else{l=o.key,u=document.body||document.head;var c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+i+"&key="+l,c.onerror=function(t){a.Loca=n.failed,r("请求 AMapUI 失败")},c.onload=function(){for(a.Loca=n.loaded,e();s.Loca.length;)s.Loca.splice(0,1)[0]()},u.appendChild(c)}}else a.Loca===n.loaded?t.version&&t.version!==o.Loca.version?r("不允许多个版本 Loca 混用"):e():t.version&&t.version!==o.Loca.version?r("不允许多个版本 Loca 混用"):s.Loca.push((function(t){t?r(t):r()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var n,i;(i=n||(n={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:n.notload,AMapUI:n.notload,Loca:n.notload},s={AMap:[],AMapUI:[],Loca:[]},l=[],u=function(t){"function"==typeof t&&(a.AMap===n.loaded?t(window.AMap):l.push(t))};return{load:function(e){return new Promise((function(r,i){if(a.AMap==n.failed)i("");else if(a.AMap==n.notload){var s=e.key,c=e.version,h=e.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),o.key=s,o.AMap.version=c||o.AMap.version,o.AMap.plugins=h||o.AMap.plugins,a.AMap=n.loading,c=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)a.AMap=n.failed,i(o);else for(a.AMap=n.loaded,t(e).then((function(){r(window.AMap)})).catch(i);l.length;)l.splice(0,1)[0]()},(h=document.createElement("script")).type="text/javascript",h.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+s+"&plugin="+o.AMap.plugins.join(","),h.onerror=function(t){a.AMap=n.failed,i(t)},c.appendChild(h)):i("请填写key")}else if(a.AMap==n.loaded)if(e.key&&e.key!==o.key)i("多个不一致的 key");else if(e.version&&e.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(s=[],e.plugins)for(c=0;c<e.plugins.length;c+=1)-1==o.AMap.plugins.indexOf(e.plugins[c])&&s.push(e.plugins[c]);s.length?window.AMap.plugin(s,(function(){t(e).then((function(){r(window.AMap)})).catch(i)})):t(e).then((function(){r(window.AMap)})).catch(i)}else if(e.key&&e.key!==o.key)i("多个不一致的 key");else if(e.version&&e.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{var p=[];if(e.plugins)for(c=0;c<e.plugins.length;c+=1)-1==o.AMap.plugins.indexOf(e.plugins[c])&&p.push(e.plugins[c]);u((function(){p.length?window.AMap.plugin(p,(function(){t(e).then((function(){r(window.AMap)})).catch(i)})):t(e).then((function(){r(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:n.notload,AMapUI:n.notload,Loca:n.notload},s={AMap:[],AMapUI:[],Loca:[]}}}}()}(xM);var bM=xM.exports;class EM{constructor(t){g_(this,"size",1e4),this.size=t||1e4}setSize(t){this.size=t}getSize(){return[this.size,this.size]}mercatorXfromLng(t){return(180+t)/360*this.size}mercatorYfromLat(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}lngFromMercatorX(t){return t/this.size*360-180}latFromMercatorY(t){const e=180-360*(1-t/this.size);return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}project(t){return[this.mercatorXfromLng(t[0]),this.mercatorYfromLat(t[1])]}unproject(t){return[this.lngFromMercatorX(t[0]),this.latFromMercatorY(t[1])]}}class TM{constructor(t){g_(this,"map",void 0),g_(this,"simpleMapCoord",new EM),g_(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),g_(this,"config",void 0),g_(this,"configService",void 0),g_(this,"coordinateSystemService",void 0),g_(this,"eventEmitter",void 0),g_(this,"markerContainer",void 0),g_(this,"mapContainer",void 0),g_(this,"cameraChangedCallback",void 0),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new Vd.exports.EventEmitter}onCameraChanged(t){this.cameraChangedCallback=t}updateView(t){var e;this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom}),this.updateCoordinateSystemService(),null===(e=this.cameraChangedCallback)||void 0===e||e.call(this,this.viewport)}updateCoordinateSystemService(){const{offsetCoordinate:t=!0}=this.config;this.viewport.getZoom()>12&&t?this.coordinateSystemService.setCoordinateSystem(F_.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(F_.LNGLAT)}creatMapContainer(t){let e;return e="string"==typeof t?document.getElementById(t):t,e}getMapStyleValue(t){var e;return null!==(e=this.getMapStyleConfig()[t])&&void 0!==e?e:t}setBgColor(t){this.bgColor=t}getMapContainer(){return this.mapContainer}getMarkerContainer(){return this.markerContainer}getOverlayContainer(){}getCanvasOverlays(){}emit(t,...e){this.eventEmitter.emit(t,...e)}once(t,e){this.eventEmitter.once(t,e)}meterToCoord(t,e){return 1}destroy(){this.eventEmitter.removeAllListeners()}}function SM(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function AM(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,m_(n.key),n)}}function wM(t,e,r){return e&&AM(t.prototype,e),r&&AM(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function CM(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function RM(t){return RM=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},RM(t)}function LM(t,e){return LM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},LM(t,e)}function IM(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function MM(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o,a,s=[],l=!0,u=!1;try{if(o=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return IM(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?IM(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function OM(t,e){var r,n,i,o=Hv([],e,t);return r=o,n=o,i=1/o[3],r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[3]=n[3]*i,o}function PM(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}var DM=Math.PI,BM=DM/4,NM=DM/180,FM=180/DM,kM=4003e4,UM=1.5;function zM(t){return Math.pow(2,t)}function GM(t,e){var r=MM(t,2),n=r[0],i=r[1];PM(Number.isFinite(n)&&Number.isFinite(e)),PM(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*NM;return[(e*=512)*(n*NM+DM)/(2*DM),e*(DM-Math.log(Math.tan(BM+.5*o)))/(2*DM)]}function jM(t,e){var r=MM(t,2),n=r[0],i=r[1],o=n/(e*=512)*(2*DM)-DM,a=2*(Math.atan(Math.exp(DM-i/e*(2*DM)))-BM);return[o*FM,a*FM]}function VM(t){var e=t.width,r=t.height,n=t.pitch,i=function(t){var e=t.width,r=t.height,n=t.altitude,i=void 0===n?UM:n,o=t.pitch,a=void 0===o?0:o,s=t.nearZMultiplier,l=void 0===s?1:s,u=t.farZMultiplier,c=void 0===u?1:u,h=a*NM,p=Math.atan(.5/i),d=Math.sin(p)*i/Math.sin(Math.PI/2-h-p),f=Math.cos(Math.PI/2-h)*d+i;return{fov:2*Math.atan(r/2/i),aspect:e/r,focalDistance:i,near:l,far:f*c}}({width:e,height:r,altitude:t.altitude,pitch:n,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),o=i.fov,a=i.aspect,s=i.near,l=i.far;return Bv([],o,a,s,l)}function HM(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=MM(t,3),i=n[0],o=n[1],a=n[2];if(PM(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a))return OM(e,[i,o,a,1]);var s=OM(e,[i,o,0,1]),l=OM(e,[i,o,1,1]),u=s[2],c=l[2];return function(t,e,r,n){var i=e[0],o=e[1];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t}([],s,l,u===c?0:((r||0)-u)/(c-u))}var WM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],XM=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.width,n=e.height,i=e.viewMatrix,o=void 0===i?WM:i,a=e.projectionMatrix,s=void 0===a?WM:a;SM(this,t),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Lv(l,l,this.projectionMatrix),Lv(l,l,this.viewMatrix),this.viewProjectionMatrix=l;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Mv(u,u,[this.width/2,-this.height/2,1]),Iv(u,u,[1,-1,0]),Lv(u,u,this.viewProjectionMatrix);var c=Rv([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=u,this.pixelUnprojectionMatrix=c,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return wM(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&Nv(e.projectionMatrix,this.projectionMatrix)&&Nv(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,r=void 0===e||e,n=function(t,e){var r=MM(t,3),n=r[0],i=r[1],o=r[2],a=void 0===o?0:o;return PM(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(a)),OM(e,[n,i,a,1])}(this.projectPosition(t),this.pixelProjectionMatrix),i=MM(n,2),o=i[0],a=i[1],s=r?a:this.height-a;return 2===t.length?[o,s]:[o,s,n[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,n=void 0===r||r,i=e.targetZ,o=MM(t,3),a=o[0],s=o[1],l=o[2],u=n?s:this.height-s,c=i&&i*this.pixelsPerMeter,h=HM([a,u,l],this.pixelUnprojectionMatrix,c),p=MM(this.unprojectPosition(h),3),d=p[0],f=p[1],m=p[2];return Number.isFinite(l)?[d,f,m]:Number.isFinite(i)?[d,f,i]:[d,f]}},{key:"projectPosition",value:function(t){var e=MM(this.projectFlat(t),2);return[e[0],e[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=MM(this.unprojectFlat(t),2);return[e[0],e[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]||this.scale,t}},{key:"unprojectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]||this.scale,t}}]),t}();function ZM(t){var e=t.width,r=t.height,n=t.bounds,i=t.minExtent,o=void 0===i?0:i,a=t.maxZoom,s=void 0===a?24:a,l=t.padding,u=void 0===l?0:l,c=t.offset,h=void 0===c?[0,0]:c,p=MM(n,2),d=MM(p[0],2),f=d[0],m=d[1],g=MM(p[1],2),_=g[0],v=g[1];if(Number.isFinite(u)){u={top:u,bottom:u,left:u,right:u}}else PM(Number.isFinite(u.top)&&Number.isFinite(u.bottom)&&Number.isFinite(u.left)&&Number.isFinite(u.right));var y=new qM({width:e,height:r,longitude:0,latitude:0,zoom:0}),x=y.project([f,v]),b=y.project([_,m]),E=[Math.max(Math.abs(b[0]-x[0]),o),Math.max(Math.abs(b[1]-x[1]),o)],T=[e-u.left-u.right-2*Math.abs(h[0]),r-u.top-u.bottom-2*Math.abs(h[1])];PM(T[0]>0&&T[1]>0);var S=T[0]/E[0],A=T[1]/E[1],w=(u.right-u.left)/2/S,C=(u.bottom-u.top)/2/A,R=[(b[0]+x[0])/2+w,(b[1]+x[1])/2+C],L=y.unproject(R),I=y.zoom+Math.log2(Math.abs(Math.min(S,A)));return{longitude:L[0],latitude:L[1],zoom:Math.min(I,s)}}var qM=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.width,i=r.height,o=r.latitude,a=void 0===o?0:o,s=r.longitude,l=void 0===s?0:s,u=r.zoom,c=void 0===u?0:u,h=r.pitch,p=void 0===h?0:h,d=r.bearing,f=void 0===d?0:d,m=r.altitude,g=void 0===m?1.5:m,_=r.nearZMultiplier,v=r.farZMultiplier;SM(this,e),n=n||1,i=i||1;var y=zM(c);g=Math.max(.75,g);var x=GM([l,a],y);x[2]=0;var b=VM({width:n,height:i,pitch:p,bearing:f,altitude:g,nearZMultiplier:_||1/i,farZMultiplier:v||1.01}),E=function(t){var e,r,n=t.height,i=t.pitch,o=t.bearing,a=t.altitude,s=t.center,l=void 0===s?null:s,u=t.flipY,c=void 0!==u&&u,h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return Iv(h,h,[0,0,-a]),Mv(h,h,[1,1,1/n]),Ov(h,h,-i*NM),Dv(h,h,o*NM),c&&Mv(h,h,[1,-1,1]),l&&Iv(h,h,((e=[])[0]=-(r=l)[0],e[1]=-r[1],e[2]=-r[2],e)),h}({height:i,center:x,pitch:p,bearing:f,altitude:g,flipY:!0});return(t=function(t,e){if(e&&("object"==f_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return CM(t)}(this,RM(e).call(this,{width:n,height:i,viewMatrix:E,projectionMatrix:b}))).latitude=a,t.longitude=l,t.zoom=c,t.pitch=p,t.bearing=f,t.altitude=g,t.scale=y,t.center=x,t.pixelsPerMeter=function(t){var e=t.latitude,r=t.longitude,n=t.zoom,i=t.scale,o=t.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:zM(n),PM(Number.isFinite(e)&&Number.isFinite(r)&&Number.isFinite(i));var s={},l=512*i,u=Math.cos(e*NM),c=l/360,h=c/u,p=l/kM/u;if(s.pixelsPerMeter=[p,-p,p],s.metersPerPixel=[1/p,-1/p,1/p],s.pixelsPerDegree=[c,-h,p],s.degreesPerPixel=[1/c,-1/h,1/p],a){var d=NM*Math.tan(e*NM)/u,f=c*d/2,m=l/kM*d,g=m/h*p;s.pixelsPerDegree2=[0,-f,m],s.pixelsPerMeter2=[g,0,g]}return s}(CM(CM(t))).pixelsPerMeter[2],Object.freeze(CM(CM(t))),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&LM(t,e)}(e,t),wM(e,[{key:"projectFlat",value:function(t){return GM(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"unprojectFlat",value:function(t){return jM(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e,r,n=t.lngLat,i=HM(t.pos,this.pixelUnprojectionMatrix),o=qv([],GM(n,this.scale),((e=[])[0]=-(r=i)[0],e[1]=-r[1],e));return jM(qv([],this.center,o),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,r=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:r})}},{key:"fitBounds",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.width,i=this.height,o=ZM(Object.assign({width:n,height:i,bounds:t},r));return new e({width:n,height:i,longitude:o.longitude,latitude:o.latitude,zoom:o.zoom})}}]),e}(XM);class YM{constructor(){g_(this,"viewport",new qM)}syncWithMapCamera(t){const{center:e,zoom:r,pitch:n,bearing:i,viewportHeight:o,viewportWidth:a}=t,s={width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing};this.viewport=new qM(v_(v_({},s),{},{width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:r,pitch:n,bearing:i}))}getZoom(){return this.viewport.zoom}getZoomScale(){return Math.pow(2,this.getZoom())}getCenter(){return[this.viewport.longitude,this.viewport.latitude]}getProjectionMatrix(){return this.viewport.projectionMatrix}getModelMatrix(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}getViewMatrix(){return this.viewport.viewMatrix}getViewMatrixUncentered(){return this.viewport.viewMatrixUncentered}getViewProjectionMatrix(){return this.viewport.viewProjectionMatrix}getViewProjectionMatrixUncentered(){return this.viewport.viewProjectionMatrix}getFocalDistance(){return 1}projectFlat(t,e){return this.viewport.projectFlat(t,e)}}let KM=function(t){return t.GAODE="GAODE",t.MAPBOX="MAPBOX",t.DEFAULT="DEFAUlTMAP",t.SIMPLE="SIMPLE",t.GLOBEL="GLOBEL",t}({});function $M(t={}){if("number"==typeof t)return{top:t,right:t,bottom:t,left:t};if(Array.isArray(t)){if(4===t.length)return{top:t[0],right:t[1],bottom:t[2],left:t[3]};if(2===t.length)return{top:t[0],right:t[1],bottom:t[0],left:t[1]}}return v_(v_({},{top:0,right:0,bottom:0,left:0}),t)}const QM={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},JM=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];!function(t,e){var r="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,n="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!r&&!n&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".amap-logo {\n  display: none !important;\n}\n.amap-copyright {\n  display: none !important;\n}\n.amap-overlays {\n  z-index: 3 !important;\n}\n");const tO="f59bcf249433f8b05caaee19f349b3d7",eO={contextmenu:"rightclick",camerachange:"viewchange"};class rO extends TM{constructor(...t){super(...t),g_(this,"viewport",new YM),g_(this,"version",KM.GAODE),g_(this,"handleCameraChanged",(()=>{const t=this.getViewState();this.updateView(t)}))}getType(){return"amap"}init(){var t=this;return Ev((function*(){const e=t.config,{id:r,style:n="light",minZoom:i=0,maxZoom:o=24,token:a=tO,mapInstance:s,plugin:l=[]}=e,u=Ay(e,JM);if(window.AMap||s||(l.push("Map3D"),yield bM.load({key:a,version:"2.0",plugins:l})),s)t.map=s,t.mapContainer=t.map.getContainer(),t.map.on("viewchange",t.handleCameraChanged);else{const e=v_({mapStyle:t.getMapStyleValue(n),zooms:[i,o],viewMode:"3D"},u);if(e.zoom&&(e.zoom+=1),a===tO&&(window._AMapSecurityConfig={securityJsCode:"2653011adeb04230b3a26cc9a780a800"},console.warn(`%c${t.configService.getSceneWarninfo("MapToken")}!`,"color: #873bf4;font-weigh:900;font-size: 16px;")),!r)throw Error("No container id specified");window.forceWebGL=!0,t.mapContainer=t.creatMapContainer(r);const s=new AMap.Map(t.mapContainer,e);t.map=s,s.on("viewchange",t.handleCameraChanged)}t.syncInitViewPort()}))()}syncInitViewPort(){const t=this.getViewState();this.updateView(t)}getViewState(){const{center:t,zoom:e}=function(t){const e=t._view.getOptions(),r=e.center,n=e.zoom;return{center:r,zoom:n}}(this.map);return{center:t,viewportWidth:this.map.getContainer().clientWidth,viewportHeight:this.map.getContainer().clientHeight,bearing:-this.map.getRotation(),pitch:this.map.getPitch(),zoom:e-1}}creatMapContainer(t){const e=super.creatMapContainer(t),r=document.createElement("div");return r.style.cssText+="\n       position: absolute;\n       top: 0;\n       height: 100%;\n       width: 100%;\n     ",r.id=ld.uniqueId("l7_amap_div"),e.appendChild(r),r}getContainer(){return this.map.getContainer()}addMarkerContainer(){if(!this.map)return;const t=this.map.getContainer();if(null!==t){const e=t.getElementsByClassName("amap-maps")[0];e.style.zIndex="auto",this.markerContainer=pd("div","l7-marker-container2",e)}}getMarkerContainer(){return this.markerContainer}getCanvasOverlays(){var t;return null===(t=this.mapContainer)||void 0===t?void 0:t.querySelector(".amap-overlays")}on(t,e){-1!==lv.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(eO[t]||t,e)}off(t,e){-1!==lv.indexOf(t)?this.eventEmitter.off(t,e):this.map.off(eO[t]||t,e)}getSize(){const t=this.map.getSize();return[t.getWidth(),t.getHeight()]}getMinZoom(){return this.map.getZooms()[0]-1}getMaxZoom(){return this.map.getZooms()[1]-1}getZoom(){return this.map.getZoom()-1}getCenter(t){if(null!=t&&t.padding){const e=this.getCenter(),r=$M(t.padding),n=this.lngLatToPixel([e.lng,e.lat]),i=[(r.right-r.left)/2,(r.bottom-r.top)/2];return this.pixelToLngLat([n.x-i[0],n.y-i[1]])}const e=this.map.getCenter();return{lng:e.getLng(),lat:e.getLat()}}getPitch(){return this.map.getPitch()}getRotation(){return 360-this.map.getRotation()}getBounds(){const t=this.map.getBounds(),e=t.getNorthEast(),r=t.getSouthWest(),n=this.getCenter(),i=n.lng>e.getLng()||n.lng<r.getLng()?180-e.getLng():e.getLng();return[[n.lng<r.getLng()?r.getLng()-180:r.getLng(),r.getLat()],[i,e.getLat()]]}getMapContainer(){return this.mapContainer}getMapCanvasContainer(){var t;return null===(t=this.map.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-maps")[0]}getMapStyleConfig(){return QM}getMapStyleValue(t){return this.getMapStyleConfig()[t]||t}getMapStyle(){return this.map.getMapStyle()}setMapStyle(t){this.map.setMapStyle(this.getMapStyleValue(t))}setRotation(t){return this.map.setRotation(t)}zoomIn(){this.map.zoomIn()}zoomOut(){this.map.zoomOut()}panTo(t){this.map.panTo(t)}panBy(t=0,e=0){this.map.panBy(t,e)}fitBounds(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]),!0)}setZoomAndCenter(t,e){this.map.setZoomAndCenter(t+1,e)}setCenter(t,e){if(null!=e&&e.padding){const r=$M(e.padding),n=this.lngLatToPixel(t),i=[(r.right-r.left)/2,(r.bottom-r.top)/2],o=this.pixelToLngLat([n.x+i[0],n.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(t)}setPitch(t){return this.map.setPitch(t)}setZoom(t){return this.map.setZoom(t+1)}setMaxZoom(t){throw new Error("Method not implemented.")}setMinZoom(t){throw new Error("Method not implemented.")}setMapStatus(t){this.map.setStatus(t)}meterToCoord(t,e){const r=AMap.GeometryUtil.distance(new AMap.LngLat(...t),new AMap.LngLat(...e)),[n,i]=Md(...t),[o,a]=Md(...e);return Math.sqrt(Math.pow(n-o,2)+Math.pow(i-a,2))/r}pixelToLngLat(t){const e=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:e.getLng(),lat:e.getLat()}}lngLatToPixel(t){const e=this.map.lnglatToPixel(t);return{x:e.getX(),y:e.getY()}}containerToLngLat(t){const e=new AMap.Pixel(t[0],t[1]),r=this.map.containerToLngLat(e);return{lng:null==r?void 0:r.getLng(),lat:null==r?void 0:r.getLat()}}lngLatToContainer(t){const e=this.map.lngLatToContainer(t);return{x:e.getX(),y:e.getY()}}lngLatToMercator([t,e],r){const[n,i]=Md(t,e);return{x:n,y:i,z:r}}getModelMatrix(t,e,r,n=[1,1,1]){const i=this.viewport.projectFlat(t),o=wv();return Iv(o,o,kv(i[0],i[1],e)),Mv(o,o,kv(n[0],n[1],n[2])),Ov(o,o,r[0]),Pv(o,o,r[1]),Dv(o,o,r[2]),o}exportMap(t){var e;const r=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0];return"jpg"===t?null==r?void 0:r.toDataURL("image/jpeg"):null==r?void 0:r.toDataURL("image/png")}destroy(){var t;super.destroy(),null===(t=this.mapContainer)||void 0===t||null===(t=t.parentNode)||void 0===t||t.removeChild(this.mapContainer),delete window.initAMap;const e=document.getElementById("amap-script");e&&document.head.removeChild(e),this.map.destroy()}}class nO extends yM{getServiceConstructor(){return rO}}const iO={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},oO={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"};class aO{constructor(t){g_(this,"version","DEFAUlTMAP"),g_(this,"map",void 0),g_(this,"simpleMapCoord",new EM),g_(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),g_(this,"config",void 0),g_(this,"configService",void 0),g_(this,"coordinateSystemService",void 0),g_(this,"eventEmitter",void 0),g_(this,"markerContainer",void 0),g_(this,"cameraChangedCallback",void 0),g_(this,"$mapContainer",void 0),g_(this,"handleCameraChanged",(t=>{const{lat:e,lng:r}=this.map.getCenter();this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:this.map.getBearing(),center:[r,e],viewportHeight:this.map.transform.height,pitch:this.map.getPitch(),viewportWidth:this.map.transform.width,zoom:this.map.getZoom(),cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)})),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new Vd.exports.EventEmitter}setBgColor(t){this.bgColor=t}addMarkerContainer(){const t=this.map.getCanvasContainer();this.markerContainer=pd("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}getMarkerContainer(){return this.markerContainer}getOverlayContainer(){}getCanvasOverlays(){}on(t,e){-1!==lv.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(oO[t]||t,e)}off(t,e){this.map.off(oO[t]||t,e),this.eventEmitter.off(t,e)}getContainer(){return this.map.getContainer()}getMapCanvasContainer(){return this.map.getCanvasContainer()}getSize(){if("SIMPLE"===this.version)return this.simpleMapCoord.getSize();const t=this.map.transform;return[t.width,t.height]}getType(){return"default"}getZoom(){return this.map.getZoom()}setZoom(t){return this.map.setZoom(t)}getCenter(){return this.map.getCenter()}setCenter(t){this.map.setCenter(t)}getPitch(){return this.map.getPitch()}getRotation(){return this.map.getBearing()}getBounds(){return this.map.getBounds().toArray()}getMinZoom(){return this.map.getMinZoom()}getMaxZoom(){return this.map.getMaxZoom()}setRotation(t){this.map.setBearing(t)}zoomIn(t,e){this.map.zoomIn(t,e)}zoomOut(t,e){this.map.zoomOut(t,e)}setPitch(t){return this.map.setPitch(t)}panTo(t){this.map.panTo(t)}panBy(t=0,e=0){this.map.panBy([t,e])}fitBounds(t,e){this.map.fitBounds(t,e)}setMaxZoom(t){this.map.setMaxZoom(t)}setMinZoom(t){this.map.setMinZoom(t)}setMapStatus(t){!0===t.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===t.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===t.dragEnable&&this.map.dragPan.disable(),!0===t.dragEnable&&this.map.dragPan.enable(),!1===t.rotateEnable&&this.map.dragRotate.disable(),!0===t.dragEnable&&this.map.dragRotate.enable(),!1===t.keyboardEnable&&this.map.keyboard.disable(),!0===t.keyboardEnable&&this.map.keyboard.enable(),!1===t.zoomEnable&&this.map.scrollZoom.disable(),!0===t.zoomEnable&&this.map.scrollZoom.enable()}setZoomAndCenter(t,e){this.map.flyTo({zoom:t,center:e})}setMapStyle(t){var e;null===(e=this.map)||void 0===e||e.setStyle(this.getMapStyleValue(t))}meterToCoord(t,e){return 1}pixelToLngLat(t){return this.map.unproject(t)}lngLatToPixel(t){return this.map.project(t)}containerToLngLat(t){return this.map.unproject(t)}lngLatToContainer(t){return this.map.project(t)}getMapStyle(){try{var t;const e=null!==(t=this.map.getStyle().sprite)&&void 0!==t?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(e)?null==e?void 0:e.replace(/\/\w+$/,"").replace(/sprites/,"styles"):e}catch(t){return""}}getMapStyleConfig(){return iO}getMapStyleValue(t){var e;return null!==(e=this.getMapStyleConfig()[t])&&void 0!==e?e:t}destroy(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(t,...e){this.eventEmitter.emit(t,...e)}once(t,...e){this.eventEmitter.once(t,...e)}getMapContainer(){return this.$mapContainer}exportMap(t){var e;const r=null===(e=this.map)||void 0===e?void 0:e.getCanvas();return"jpg"===t?null==r?void 0:r.toDataURL("image/jpeg"):null==r?void 0:r.toDataURL("image/png")}onCameraChanged(t){this.cameraChangedCallback=t}creatMapContainer(t){let e=t;return"string"==typeof t&&(e=document.getElementById(t)),e}updateView(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}updateCoordinateSystemService(){const{offsetCoordinate:t=!0}=this.config;this.viewport.getZoom()>12&&t?this.coordinateSystemService.setCoordinateSystem(F_.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(F_.LNGLAT)}}var sO=lO;function lO(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=n}lO.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,n=0;n<8;n++){var i=this.sampleCurveX(r)-t;if(Math.abs(i)<e)return r;var o=this.sampleCurveDerivativeX(r);if(Math.abs(o)<1e-6)break;r-=i/o}var a=0,s=1;for(r=t,n=0;n<20&&(i=this.sampleCurveX(r),!(Math.abs(i-t)<e));n++)t>i?a=r:s=r,r=.5*(s-a)+a;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};const uO=function(t,e,r){return t+r*(e-t)};function cO(t,e,r){return Math.min(r,Math.max(e,t))}function hO(t,e,r){const n=r-e,i=((t-e)%n+n)%n+e;return i===e?r:i}let pO=1;function dO(t,...e){for(const r of e)for(const e in r)t[e]=r[e];return t}function fO(t,e,r,n){const i=new sO(t,e,r,n);return t=>i.solve(t)}const mO=fO(.25,.1,.25,1),gO={};function _O(t){return t*Math.PI/180}const vO=6371008.8;class yO{constructor(t,e){if(g_(this,"lng",void 0),g_(this,"lat",void 0),isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new yO(hO(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,r=this.lat*e,n=t.lat*e,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return vO*Math.acos(Math.min(i,1))}static convert(t){if(t instanceof yO)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new yO(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new yO(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const xO=2*Math.PI*vO;function bO(t){return xO*Math.cos(t*Math.PI/180)}function EO(t){return(180+t)/360}function TO(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function SO(t,e){return t/bO(e)}function AO(t){const e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}class wO{constructor(t,e,r=0){g_(this,"x",void 0),g_(this,"y",void 0),g_(this,"z",void 0),this.x=+t,this.y=+e,this.z=+r}static fromLngLat(t,e=0){const r=yO.convert(t);return new wO(EO(r.lng),TO(r.lat),SO(e,r.lat))}toLngLat(){return new yO(360*this.x-180,AO(this.y))}toAltitude(){return t=this.z,e=this.y,t*bO(AO(e));var t,e}meterInMercatorCoordinateUnits(){return 1/xO*(t=AO(this.y),1/Math.cos(t*Math.PI/180));var t}}class CO{constructor(t,e){g_(this,"_ne",void 0),g_(this,"_sw",void 0),t&&(e?this.setSouthWest(t).setNorthEast(e):Array.isArray(t)&&(4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof yO?new yO(t.lng,t.lat):yO.convert(t),this}setSouthWest(t){return this._sw=t instanceof yO?new yO(t.lng,t.lat):yO.convert(t),this}extend(t){const e=this._sw,r=this._ne;let n,i;if(t instanceof yO)n=t,i=t;else{if(!(t instanceof CO)){if(Array.isArray(t)){if(4===t.length||t.every(Array.isArray)){const e=t;return this.extend(CO.convert(e))}{const e=t;return this.extend(yO.convert(e))}}return t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(yO.convert(t)):this}if(n=t._sw,i=t._ne,!n||!i)return this}return e||r?(e.lng=Math.min(n.lng,e.lng),e.lat=Math.min(n.lat,e.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new yO(n.lng,n.lat),this._ne=new yO(i.lng,i.lat)),this}getCenter(){return new yO((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new yO(this.getWest(),this.getNorth())}getSouthEast(){return new yO(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:r}=yO.convert(t),n=this._sw.lat<=r&&r<=this._ne.lat;let i=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=e&&e>=this._ne.lng),n&&i}static convert(t){return t instanceof CO?t:new CO(t)}static fromLngLat(t,e=0){const r=360*e/40075017,n=r/Math.cos(Math.PI/180*t.lat);return new CO(new yO(t.lng-n,t.lat-r),new yO(t.lng+n,t.lat+r))}}let RO;const LO={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:t=>new Promise(((e,r)=>{const n=requestAnimationFrame(e);t.signal.addEventListener("abort",(()=>{cancelAnimationFrame(n),r(new Error("AbortError"))}))})),get prefersReducedMotion(){return!!window.matchMedia&&(null==RO&&(RO=window.matchMedia("(prefers-reduced-motion: reduce)")),RO.matches)}};function IO(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e))}function MO(t,e,r){if(r&&r[t]){const n=r[t].indexOf(e);-1!==n&&r[t].splice(n,1)}}class OO{constructor(t,e={}){g_(this,"type",void 0),dO(this,e),this.type=t}}class PO extends OO{constructor(t,e={}){super("error",e),g_(this,"error",void 0),this.error=t}}class DO{constructor(){g_(this,"_listeners",void 0),g_(this,"_oneTimeListeners",void 0),g_(this,"_eventedParent",void 0),g_(this,"_eventedParentData",void 0)}on(t,e){return this._listeners=this._listeners||{},IO(t,e,this._listeners),this}off(t,e){return MO(t,e,this._listeners),MO(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},IO(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){"string"==typeof t&&(t=new OO(t,e||{}));const r=t.type;if(this.listens(r)){t.target=this;const e=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const r of e)r.call(this,t);const n=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const e of n)MO(r,e,this._oneTimeListeners),e.call(this,t);const i=this._eventedParent;i&&(dO(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(t))}else t instanceof PO&&console.error(t.error);return this}emit(t,e){return this.fire(t,e)}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return t&&(this._eventedParent=t),this._eventedParentData=e,this}}class BO extends DO{constructor(t,e){super(),g_(this,"transform",void 0),g_(this,"handlers",void 0),g_(this,"_moving",void 0),g_(this,"_zooming",void 0),g_(this,"_rotating",void 0),g_(this,"_pitching",void 0),g_(this,"_padding",void 0),g_(this,"_bearingSnap",void 0),g_(this,"_easeStart",void 0),g_(this,"_easeOptions",void 0),g_(this,"_easeId",void 0),g_(this,"_onEaseFrame",void 0),g_(this,"_onEaseEnd",void 0),g_(this,"_easeFrameId",void 0),g_(this,"_requestedCameraState",void 0),g_(this,"transformCameraUpdate",void 0),g_(this,"_renderFrameCallback",(()=>{const t=Math.min((LO.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()})),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=e.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new yO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(t,e,r){return t=qm.convert(t).mult(-1),this.panTo(this.transform.center,dO({offset:t},e),r)}panTo(t,e,r){return this.easeTo(dO({center:t},e),r)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(t,e,r){return this.easeTo(dO({zoom:t},e),r)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(t,e,r){return this.easeTo(dO({bearing:t},e),r)}resetNorth(t,e){return this.rotateTo(0,dO({duration:1e3},t),e),this}resetNorthPitch(t,e){return this.easeTo(dO({bearing:0,pitch:0,duration:1e3},t),e),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(t,e){t=CO.convert(t);const r=e&&e.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),r,e)}_cameraForBoxAndBearing(t,e,r,n){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=dO({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const t=n.padding;n.padding={top:t,bottom:t,right:t,left:t}}n.padding=dO(i,n.padding);const o=this.transform,a=o.padding,s=new CO(t,e),l=o.project(s.getNorthWest()),u=o.project(s.getNorthEast()),c=o.project(s.getSouthEast()),h=o.project(s.getSouthWest()),p=_O(-r),d=l.rotate(p),f=u.rotate(p),m=c.rotate(p),g=h.rotate(p),_=new qm(Math.max(d.x,f.x,g.x,m.x),Math.max(d.y,f.y,g.y,m.y)),v=new qm(Math.min(d.x,f.x,g.x,m.x),Math.min(d.y,f.y,g.y,m.y)),y=_.sub(v),x=(o.width-(a.left+a.right+n.padding.left+n.padding.right))/y.x,b=(o.height-(a.top+a.bottom+n.padding.top+n.padding.bottom))/y.y;if(b<0||x<0)return void(gO[E="Map cannot fit within canvas with the given bounds, padding, and/or offset."]||("undefined"!=typeof console&&console.warn(E),gO[E]=!0));var E;const T=Math.min(o.scaleZoom(o.scale*Math.min(x,b)),n.maxZoom),S=qm.convert(n.offset),A=(n.padding.left-n.padding.right)/2,w=(n.padding.top-n.padding.bottom)/2,C=new qm(A,w).rotate(_O(r)),R=S.add(C).mult(o.scale/o.zoomScale(T));return{center:o.unproject(l.add(c).div(2).sub(R)),zoom:T,bearing:r}}fitBounds(t,e,r){return this._fitInternal(this.cameraForBounds(t,e),e,r)}fitScreenCoordinates(t,e,r,n,i){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(qm.convert(t)),this.transform.pointLocation(qm.convert(e)),r,n),n,i)}_fitInternal(t,e,r){return t?(delete(e=dO(t,e)).padding,e.linear?this.easeTo(e,r):this.flyTo(e,r)):this}jumpTo(t,e){this.stop();const r=this._getTransformForUpdate();let n=!1,i=!1,o=!1;return"zoom"in t&&r.zoom!==+t.zoom&&(n=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=yO.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(i=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(o=!0,r.pitch=+t.pitch),null==t.padding||r.isPaddingEqual(t.padding)||(r.padding=t.padding),this._applyUpdatedTransform(r),this.fire(new OO("movestart",e)).fire(new OO("move",e)),n&&this.fire(new OO("zoomstart",e)).fire(new OO("zoom",e)).fire(new OO("zoomend",e)),i&&this.fire(new OO("rotatestart",e)).fire(new OO("rotate",e)).fire(new OO("rotateend",e)),o&&this.fire(new OO("pitchstart",e)).fire(new OO("pitch",e)).fire(new OO("pitchend",e)),this.fire(new OO("moveend",e))}calculateCameraOptionsFromTo(t,e,r,n=0){const i=wO.fromLngLat(t,e),o=wO.fromLngLat(r,n),a=o.x-i.x,s=o.y-i.y,l=o.z-i.z,u=Math.hypot(a,s,l);if(0===u)throw new Error("Can't calculate camera options with same From and To");const c=Math.hypot(a,s),h=this.transform.scaleZoom(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(a,-s)/Math.PI;let d=180*Math.acos(c/u)/Math.PI;return d=l<0?90-d:90+d,{center:o.toLngLat(),zoom:h,pitch:d,bearing:p}}easeTo(t,e){var r;this._stop(!1,t.easeId),(!1===(t=dO({offset:[0,0],duration:500,easing:mO},t)).animate||!t.essential&&LO.prefersReducedMotion)&&(t.duration=0);const n=this._getTransformForUpdate(),i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:a,c="padding"in t?t.padding:n.padding,h=qm.convert(t.offset);let p=n.centerPoint.add(h);const d=n.pointLocation(p),{center:f,zoom:m}=n.getConstrained(yO.convert(t.center||d),null!==(r=t.zoom)&&void 0!==r?r:i);this._normalizeCenter(f);const g=n.project(d),_=n.project(f).sub(g),v=n.zoomScale(m-i);let y,x;t.around&&(y=yO.convert(t.around),x=n.locationPoint(y));const b={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||m!==i,this._rotating=this._rotating||o!==l,this._pitching=this._pitching||u!==a,this._padding=!n.isPaddingEqual(c),this._easeId=t.easeId,this._prepareEase(e,t.noMoveStart,b),this._ease((t=>{if(this._zooming&&(n.zoom=uO(i,m,t)),this._rotating&&(n.bearing=uO(o,l,t)),this._pitching&&(n.pitch=uO(a,u,t)),this._padding&&(n.interpolatePadding(s,c,t),p=n.centerPoint.add(h)),y)n.setLocationAtPoint(y,x);else{const e=n.zoomScale(n.zoom-i),r=m>i?Math.min(2,v):Math.max(.5,v),o=Math.pow(r,1-t),a=n.unproject(g.add(_.mult(t*o)).mult(e));n.setLocationAtPoint(n.renderWorldCopies?a.wrap():a,p)}this._applyUpdatedTransform(n),this._fireMoveEvents(e)}),(t=>{this._afterEase(e,t)}),t),this}_prepareEase(t,e,r={}){this._moving=!0,e||r.moving||this.fire(new OO("movestart",t)),this._zooming&&!r.zooming&&this.fire(new OO("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new OO("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new OO("pitchstart",t))}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const e=t.clone(),{center:r,zoom:n,pitch:i,bearing:o,elevation:a}=this.transformCameraUpdate(e);r&&(e.center=r),void 0!==n&&(e.zoom=n),void 0!==i&&(e.pitch=i),void 0!==o&&(e.bearing=o),void 0!==a&&(e.elevation=a),this.transform.apply(e)}_fireMoveEvents(t){this.fire(new OO("move",t)),this._zooming&&this.fire(new OO("zoom",t)),this._rotating&&this.fire(new OO("rotate",t)),this._pitching&&this.fire(new OO("pitch",t))}_afterEase(t,e){if(this._easeId&&e&&this._easeId===e)return;delete this._easeId;const r=this._zooming,n=this._rotating,i=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new OO("zoomend",t)),n&&this.fire(new OO("rotateend",t)),i&&this.fire(new OO("pitchend",t)),this.fire(new OO("moveend",t))}flyTo(t,e){var r;if(!t.essential&&LO.prefersReducedMotion){const r=function(t,e){const r={};for(let n=0;n<e.length;n++){const i=e[n];i in t&&(r[i]=t[i])}return r}(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,e)}this.stop(),t=dO({offset:[0,0],speed:1.2,curve:1.42,easing:mO},t);const n=this._getTransformForUpdate(),i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:a,c="padding"in t?t.padding:n.padding,h=qm.convert(t.offset);let p=n.centerPoint.add(h);const d=n.pointLocation(p),{center:f,zoom:m}=n.getConstrained(yO.convert(t.center||d),null!==(r=t.zoom)&&void 0!==r?r:i);this._normalizeCenter(f);const g=n.zoomScale(m-i),_=n.project(d),v=n.project(f).sub(_);let y=t.curve;const x=Math.max(n.width,n.height),b=x/g,E=v.mag();if("minZoom"in t){const e=cO(Math.min(t.minZoom,i,m),n.minZoom,n.maxZoom),r=x/n.zoomScale(e-i);y=Math.sqrt(r/E*2)}const T=y*y;function S(t){const e=(b*b-x*x+(t?-1:1)*T*T*E*E)/(2*(t?b:x)*T*E);return Math.log(Math.sqrt(e*e+1)-e)}function A(t){return(Math.exp(t)-Math.exp(-t))/2}function w(t){return(Math.exp(t)+Math.exp(-t))/2}const C=S(!1);let R=function(t){return w(C)/w(C+y*t)},L=function(t){return x*((w(C)*(A(e=C+y*t)/w(e))-A(C))/T)/E;var e},I=(S(!0)-C)/y;if(Math.abs(E)<1e-6||!isFinite(I)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,e);const r=b<x?-1:1;I=Math.abs(Math.log(b/x))/y,L=()=>0,R=t=>Math.exp(r*y*t)}if("duration"in t)t.duration=+t.duration;else{const e="screenSpeed"in t?+t.screenSpeed/y:+t.speed;t.duration=1e3*I/e}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=o!==l,this._pitching=u!==a,this._padding=!n.isPaddingEqual(c),this._prepareEase(e,!1),this._ease((t=>{const r=t*I,d=1/R(r);n.zoom=1===t?m:i+n.scaleZoom(d),this._rotating&&(n.bearing=uO(o,l,t)),this._pitching&&(n.pitch=uO(a,u,t)),this._padding&&(n.interpolatePadding(s,c,t),p=n.centerPoint.add(h));const g=1===t?f:n.unproject(_.add(v.mult(L(r))).mult(d));n.setLocationAtPoint(n.renderWorldCopies?g.wrap():g,p),this._applyUpdatedTransform(n),this._fireMoveEvents(e)}),(()=>{this._afterEase(e)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}var r;t||(null===(r=this.handlers)||void 0===r||r.stop(!1));return this}_ease(t,e,r){!1===r.animate||0===r.duration?(t(1),e()):(this._easeStart=LO.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,e){t=hO(t,-180,180);const r=Math.abs(t-e);return Math.abs(t-360-e)<r&&(t-=360),Math.abs(t+360-e)<r&&(t+=360),t}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.lngRange)return;const r=t.lng-e.center.lng;t.lng+=r>180?-360:r<-180?360:0}}class NO{constructor(t=0,e=0,r=0,n=0){if(g_(this,"top",void 0),g_(this,"bottom",void 0),g_(this,"left",void 0),g_(this,"right",void 0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(r)||r<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=r,this.right=n}interpolate(t,e,r){return null!=e.top&&null!=t.top&&(this.top=uO(t.top,e.top,r)),null!=e.bottom&&null!=t.bottom&&(this.bottom=uO(t.bottom,e.bottom,r)),null!=e.left&&null!=t.left&&(this.left=uO(t.left,e.left,r)),null!=e.right&&null!=t.right&&(this.right=uO(t.right,e.right,r)),this}getCenter(t,e){const r=cO((this.left+t-this.right)/2,0,t),n=cO((this.top+e-this.bottom)/2,0,e);return new qm(r,n)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new NO(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const FO=85.051129;class kO{constructor(t,e,r,n,i){g_(this,"tileSize",void 0),g_(this,"tileZoom",void 0),g_(this,"lngRange",void 0),g_(this,"latRange",void 0),g_(this,"scale",void 0),g_(this,"width",void 0),g_(this,"height",void 0),g_(this,"angle",void 0),g_(this,"rotationMatrix",void 0),g_(this,"pixelsToGLUnits",void 0),g_(this,"cameraToCenterDistance",void 0),g_(this,"mercatorMatrix",void 0),g_(this,"projMatrix",void 0),g_(this,"invProjMatrix",void 0),g_(this,"alignedProjMatrix",void 0),g_(this,"pixelMatrix",void 0),g_(this,"pixelMatrix3D",void 0),g_(this,"pixelMatrixInverse",void 0),g_(this,"glCoordMatrix",void 0),g_(this,"labelPlaneMatrix",void 0),g_(this,"minElevationForCurrentTile",void 0),g_(this,"_fov",void 0),g_(this,"_pitch",void 0),g_(this,"_zoom",void 0),g_(this,"_unmodified",void 0),g_(this,"_renderWorldCopies",void 0),g_(this,"_minZoom",void 0),g_(this,"_maxZoom",void 0),g_(this,"_minPitch",void 0),g_(this,"_maxPitch",void 0),g_(this,"_center",void 0),g_(this,"_elevation",void 0),g_(this,"_pixelPerMeter",void 0),g_(this,"_edgeInsets",void 0),g_(this,"_constraining",void 0),g_(this,"_posMatrixCache",void 0),g_(this,"_alignedPosMatrixCache",void 0),this.tileSize=512,this._renderWorldCopies=void 0===i||!!i,this._minZoom=t||0,this._maxZoom=e||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setMaxBounds(),this.width=0,this.height=0,this._center=new yO(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new NO,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new kO(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new qm(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const e=-hO(t,-180,180)*Math.PI/180;var r;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=(r=new Av(4),Av!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r),function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),l=Math.cos(r);t[0]=n*l+o*s,t[1]=i*l+a*s,t[2]=n*-s+o*l,t[3]=i*-s+a*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const e=cO(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.tileZoom=Math.max(0,Math.floor(e)),this.scale=this.zoomScale(e),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,r){this._unmodified=!1,this._edgeInsets.interpolate(t,e,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const e=cO(t.lat,-85.051129,FO);return new qm(EO(t.lng)*this.worldSize,TO(e)*this.worldSize)}unproject(t){return new wO(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}setLocationAtPoint(t,e){const r=this.pointCoordinate(e),n=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(t),o=new wO(i.x-(r.x-n.x),i.y-(r.y-n.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}locationCoordinate(t){return wO.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t){const e=[t.x,t.y,0,1],r=[t.x,t.y,1,1];Hv(e,e,this.pixelMatrixInverse),Hv(r,r,this.pixelMatrixInverse);const n=e[3],i=r[3],o=e[1]/n,a=r[1]/i,s=e[2]/n,l=r[2]/i,u=s===l?0:(0-s)/(l-s);return new wO(uO(e[0]/n,r[0]/i,u)/this.worldSize,uO(o,a,u)/this.worldSize)}coordinatePoint(t,e=0,r=this.pixelMatrix){const n=[t.x*this.worldSize,t.y*this.worldSize,e,1];return Hv(n,n,r),new qm(n[0]/n[3],n[1]/n[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return(new CO).extend(this.pointLocation(new qm(0,t))).extend(this.pointLocation(new qm(this.width,t))).extend(this.pointLocation(new qm(this.width,this.height))).extend(this.pointLocation(new qm(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new CO([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,FO])}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,e){e=cO(+e,this.minZoom,this.maxZoom);const r={center:new yO(t.lng,t.lat),zoom:e};let n=this.lngRange;if(!this._renderWorldCopies&&null===n){const t=180-1e-10;n=[-t,t]}const i=this.tileSize*this.zoomScale(r.zoom);let o=0,a=i,s=0,l=i,u=0,c=0;const{x:h,y:p}=this.size;if(this.latRange){const t=this.latRange;o=TO(t[1])*i,a=TO(t[0])*i;a-o<p&&(u=p/(a-o))}if(n){s=hO(EO(n[0])*i,0,i),l=hO(EO(n[1])*i,0,i),l<s&&(l+=i);l-s<h&&(c=h/(l-s))}const{x:d,y:f}=this.project.call({worldSize:i},t);let m,g;const _=Math.max(c||0,u||0);if(_){const t=new qm(c?(l+s)/2:d,u?(a+o)/2:f);return r.center=this.unproject.call({worldSize:i},t).wrap(),r.zoom+=this.scaleZoom(_),r}if(this.latRange){const t=p/2;f-t<o&&(g=o+t),f+t>a&&(g=a-t)}if(n){const t=(s+l)/2;let e=d;this._renderWorldCopies&&(e=hO(d,t-i/2,t+i/2));const r=h/2;e-r<s&&(m=s+r),e+r>l&&(m=l-r)}if(void 0!==m||void 0!==g){var v,y;const t=new qm(null!==(v=m)&&void 0!==v?v:d,null!==(y=g)&&void 0!==y?y:f);r.center=this.unproject.call({worldSize:i},t).wrap()}return r}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:e,zoom:r}=this.getConstrained(this.center,this.zoom);this.center=e,this.zoom=r,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this._fov/2,e=this.centerOffset,r=this.point.x,n=this.point.y;this.cameraToCenterDistance=.5/Math.tan(t)*this.height,this._pixelPerMeter=SO(1,this.center.lat)*this.worldSize;let i=Cv(new Float64Array(16));Mv(i,i,[this.width/2,-this.height/2,1]),Iv(i,i,[1,-1,0]),this.labelPlaneMatrix=i,i=Cv(new Float64Array(16)),Mv(i,i,[1,-1,1]),Iv(i,i,[-1,-1,0]),Mv(i,i,[2/this.width,2/this.height,1]),this.glCoordMatrix=i;const o=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),a=Math.min(this.elevation,this.minElevationForCurrentTile),s=o-a*this._pixelPerMeter/Math.cos(this._pitch),l=a<0?s:o,u=Math.PI/2+this._pitch,c=this._fov*(.5+e.y/this.height),h=Math.sin(c)*l/Math.sin(cO(Math.PI-u-c,.01,Math.PI-.01)),p=this.getHorizon(),d=2*Math.atan(p/this.cameraToCenterDistance)*(.5+e.y/(2*p)),f=Math.sin(d)*l/Math.sin(cO(Math.PI-u-d,.01,Math.PI-.01)),m=Math.min(h,f),g=1.01*(Math.cos(Math.PI/2-this._pitch)*m+l),_=this.height/50;i=new Float64Array(16),Bv(i,this._fov,this.width/this.height,_,g),i[8]=2*-e.x/this.width,i[9]=2*e.y/this.height,Mv(i,i,[1,-1,1]),Iv(i,i,[0,0,-this.cameraToCenterDistance]),Ov(i,i,this._pitch),Dv(i,i,this.angle),Iv(i,i,[-r,-n,0]),this.mercatorMatrix=Mv([],i,[this.worldSize,this.worldSize,this.worldSize]),Mv(i,i,[1,1,this._pixelPerMeter]),this.pixelMatrix=Lv(new Float64Array(16),this.labelPlaneMatrix,i),Iv(i,i,[0,0,-this.elevation]),this.projMatrix=i,this.invProjMatrix=Rv([],i),this.pixelMatrix3D=Lv(new Float64Array(16),this.labelPlaneMatrix,i);const v=this.width%2/2,y=this.height%2/2,x=Math.cos(this.angle),b=Math.sin(this.angle),E=r-Math.round(r)+x*v+b*y,T=n-Math.round(n)+x*y+b*v,S=new Float64Array(i);if(Iv(S,S,[E>.5?E-1:E,T>.5?T-1:T,0]),this.alignedProjMatrix=S,i=Rv(new Float64Array(16),this.pixelMatrix),!i)throw new Error("failed to invert matrix");this.pixelMatrixInverse=i,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new qm(0,0)),e=[t.x*this.worldSize,t.y*this.worldSize,0,1];return Hv(e,e,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=this._pitch,e=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new qm(0,e))}getCameraQueryGeometry(t){const e=this.getCameraPoint();if(1===t.length)return[t[0],e];{let r=e.x,n=e.y,i=e.x,o=e.y;for(const e of t)r=Math.min(r,e.x),n=Math.min(n,e.y),i=Math.max(i,e.x),o=Math.max(o,e.y);return[new qm(r,n),new qm(i,n),new qm(i,o),new qm(r,o),new qm(r,n)]}}lngLatToCameraDepth(t,e){const r=this.locationCoordinate(t),n=[r.x*this.worldSize,r.y*this.worldSize,e,1];return Hv(n,n,this.projMatrix),n[2]/n[3]}}var UO;class zO{static testProp(t){if(!zO.docStyle)return t[0];for(let e=0;e<t.length;e++)if(t[e]in zO.docStyle)return t[e];return t[0]}static create(t,e,r){const n=window.document.createElement(t);return void 0!==e&&(n.className=e),r&&r.appendChild(n),n}static createNS(t,e){return window.document.createElementNS(t,e)}static disableDrag(){zO.docStyle&&zO.selectProp&&(zO.userSelect=zO.docStyle[zO.selectProp],zO.docStyle[zO.selectProp]="none")}static enableDrag(){zO.docStyle&&zO.selectProp&&(zO.docStyle[zO.selectProp]=zO.userSelect)}static setTransform(t,e){t.style[zO.transformProp]=e}static addEventListener(t,e,r,n={}){"passive"in n?t.addEventListener(e,r,n):t.addEventListener(e,r,n.capture)}static removeEventListener(t,e,r,n={}){"passive"in n?t.removeEventListener(e,r,n):t.removeEventListener(e,r,n.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",zO.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",zO.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",zO.suppressClickInternal,!0)}),0)}static getScale(t){const e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}static getPoint(t,e,r){const n=e.boundingClientRect;return new qm((r.clientX-n.left)/e.x-t.clientLeft,(r.clientY-n.top)/e.y-t.clientTop)}static mousePos(t,e){const r=zO.getScale(t);return zO.getPoint(t,r,e)}static touchPos(t,e){const r=[],n=zO.getScale(t);for(let i=0;i<e.length;i++)r.push(zO.getPoint(t,n,e[i]));return r}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}UO=zO,g_(zO,"docStyle","undefined"!=typeof window&&window.document&&window.document.documentElement.style),g_(zO,"userSelect",void 0),g_(zO,"selectProp",UO.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"])),g_(zO,"transformProp",UO.testProp(["transform","WebkitTransform"]));class GO{constructor(t){g_(this,"_map",void 0),this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(qm.convert(t))}}class jO{constructor(t,e){g_(this,"_map",void 0),g_(this,"_tr",void 0),g_(this,"_el",void 0),g_(this,"_container",void 0),g_(this,"_enabled",void 0),g_(this,"_active",void 0),g_(this,"_startPos",void 0),g_(this,"_lastPos",void 0),g_(this,"_box",void 0),g_(this,"_clickTolerance",void 0),this._map=t,this._tr=new GO(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(zO.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const r=e;if(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)return;const n=this._startPos;this._lastPos=r,this._box||(this._box=zO.create("div","l7-boxzoom",this._container),this._container.classList.add("l7-crosshair"),this._fireEvent("boxzoomstart",t));const i=Math.min(n.x,r.x),o=Math.max(n.x,r.x),a=Math.min(n.y,r.y),s=Math.max(n.y,r.y);zO.setTransform(this._box,`translate(${i}px,${a}px)`),this._box.style.width=o-i+"px",this._box.style.height=s-a+"px"}mouseupWindow(t,e){if(!this._active)return;if(0!==t.button)return;const r=this._startPos,n=e;if(this.reset(),zO.suppressClick(),r.x!==n.x||r.y!==n.y)return this._map.fire(new OO("boxzoomend",{originalEvent:t})),{cameraAnimation:t=>t.fitScreenCoordinates(r,n,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("l7-crosshair"),this._box&&(zO.remove(this._box),this._box=null),zO.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,e){return this._map.fire(new OO(t,{originalEvent:e}))}}class VO{constructor(t){g_(this,"_tr",void 0),g_(this,"_enabled",void 0),g_(this,"_active",void 0),this._tr=new GO(t),this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class HO{constructor(t,e){g_(this,"_options",void 0),g_(this,"_map",void 0),g_(this,"_container",void 0),g_(this,"_bypassKey",-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey"),g_(this,"_enabled",void 0),this._map=t,this._options=e,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("l7-cooperative-gestures"),this._container=zO.create("div","l7-cooperative-gesture-screen",t);const e=document.createElement("div");e.className="l7-desktop-message",e.textContent="Missing UI string",this._container.appendChild(e);const r=document.createElement("div");r.className="l7-mobile-message",r.textContent="Missing UI string",this._container.appendChild(r),this._container.setAttribute("aria-hidden","true")}_destoryUI(){if(this._container){zO.remove(this._container);this._map.getCanvasContainer().classList.remove("l7-cooperative-gestures")}delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(1===t.touches.length)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("l7-show"),setTimeout((()=>{this._container.classList.remove("l7-show")}),100))}}const WO={panStep:100,bearingStep:15,pitchStep:10};class XO{constructor(t){g_(this,"_tr",void 0),g_(this,"_enabled",void 0),g_(this,"_active",void 0),g_(this,"_panStep",void 0),g_(this,"_bearingStep",void 0),g_(this,"_pitchStep",void 0),g_(this,"_rotationDisabled",void 0),this._tr=new GO(t);const e=WO;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,r=0,n=0,i=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),i=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),i=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(r=0,n=0),{cameraAnimation:a=>{const s=this._tr;a.easeTo({duration:300,easeId:"keyboardHandler",easing:ZO,zoom:e?Math.round(s.zoom)+e*(t.shiftKey?2:1):s.zoom,bearing:s.bearing+r*this._bearingStep,pitch:s.pitch+n*this._pitchStep,offset:[-i*this._panStep,-o*this._panStep],center:s.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ZO(t){return t*(2-t)}class qO extends OO{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,r,n={}){super(t,n),g_(this,"target",void 0),g_(this,"originalEvent",void 0),g_(this,"point",void 0),g_(this,"lngLat",void 0),g_(this,"_defaultPrevented",void 0);const i=zO.mousePos(e.getCanvasContainer(),r),o=e.unproject(i);this.point=i,this.lngLat=o,this.originalEvent=r,this._defaultPrevented=!1,this.target=e}}class YO extends OO{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,r){super(t),g_(this,"target",void 0),g_(this,"originalEvent",void 0),g_(this,"lngLat",void 0),g_(this,"point",void 0),g_(this,"points",void 0),g_(this,"lngLats",void 0),g_(this,"_defaultPrevented",void 0);const n="touchend"===t?r.changedTouches:r.touches,i=zO.touchPos(e.getCanvasContainer(),n),o=i.map((t=>e.unproject(t))),a=i.reduce(((t,e,r,n)=>t.add(e.div(n.length))),new qm(0,0)),s=e.unproject(a);this.target=e,this.points=i,this.point=a,this.lngLats=o,this.lngLat=s,this.originalEvent=r,this._defaultPrevented=!1}}class KO extends OO{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,r){super(t),g_(this,"target",void 0),g_(this,"originalEvent",void 0),g_(this,"_defaultPrevented",void 0),this.target=e,this._defaultPrevented=!1,this.originalEvent=r}}class $O{constructor(t,e){g_(this,"_mousedownPos",void 0),g_(this,"_clickTolerance",void 0),g_(this,"_map",void 0),this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new KO(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new qO(t.type,this._map,t))}mouseup(t){this._map.fire(new qO(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new qO(t.type,this._map,t))}dblclick(t){return this._firePreventable(new qO(t.type,this._map,t))}mouseover(t){this._map.fire(new qO(t.type,this._map,t))}mouseout(t){this._map.fire(new qO(t.type,this._map,t))}touchstart(t){return this._firePreventable(new YO(t.type,this._map,t))}touchmove(t){this._map.fire(new YO(t.type,this._map,t))}touchend(t){this._map.fire(new YO(t.type,this._map,t))}touchcancel(t){this._map.fire(new YO(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class QO{constructor(t){g_(this,"_map",void 0),g_(this,"_delayContextMenu",void 0),g_(this,"_ignoreContextMenu",void 0),g_(this,"_contextMenuEvent",void 0),this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new qO(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qO("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new qO(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class JO{constructor(t){g_(this,"contextmenu",void 0),g_(this,"mousedown",void 0),g_(this,"mousemoveWindow",void 0),g_(this,"mouseup",void 0),g_(this,"touchstart",void 0),g_(this,"touchmoveWindow",void 0),g_(this,"touchend",void 0),g_(this,"_clickTolerance",void 0),g_(this,"_moveFunction",void 0),g_(this,"_activateOnStart",void 0),g_(this,"_active",void 0),g_(this,"_enabled",void 0),g_(this,"_moved",void 0),g_(this,"_lastPoint",void 0),g_(this,"_moveStateManager",void 0),this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const e=this._moveFunction(...t);if(e.bearingDelta||e.pitchDelta||e.around||e.panDelta)return this._active=!0,e}dragStart(t,e){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=e.length?e[0]:e,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,e){if(!this.isEnabled())return;const r=this._lastPoint;if(!r)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const n=e.length?e[0]:e;return!this._moved&&n.dist(r)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=n,this._move(r,n))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&zO.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const tP=0,eP=2,rP={[tP]:1,[eP]:2};class nP{constructor(t){g_(this,"_eventButton",void 0),g_(this,"_correctEvent",void 0),this._correctEvent=t.checkCorrectEvent}startMove(t){const e=zO.mouseButton(t);this._eventButton=e}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(t,e){const r=rP[e];return void 0===t.buttons||(t.buttons&r)!==r}(t,this._eventButton)}isValidEndEvent(t){return zO.mouseButton(t)===this._eventButton}}const iP=t=>{t.mousedown=t.dragStart,t.mousemoveWindow=t.dragMove,t.mouseup=t.dragEnd,t.contextmenu=t=>{t.preventDefault()}},oP=4.000244140625,aP=1/450;class sP{constructor(t,e){g_(this,"_map",void 0),g_(this,"_tr",void 0),g_(this,"_enabled",void 0),g_(this,"_active",void 0),g_(this,"_zooming",void 0),g_(this,"_aroundCenter",void 0),g_(this,"_around",void 0),g_(this,"_aroundPoint",void 0),g_(this,"_type",void 0),g_(this,"_lastValue",void 0),g_(this,"_timeout",void 0),g_(this,"_finishTimeout",void 0),g_(this,"_lastWheelEvent",void 0),g_(this,"_lastWheelEventTime",void 0),g_(this,"_startZoom",void 0),g_(this,"_targetZoom",void 0),g_(this,"_delta",void 0),g_(this,"_easing",void 0),g_(this,"_prevEase",void 0),g_(this,"_frameId",void 0),g_(this,"_triggerRenderFrame",void 0),g_(this,"_defaultZoomRate",void 0),g_(this,"_wheelZoomRate",void 0),g_(this,"_onTimeout",(t=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)})),this._map=t,this._tr=new GO(t),this._triggerRenderFrame=e,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=aP}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let e=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const r=LO.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==e&&e%oP==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=zO.mousePos(this._map.getCanvasContainer(),t),r=this._tr;e.y>r.transform.height/2-r.transform.getHorizon()?this._around=yO.convert(this._aroundCenter?r.center:r.unproject(e)):this._around=yO.convert(r.center),this._aroundPoint=r.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._tr.transform;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>oP?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==r&&(r=1/r);const n="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(n*r))),"wheel"===this._type&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const e="number"==typeof this._targetZoom?this._targetZoom:t.zoom,r=this._startZoom,n=this._easing;let i,o=!1;if("wheel"===this._type&&r&&n){const t=Math.min((LO.now()-this._lastWheelEventTime)/200,1),a=n(t);i=uO(r,e,a),t<1?this._frameId||(this._frameId=!0):o=!0}else i=e,o=!0;return this._active=!0,o&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!o,zoomDelta:i-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let e=mO;if(this._prevEase){const t=this._prevEase,r=(LO.now()-t.start)/t.duration,n=t.easing(r+.01)-t.easing(r),i=.27/Math.sqrt(n*n+1e-4)*.01;e=fO(i,Math.sqrt(.0729-i*i),.25,1)}return this._prevEase={start:LO.now(),duration:t,easing:e},e}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class lP{constructor(t,e){g_(this,"_clickZoom",void 0),g_(this,"_tapZoom",void 0),this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class uP{constructor(t,e,r){g_(this,"_el",void 0),g_(this,"_mousePan",void 0),g_(this,"_touchPan",void 0),g_(this,"_inertiaOptions",void 0),this._el=t,this._mousePan=e,this._touchPan=r}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("l7-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("l7-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class cP{constructor(t,e,r){g_(this,"_mouseRotate",void 0),g_(this,"_mousePitch",void 0),g_(this,"_pitchWithRotate",void 0),this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class hP{constructor(t,e,r,n){g_(this,"_el",void 0),g_(this,"_touchZoom",void 0),g_(this,"_touchRotate",void 0),g_(this,"_tapDragZoom",void 0),g_(this,"_rotationDisabled",void 0),g_(this,"_enabled",void 0),this._el=t,this._touchZoom=e,this._touchRotate=r,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("l7-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("l7-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}function pP(t,e){if(t.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${t.length}, points ${e.length}`);const r={};for(let n=0;n<t.length;n++)r[t[n].identifier]=e[n];return r}class dP{constructor(t){g_(this,"numTouches",void 0),g_(this,"centroid",void 0),g_(this,"startTime",void 0),g_(this,"aborted",void 0),g_(this,"touches",void 0),this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,e,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){const e=new qm(0,0);for(const r of t)e._add(r);return e.div(t.length)}(e),this.touches=pP(r,e)))}touchmove(t,e,r){if(this.aborted||!this.centroid)return;const n=pP(r,e);for(const t in this.touches){const e=this.touches[t],r=n[t];(!r||r.dist(e)>30)&&(this.aborted=!0)}}touchend(t,e,r){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class fP{constructor(t){g_(this,"singleTap",void 0),g_(this,"numTaps",void 0),g_(this,"lastTime",void 0),g_(this,"lastTap",void 0),g_(this,"count",void 0),this.singleTap=new dP(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,r){this.singleTap.touchstart(t,e,r)}touchmove(t,e,r){this.singleTap.touchmove(t,e,r)}touchend(t,e,r){const n=this.singleTap.touchend(t,e,r);if(n){const e=t.timeStamp-this.lastTime<500,r=!this.lastTap||this.lastTap.dist(n)<30;if(e&&r||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class mP{constructor(){g_(this,"_enabled",void 0),g_(this,"_active",void 0),g_(this,"_swipePoint",void 0),g_(this,"_swipeTouch",void 0),g_(this,"_tapTime",void 0),g_(this,"_tapPoint",void 0),g_(this,"_tap",void 0),this._tap=new fP({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,e,r){if(!this._swipePoint)if(this._tapTime){const n=e[0],i=t.timeStamp-this._tapTime<500,o=this._tapPoint.dist(n)<30;i&&o?r.length>0&&(this._swipePoint=n,this._swipeTouch=r[0].identifier):this.reset()}else this._tap.touchstart(t,e,r)}touchmove(t,e,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;const n=e[0],i=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(t,e,r)}touchend(t,e,r){if(this._tapTime)this._swipePoint&&0===r.length&&this.reset();else{const n=this._tap.touchend(t,e,r);n&&(this._tapTime=t.timeStamp,this._tapPoint=n)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gP{constructor(t){g_(this,"_tr",void 0),g_(this,"_enabled",void 0),g_(this,"_active",void 0),g_(this,"_zoomIn",void 0),g_(this,"_zoomOut",void 0),this._tr=new GO(t),this._zoomIn=new fP({numTouches:1,numTaps:2}),this._zoomOut=new fP({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,r){this._zoomIn.touchstart(t,e,r),this._zoomOut.touchstart(t,e,r)}touchmove(t,e,r){this._zoomIn.touchmove(t,e,r),this._zoomOut.touchmove(t,e,r)}touchend(t,e,r){const n=this._zoomIn.touchend(t,e,r),i=this._zoomOut.touchend(t,e,r),o=this._tr;return n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(n)},{originalEvent:t})}):i?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(i)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _P{constructor(t,e){g_(this,"_enabled",void 0),g_(this,"_active",void 0),g_(this,"_touches",void 0),g_(this,"_clickTolerance",void 0),g_(this,"_sum",void 0),g_(this,"_map",void 0),this._clickTolerance=t.clickTolerance||1,this._map=e,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new qm(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,e,r){return this._calculateTransform(t,e,r)}touchmove(t,e,r){if(this._active&&!(r.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,e,r)}touchend(t,e,r){this._calculateTransform(t,e,r),this._active&&r.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,e,r){r.length>0&&(this._active=!0);const n=pP(r,e),i=new qm(0,0),o=new qm(0,0);let a=0;for(const t in n){const e=n[t],r=this._touches[t];r&&(i._add(e),o._add(e.sub(r)),a++,n[t]=e)}if(this._touches=n,a<this.minTouchs()||!o.mag())return;const s=o.div(a);if(this._sum._add(s),this._sum.mag()<this._clickTolerance)return;return{around:i.div(a),panDelta:s}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vP{constructor(){g_(this,"_enabled",void 0),g_(this,"_active",void 0),g_(this,"_firstTwoTouches",void 0),g_(this,"_vector",void 0),g_(this,"_startVector",void 0),g_(this,"_aroundCenter",void 0),this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,e,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,r){if(!this._firstTwoTouches)return;t.preventDefault();const[n,i]=this._firstTwoTouches,o=yP(r,e,n),a=yP(r,e,i);if(!o||!a)return;const s=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],s,t)}touchend(t,e,r){if(!this._firstTwoTouches)return;const[n,i]=this._firstTwoTouches,o=yP(r,e,n),a=yP(r,e,i);o&&a||(this._active&&zO.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function yP(t,e,r){for(let n=0;n<t.length;n++)if(t[n].identifier===r)return e[n]}function xP(t,e){return Math.log(t/e)/Math.LN2}class bP extends vP{constructor(...t){super(...t),g_(this,"_distance",void 0),g_(this,"_startDistance",void 0)}reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const r=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(xP(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xP(this._distance,r),pinchAround:e}}}function EP(t,e){return 180*t.angleWith(e)/Math.PI}class TP extends vP{constructor(...t){super(...t),g_(this,"_minDiameter",void 0)}reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e,r){const n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:EP(this._vector,n),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,r=EP(t,this._startVector);return Math.abs(r)<e}}function SP(t){return Math.abs(t.y)>Math.abs(t.x)}class AP extends vP{constructor(t){super(),g_(this,"_valid",void 0),g_(this,"_firstMove",void 0),g_(this,"_lastPoints",void 0),g_(this,"_map",void 0),g_(this,"_currentTouchCount",0),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,e,r){super.touchstart(t,e,r),this._currentTouchCount=r.length}_start(t){this._lastPoints=t,SP(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,r){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const n=t[0].sub(this._lastPoints[0]),i=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(n,i,r.timeStamp),!this._valid)return;this._lastPoints=t,this._active=!0;return{pitchDelta:-.5*((n.y+i.y)/2)}}gestureBeginsVertically(t,e,r){if(void 0!==this._valid)return this._valid;const n=t.mag()>=2,i=e.mag()>=2;if(!n&&!i)return;if(!n||!i)return void 0===this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return SP(t)&&SP(e)&&o}}const wP={linearity:.3,easing:fO(0,0,.3,1)},CP=dO({deceleration:2500,maxSpeed:1400},wP),RP=dO({deceleration:20,maxSpeed:1400},wP),LP=dO({deceleration:1e3,maxSpeed:360},wP),IP=dO({deceleration:1e3,maxSpeed:90},wP);class MP{constructor(t){g_(this,"_map",void 0),g_(this,"_inertiaBuffer",void 0),this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:LO.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,e=LO.now();for(;t.length>0&&e-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const e={zoom:0,bearing:0,pitch:0,pan:new qm(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)e.zoom+=t.zoomDelta||0,e.bearing+=t.bearingDelta||0,e.pitch+=t.pitchDelta||0,t.panDelta&&e.pan._add(t.panDelta),t.around&&(e.around=t.around),t.pinchAround&&(e.pinchAround=t.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(e.pan.mag()){const i=PP(e.pan.mag(),r,dO({},CP,t||{}));n.offset=e.pan.mult(i.amount/e.pan.mag()),n.center=this._map.transform.center,OP(n,i)}if(e.zoom){const t=PP(e.zoom,r,RP);n.zoom=this._map.transform.zoom+t.amount,OP(n,t)}if(e.bearing){const t=PP(e.bearing,r,LP);n.bearing=this._map.transform.bearing+cO(t.amount,-179,179),OP(n,t)}if(e.pitch){const t=PP(e.pitch,r,IP);n.pitch=this._map.transform.pitch+t.amount,OP(n,t)}if(n.zoom||n.bearing){const t=void 0===e.pinchAround?e.around:e.pinchAround;n.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),dO(n,{noMoveStart:!0})}}function OP(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function PP(t,e,r){const{maxSpeed:n,linearity:i,deceleration:o}=r,a=cO(t*i/(e/1e3),-n,n),s=Math.abs(a)/(o*i);return{easing:r.easing,duration:1e3*s,amount:a*(s/2)}}const DP=t=>t.zoom||t.drag||t.pitch||t.rotate;class BP extends OO{constructor(t,e){super(t),g_(this,"type","renderFrame"),g_(this,"timeStamp",void 0),this.timeStamp=e}}function NP(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class FP{constructor(t,e){g_(this,"_map",void 0),g_(this,"_el",void 0),g_(this,"_handlers",void 0),g_(this,"_eventsInProgress",void 0),g_(this,"_frameId",void 0),g_(this,"_inertia",void 0),g_(this,"_bearingSnap",void 0),g_(this,"_handlersById",void 0),g_(this,"_updatingCamera",void 0),g_(this,"_changes",void 0),g_(this,"_zoom",void 0),g_(this,"_previousActiveHandlers",void 0),g_(this,"_listeners",void 0),g_(this,"handleWindowEvent",(t=>{this.handleEvent(t,`${t.type}Window`)})),g_(this,"handleEvent",((t,e)=>{if("blur"===t.type)return void this.stop(!0);this._updatingCamera=!0;const r="renderFrame"===t.type?void 0:t,n={needsRenderFrame:!1},i={},o={},a=t.touches,s=a?this._getMapTouches(a):void 0,l=s?zO.touchPos(this._map.getCanvasContainer(),s):zO.mousePos(this._map.getCanvasContainer(),t);for(const{handlerName:a,handler:u,allowed:c}of this._handlers){if(!u.isEnabled())continue;let h;this._blockedByActive(o,c,a)?u.reset():u[e||t.type]&&(h=u[e||t.type](t,l,s),this.mergeHandlerResult(n,i,h,a,r),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||u.isActive())&&(o[a]=u)}const u={};for(const t in this._previousActiveHandlers)o[t]||(u[t]=r);this._previousActiveHandlers=o,(Object.keys(u).length||NP(n))&&(this._changes.push([n,i,u]),this._triggerRenderFrame()),(Object.keys(o).length||NP(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:c}=n;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))})),this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new MP(t),this._bearingSnap=e.bearingSnap||7,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(e);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,e,r]of this._listeners)zO.addEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,r)}destroy(){for(const[t,e,r]of this._listeners)zO.removeEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(t){const e=this._map,r=e.getCanvasContainer();this._add("mapEvent",new $O(e,t));const n=e.boxZoom=new jO(e,t);this._add("boxZoom",n),t.interactive&&t.boxZoom&&n.enable();const i=e.cooperativeGestures=new HO(e,t.cooperativeGestures);this._add("cooperativeGestures",i),t.cooperativeGestures&&i.enable();const o=new gP(e),a=new VO(e);e.doubleClickZoom=new lP(a,o),this._add("tapZoom",o),this._add("clickZoom",a),t.interactive&&t.doubleClickZoom&&e.doubleClickZoom.enable();const s=new mP;this._add("tapDragZoom",s);const l=e.touchPitch=new AP(e);this._add("touchPitch",l),t.interactive&&t.touchPitch&&e.touchPitch.enable(t.touchPitch);const u=(({enable:t,clickTolerance:e,bearingDegreesPerPixelMoved:r=.8})=>{const n=new nP({checkCorrectEvent:t=>0===zO.mouseButton(t)&&t.ctrlKey||2===zO.mouseButton(t)});return new JO({clickTolerance:e,move:(t,e)=>({bearingDelta:(e.x-t.x)*r}),moveStateManager:n,enable:t,assignEvents:iP})})(t),c=(({enable:t,clickTolerance:e,pitchDegreesPerPixelMoved:r=-.5})=>{const n=new nP({checkCorrectEvent:t=>0===zO.mouseButton(t)&&t.ctrlKey||2===zO.mouseButton(t)});return new JO({clickTolerance:e,move:(t,e)=>({pitchDelta:(e.y-t.y)*r}),moveStateManager:n,enable:t,assignEvents:iP})})(t);e.dragRotate=new cP(t,u,c),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]),t.interactive&&t.dragRotate&&e.dragRotate.enable();const h=(({enable:t,clickTolerance:e})=>{const r=new nP({checkCorrectEvent:t=>0===zO.mouseButton(t)&&!t.ctrlKey});return new JO({clickTolerance:e,move:(t,e)=>({around:e,panDelta:e.sub(t)}),activateOnStart:!0,moveStateManager:r,enable:t,assignEvents:iP})})(t),p=new _P(t,e);e.dragPan=new uP(r,h,p),this._add("mousePan",h),this._add("touchPan",p,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&e.dragPan.enable(t.dragPan);const d=new TP,f=new bP;e.touchZoomRotate=new hP(r,f,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&e.touchZoomRotate.enable(t.touchZoomRotate);const m=e.scrollZoom=new sP(e,(()=>this._triggerRenderFrame()));this._add("scrollZoom",m,["mousePan"]),t.interactive&&t.scrollZoom&&e.scrollZoom.enable(t.scrollZoom);const g=e.keyboard=new XO(e);this._add("keyboard",g),t.interactive&&t.keyboard&&e.keyboard.enable(),this._add("blockableMapEvent",new QO(e))}_add(t,e,r){this._handlers.push({handlerName:t,handler:e,allowed:r}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(DP(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,r){for(const n in t)if(n!==r&&(!e||e.indexOf(n)<0))return!0;return!1}_getMapTouches(t){const e=[];for(const r of t){const t=r.target;this._el.contains(t)&&e.push(r)}return e}mergeHandlerResult(t,e,r,n,i){if(!r)return;dO(t,r);const o={handlerName:n,originalEvent:r.originalEvent||i};void 0!==r.zoomDelta&&(e.zoom=o),void 0!==r.panDelta&&(e.drag=o),void 0!==r.pitchDelta&&(e.pitch=o),void 0!==r.bearingDelta&&(e.rotate=o)}_applyChanges(){const t={},e={},r={};for(const[n,i,o]of this._changes)n.panDelta&&(t.panDelta=(t.panDelta||new qm(0,0))._add(n.panDelta)),n.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(t.around=n.around),void 0!==n.pinchAround&&(t.pinchAround=n.pinchAround),n.noInertia&&(t.noInertia=n.noInertia),dO(e,i),dO(r,o);this._updateMapTransform(t,e,r),this._changes=[]}_updateMapTransform(t,e,r){const n=this._map,i=n._getTransformForUpdate();if(!NP(t))return this._fireEvents(e,r,!0);const{panDelta:o,zoomDelta:a,bearingDelta:s,pitchDelta:l,pinchAround:u}=t;let{around:c}=t;void 0!==u&&(c=u),n._stop(!0),c=c||n.transform.centerPoint;const h=i.pointLocation(o?c.sub(o):c);s&&(i.bearing+=s),l&&(i.pitch+=l),a&&(i.zoom+=a),i.setLocationAtPoint(h,c),n._applyUpdatedTransform(i),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,r,!0)}_fireEvents(t,e,r){const n=DP(this._eventsInProgress),i=DP(t),o={};for(const e in t){const{originalEvent:r}=t[e];this._eventsInProgress[e]||(o[`${e}start`]=r),this._eventsInProgress[e]=t[e]}!n&&i&&this._fireEvent("movestart",i.originalEvent);for(const t in o)this._fireEvent(t,o[t]);i&&this._fireEvent("move",i.originalEvent);for(const e in t){const{originalEvent:r}=t[e];this._fireEvent(e,r)}const a={};let s;for(const t in this._eventsInProgress){const{handlerName:r,originalEvent:n}=this._eventsInProgress[t];this._handlersById[r].isActive()||(delete this._eventsInProgress[t],s=e[r]||n,a[`${t}end`]=s)}for(const t in a)this._fireEvent(t,a[t]);const l=DP(this._eventsInProgress);if(r&&((n||i)&&!l)){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),e=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;!t||!t.essential&&LO.prefersReducedMotion?(this._map.fire(new OO("moveend",{originalEvent:s})),e(this._map.getBearing())&&this._map.resetNorth()):(e(t.bearing||this._map.getBearing())&&(t.bearing=0),t.freezeElevation=!0,this._map.easeTo(t,{originalEvent:s})),this._updatingCamera=!1}}_fireEvent(t,e){this._map.fire(new OO(t,e?{originalEvent:e}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new BP("renderFrame",t)),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class kP{constructor(){g_(this,"_queue",void 0),g_(this,"_id",void 0),g_(this,"_cleared",void 0),g_(this,"_currentlyRunning",void 0),this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,r=e?this._queue.concat(e):this._queue;for(const e of r)if(e.id===t)return void(e.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const e=this._currentlyRunning=this._queue;this._queue=[];for(const r of e)if(!r.cancelled&&(r.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}!function(t,e){var r="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,n="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!r&&!n&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".l7-map {\n  font:\n    12px/20px 'Helvetica Neue',\n    Arial,\n    Helvetica,\n    sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: grab;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  touch-action: none;\n}\n\n.l7-canvas-container.l7-touch-drag-pan.l7-cooperative-gestures,\n.l7-canvas-container.l7-touch-drag-pan.l7-cooperative-gestures .l7-canvas {\n  touch-action: pan-x pan-y;\n}\n\n.l7-cooperative-gesture-screen {\n  background: rgba(0 0 0 / 40%);\n  position: absolute;\n  inset: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: white;\n  padding: 1rem;\n  font-size: 1.4em;\n  line-height: 1.2;\n  opacity: 0;\n  pointer-events: none;\n  transition: opacity 1s ease 1s;\n  z-index: 99999;\n}\n\n.l7-cooperative-gesture-screen.l7-show {\n  opacity: 1;\n  transition: opacity 0.05s;\n}\n\n.l7-cooperative-gesture-screen .l7-mobile-message {\n  display: none;\n}\n\n@media (hover: none), (width <= 480px) {\n  .l7-cooperative-gesture-screen .l7-desktop-message {\n    display: none;\n  }\n\n  .l7-cooperative-gesture-screen .l7-mobile-message {\n    display: block;\n  }\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right {\n  position: absolute;\n  pointer-events: none;\n  z-index: 2;\n}\n.l7-ctrl-top-left {\n  top: 0;\n  left: 0;\n}\n.l7-ctrl-top-right {\n  top: 0;\n  right: 0;\n}\n.l7-ctrl-bottom-left {\n  bottom: 0;\n  left: 0;\n}\n.l7-ctrl-bottom-right {\n  right: 0;\n  bottom: 0;\n}\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl {\n  margin: 10px 0 0 10px;\n  float: left;\n}\n.l7-ctrl-top-right .l7-ctrl {\n  margin: 10px 10px 0 0;\n  float: right;\n}\n.l7-ctrl-bottom-left .l7-ctrl {\n  margin: 0 0 10px 10px;\n  float: left;\n}\n.l7-ctrl-bottom-right .l7-ctrl {\n  margin: 0 10px 10px 0;\n  float: right;\n}\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n  cursor: crosshair;\n}\n\n.l7-boxzoom {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 0;\n  height: 0;\n  background: #fff;\n  border: 2px dotted #202020;\n  opacity: 0.5;\n  z-index: 10;\n}\n");const UP={interactive:!0,bearingSnap:7,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,fadeDuration:300,clickTolerance:3,pitchWithRotate:!0};class zP extends BO{constructor(t){const e=v_(v_({},UP),t);if(null!=e.minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new kO(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),g_(this,"_container",void 0),g_(this,"_canvasContainer",void 0),g_(this,"_interactive",void 0),g_(this,"_frameRequest",void 0),g_(this,"_loaded",void 0),g_(this,"_idleTriggered",!1),g_(this,"_fullyLoaded",void 0),g_(this,"_trackResize",void 0),g_(this,"_resizeObserver",void 0),g_(this,"_preserveDrawingBuffer",void 0),g_(this,"_failIfMajorPerformanceCaveat",void 0),g_(this,"_fadeDuration",void 0),g_(this,"_crossSourceCollisions",void 0),g_(this,"_crossFadingFactor",1),g_(this,"_collectResourceTiming",void 0),g_(this,"_renderTaskQueue",new kP),g_(this,"_mapId",pO++),g_(this,"_removed",void 0),g_(this,"_clickTolerance",void 0),g_(this,"scrollZoom",void 0),g_(this,"boxZoom",void 0),g_(this,"dragRotate",void 0),g_(this,"dragPan",void 0),g_(this,"keyboard",void 0),g_(this,"doubleClickZoom",void 0),g_(this,"touchZoomRotate",void 0),g_(this,"touchPitch",void 0),g_(this,"cooperativeGestures",void 0),g_(this,"_onMapScroll",(t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1})),this._interactive=e.interactive,this._trackResize=!0===e.trackResize,this._bearingSnap=e.bearingSnap,this._fadeDuration=e.fadeDuration,this._clickTolerance=e.clickTolerance,"string"==typeof e.container){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this.on("move",(()=>this._update())).on("moveend",(()=>this._update())).on("zoom",(()=>this._update())).once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window){let t=!1;const e=ld.throttle((t=>{this._trackResize&&!this._removed&&this.resize(t)._update()}),50);this._resizeObserver=new ResizeObserver((r=>{t?e(r):t=!0})),this._resizeObserver.observe(this._container)}this.handlers=new FP(this,e),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,dO({},e.fitBoundsOptions,{duration:0}))),this.resize()}_getMapId(){return this._mapId}calculateCameraOptionsFromTo(t,e,r,n){return super.calculateCameraOptionsFromTo(t,e,r,n)}resize(t){var e;const r=this._containerDimensions(),n=r[0],i=r[1];this.transform.resize(n,i),null===(e=this._requestedCameraState)||void 0===e||e.resize(n,i);const o=!this._moving;return o&&(this.stop(),this.fire(new OO("movestart",t)).fire(new OO("move",t))),this.fire(new OO("resize",t)),o&&this.fire(new OO("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(t&&CO.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?60:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){this.transform.renderWorldCopies=t}project(t){return this.transform.locationPoint(yO.convert(t))}unproject(t){return this.transform.pointLocation(qm.convert(t))}isMoving(){var t;return this._moving||(null===(t=this.handlers)||void 0===t?void 0:t.isMoving())}isZooming(){var t;return this._zooming||(null===(t=this.handlers)||void 0===t?void 0:t.isZooming())}isRotating(){var t;return this._rotating||(null===(t=this.handlers)||void 0===t?void 0:t.isRotating())}on(t,e){return super.on(t,e)}once(t,e){return super.once(t,e)}off(t,e){return super.off(t,e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_setupContainer(){const t=this._container;t.classList.add("l7-map");const e=this._canvasContainer=zO.create("div","l7-canvas-container",t);this._interactive&&e.classList.add("l7-interactive"),this._container.addEventListener("scroll",this._onMapScroll,!1)}_update(){return this.triggerRepaint(),this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(t){if(this._renderTaskQueue.run(t),!this._removed)return this.fire(new OO("render")),this.isMoving()||this.fire(new OO("idle")),this}remove(){var t;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.handlers.destroy(),delete this.handlers,null===(t=this._resizeObserver)||void 0===t||t.disconnect(),zO.remove(this._canvasContainer),this._container.classList.remove("l7-map"),this._removed=!0,this.fire(new OO("remove"))}triggerRepaint(){this._frameRequest||(this._frameRequest=new AbortController,LO.frameAsync(this._frameRequest).then((t=>{this._frameRequest=null,this._render(t)})).catch((()=>{})))}getCameraTargetElevation(){return this.transform.elevation}}const GP=["id","style","rotation","mapInstance","version","mapSize","interactive"];class jP extends aO{constructor(...t){super(...t),g_(this,"version",KM.DEFAULT),g_(this,"viewport",void 0)}lngLatToCoord(t,e={x:0,y:0,z:0}){const{x:r,y:n}=this.lngLatToMercator(t,0);return[r-e.x,n-e.y]}lngLatToMercator(t,e){const{x:r=0,y:n=0,z:i=0}=wO.fromLngLat(t,e);return{x:r,y:n,z:i}}getModelMatrix(t,e,r,n=[1,1,1],i={x:0,y:0,z:0}){const o=wO.fromLngLat(t,e),a=o.meterInMercatorCoordinateUnits(),s=wv();return Iv(s,s,kv(o.x-i.x,o.y-i.y,o.z||0-i.z)),Mv(s,s,kv(a*n[0],-a*n[1],a*n[2])),Ov(s,s,r[0]),Pv(s,s,r[1]),Dv(s,s,r[2]),s}init(){var t=this;return Ev((function*(){const e=t.config,{id:r="map",style:n="light",rotation:i=0,mapInstance:o,version:a="DEFAULTMAP",mapSize:s=1e4,interactive:l=!0}=e,u=Ay(e,GP);t.viewport=new YM,t.version=a,t.simpleMapCoord.setSize(s),"SIMPLE"===a&&u.center&&(u.center=t.simpleMapCoord.unproject(u.center)),o?(t.map=o,t.$mapContainer=t.map.getContainer()):(t.$mapContainer=t.creatMapContainer(r),t.map=new zP(v_({container:t.$mapContainer,bearing:i},u))),t.map.on("load",(()=>{t.handleCameraChanged()})),l&&t.map.on("move",t.handleCameraChanged),setTimeout((()=>{t.handleCameraChanged()}),100),t.handleCameraChanged()}))()}creatMapContainer(t){let e=t;"string"==typeof t&&(e=document.getElementById(t));const r=document.createElement("div");return r.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",e.appendChild(r),r}exportMap(t){return""}setMapStyle(t){}getCanvasOverlays(){return this.getContainer()}}class VP extends yM{getServiceConstructor(){return jP}}var HP={exports:{}};!function(t,e){t.exports=function(){var t,e,r;function n(n,i){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),r=i(a),"undefined"!=typeof window&&(r.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=i;else t=i}return n(["exports"],(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var r=n;function n(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}n.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var r,n,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?r=i:n=i,i=.5*(n-r)+r}return i},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var i=o;function o(t,e){this.x=t,this.y=e}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var a="undefined"!=typeof self?self:{},s=Math.pow(2,53)-1;function l(t,e,n,i){var o=new r(t,e,n,i);return function(t){return o.solve(t)}}var u=l(.25,.1,.25,1);function c(t,e,r){return Math.min(r,Math.max(e,t))}function h(t,e,r){var n=r-e,i=((t-e)%n+n)%n+e;return i===e?r:i}function p(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var o=i[n];for(var a in o)t[a]=o[a]}return t}var d=1;function f(){return d++}function m(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function g(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function _(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function v(t,e){return-1!==t.indexOf(e,t.length-e.length)}function y(t,e,r){var n={};for(var i in t)n[i]=e.call(r||this,t[i],i,t);return n}function x(t,e,r){var n={};for(var i in t)e.call(r||this,t[i],i,t)&&(n[i]=t[i]);return n}function b(t){return Array.isArray(t)?t.map(b):"object"==typeof t&&t?y(t,b):t}var E={};function T(t){E[t]||("undefined"!=typeof console&&console.warn(t),E[t]=!0)}function S(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function A(t){for(var e=0,r=0,n=t.length,i=n-1,o=void 0,a=void 0;r<n;i=r++)e+=((a=t[i]).x-(o=t[r]).x)*(o.y+a.y);return e}function w(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function C(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,r,n,i){var o=n||i;return e[r]=!o||o.toLowerCase(),""})),e["max-age"]){var r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}var R=null;function L(t){if(null==R){var e=t.navigator?t.navigator.userAgent:null;R=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return R}function I(t){try{var e=a[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var M,O,P,D,B=a.performance&&a.performance.now?a.performance.now.bind(a.performance):Date.now.bind(Date),N=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,F=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame||a.msCancelAnimationFrame,k={now:B,frame:function(t){var e=N(t);return{cancel:function(){return F(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var r=a.document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return M||(M=a.document.createElement("a")),M.href=t,M.href},hardwareConcurrency:a.navigator&&a.navigator.hardwareConcurrency||4,get devicePixelRatio(){return a.devicePixelRatio},get prefersReducedMotion(){return!!a.matchMedia&&(null==O&&(O=a.matchMedia("(prefers-reduced-motion: reduce)")),O.matches)}},U={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},z={supported:!1,testSupport:function(t){!G&&D&&(j?V(t):P=t)}},G=!1,j=!1;function V(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,D),t.isContextLost())return;z.supported=!0}catch(t){}t.deleteTexture(e),G=!0}a.document&&((D=a.document.createElement("img")).onload=function(){P&&V(P),P=null,j=!0},D.onerror=function(){G=!0,P=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var H="01",W=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function X(t){return 0===t.indexOf("mapbox:")}W.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",H,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},W.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},W.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},W.prototype.normalizeStyleURL=function(t,e){if(!X(t))return t;var r=K(t);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},W.prototype.normalizeGlyphsURL=function(t,e){if(!X(t))return t;var r=K(t);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},W.prototype.normalizeSourceURL=function(t,e){if(!X(t))return t;var r=K(t);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)},W.prototype.normalizeSpriteURL=function(t,e,r,n){var i=K(t);return X(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+r,this._makeAPIURL(i,this._customAccessToken||n)):(i.path+=""+e+r,$(i))},W.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!X(t))return t;var r=K(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(k.devicePixelRatio>=2||512===e?"@2x":"")+(z.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var n=this._customAccessToken||function(t){for(var e=0,r=t;e<r.length;e+=1){var n=r[e].match(/^access_token=(.*)$/);if(n)return n[1]}return null}(r.params)||U.ACCESS_TOKEN;return U.REQUIRE_ACCESS_TOKEN&&n&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,n)},W.prototype.canonicalizeTileURL=function(t,e){var r=K(t);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return t;var n="mapbox://tiles/";n+=r.path.replace("/v4/","");var i=r.params;return e&&(i=i.filter((function(t){return!t.match(/^access_token=/)}))),i.length&&(n+="?"+i.join("&")),n},W.prototype.canonicalizeTileset=function(t,e){for(var r=!!e&&X(e),n=[],i=0,o=t.tiles||[];i<o.length;i+=1){var a=o[i];q(a)?n.push(this.canonicalizeTileURL(a,r)):n.push(a)}return n},W.prototype._makeAPIURL=function(t,e){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=K(U.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"http"===t.protocol){var i=t.params.indexOf("secure");i>=0&&t.params.splice(i,1)}if("/"!==n.path&&(t.path=""+n.path+t.path),!U.REQUIRE_ACCESS_TOKEN)return $(t);if(!(e=e||U.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return t.params=t.params.filter((function(t){return-1===t.indexOf("access_token")})),t.params.push("access_token="+e),$(t)};var Z=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function q(t){return Z.test(t)}var Y=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function K(t){var e=t.match(Y);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function $(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function Q(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(a.atob(e[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return null}}var J=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};J.prototype.getStorageKey=function(t){var e,r=Q(U.ACCESS_TOKEN);return e=r&&r.u?a.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))}))):U.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},J.prototype.fetchEventData=function(){var t=I("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{var n=a.localStorage.getItem(e);n&&(this.eventData=JSON.parse(n));var i=a.localStorage.getItem(r);i&&(this.anonId=i)}catch(t){T("Unable to read from LocalStorage")}},J.prototype.saveEventData=function(){var t=I("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{a.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&a.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){T("Unable to write to LocalStorage")}},J.prototype.processRequests=function(t){},J.prototype.postEvent=function(t,e,r,n){var i=this;if(U.EVENTS_URL){var o=K(U.EVENTS_URL);o.params.push("access_token="+(n||U.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:H,userId:this.anonId},s=e?p(a,e):a,l={url:$(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=bt(l,(function(t){i.pendingRequest=null,r(t),i.saveEventData(),i.processRequests(n)}))}},J.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var tt,et,rt=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,r,n){this.skuToken=r;var i=!(!n&&!U.ACCESS_TOKEN),o=Array.isArray(t)&&t.some((function(t){return X(t)||q(t)}));U.EVENTS_URL&&i&&o&&this.queueRequest({id:e,timestamp:Date.now()},n)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var r=this.queue.shift(),n=r.id,i=r.timestamp;n&&this.success[n]||(this.anonId||this.fetchEventData(),g(this.anonId)||(this.anonId=m()),this.postEvent(i,{skuToken:this.skuToken},(function(t){t||n&&(e.success[n]=!0)}),t))}},e}(J),nt=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){U.EVENTS_URL&&U.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return X(t)||q(t)}))&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var r=Q(U.ACCESS_TOKEN),n=r?r.u:U.ACCESS_TOKEN,i=n!==this.eventData.tokenU;g(this.anonId)||(this.anonId=m(),i=!0);var o=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),s=new Date(o),l=(o-this.eventData.lastSuccess)/864e5;i=i||l>=1||l<-1||a.getDate()!==s.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(o,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=o,e.eventData.tokenU=n)}),t)}},e}(J)),it=nt.postTurnstileEvent.bind(nt),ot=new rt,at=ot.postMapLoadEvent.bind(ot),st=500,lt=50;function ut(){a.caches&&!tt&&(tt=a.caches.open("mapbox-tiles"))}function ct(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var ht,pt=1/0;function dt(){return null==ht&&(ht=a.OffscreenCanvas&&new a.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof a.createImageBitmap),ht}var ft={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ft);var mt,gt,_t=function(t){function e(e,r,n){401===r&&q(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=r,this.url=n,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),vt=w()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===a.location.protocol?a.parent:a).location.href},yt=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(vt())&&!/^\w+:/.test(r))){if(a.fetch&&a.Request&&a.AbortController&&a.Request.prototype.hasOwnProperty("signal"))return function(t,e){var r,n=new a.AbortController,i=new a.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:vt(),signal:n.signal}),o=!1,s=!1,l=(r=i.url).indexOf("sku=")>0&&q(r);"json"===t.type&&i.headers.set("Accept","application/json");var u=function(r,n,o){if(!s){if(r&&"SecurityError"!==r.message&&T(r),n&&o)return c(n);var u=Date.now();a.fetch(i).then((function(r){if(r.ok){var n=l?r.clone():null;return c(r,n,u)}return e(new _t(r.statusText,r.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},c=function(r,n,l){("arrayBuffer"===t.type?r.arrayBuffer():"json"===t.type?r.json():r.text()).then((function(t){s||(n&&l&&function(t,e,r){if(ut(),tt){var n={status:e.status,statusText:e.statusText,headers:new a.Headers};e.headers.forEach((function(t,e){return n.headers.set(e,t)}));var i=C(e.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&n.headers.set("Expires",new Date(r+1e3*i["max-age"]).toUTCString()),new Date(n.headers.get("Expires")).getTime()-r<42e4||function(t,e){if(void 0===et)try{new Response(new ReadableStream),et=!0}catch(t){et=!1}et?e(t.body):t.blob().then(e)}(e,(function(e){var r=new a.Response(e,n);ut(),tt&&tt.then((function(e){return e.put(ct(t.url),r)})).catch((function(t){return T(t.message)}))})))}}(i,n,l),o=!0,e(null,t,r.headers.get("Cache-Control"),r.headers.get("Expires")))})).catch((function(t){s||e(new Error(t.message))}))};return l?function(t,e){if(ut(),!tt)return e(null);var r=ct(t.url);tt.then((function(t){t.match(r).then((function(n){var i=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),r=C(t.headers.get("Cache-Control")||"");return e>Date.now()&&!r["no-cache"]}(n);t.delete(r),i&&t.put(r,n.clone()),e(null,n,i)})).catch(e)})).catch(e)}(i,u):u(null,null),{cancel:function(){s=!0,o||n.abort()}}}(t,e);if(w()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(t,e){var r=new a.XMLHttpRequest;for(var n in r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer"),t.headers)r.setRequestHeader(n,t.headers[n]);return"json"===t.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===t.credentials,r.onerror=function(){e(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){var n=r.response;if("json"===t.type)try{n=JSON.parse(r.response)}catch(t){return e(t)}e(null,n,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else e(new _t(r.statusText,r.status,t.url))},r.send(t.body),{cancel:function(){return r.abort()}}}(t,e)},xt=function(t,e){return yt(p(t,{type:"arrayBuffer"}),e)},bt=function(t,e){return yt(p(t,{method:"POST"}),e)},Et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";mt=[],gt=0;var Tt=function(t,e){if(z.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),gt>=U.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return mt.push(r),r}gt++;var n=!1,i=function(){if(!n)for(n=!0,gt--;mt.length&&gt<U.MAX_PARALLEL_IMAGE_REQUESTS;){var t=mt.shift();t.cancelled||(t.cancel=Tt(t.requestParameters,t.callback).cancel)}},o=xt(t,(function(t,r,n,o){i(),t?e(t):r&&(dt()?function(t,e){var r=new a.Blob([new Uint8Array(t)],{type:"image/png"});a.createImageBitmap(r).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(r,e):function(t,e,r,n){var i=new a.Image,o=a.URL;i.onload=function(){e(null,i),o.revokeObjectURL(i.src),i.onload=null,a.requestAnimationFrame((function(){i.src=Et}))},i.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var s=new a.Blob([new Uint8Array(t)],{type:"image/png"});i.cacheControl=r,i.expires=n,i.src=t.byteLength?o.createObjectURL(s):Et}(r,e,n,o))}));return{cancel:function(){o.cancel(),i()}}};function St(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e))}function At(t,e,r){if(r&&r[t]){var n=r[t].indexOf(e);-1!==n&&r[t].splice(n,1)}}var wt=function(t,e){void 0===e&&(e={}),p(this,e),this.type=t},Ct=function(t){function e(e,r){void 0===r&&(r={}),t.call(this,"error",p({error:e},r))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(wt),Rt=function(){};Rt.prototype.on=function(t,e){return this._listeners=this._listeners||{},St(t,e,this._listeners),this},Rt.prototype.off=function(t,e){return At(t,e,this._listeners),At(t,e,this._oneTimeListeners),this},Rt.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},St(t,e,this._oneTimeListeners),this},Rt.prototype.fire=function(t,e){"string"==typeof t&&(t=new wt(t,e||{}));var r=t.type;if(this.listens(r)){t.target=this;for(var n=0,i=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];n<i.length;n+=1)i[n].call(this,t);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];o<a.length;o+=1){var s=a[o];At(r,s,this._oneTimeListeners),s.call(this,t)}var l=this._eventedParent;l&&(p(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),l.fire(t))}else t instanceof Ct&&console.error(t.error);return this},Rt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Rt.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var Lt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},It=function(t,e,r,n){this.message=(t?t+": ":"")+r,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)};function Mt(t){var e=t.value;return e?[new It(t.key,e,"constants have been deprecated as of v8")]:[]}function Ot(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var o=i[n];for(var a in o)t[a]=o[a]}return t}function Pt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Dt(t){if(Array.isArray(t))return t.map(Dt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var r in t)e[r]=Dt(t[r]);return e}return Pt(t)}var Bt=function(t){function e(e,r){t.call(this,r),this.message=r,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),Nt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,n=e;r<n.length;r+=1){var i=n[r];this.bindings[i[0]]=i[1]}};Nt.prototype.concat=function(t){return new Nt(this,t)},Nt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Nt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Ft={kind:"null"},kt={kind:"number"},Ut={kind:"string"},zt={kind:"boolean"},Gt={kind:"color"},jt={kind:"object"},Vt={kind:"value"},Ht={kind:"collator"},Wt={kind:"formatted"},Xt={kind:"resolvedImage"};function Zt(t,e){return{kind:"array",itemType:t,N:e}}function qt(t){if("array"===t.kind){var e=qt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Yt=[Ft,kt,Ut,zt,Gt,Wt,jt,Zt(Vt),Xt];function Kt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Kt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,n=Yt;r<n.length;r+=1)if(!Kt(n[r],e))return null}return"Expected "+qt(t)+" but found "+qt(e)+" instead."}function $t(t,e){return e.some((function(e){return e.kind===t.kind}))}function Qt(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t}))}var Jt=e((function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return n("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function a(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in r)return r[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=s.indexOf("("),u=s.indexOf(")");if(-1!==l&&u+1===s.length){var c=s.substr(0,l),h=s.substr(l+1,u-(l+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=o(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),p];case"hsla":if(4!==h.length)return null;p=o(h.pop());case"hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,f=o(h[1]),m=o(h[2]),g=m<=.5?m*(f+1):m+f-m*f,_=2*m-g;return[n(255*a(_,g,d+1/3)),n(255*a(_,g,d)),n(255*a(_,g,d-1/3)),p];default:return null}}return null}}catch(t){}})).parseCSSColor,te=function(t,e,r,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=r,this.a=n};te.parse=function(t){if(t){if(t instanceof te)return t;if("string"==typeof t){var e=Jt(t);if(e)return new te(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},te.prototype.toString=function(){var t=this.toArray(),e=t[1],r=t[2],n=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(r)+","+n+")"},te.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},te.black=new te(0,0,0,1),te.white=new te(1,1,1,1),te.transparent=new te(0,0,0,0),te.red=new te(1,0,0,1);var ee=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ee.prototype.compare=function(t,e){return this.collator.compare(t,e)},ee.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var re=function(t,e,r,n,i){this.text=t,this.image=e,this.scale=r,this.fontStack=n,this.textColor=i},ne=function(t){this.sections=t};ne.fromString=function(t){return new ne([new re(t,null,null,null,null)])},ne.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},ne.factory=function(t){return t instanceof ne?t:ne.fromString(t)},ne.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},ne.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];if(n.image)t.push(["image",n.image.name]);else{t.push(n.text);var i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(i)}}return t};var ie=function(t){this.name=t.name,this.available=t.available};function oe(t,e,r,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value ["+[t,e,r,n].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ae(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof te)return!0;if(t instanceof ee)return!0;if(t instanceof ne)return!0;if(t instanceof ie)return!0;if(Array.isArray(t)){for(var e=0,r=t;e<r.length;e+=1)if(!ae(r[e]))return!1;return!0}if("object"==typeof t){for(var n in t)if(!ae(t[n]))return!1;return!0}return!1}function se(t){if(null===t)return Ft;if("string"==typeof t)return Ut;if("boolean"==typeof t)return zt;if("number"==typeof t)return kt;if(t instanceof te)return Gt;if(t instanceof ee)return Ht;if(t instanceof ne)return Wt;if(t instanceof ie)return Xt;if(Array.isArray(t)){for(var e,r=t.length,n=0,i=t;n<i.length;n+=1){var o=se(i[n]);if(e){if(e===o)continue;e=Vt;break}e=o}return Zt(e||Vt,r)}return jt}function le(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof te||t instanceof ne||t instanceof ie?t.toString():JSON.stringify(t)}ie.prototype.toString=function(){return this.name},ie.fromString=function(t){return t?new ie({name:t,available:!1}):null},ie.prototype.serialize=function(){return["image",this.name]};var ue=function(t,e){this.type=t,this.value=e};ue.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!ae(t[1]))return e.error("invalid value");var r=t[1],n=se(r),i=e.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new ue(n,r)},ue.prototype.evaluate=function(){return this.value},ue.prototype.eachChild=function(){},ue.prototype.outputDefined=function(){return!0},ue.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof te?["rgba"].concat(this.value.toArray()):this.value instanceof ne?this.value.serialize():this.value};var ce=function(t){this.name="ExpressionEvaluationError",this.message=t};ce.prototype.toJSON=function(){return this.message};var he={string:Ut,number:kt,boolean:zt,object:jt},pe=function(t,e){this.type=t,this.args=e};pe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,n=1,i=t[0];if("array"===i){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in he)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=he[s],n++}else o=Vt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],n++}r=Zt(o,a)}else r=he[i];for(var l=[];n<t.length;n++){var u=e.parse(t[n],n,Vt);if(!u)return null;l.push(u)}return new pe(r,l)},pe.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!Kt(this.type,se(r)))return r;if(e===this.args.length-1)throw new ce("Expected value to be of type "+qt(this.type)+", but found "+qt(se(r))+" instead.")}return null},pe.prototype.eachChild=function(t){this.args.forEach(t)},pe.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},pe.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);var n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var de=function(t){this.type=Wt,this.sections=t};de.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[1];if(!Array.isArray(r)&&"object"==typeof r)return e.error("First argument must be an image or text section.");for(var n=[],i=!1,o=1;o<=t.length-1;++o){var a=t[o];if(i&&"object"==typeof a&&!Array.isArray(a)){i=!1;var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,kt)))return null;var l=null;if(a["text-font"]&&!(l=e.parse(a["text-font"],1,Zt(Ut))))return null;var u=null;if(a["text-color"]&&!(u=e.parse(a["text-color"],1,Gt)))return null;var c=n[n.length-1];c.scale=s,c.font=l,c.textColor=u}else{var h=e.parse(t[o],1,Vt);if(!h)return null;var p=h.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:h,scale:null,font:null,textColor:null})}}return new de(n)},de.prototype.evaluate=function(t){return new ne(this.sections.map((function(e){var r=e.content.evaluate(t);return se(r)===Xt?new re("",r,null,null,null):new re(le(r),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},de.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}},de.prototype.outputDefined=function(){return!1},de.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t.push(n.content.serialize());var i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),t.push(i)}return t};var fe=function(t){this.type=Xt,this.input=t};fe.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Ut);return r?new fe(r):e.error("No image name provided.")},fe.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=ie.fromString(e);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(e)>-1),r},fe.prototype.eachChild=function(t){t(this.input)},fe.prototype.outputDefined=function(){return!1},fe.prototype.serialize=function(){return["image",this.input.serialize()]};var me={"to-boolean":zt,"to-color":Gt,"to-number":kt,"to-string":Ut},ge=function(t,e){this.type=t,this.args=e};ge.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");for(var n=me[r],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,Vt);if(!a)return null;i.push(a)}return new ge(n,i)},ge.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,r,n=0,i=this.args;n<i.length;n+=1){if(r=null,(e=i[n].evaluate(t))instanceof te)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":oe(e[0],e[1],e[2],e[3])))return new te(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ce(r||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,l=this.args;s<l.length;s+=1){if(null===(a=l[s].evaluate(t)))return 0;var u=Number(a);if(!isNaN(u))return u}throw new ce("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?ne.fromString(le(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ie.fromString(le(this.args[0].evaluate(t))):le(this.args[0].evaluate(t))},ge.prototype.eachChild=function(t){this.args.forEach(t)},ge.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},ge.prototype.serialize=function(){if("formatted"===this.type.kind)return new de([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new fe(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var _e=["Unknown","Point","LineString","Polygon"],ve=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ve.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ve.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?_e[this.feature.type]:this.feature.type:null},ve.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ve.prototype.canonicalID=function(){return this.canonical},ve.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ve.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=te.parse(t)),e};var ye=function(t,e,r,n){this.name=t,this.type=e,this._evaluate=r,this.args=n};ye.prototype.evaluate=function(t){return this._evaluate(t,this.args)},ye.prototype.eachChild=function(t){this.args.forEach(t)},ye.prototype.outputDefined=function(){return!1},ye.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},ye.parse=function(t,e){var r,n=t[0],i=ye.definitions[n];if(!i)return e.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter((function(e){var r=e[0];return!Array.isArray(r)||r.length===t.length-1})),l=null,u=0,c=s;u<c.length;u+=1){var h=c[u],p=h[0],d=h[1];l=new Ge(e.registry,e.path,null,e.scope);for(var f=[],m=!1,g=1;g<t.length;g++){var _=t[g],v=Array.isArray(p)?p[g-1]:p.type,y=l.parse(_,1+f.length,v);if(!y){m=!0;break}f.push(y)}if(!m)if(Array.isArray(p)&&p.length!==f.length)l.error("Expected "+p.length+" arguments, but found "+f.length+" instead.");else{for(var x=0;x<f.length;x++){var b=Array.isArray(p)?p[x]:p.type,E=f[x];l.concat(x+1).checkSubtype(b,E.type)}if(0===l.errors.length)return new ye(n,o,d,f)}}if(1===s.length)(r=e.errors).push.apply(r,l.errors);else{for(var T=(s.length?s:a).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(qt).join(", ")+")":"("+qt(e.type)+"...)"})).join(" | "),S=[],A=1;A<t.length;A++){var w=e.parse(t[A],1+S.length);if(!w)return null;S.push(qt(w.type))}e.error("Expected arguments of type "+T+", but found ("+S.join(", ")+") instead.")}return null},ye.register=function(t,e){for(var r in ye.definitions=e,e)t[r]=ye};var xe=function(t,e,r){this.type=Ht,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e};function be(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ee(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Te(t,e){var r=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(r*i*8192),Math.round(n*i*8192)]}function Se(t,e,r){return e[1]>t[1]!=r[1]>t[1]&&t[0]<(r[0]-e[0])*(t[1]-e[1])/(r[1]-e[1])+e[0]}function Ae(t,e){for(var r,n,i,o,a,s,l,u=!1,c=0,h=e.length;c<h;c++)for(var p=e[c],d=0,f=p.length;d<f-1;d++){if((o=(r=t)[0]-(n=p[d])[0])*(l=r[1]-(i=p[d+1])[1])-(s=r[0]-i[0])*(a=r[1]-n[1])==0&&o*s<=0&&a*l<=0)return!1;Se(t,p[d],p[d+1])&&(u=!u)}return u}function we(t,e){for(var r=0;r<e.length;r++)if(Ae(t,e[r]))return!0;return!1}function Ce(t,e,r,n){var i=n[0]-r[0],o=n[1]-r[1],a=(t[0]-r[0])*o-i*(t[1]-r[1]),s=(e[0]-r[0])*o-i*(e[1]-r[1]);return a>0&&s<0||a<0&&s>0}function Re(t,e,r){for(var n=0,i=r;n<i.length;n+=1)for(var o=i[n],a=0;a<o.length-1;++a)if(0!=(h=[(c=o[a+1])[0]-(u=o[a])[0],c[1]-u[1]])[0]*(p=[(l=e)[0]-(s=t)[0],l[1]-s[1]])[1]-h[1]*p[0]&&Ce(s,l,u,c)&&Ce(u,c,s,l))return!0;var s,l,u,c,h,p;return!1}function Le(t,e){for(var r=0;r<t.length;++r)if(!Ae(t[r],e))return!1;for(var n=0;n<t.length-1;++n)if(Re(t[n],t[n+1],e))return!1;return!0}function Ie(t,e){for(var r=0;r<e.length;r++)if(Le(t,e[r]))return!0;return!1}function Me(t,e,r){for(var n=[],i=0;i<t.length;i++){for(var o=[],a=0;a<t[i].length;a++){var s=Te(t[i][a],r);be(e,s),o.push(s)}n.push(o)}return n}function Oe(t,e,r){for(var n=[],i=0;i<t.length;i++){var o=Me(t[i],e,r);n.push(o)}return n}function Pe(t,e,r,n){if(t[0]<r[0]||t[0]>r[2]){var i=.5*n,o=t[0]-r[0]>i?-n:r[0]-t[0]>i?n:0;0===o&&(o=t[0]-r[2]>i?-n:r[2]-t[0]>i?n:0),t[0]+=o}be(e,t)}function De(t,e,r,n){for(var i=8192*Math.pow(2,n.z),o=[8192*n.x,8192*n.y],a=[],s=0,l=t;s<l.length;s+=1)for(var u=0,c=l[s];u<c.length;u+=1){var h=c[u],p=[h.x+o[0],h.y+o[1]];Pe(p,e,r,i),a.push(p)}return a}function Be(t,e,r,n){for(var i,o=8192*Math.pow(2,n.z),a=[8192*n.x,8192*n.y],s=[],l=0,u=t;l<u.length;l+=1){for(var c=[],h=0,p=u[l];h<p.length;h+=1){var d=p[h],f=[d.x+a[0],d.y+a[1]];be(e,f),c.push(f)}s.push(c)}if(e[2]-e[0]<=o/2){(i=e)[0]=i[1]=1/0,i[2]=i[3]=-1/0;for(var m=0,g=s;m<g.length;m+=1)for(var _=0,v=g[m];_<v.length;_+=1)Pe(v[_],e,r,o)}return s}xe.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");var n=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,zt);if(!n)return null;var i=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,zt);if(!i)return null;var o=null;return r.locale&&!(o=e.parse(r.locale,1,Ut))?null:new xe(n,i,o)},xe.prototype.evaluate=function(t){return new ee(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},xe.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},xe.prototype.outputDefined=function(){return!1},xe.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Ne=function(t,e){this.type=zt,this.geojson=t,this.geometries=e};function Fe(t){if(t instanceof ye){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Ne)return!1;var e=!0;return t.eachChild((function(t){e&&!Fe(t)&&(e=!1)})),e}function ke(t){if(t instanceof ye&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!ke(t)&&(e=!1)})),e}function Ue(t,e){if(t instanceof ye&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild((function(t){r&&!Ue(t,e)&&(r=!1)})),r}Ne.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(ae(t[1])){var r=t[1];if("FeatureCollection"===r.type)for(var n=0;n<r.features.length;++n){var i=r.features[n].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ne(r,r.features[n].geometry)}else if("Feature"===r.type){var o=r.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new Ne(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new Ne(r,r)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ne.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Me(e.coordinates,n,i),a=De(t.geometry(),r,n,i);if(!Ee(r,n))return!1;for(var s=0,l=a;s<l.length;s+=1)if(!Ae(l[s],o))return!1}if("MultiPolygon"===e.type){var u=Oe(e.coordinates,n,i),c=De(t.geometry(),r,n,i);if(!Ee(r,n))return!1;for(var h=0,p=c;h<p.length;h+=1)if(!we(p[h],u))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Me(e.coordinates,n,i),a=Be(t.geometry(),r,n,i);if(!Ee(r,n))return!1;for(var s=0,l=a;s<l.length;s+=1)if(!Le(l[s],o))return!1}if("MultiPolygon"===e.type){var u=Oe(e.coordinates,n,i),c=Be(t.geometry(),r,n,i);if(!Ee(r,n))return!1;for(var h=0,p=c;h<p.length;h+=1)if(!Ie(p[h],u))return!1}return!0}(t,this.geometries)}return!1},Ne.prototype.eachChild=function(){},Ne.prototype.outputDefined=function(){return!0},Ne.prototype.serialize=function(){return["within",this.geojson]};var ze=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};ze.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new ze(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},ze.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},ze.prototype.eachChild=function(){},ze.prototype.outputDefined=function(){return!1},ze.prototype.serialize=function(){return["var",this.name]};var Ge=function(t,e,r,n,i){void 0===e&&(e=[]),void 0===n&&(n=new Nt),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=n,this.errors=i,this.expectedType=r};function je(t,e){for(var r,n=t.length-1,i=0,o=n,a=0;i<=o;)if((r=t[a=Math.floor((i+o)/2)])<=e){if(a===n||e<t[a+1])return a;i=a+1}else{if(!(r>e))throw new ce("Input is not a number.");o=a-1}return 0}Ge.prototype.parse=function(t,e,r,n,i){return void 0===i&&(i={}),e?this.concat(e,r,n)._parse(t,i):this._parse(t,i)},Ge.prototype._parse=function(t,e){function r(t,e,r){return"assert"===r?new pe(e,[t]):"coerce"===r?new ge(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n=t[0];if("string"!=typeof n)return this.error("Expression name must be a string, but found "+typeof n+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[n];if(i){var o=i.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"resolvedImage"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=r(o,a,e.typeAnnotation||"coerce");else o=r(o,a,e.typeAnnotation||"assert")}if(!(o instanceof ue)&&"resolvedImage"!==o.type.kind&&function t(e){if(e instanceof ze)return t(e.boundExpression);if(e instanceof ye&&"error"===e.name)return!1;if(e instanceof xe)return!1;if(e instanceof Ne)return!1;var r=e instanceof ge||e instanceof pe,n=!0;return e.eachChild((function(e){n=r?n&&t(e):n&&e instanceof ue})),!!n&&Fe(e)&&Ue(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(o)){var l=new ve;try{o=new ue(o.type,o.evaluate(l))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Ge.prototype.concat=function(t,e,r){var n="number"==typeof t?this.path.concat(t):this.path,i=r?this.scope.concat(r):this.scope;return new Ge(this.registry,n,e||null,i,this.errors)},Ge.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var n=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Bt(n,t))},Ge.prototype.checkSubtype=function(t,e){var r=Kt(t,e);return r&&this.error(r),r};var Ve=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,i=r;n<i.length;n+=1){var o=i[n],a=o[1];this.labels.push(o[0]),this.outputs.push(a)}};function He(t,e,r){return t*(1-r)+e*r}Ve.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var r=e.parse(t[1],1,kt);if(!r)return null;var n=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],l=o,u=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(n.length&&n[n.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);var c=e.parse(s,u,i);if(!c)return null;i=i||c.type,n.push([a,c])}return new Ve(i,r,n)},Ve.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;return n>=e[i-1]?r[i-1].evaluate(t):r[je(e,n)].evaluate(t)},Ve.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},Ve.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},Ve.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var We=Object.freeze({__proto__:null,number:He,color:function(t,e,r){return new te(He(t.r,e.r,r),He(t.g,e.g,r),He(t.b,e.b,r),He(t.a,e.a,r))},array:function(t,e,r){return t.map((function(t,n){return He(t,e[n],r)}))}}),Xe=6/29*3*(6/29),Ze=Math.PI/180,qe=180/Math.PI;function Ye(t){return t>.008856451679035631?Math.pow(t,1/3):t/Xe+4/29}function Ke(t){return t>6/29?t*t*t:Xe*(t-4/29)}function $e(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Qe(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Je(t){var e=Qe(t.r),r=Qe(t.g),n=Qe(t.b),i=Ye((.4124564*e+.3575761*r+.1804375*n)/.95047),o=Ye((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-Ye((.0193339*e+.119192*r+.9503041*n)/1.08883)),alpha:t.a}}function tr(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Ke(e),r=.95047*Ke(r),n=1.08883*Ke(n),new te($e(3.2404542*r-1.5371385*e-.4985314*n),$e(-.969266*r+1.8760108*e+.041556*n),$e(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function er(t,e,r){var n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}var rr={forward:Je,reverse:tr,interpolate:function(t,e,r){return{l:He(t.l,e.l,r),a:He(t.a,e.a,r),b:He(t.b,e.b,r),alpha:He(t.alpha,e.alpha,r)}}},nr={forward:function(t){var e=Je(t),r=e.l,n=e.a,i=e.b,o=Math.atan2(i,n)*qe;return{h:o<0?o+360:o,c:Math.sqrt(n*n+i*i),l:r,alpha:t.a}},reverse:function(t){var e=t.h*Ze,r=t.c;return tr({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:er(t.h,e.h,r),c:He(t.c,e.c,r),l:He(t.l,e.l,r),alpha:He(t.alpha,e.alpha,r)}}},ir=Object.freeze({__proto__:null,lab:rr,hcl:nr}),or=function(t,e,r,n,i){this.type=t,this.operator=e,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],l=s[1];this.labels.push(s[0]),this.outputs.push(l)}};function ar(t,e,r,n){var i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}or.interpolationFactor=function(t,e,n,i){var o=0;if("exponential"===t.name)o=ar(e,t.base,n,i);else if("linear"===t.name)o=ar(e,1,n,i);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new r(a[0],a[1],a[2],a[3]).solve(ar(e,1,n,i))}return o},or.parse=function(t,e){var r=t[0],n=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){var a=n[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:a}}else{if("cubic-bezier"!==n[0])return e.error("Unknown interpolation type "+String(n[0]),1,0);var s=n.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,kt)))return null;var l=[],u=null;"interpolate-hcl"===r||"interpolate-lab"===r?u=Gt:e.expectedType&&"value"!==e.expectedType.kind&&(u=e.expectedType);for(var c=0;c<o.length;c+=2){var h=o[c],p=o[c+1],d=c+3,f=c+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(l.length&&l[l.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);var m=e.parse(p,f,u);if(!m)return null;u=u||m.type,l.push([h,m])}return"number"===u.kind||"color"===u.kind||"array"===u.kind&&"number"===u.itemType.kind&&"number"==typeof u.N?new or(u,r,n,i,l):e.error("Type "+qt(u)+" is not interpolatable.")},or.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);var o=je(e,n),a=or.interpolationFactor(this.interpolation,n,e[o],e[o+1]),s=r[o].evaluate(t),l=r[o+1].evaluate(t);return"interpolate"===this.operator?We[this.type.kind.toLowerCase()](s,l,a):"interpolate-hcl"===this.operator?nr.reverse(nr.interpolate(nr.forward(s),nr.forward(l),a)):rr.reverse(rr.interpolate(rr.forward(s),rr.forward(l),a))},or.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},or.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},or.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var sr=function(t,e){this.type=t,this.args=e};sr.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,n=e.expectedType;n&&"value"!==n.kind&&(r=n);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=e.parse(a[o],1+i.length,r,void 0,{typeAnnotation:"omit"});if(!s)return null;r=r||s.type,i.push(s)}var l=n&&i.some((function(t){return Kt(n,t.type)}));return new sr(l?Vt:r,i)},sr.prototype.evaluate=function(t){for(var e,r=null,n=0,i=0,o=this.args;i<o.length&&(n++,(r=o[i].evaluate(t))&&r instanceof ie&&!r.available&&(e||(e=r.name),r=null,n===this.args.length&&(r=e)),null===r);i+=1);return r},sr.prototype.eachChild=function(t){this.args.forEach(t)},sr.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},sr.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var lr=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};lr.prototype.evaluate=function(t){return this.result.evaluate(t)},lr.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1)t(r[e][1]);t(this.result)},lr.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],n=1;n<t.length-1;n+=2){var i=t[n];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",n);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var o=e.parse(t[n+1],n+1);if(!o)return null;r.push([i,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return a?new lr(r,a):null},lr.prototype.outputDefined=function(){return this.result.outputDefined()},lr.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var n=r[e];t.push(n[0],n[1].serialize())}return t.push(this.result.serialize()),t};var ur=function(t,e,r){this.type=t,this.index=e,this.input=r};ur.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,kt),n=e.parse(t[2],2,Zt(e.expectedType||Vt));return r&&n?new ur(n.type.itemType,r,n):null},ur.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new ce("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new ce("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new ce("Array index must be an integer, but found "+e+" instead.");return r[e]},ur.prototype.eachChild=function(t){t(this.index),t(this.input)},ur.prototype.outputDefined=function(){return!1},ur.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var cr=function(t,e){this.type=zt,this.needle=t,this.haystack=e};cr.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Vt),n=e.parse(t[2],2,Vt);return r&&n?$t(r.type,[zt,Ut,kt,Ft,Vt])?new cr(r,n):e.error("Expected first argument to be of type boolean, string, number or null, but found "+qt(r.type)+" instead"):null},cr.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!r)return!1;if(!Qt(e,["boolean","string","number","null"]))throw new ce("Expected first argument to be of type boolean, string, number or null, but found "+qt(se(e))+" instead.");if(!Qt(r,["string","array"]))throw new ce("Expected second argument to be of type array or string, but found "+qt(se(r))+" instead.");return r.indexOf(e)>=0},cr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},cr.prototype.outputDefined=function(){return!0},cr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var hr=function(t,e,r){this.type=kt,this.needle=t,this.haystack=e,this.fromIndex=r};hr.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Vt),n=e.parse(t[2],2,Vt);if(!r||!n)return null;if(!$t(r.type,[zt,Ut,kt,Ft,Vt]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+qt(r.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,kt);return i?new hr(r,n,i):null}return new hr(r,n)},hr.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!Qt(e,["boolean","string","number","null"]))throw new ce("Expected first argument to be of type boolean, string, number or null, but found "+qt(se(e))+" instead.");if(!Qt(r,["string","array"]))throw new ce("Expected second argument to be of type array or string, but found "+qt(se(r))+" instead.");if(this.fromIndex){var n=this.fromIndex.evaluate(t);return r.indexOf(e,n)}return r.indexOf(e)},hr.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},hr.prototype.outputDefined=function(){return!1},hr.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var pr=function(t,e,r,n,i,o){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o};pr.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],l=t[a+1];Array.isArray(s)||(s=[s]);var u=e.concat(a);if(0===s.length)return u.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return u.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return u.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return u.error("Numeric branch labels must be integer values.");if(r){if(u.checkSubtype(r,se(p)))return null}else r=se(p);if(void 0!==i[String(p)])return u.error("Branch labels must be unique.");i[String(p)]=o.length}var d=e.parse(l,a,n);if(!d)return null;n=n||d.type,o.push(d)}var f=e.parse(t[1],1,Vt);if(!f)return null;var m=e.parse(t[t.length-1],t.length-1,n);return m?"value"!==f.type.kind&&e.concat(1).checkSubtype(r,f.type)?null:new pr(r,n,f,i,o,m):null},pr.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(se(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},pr.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},pr.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},pr.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],n={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(h=n[this.cases[a]])?(n[this.cases[a]]=r.length,r.push([this.cases[a],[a]])):r[h][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},l=0,u=r;l<u.length;l+=1){var c=u[l],h=c[0],p=c[1];e.push(1===p.length?s(p[0]):p.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var dr=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r};dr.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var n=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,zt);if(!o)return null;var a=e.parse(t[i+1],i+1,r);if(!a)return null;n.push([o,a]),r=r||a.type}var s=e.parse(t[t.length-1],t.length-1,r);return s?new dr(r,n,s):null},dr.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[1];if(n[0].evaluate(t))return i.evaluate(t)}return this.otherwise.evaluate(t)},dr.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[1];t(n[0]),t(i)}t(this.otherwise)},dr.prototype.outputDefined=function(){return this.branches.every((function(t){return t[1].outputDefined()}))&&this.otherwise.outputDefined()},dr.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var fr=function(t,e,r,n){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=n};function mr(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function gr(t,e,r,n){return 0===n.compare(e,r)}function _r(t,e,r){var n="=="!==t&&"!="!==t;return function(){function i(t,e,r){this.type=zt,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var r=t[0],o=e.parse(t[1],1,Vt);if(!o)return null;if(!mr(r,o.type))return e.concat(1).error('"'+r+"\" comparisons are not supported for type '"+qt(o.type)+"'.");var a=e.parse(t[2],2,Vt);if(!a)return null;if(!mr(r,a.type))return e.concat(2).error('"'+r+"\" comparisons are not supported for type '"+qt(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+qt(o.type)+"' and '"+qt(a.type)+"'.");n&&("value"===o.type.kind&&"value"!==a.type.kind?o=new pe(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new pe(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Ht)))return null}return new i(o,a,s)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){var s=se(o),l=se(a);if(s.kind!==l.kind||"string"!==s.kind&&"number"!==s.kind)throw new ce('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+l.kind+") instead.")}if(this.collator&&!n&&this.hasUntypedArgument){var u=se(o),c=se(a);if("string"!==u.kind||"string"!==c.kind)return e(i,o,a)}return this.collator?r(i,o,a,this.collator.evaluate(i)):e(i,o,a)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},i}()}fr.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Vt),n=e.parse(t[2],2,kt);if(!r||!n)return null;if(!$t(r.type,[Zt(Vt),Ut,Vt]))return e.error("Expected first argument to be of type array or string, but found "+qt(r.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,kt);return i?new fr(r.type,r,n,i):null}return new fr(r.type,r,n)},fr.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!Qt(e,["string","array"]))throw new ce("Expected first argument to be of type array or string, but found "+qt(se(e))+" instead.");if(this.endIndex){var n=this.endIndex.evaluate(t);return e.slice(r,n)}return e.slice(r)},fr.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},fr.prototype.outputDefined=function(){return!1},fr.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var vr=_r("==",(function(t,e,r){return e===r}),gr),yr=_r("!=",(function(t,e,r){return e!==r}),(function(t,e,r,n){return!gr(0,e,r,n)})),xr=_r("<",(function(t,e,r){return e<r}),(function(t,e,r,n){return n.compare(e,r)<0})),br=_r(">",(function(t,e,r){return e>r}),(function(t,e,r,n){return n.compare(e,r)>0})),Er=_r("<=",(function(t,e,r){return e<=r}),(function(t,e,r,n){return n.compare(e,r)<=0})),Tr=_r(">=",(function(t,e,r){return e>=r}),(function(t,e,r,n){return n.compare(e,r)>=0})),Sr=function(t,e,r,n,i){this.type=Ut,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i};Sr.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,kt);if(!r)return null;var n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");var i=null;if(n.locale&&!(i=e.parse(n.locale,1,Ut)))return null;var o=null;if(n.currency&&!(o=e.parse(n.currency,1,Ut)))return null;var a=null;if(n["min-fraction-digits"]&&!(a=e.parse(n["min-fraction-digits"],1,kt)))return null;var s=null;return n["max-fraction-digits"]&&!(s=e.parse(n["max-fraction-digits"],1,kt))?null:new Sr(r,i,o,a,s)},Sr.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Sr.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Sr.prototype.outputDefined=function(){return!1},Sr.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Ar=function(t){this.type=kt,this.input=t};Ar.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+qt(r.type)+" instead."):new Ar(r):null},Ar.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ce("Expected value to be of type string or array, but found "+qt(se(e))+" instead.")},Ar.prototype.eachChild=function(t){t(this.input)},Ar.prototype.outputDefined=function(){return!1},Ar.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var wr={"==":vr,"!=":yr,">":br,"<":xr,">=":Tr,"<=":Er,array:pe,at:ur,boolean:pe,case:dr,coalesce:sr,collator:xe,format:de,image:fe,in:cr,"index-of":hr,interpolate:or,"interpolate-hcl":or,"interpolate-lab":or,length:Ar,let:lr,literal:ue,match:pr,number:pe,"number-format":Sr,object:pe,slice:fr,step:Ve,string:pe,"to-boolean":ge,"to-color":ge,"to-number":ge,"to-string":ge,var:ze,within:Ne};function Cr(t,e){var r=e[0],n=e[1],i=e[2],o=e[3];r=r.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=oe(r,n,i,a);if(s)throw new ce(s);return new te(r/255*a,n/255*a,i/255*a,a)}function Rr(t,e){return t in e}function Lr(t,e){var r=e[t];return void 0===r?null:r}function Ir(t){return{type:t}}function Mr(t){return{result:"success",value:t}}function Or(t){return{result:"error",value:t}}function Pr(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Dr(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Br(t){return!!t.expression&&t.expression.interpolated}function Nr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Fr(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function kr(t){return t}function Ur(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function zr(t,e,r,n,i){return Ur(typeof r===i?n[r]:void 0,t.default,e.default)}function Gr(t,e,r){if("number"!==Nr(r))return Ur(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];var i=je(t.stops.map((function(t){return t[0]})),r);return t.stops[i][1]}function jr(t,e,r){var n=void 0!==t.base?t.base:1;if("number"!==Nr(r))return Ur(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];var o=je(t.stops.map((function(t){return t[0]})),r),a=function(t,e,r,n){var i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(r,n,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],l=t.stops[o+1][1],u=We[e.type]||kr;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=ir[t.colorSpace];u=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=s.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==n)return u(r,n,a)}}:u(s,l,a)}function Vr(t,e,r){return"color"===e.type?r=te.parse(r):"formatted"===e.type?r=ne.fromString(r.toString()):"resolvedImage"===e.type?r=ie.fromString(r.toString()):Nr(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),Ur(r,t.default,e.default)}ye.register(wr,{error:[{kind:"error"},[Ut],function(t,e){throw new ce(e[0].evaluate(t))}],typeof:[Ut,[Vt],function(t,e){return qt(se(e[0].evaluate(t)))}],"to-rgba":[Zt(kt,4),[Gt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Gt,[kt,kt,kt],Cr],rgba:[Gt,[kt,kt,kt,kt],Cr],has:{type:zt,overloads:[[[Ut],function(t,e){return Rr(e[0].evaluate(t),t.properties())}],[[Ut,jt],function(t,e){var r=e[1];return Rr(e[0].evaluate(t),r.evaluate(t))}]]},get:{type:Vt,overloads:[[[Ut],function(t,e){return Lr(e[0].evaluate(t),t.properties())}],[[Ut,jt],function(t,e){var r=e[1];return Lr(e[0].evaluate(t),r.evaluate(t))}]]},"feature-state":[Vt,[Ut],function(t,e){return Lr(e[0].evaluate(t),t.featureState||{})}],properties:[jt,[],function(t){return t.properties()}],"geometry-type":[Ut,[],function(t){return t.geometryType()}],id:[Vt,[],function(t){return t.id()}],zoom:[kt,[],function(t){return t.globals.zoom}],"heatmap-density":[kt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[kt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Vt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[kt,Ir(kt),function(t,e){for(var r=0,n=0,i=e;n<i.length;n+=1)r+=i[n].evaluate(t);return r}],"*":[kt,Ir(kt),function(t,e){for(var r=1,n=0,i=e;n<i.length;n+=1)r*=i[n].evaluate(t);return r}],"-":{type:kt,overloads:[[[kt,kt],function(t,e){var r=e[1];return e[0].evaluate(t)-r.evaluate(t)}],[[kt],function(t,e){return-e[0].evaluate(t)}]]},"/":[kt,[kt,kt],function(t,e){var r=e[1];return e[0].evaluate(t)/r.evaluate(t)}],"%":[kt,[kt,kt],function(t,e){var r=e[1];return e[0].evaluate(t)%r.evaluate(t)}],ln2:[kt,[],function(){return Math.LN2}],pi:[kt,[],function(){return Math.PI}],e:[kt,[],function(){return Math.E}],"^":[kt,[kt,kt],function(t,e){var r=e[1];return Math.pow(e[0].evaluate(t),r.evaluate(t))}],sqrt:[kt,[kt],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[kt,[kt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[kt,[kt],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[kt,[kt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[kt,[kt],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[kt,[kt],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[kt,[kt],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[kt,[kt],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[kt,[kt],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[kt,[kt],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[kt,Ir(kt),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[kt,Ir(kt),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[kt,[kt],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[kt,[kt],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[kt,[kt],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[kt,[kt],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[zt,[Ut,Vt],function(t,e){var r=e[0],n=e[1];return t.properties()[r.value]===n.value}],"filter-id-==":[zt,[Vt],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[zt,[Ut],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[zt,[Ut,Vt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i<o}],"filter-id-<":[zt,[Vt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<i}],"filter->":[zt,[Ut,Vt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i>o}],"filter-id->":[zt,[Vt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>i}],"filter-<=":[zt,[Ut,Vt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[zt,[Vt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<=i}],"filter->=":[zt,[Ut,Vt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[zt,[Vt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>=i}],"filter-has":[zt,[Vt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[zt,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[zt,[Zt(Ut)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[zt,[Zt(Vt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[zt,[Ut,Zt(Vt)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[zt,[Ut,Zt(Vt)],function(t,e){var r=e[0],n=e[1];return function(t,e,r,n){for(;r<=n;){var i=r+n>>1;if(e[i]===t)return!0;e[i]>t?n=i-1:r=i+1}return!1}(t.properties()[r.value],n.value,0,n.value.length-1)}],all:{type:zt,overloads:[[[zt,zt],function(t,e){var r=e[1];return e[0].evaluate(t)&&r.evaluate(t)}],[Ir(zt),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(!n[r].evaluate(t))return!1;return!0}]]},any:{type:zt,overloads:[[[zt,zt],function(t,e){var r=e[1];return e[0].evaluate(t)||r.evaluate(t)}],[Ir(zt),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(n[r].evaluate(t))return!0;return!1}]]},"!":[zt,[zt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[zt,[Ut],function(t,e){var r=t.globals&&t.globals.isSupportedScript;return!r||r(e[0].evaluate(t))}],upcase:[Ut,[Ut],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Ut,[Ut],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Ut,Ir(Vt),function(t,e){return e.map((function(e){return le(e.evaluate(t))})).join("")}],"resolved-locale":[Ut,[Ht],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Hr=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new ve,this._defaultValue=e?function(t){return"color"===t.type&&Fr(t.default)?new te(0,0,0,0):"color"===t.type?te.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function Wr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in wr}function Xr(t,e){var r=new Ge(wr,[],e?function(t){var e={color:Gt,string:Ut,number:kt,enum:Ut,boolean:zt,formatted:Wt,resolvedImage:Xt};return"array"===t.type?Zt(e[t.value]||Vt,t.length):e[t.type]}(e):void 0),n=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?Mr(new Hr(n,e)):Or(r.errors)}Hr.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)},Hr.prototype.evaluate=function(t,e,r,n,i,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null;try{var a=this.expression.evaluate(this._evaluator);if(null==a||"number"==typeof a&&a!=a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new ce("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(a)+" instead.");return a}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Zr=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!ke(e.expression)};Zr.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,o)},Zr.prototype.evaluate=function(t,e,r,n,i,o){return this._styleExpression.evaluate(t,e,r,n,i,o)};var qr=function(t,e,r,n){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent="camera"!==t&&!ke(e.expression),this.interpolationType=n};function Yr(t,e){if("error"===(t=Xr(t,e)).result)return t;var r=t.value.expression,n=Fe(r);if(!n&&!Pr(e))return Or([new Bt("","data expressions not supported")]);var i=Ue(r,["zoom"]);if(!i&&!Dr(e))return Or([new Bt("","zoom expressions not supported")]);var o=function t(e){var r=null;if(e instanceof lr)r=t(e.result);else if(e instanceof sr)for(var n=0,i=e.args;n<i.length&&!(r=t(i[n]));n+=1);else(e instanceof Ve||e instanceof or)&&e.input instanceof ye&&"zoom"===e.input.name&&(r=e);return r instanceof Bt||e.eachChild((function(e){var n=t(e);n instanceof Bt?r=n:!r&&n?r=new Bt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&n&&r!==n&&(r=new Bt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}(r);return o||i?o instanceof Bt?Or([o]):o instanceof or&&!Br(e)?Or([new Bt("",'"interpolate" expressions cannot be used with this property')]):Mr(o?new qr(n?"camera":"composite",t.value,o.labels,o instanceof or?o.interpolation:void 0):new Zr(n?"constant":"source",t.value)):Or([new Bt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}qr.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,o)},qr.prototype.evaluate=function(t,e,r,n,i,o){return this._styleExpression.evaluate(t,e,r,n,i,o)},qr.prototype.interpolationFactor=function(t,e,r){return this.interpolationType?or.interpolationFactor(this.interpolationType,t,e,r):0};var Kr=function(t,e){this._parameters=t,this._specification=e,Ot(this,function t(e,r){var n,i,o,a="color"===r.type,s=e.stops&&"object"==typeof e.stops[0][0],l=s||!(s||void 0!==e.property),u=e.type||(Br(r)?"exponential":"interval");if(a&&((e=Ot({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],te.parse(t[1])]}))),e.default=te.parse(e.default?e.default:r.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!ir[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===u)n=jr;else if("interval"===u)n=Gr;else if("categorical"===u){n=zr,i=Object.create(null);for(var c=0,h=e.stops;c<h.length;c+=1){var p=h[c];i[p[0]]=p[1]}o=typeof e.stops[0][0]}else{if("identity"!==u)throw new Error('Unknown function type "'+u+'"');n=Vr}if(s){for(var d={},f=[],m=0;m<e.stops.length;m++){var g=e.stops[m],_=g[0].zoom;void 0===d[_]&&(d[_]={zoom:_,type:e.type,property:e.property,default:e.default,stops:[]},f.push(_)),d[_].stops.push([g[0].value,g[1]])}for(var v=[],y=0,x=f;y<x.length;y+=1){var b=x[y];v.push([d[b].zoom,t(d[b],r)])}var E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:or.interpolationFactor.bind(void 0,E),zoomStops:v.map((function(t){return t[0]})),evaluate:function(t,n){var i=t.zoom;return jr({stops:v,base:e.base},r,i).evaluate(i,n)}}}if(l){var T="exponential"===u?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:or.interpolationFactor.bind(void 0,T),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){return n(e,r,t.zoom,i,o)}}}return{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?Ur(e.default,r.default):n(e,r,s,i,o)}}}(this._parameters,this._specification))};function $r(t){var e=t.key,r=t.value,n=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],l=Nr(r);if("object"!==l)return[new It(e,r,"object expected, "+l+" found")];for(var u in r){var c=u.split(".")[0],h=n[c]||n["*"],p=void 0;if(i[c])p=i[c];else if(n[c])p=Tn;else if(i["*"])p=i["*"];else{if(!n["*"]){s.push(new It(e,r[u],'unknown property "'+u+'"'));continue}p=Tn}s=s.concat(p({key:(e?e+".":e)+u,value:r[u],valueSpec:h,style:o,styleSpec:a,object:r,objectKey:u},r))}for(var d in n)i[d]||n[d].required&&void 0===n[d].default&&void 0===r[d]&&s.push(new It(e,r,'missing required property "'+d+'"'));return s}function Qr(t){var e=t.value,r=t.valueSpec,n=t.style,i=t.styleSpec,o=t.key,a=t.arrayElementValidator||Tn;if("array"!==Nr(e))return[new It(o,e,"array expected, "+Nr(e)+" found")];if(r.length&&e.length!==r.length)return[new It(o,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return[new It(o,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var s={type:r.value,values:r.values};i.$version<7&&(s.function=r.function),"object"===Nr(r.value)&&(s=r.value);for(var l=[],u=0;u<e.length;u++)l=l.concat(a({array:e,arrayIndex:u,value:e[u],valueSpec:s,style:n,styleSpec:i,key:o+"["+u+"]"}));return l}function Jr(t){var e=t.key,r=t.value,n=t.valueSpec,i=Nr(r);return"number"===i&&r!=r&&(i="NaN"),"number"!==i?[new It(e,r,"number expected, "+i+" found")]:"minimum"in n&&r<n.minimum?[new It(e,r,r+" is less than the minimum value "+n.minimum)]:"maximum"in n&&r>n.maximum?[new It(e,r,r+" is greater than the maximum value "+n.maximum)]:[]}function tn(t){var e,r,n,i=t.valueSpec,o=Pt(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,l=!s,u="array"===Nr(t.value.stops)&&"array"===Nr(t.value.stops[0])&&"object"===Nr(t.value.stops[0][0]),c=$r({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new It(t.key,t.value,'identity function may not have a "stops" property')];var e=[],r=t.value;return e=e.concat(Qr({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Nr(r)&&0===r.length&&e.push(new It(t.key,r,"array must have at least one stop")),e},default:function(t){return Tn({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&c.push(new It(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||c.push(new It(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!Br(t.valueSpec)&&c.push(new It(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!Pr(t.valueSpec)?c.push(new It(t.key,t.value,"property functions not supported")):s&&!Dr(t.valueSpec)&&c.push(new It(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!u||void 0!==t.value.property||c.push(new It(t.key,t.value,'"property" property is required')),c;function h(t){var e=[],o=t.value,s=t.key;if("array"!==Nr(o))return[new It(s,o,"array expected, "+Nr(o)+" found")];if(2!==o.length)return[new It(s,o,"array length 2 expected, length "+o.length+" found")];if(u){if("object"!==Nr(o[0]))return[new It(s,o,"object expected, "+Nr(o[0])+" found")];if(void 0===o[0].zoom)return[new It(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new It(s,o,"object stop key must have value")];if(n&&n>Pt(o[0].zoom))return[new It(s,o[0].zoom,"stop zoom values must appear in ascending order")];Pt(o[0].zoom)!==n&&(n=Pt(o[0].zoom),r=void 0,a={}),e=e.concat($r({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Jr,value:p}}))}else e=e.concat(p({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return Wr(Dt(o[1]))?e.concat([new It(s+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(Tn({key:s+"[1]",value:o[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function p(t,n){var s=Nr(t.value),l=Pt(t.value),u=null!==t.value?t.value:n;if(e){if(s!==e)return[new It(t.key,u,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new It(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var c="number expected, "+s+" found";return Pr(i)&&void 0===o&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(t.key,u,c)]}return"categorical"!==o||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==o&&"number"===s&&void 0!==r&&l<r?[new It(t.key,u,"stop domain values must appear in ascending order")]:(r=l,"categorical"===o&&l in a?[new It(t.key,u,"stop domain values must be unique")]:(a[l]=!0,[])):[new It(t.key,u,"integer expected, found "+l)]}}function en(t){var e=("property"===t.expressionContext?Yr:Xr)(Dt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new It(""+t.key+e.key,t.value,e.message)}));var r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new It(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!ke(r))return[new It(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!ke(r))return[new It(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ue(r,["zoom","feature-state"]))return[new It(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Fe(r))return[new It(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rn(t){var e=t.key,r=t.value,n=t.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(Pt(r))&&i.push(new It(e,r,"expected one of ["+n.values.join(", ")+"], "+JSON.stringify(r)+" found")):-1===Object.keys(n.values).indexOf(Pt(r))&&i.push(new It(e,r,"expected one of ["+Object.keys(n.values).join(", ")+"], "+JSON.stringify(r)+" found")),i}function nn(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var n=r[e];if(!nn(n)&&"boolean"!=typeof n)return!1}return!0;default:return!0}}Kr.deserialize=function(t){return new Kr(t._parameters,t._specification)},Kr.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var on={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function an(t){if(null==t)return{filter:function(){return!0},needGeometry:!1};nn(t)||(t=ln(t));var e=Xr(t,on);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return{filter:function(t,r,n){return e.value.evaluate(t,r,{},n)},needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var r=1;r<e.length;r++)if(t(e[r]))return!0;return!1}(t)}}function sn(t,e){return t<e?-1:t>e?1:0}function ln(t){if(!t)return!0;var e,r=t[0];return t.length<=1?"any"!==r:"=="===r?un(t[1],t[2],"=="):"!="===r?pn(un(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?un(t[1],t[2],r):"any"===r?(e=t.slice(1),["any"].concat(e.map(ln))):"all"===r?["all"].concat(t.slice(1).map(ln)):"none"===r?["all"].concat(t.slice(1).map(ln).map(pn)):"in"===r?cn(t[1],t.slice(2)):"!in"===r?pn(cn(t[1],t.slice(2))):"has"===r?hn(t[1]):"!has"===r?pn(hn(t[1])):"within"!==r||t}function un(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function cn(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(sn)]]:["filter-in-small",t,["literal",e]]}}function hn(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function pn(t){return["!",t]}function dn(t){return nn(Dt(t.value))?en(Ot({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var r=e.value,n=e.key;if("array"!==Nr(r))return[new It(n,r,"array expected, "+Nr(r)+" found")];var i,o=e.styleSpec,a=[];if(r.length<1)return[new It(n,r,"filter array must have at least 1 element")];switch(a=a.concat(rn({key:n+"[0]",value:r[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),Pt(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Pt(r[1])&&a.push(new It(n,r,'"$type" cannot be use with operator "'+r[0]+'"'));case"==":case"!=":3!==r.length&&a.push(new It(n,r,'filter array for operator "'+r[0]+'" must have 3 elements'));case"in":case"!in":r.length>=2&&"string"!==(i=Nr(r[1]))&&a.push(new It(n+"[1]",r[1],"string expected, "+i+" found"));for(var s=2;s<r.length;s++)i=Nr(r[s]),"$type"===Pt(r[1])?a=a.concat(rn({key:n+"["+s+"]",value:r[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new It(n+"["+s+"]",r[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var l=1;l<r.length;l++)a=a.concat(t({key:n+"["+l+"]",value:r[l],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Nr(r[1]),2!==r.length?a.push(new It(n,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"string"!==i&&a.push(new It(n+"[1]",r[1],"string expected, "+i+" found"));break;case"within":i=Nr(r[1]),2!==r.length?a.push(new It(n,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"object"!==i&&a.push(new It(n+"[1]",r[1],"object expected, "+i+" found"))}return a}(t)}function fn(t,e){var r=t.key,n=t.style,i=t.styleSpec,o=t.value,a=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return[];var l=a.match(/^(.*)-transition$/);if("paint"===e&&l&&s[l[1]]&&s[l[1]].transition)return Tn({key:r,value:o,valueSpec:i.transition,style:n,styleSpec:i});var u,c=t.valueSpec||s[a];if(!c)return[new It(r,o,'unknown property "'+a+'"')];if("string"===Nr(o)&&Pr(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new It(r,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(u[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&n&&!n.glyphs&&h.push(new It(r,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Fr(Dt(o))&&"identity"===Pt(o.type)&&h.push(new It(r,o,'"text-font" does not support identity functions'))),h.concat(Tn({key:t.key,value:o,valueSpec:c,style:n,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function mn(t){return fn(t,"paint")}function gn(t){return fn(t,"layout")}function _n(t){var e=[],r=t.value,n=t.key,i=t.style,o=t.styleSpec;r.type||r.ref||e.push(new It(n,r,'either "type" or "ref" is required'));var a,s=Pt(r.type),l=Pt(r.ref);if(r.id)for(var u=Pt(r.id),c=0;c<t.arrayIndex;c++){var h=i.layers[c];Pt(h.id)===u&&e.push(new It(n,r.id,'duplicate layer id "'+r.id+'", previously used at line '+h.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach((function(t){t in r&&e.push(new It(n,r[t],'"'+t+'" is prohibited for ref layers'))})),i.layers.forEach((function(t){Pt(t.id)===l&&(a=t)})),a?a.ref?e.push(new It(n,r.ref,"ref cannot reference another ref layer")):s=Pt(a.type):e.push(new It(n,r.ref,'ref layer "'+l+'" not found'));else if("background"!==s)if(r.source){var p=i.sources&&i.sources[r.source],d=p&&Pt(p.type);p?"vector"===d&&"raster"===s?e.push(new It(n,r.source,'layer "'+r.id+'" requires a raster source')):"raster"===d&&"raster"!==s?e.push(new It(n,r.source,'layer "'+r.id+'" requires a vector source')):"vector"!==d||r["source-layer"]?"raster-dem"===d&&"hillshade"!==s?e.push(new It(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!r.paint||!r.paint["line-gradient"]||"geojson"===d&&p.lineMetrics||e.push(new It(n,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new It(n,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new It(n,r.source,'source "'+r.source+'" not found'))}else e.push(new It(n,r,'missing required property "source"'));return e=e.concat($r({key:n,value:r,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Tn({key:n+".type",value:r.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:dn,layout:function(t){return $r({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return gn(Ot({layerType:s},t))}}})},paint:function(t){return $r({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return mn(Ot({layerType:s},t))}}})}}}))}function vn(t){var e=t.value,r=t.key,n=Nr(e);return"string"!==n?[new It(r,e,"string expected, "+n+" found")]:[]}var yn={promoteId:function(t){var e=t.key,r=t.value;if("string"===Nr(r))return vn({key:e,value:r});var n=[];for(var i in r)n.push.apply(n,vn({key:e+"."+i,value:r[i]}));return n}};function xn(t){var e=t.value,r=t.key,n=t.styleSpec,i=t.style;if(!e.type)return[new It(r,e,'"type" is required')];var o,a=Pt(e.type);switch(a){case"vector":case"raster":case"raster-dem":return $r({key:r,value:e,valueSpec:n["source_"+a.replace("-","_")],style:t.style,styleSpec:n,objectElementValidators:yn});case"geojson":if(o=$r({key:r,value:e,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:yn}),e.cluster)for(var s in e.clusterProperties){var l=e.clusterProperties[s],u=l[0],c="string"==typeof u?[u,["accumulated"],["get",s]]:u;o.push.apply(o,en({key:r+"."+s+".map",value:l[1],expressionContext:"cluster-map"})),o.push.apply(o,en({key:r+"."+s+".reduce",value:c,expressionContext:"cluster-reduce"}))}return o;case"video":return $r({key:r,value:e,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return $r({key:r,value:e,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new It(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rn({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:n})}}function bn(t){var e=t.value,r=t.styleSpec,n=r.light,i=t.style,o=[],a=Nr(e);if(void 0===e)return o;if("object"!==a)return o.concat([new It("light",e,"object expected, "+a+" found")]);for(var s in e){var l=s.match(/^(.*)-transition$/);o=o.concat(l&&n[l[1]]&&n[l[1]].transition?Tn({key:s,value:e[s],valueSpec:r.transition,style:i,styleSpec:r}):n[s]?Tn({key:s,value:e[s],valueSpec:n[s],style:i,styleSpec:r}):[new It(s,e[s],'unknown property "'+s+'"')])}return o}var En={"*":function(){return[]},array:Qr,boolean:function(t){var e=t.value,r=t.key,n=Nr(e);return"boolean"!==n?[new It(r,e,"boolean expected, "+n+" found")]:[]},number:Jr,color:function(t){var e=t.key,r=t.value,n=Nr(r);return"string"!==n?[new It(e,r,"color expected, "+n+" found")]:null===Jt(r)?[new It(e,r,'color expected, "'+r+'" found')]:[]},constants:Mt,enum:rn,filter:dn,function:tn,layer:_n,object:$r,source:xn,light:bn,string:vn,formatted:function(t){return 0===vn(t).length?[]:en(t)},resolvedImage:function(t){return 0===vn(t).length?[]:en(t)}};function Tn(t){var e=t.value,r=t.valueSpec,n=t.styleSpec;return r.expression&&Fr(Pt(e))?tn(t):r.expression&&Wr(Dt(e))?en(t):r.type&&En[r.type]?En[r.type](t):$r(Ot({},t,{valueSpec:r.type?n[r.type]:r}))}function Sn(t){var e=t.value,r=t.key,n=vn(t);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new It(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new It(r,e,'"glyphs" url must include a "{range}" token'))),n}function An(t,e){void 0===e&&(e=Lt);var r=[];return r=r.concat(Tn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Sn,"*":function(){return[]}}})),t.constants&&(r=r.concat(Mt({key:"constants",value:t.constants,style:t,styleSpec:e}))),wn(r)}function wn(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function Cn(t){return function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return wn(t.apply(this,e))}}An.source=Cn(xn),An.light=Cn(bn),An.layer=Cn(_n),An.filter=Cn(dn),An.paintProperty=Cn(mn),An.layoutProperty=Cn(gn);var Rn=An,Ln=Rn.light,In=Rn.paintProperty,Mn=Rn.layoutProperty;function On(t,e){var r=!1;if(e&&e.length)for(var n=0,i=e;n<i.length;n+=1)t.fire(new Ct(new Error(i[n].message))),r=!0;return r}var Pn=Dn;function Dn(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(r=i[2]);for(var o=0;o<this.d*this.d;o++){var a=i[3+o],s=i[3+o+1];n.push(a===s?null:i.subarray(a,s))}var l=i[3+n.length+1];this.keys=i.subarray(i[3+n.length],l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var c=r/e*t;this.min=-c,this.max=t+c}Dn.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},Dn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Dn.prototype._insertCell=function(t,e,r,n,i,o){this.cells[i].push(o)},Dn.prototype.query=function(t,e,r,n,i){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=r&&a<=n&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,r,n,this._queryCell,s,{},i),s},Dn.prototype._queryCell=function(t,e,r,n,i,o,a,s){var l=this.cells[i];if(null!==l)for(var u=this.keys,c=this.bboxes,h=0;h<l.length;h++){var p=l[h];if(void 0===a[p]){var d=4*p;(s?s(c[d+0],c[d+1],c[d+2],c[d+3]):t<=c[d+2]&&e<=c[d+3]&&r>=c[d+0]&&n>=c[d+1])?(a[p]=!0,o.push(u[p])):a[p]=!1}}},Dn.prototype._forEachCell=function(t,e,r,n,i,o,a,s){for(var l=this._convertToCellCoord(t),u=this._convertToCellCoord(e),c=this._convertToCellCoord(r),h=this._convertToCellCoord(n),p=l;p<=c;p++)for(var d=u;d<=h;d++){var f=this.d*d+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(d),this._convertFromCellCoord(p+1),this._convertFromCellCoord(d+1)))&&i.call(this,t,e,r,n,f,o,a,s))return}},Dn.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Dn.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Dn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(e+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[3+a]=o,i.set(s,o),o+=s.length}return i[3+t.length]=o,i.set(this.keys,o),i[3+t.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var Bn=a.ImageData,Nn=a.ImageBitmap,Fn={};function kn(t,e,r){void 0===r&&(r={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Fn[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}for(var Un in kn("Object",Object),Pn.serialize=function(t,e){var r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},Pn.deserialize=function(t){return new Pn(t.buffer)},kn("Grid",Pn),kn("Color",te),kn("Error",Error),kn("ResolvedImage",ie),kn("StylePropertyFunction",Kr),kn("StyleExpression",Hr,{omit:["_evaluator"]}),kn("ZoomDependentExpression",qr),kn("ZoomConstantExpression",Zr),kn("CompoundExpression",ye,{omit:["_evaluate"]}),wr)wr[Un]._classRegistryKey||kn("Expression_"+Un,wr[Un]);function zn(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Gn(t){return Nn&&t instanceof Nn}function jn(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(zn(t)||Gn(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var r=t;return e&&e.push(r.buffer),r}if(t instanceof Bn)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var n=[],i=0,o=t;i<o.length;i+=1)n.push(jn(o[i],e));return n}if("object"==typeof t){var a=t.constructor,s=a._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var l=a.serialize?a.serialize(t,e):{};if(!a.serialize){for(var u in t)if(t.hasOwnProperty(u)&&!(Fn[s].omit.indexOf(u)>=0)){var c=t[u];l[u]=Fn[s].shallow.indexOf(u)>=0?c:jn(c,e)}t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof t)}function Vn(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||zn(t)||Gn(t)||ArrayBuffer.isView(t)||t instanceof Bn)return t;if(Array.isArray(t))return t.map(Vn);if("object"==typeof t){var e=t.$name||"Object",r=Fn[e].klass;if(!r)throw new Error("can't deserialize unregistered class "+e);if(r.deserialize)return r.deserialize(t);for(var n=Object.create(r.prototype),i=0,o=Object.keys(t);i<o.length;i+=1){var a=o[i];if("$name"!==a){var s=t[a];n[a]=Fn[e].shallow.indexOf(a)>=0?s:Vn(s)}}return n}throw new Error("can't deserialize object of type "+typeof t)}var Hn=function(){this.first=!0};Hn.prototype.update=function(t,e){var r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))};var Wn={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Xn(t){for(var e=0,r=t;e<r.length;e+=1)if(Zn(r[e].charCodeAt(0)))return!0;return!1}function Zn(t){return!(746!==t&&747!==t&&(t<4352||!(Wn["Bopomofo Extended"](t)||Wn.Bopomofo(t)||Wn["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Wn["CJK Compatibility Ideographs"](t)||Wn["CJK Compatibility"](t)||Wn["CJK Radicals Supplement"](t)||Wn["CJK Strokes"](t)||!(!Wn["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Wn["CJK Unified Ideographs Extension A"](t)||Wn["CJK Unified Ideographs"](t)||Wn["Enclosed CJK Letters and Months"](t)||Wn["Hangul Compatibility Jamo"](t)||Wn["Hangul Jamo Extended-A"](t)||Wn["Hangul Jamo Extended-B"](t)||Wn["Hangul Jamo"](t)||Wn["Hangul Syllables"](t)||Wn.Hiragana(t)||Wn["Ideographic Description Characters"](t)||Wn.Kanbun(t)||Wn["Kangxi Radicals"](t)||Wn["Katakana Phonetic Extensions"](t)||Wn.Katakana(t)&&12540!==t||!(!Wn["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Wn["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Wn["Unified Canadian Aboriginal Syllabics"](t)||Wn["Unified Canadian Aboriginal Syllabics Extended"](t)||Wn["Vertical Forms"](t)||Wn["Yijing Hexagram Symbols"](t)||Wn["Yi Syllables"](t)||Wn["Yi Radicals"](t))))}function qn(t){return!(Zn(t)||function(t){return!!(Wn["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Wn["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Wn["Letterlike Symbols"](t)||Wn["Number Forms"](t)||Wn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Wn["Control Pictures"](t)&&9251!==t||Wn["Optical Character Recognition"](t)||Wn["Enclosed Alphanumerics"](t)||Wn["Geometric Shapes"](t)||Wn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Wn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Wn["CJK Symbols and Punctuation"](t)||Wn.Katakana(t)||Wn["Private Use Area"](t)||Wn["CJK Compatibility Forms"](t)||Wn["Small Form Variants"](t)||Wn["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Yn(t){return t>=1424&&t<=2303||Wn["Arabic Presentation Forms-A"](t)||Wn["Arabic Presentation Forms-B"](t)}function Kn(t,e){return!(!e&&Yn(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Wn.Khmer(t))}function $n(t){for(var e=0,r=t;e<r.length;e+=1)if(Yn(r[e].charCodeAt(0)))return!0;return!1}var Qn=null,Jn="unavailable",ti=null,ei=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Jn="error"),Qn&&Qn(t)};function ri(){ni.fire(new wt("pluginStateChange",{pluginStatus:Jn,pluginURL:ti}))}var ni=new Rt,ii=function(){return Jn},oi=function(){if("deferred"!==Jn||!ti)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Jn="loading",ri(),ti&&xt({url:ti},(function(t){t?ei(t):(Jn="loaded",ri())}))},ai={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===Jn||null!=ai.applyArabicShaping},isLoading:function(){return"loading"===Jn},setState:function(t){Jn=t.pluginStatus,ti=t.pluginURL},isParsed:function(){return null!=ai.applyArabicShaping&&null!=ai.processBidirectionalText&&null!=ai.processStyledBidirectionalText},getPluginURL:function(){return ti}},si=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Hn,this.transition={})};si.prototype.isSupportedScript=function(t){return function(t,e){for(var r=0,n=t;r<n.length;r+=1)if(!Kn(n[r].charCodeAt(0),e))return!1;return!0}(t,ai.isLoaded())},si.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},si.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),r=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*e}};var li=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Fr(t))return new Kr(t,e);if(Wr(t)){var r=Yr(t,e);if("error"===r.result)throw new Error(r.value.map((function(t){return t.key+": "+t.message})).join(", "));return r.value}var n=t;return"string"==typeof t&&"color"===e.type&&(n=te.parse(t)),{kind:"constant",evaluate:function(){return n}}}(void 0===e?t.specification.default:e,t.specification)};li.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},li.prototype.possiblyEvaluate=function(t,e,r){return this.property.possiblyEvaluate(this,t,e,r)};var ui=function(t){this.property=t,this.value=new li(t,void 0)};ui.prototype.transitioned=function(t,e){return new hi(this.property,this.value,e,p({},t.transition,this.transition),t.now)},ui.prototype.untransitioned=function(){return new hi(this.property,this.value,null,{},0)};var ci=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};ci.prototype.getValue=function(t){return b(this._values[t].value.value)},ci.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ui(this._values[t].property)),this._values[t].value=new li(this._values[t].property,null===e?void 0:b(e))},ci.prototype.getTransition=function(t){return b(this._values[t].transition)},ci.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ui(this._values[t].property)),this._values[t].transition=b(e)||void 0},ci.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i);var o=this.getTransition(n);void 0!==o&&(t[n+"-transition"]=o)}return t},ci.prototype.transitioned=function(t,e){for(var r=new pi(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var o=i[n];r._values[o]=this._values[o].transitioned(t,e._values[o])}return r},ci.prototype.untransitioned=function(){for(var t=new pi(this._properties),e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e];t._values[n]=this._values[n].untransitioned()}return t};var hi=function(t,e,r,n,i){this.property=t,this.value=e,this.begin=i+n.delay||0,this.end=this.begin+n.duration||0,t.specification.transition&&(n.delay||n.duration)&&(this.prior=r)};hi.prototype.possiblyEvaluate=function(t,e,r){var n=t.now||0,i=this.value.possiblyEvaluate(t,e,r),o=this.prior;if(o){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return o.possiblyEvaluate(t,e,r);var a=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,r),i,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}(a))}return i};var pi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};pi.prototype.possiblyEvaluate=function(t,e,r){for(var n=new mi(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];n._values[a]=this._values[a].possiblyEvaluate(t,e,r)}return n},pi.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var di=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};di.prototype.getValue=function(t){return b(this._values[t].value)},di.prototype.setValue=function(t,e){this._values[t]=new li(this._values[t].property,null===e?void 0:b(e))},di.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i)}return t},di.prototype.possiblyEvaluate=function(t,e,r){for(var n=new mi(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];n._values[a]=this._values[a].possiblyEvaluate(t,e,r)}return n};var fi=function(t,e,r){this.property=t,this.value=e,this.parameters=r};fi.prototype.isConstant=function(){return"constant"===this.value.kind},fi.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},fi.prototype.evaluate=function(t,e,r,n){return this.property.evaluate(this.value,this.parameters,t,e,r,n)};var mi=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};mi.prototype.get=function(t){return this._values[t]};var gi=function(t){this.specification=t};gi.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},gi.prototype.interpolate=function(t,e,r){var n=We[this.specification.type];return n?n(t,e,r):t};var _i=function(t,e){this.specification=t,this.overrides=e};_i.prototype.possiblyEvaluate=function(t,e,r,n){return new fi(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},r,n)}:t.expression,e)},_i.prototype.interpolate=function(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new fi(this,{kind:"constant",value:void 0},t.parameters);var n=We[this.specification.type];return n?new fi(this,{kind:"constant",value:n(t.value.value,e.value.value,r)},t.parameters):t},_i.prototype.evaluate=function(t,e,r,n,i,o){return"constant"===t.kind?t.value:t.evaluate(e,r,n,i,o)};var vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,r,n){if(void 0===t.value)return new fi(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},r,n),o="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,a=this._calculate(o,o,o,e);return new fi(this,{kind:"constant",value:a},e)}if("camera"===t.expression.kind){var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new fi(this,{kind:"constant",value:s},e)}return new fi(this,t.expression,e)},e.prototype.evaluate=function(t,e,r,n,i,o){if("source"===t.kind){var a=t.evaluate(e,r,n,i,o);return this._calculate(a,a,a,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},r,n),t.evaluate({zoom:Math.floor(e.zoom)},r,n),t.evaluate({zoom:Math.floor(e.zoom)+1},r,n),e):t.value},e.prototype._calculate=function(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},e.prototype.interpolate=function(t){return t},e}(_i),yi=function(t){this.specification=t};yi.prototype.possiblyEvaluate=function(t,e,r,n){if(void 0!==t.value){if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},r,n);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new si(Math.floor(e.zoom-1),e)),t.expression.evaluate(new si(Math.floor(e.zoom),e)),t.expression.evaluate(new si(Math.floor(e.zoom+1),e)),e)}},yi.prototype._calculate=function(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},yi.prototype.interpolate=function(t){return t};var xi=function(t){this.specification=t};xi.prototype.possiblyEvaluate=function(t,e,r,n){return!!t.expression.evaluate(e,null,{},r,n)},xi.prototype.interpolate=function(){return!1};var bi=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var r=t[e];r.specification.overridable&&this.overridableProperties.push(e);var n=this.defaultPropertyValues[e]=new li(r,void 0),i=this.defaultTransitionablePropertyValues[e]=new ui(r);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}};kn("DataDrivenProperty",_i),kn("DataConstantProperty",gi),kn("CrossFadedDataDrivenProperty",vi),kn("CrossFadedProperty",yi),kn("ColorRampProperty",xi);var Ei=function(t){function e(e,r){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new di(r.layout)),r.paint)){for(var n in this._transitionablePaint=new ci(r.paint),e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(var i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mi(r.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,r){void 0===r&&(r={}),null!=e&&this._validate(Mn,"layers."+this.id+".layout."+t,t,e,r)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},e.prototype.getPaintProperty=function(t){return v(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,r){if(void 0===r&&(r={}),null!=e&&this._validate(In,"layers."+this.id+".paint."+t,t,e,r))return!1;if(v(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-11),e||void 0),!1;var n=this._transitionablePaint._values[t],i="cross-faded-data-driven"===n.property.specification["property-type"],o=n.value.isDataDriven(),a=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||o||i||this._handleOverridablePaintPropertyUpdate(t,a,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,r){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),x(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,r,n,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&On(this,t.call(Rn,{key:e,layerType:this.type,objectKey:r,value:n,styleSpec:Lt,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof fi&&Pr(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(Rt),Ti={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Si=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ai=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function wi(t,e){void 0===e&&(e=1);var r=0,n=0;return{members:t.map((function(t){var i=Ti[t.type].BYTES_PER_ELEMENT,o=r=Ci(r,Math.max(e,i)),a=t.components||1;return n=Math.max(n,i),r+=i*a,{name:t.name,type:t.type,components:a,offset:o}})),size:Ci(r,Math.max(n,e)),alignment:e}}function Ci(t,e){return Math.ceil(t/e)*e}Ai.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Ai.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Ai.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ai.prototype.clear=function(){this.length=0},Ai.prototype.resize=function(t){this.reserve(t),this.length=t},Ai.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Ai.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.int16[n+0]=e,this.int16[n+1]=r,t},e}(Ai);Ri.prototype.bytesPerElement=4,kn("StructArrayLayout2i4",Ri);var Li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var o=4*t;return this.int16[o+0]=e,this.int16[o+1]=r,this.int16[o+2]=n,this.int16[o+3]=i,t},e}(Ai);Li.prototype.bytesPerElement=8,kn("StructArrayLayout4i8",Li);var Ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o)},e.prototype.emplace=function(t,e,r,n,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Ai);Ii.prototype.bytesPerElement=12,kn("StructArrayLayout2i4i12",Ii);var Mi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o)},e.prototype.emplace=function(t,e,r,n,i,o,a){var s=4*t,l=8*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.uint8[l+4]=n,this.uint8[l+5]=i,this.uint8[l+6]=o,this.uint8[l+7]=a,t},e}(Ai);Mi.prototype.bytesPerElement=8,kn("StructArrayLayout2i4ub8",Mi);var Oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.float32[n+0]=e,this.float32[n+1]=r,t},e}(Ai);Oi.prototype.bytesPerElement=8,kn("StructArrayLayout2f8",Oi);var Pi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,l,u){var c=this.length;return this.resize(c+1),this.emplace(c,t,e,r,n,i,o,a,s,l,u)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,l,u,c){var h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=r,this.uint16[h+2]=n,this.uint16[h+3]=i,this.uint16[h+4]=o,this.uint16[h+5]=a,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=u,this.uint16[h+9]=c,t},e}(Ai);Pi.prototype.bytesPerElement=20,kn("StructArrayLayout10ui20",Pi);var Di=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,l,u,c,h){var p=this.length;return this.resize(p+1),this.emplace(p,t,e,r,n,i,o,a,s,l,u,c,h)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,l,u,c,h,p){var d=12*t;return this.int16[d+0]=e,this.int16[d+1]=r,this.int16[d+2]=n,this.int16[d+3]=i,this.uint16[d+4]=o,this.uint16[d+5]=a,this.uint16[d+6]=s,this.uint16[d+7]=l,this.int16[d+8]=u,this.int16[d+9]=c,this.int16[d+10]=h,this.int16[d+11]=p,t},e}(Ai);Di.prototype.bytesPerElement=24,kn("StructArrayLayout4i4ui4i24",Di);var Bi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.float32[i+0]=e,this.float32[i+1]=r,this.float32[i+2]=n,t},e}(Ai);Bi.prototype.bytesPerElement=12,kn("StructArrayLayout3f12",Bi);var Ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(Ai);Ni.prototype.bytesPerElement=4,kn("StructArrayLayout1ul4",Ni);var Fi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,l){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,r,n,i,o,a,s,l)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,l,u){var c=10*t,h=5*t;return this.int16[c+0]=e,this.int16[c+1]=r,this.int16[c+2]=n,this.int16[c+3]=i,this.int16[c+4]=o,this.int16[c+5]=a,this.uint32[h+3]=s,this.uint16[c+8]=l,this.uint16[c+9]=u,t},e}(Ai);Fi.prototype.bytesPerElement=20,kn("StructArrayLayout6i1ul2ui20",Fi);var ki=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o)},e.prototype.emplace=function(t,e,r,n,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Ai);ki.prototype.bytesPerElement=12,kn("StructArrayLayout2i2i2i12",ki);var Ui=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,n,i)},e.prototype.emplace=function(t,e,r,n,i,o){var a=4*t,s=8*t;return this.float32[a+0]=e,this.float32[a+1]=r,this.float32[a+2]=n,this.int16[s+6]=i,this.int16[s+7]=o,t},e}(Ai);Ui.prototype.bytesPerElement=16,kn("StructArrayLayout2f1f2i16",Ui);var zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=r,this.float32[a+1]=n,this.float32[a+2]=i,t},e}(Ai);zi.prototype.bytesPerElement=12,kn("StructArrayLayout2ub2f12",zi);var Gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=r,this.uint16[i+2]=n,t},e}(Ai);Gi.prototype.bytesPerElement=6,kn("StructArrayLayout3ui6",Gi);var ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m,g){var _=this.length;return this.resize(_+1),this.emplace(_,t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m,g)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m,g,_){var v=24*t,y=12*t,x=48*t;return this.int16[v+0]=e,this.int16[v+1]=r,this.uint16[v+2]=n,this.uint16[v+3]=i,this.uint32[y+2]=o,this.uint32[y+3]=a,this.uint32[y+4]=s,this.uint16[v+10]=l,this.uint16[v+11]=u,this.uint16[v+12]=c,this.float32[y+7]=h,this.float32[y+8]=p,this.uint8[x+36]=d,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[y+10]=g,this.int16[v+22]=_,t},e}(Ai);ji.prototype.bytesPerElement=48,kn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ji);var Vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m,g,_,v,y,x,b,E,T,S,A,w,C){var R=this.length;return this.resize(R+1),this.emplace(R,t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m,g,_,v,y,x,b,E,T,S,A,w,C)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m,g,_,v,y,x,b,E,T,S,A,w,C,R){var L=34*t,I=17*t;return this.int16[L+0]=e,this.int16[L+1]=r,this.int16[L+2]=n,this.int16[L+3]=i,this.int16[L+4]=o,this.int16[L+5]=a,this.int16[L+6]=s,this.int16[L+7]=l,this.uint16[L+8]=u,this.uint16[L+9]=c,this.uint16[L+10]=h,this.uint16[L+11]=p,this.uint16[L+12]=d,this.uint16[L+13]=f,this.uint16[L+14]=m,this.uint16[L+15]=g,this.uint16[L+16]=_,this.uint16[L+17]=v,this.uint16[L+18]=y,this.uint16[L+19]=x,this.uint16[L+20]=b,this.uint16[L+21]=E,this.uint16[L+22]=T,this.uint32[I+12]=S,this.float32[I+13]=A,this.float32[I+14]=w,this.float32[I+15]=C,this.float32[I+16]=R,t},e}(Ai);Vi.prototype.bytesPerElement=68,kn("StructArrayLayout8i15ui1ul4f68",Vi);var Hi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(Ai);Hi.prototype.bytesPerElement=4,kn("StructArrayLayout1f4",Hi);var Wi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.int16[i+0]=e,this.int16[i+1]=r,this.int16[i+2]=n,t},e}(Ai);Wi.prototype.bytesPerElement=6,kn("StructArrayLayout3i6",Wi);var Xi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=4*t;return this.uint32[2*t+0]=e,this.uint16[i+2]=r,this.uint16[i+3]=n,t},e}(Ai);Xi.prototype.bytesPerElement=8,kn("StructArrayLayout1ul2ui8",Xi);var Zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=r,t},e}(Ai);Zi.prototype.bytesPerElement=4,kn("StructArrayLayout2ui4",Zi);var qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(Ai);qi.prototype.bytesPerElement=2,kn("StructArrayLayout1ui2",qi);var Yi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var o=4*t;return this.float32[o+0]=e,this.float32[o+1]=r,this.float32[o+2]=n,this.float32[o+3]=i,t},e}(Ai);Yi.prototype.bytesPerElement=16,kn("StructArrayLayout4f16",Yi);var Ki=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new i(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,r),e}(Si);Ki.prototype.size=20;var $i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Ki(this,t)},e}(Fi);kn("CollisionBoxArray",$i);var Qi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,r),e}(Si);Qi.prototype.size=48;var Ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Qi(this,t)},e}(ji);kn("PlacedSymbolArray",Ji);var to=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+12]=t},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,r),e}(Si);to.prototype.size=68;var eo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new to(this,t)},e}(Vi);kn("SymbolInstanceArray",eo);var ro=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e}(Hi);kn("GlyphOffsetArray",ro);var no=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e}(Wi);kn("SymbolLineVertexArray",no);var io=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,r),e}(Si);io.prototype.size=8;var oo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new io(this,t)},e}(Xi);kn("FeatureIndexArray",oo);var ao=wi([{name:"a_pos",components:2,type:"Int16"}],4).members,so=function(t){void 0===t&&(t=[]),this.segments=t};function lo(t,e){return 256*(t=c(Math.floor(t),0,255))+c(Math.floor(e),0,255)}so.prototype.prepareSegment=function(t,e,r,n){var i=this.segments[this.segments.length-1];return t>so.MAX_VERTEX_ARRAY_LENGTH&&T("Max vertices per segment is "+so.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>so.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i},so.prototype.get=function(){return this.segments},so.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var r=e[t];for(var n in r.vaos)r.vaos[n].destroy()}},so.simpleSegment=function(t,e,r,n){return new so([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])},so.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,kn("SegmentVector",so);var uo=wi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),co=e((function(t){t.exports=function(t,e){var r,n,i,o,a,s,l,u;for(n=t.length-(r=3&t.length),i=e,a=3432918353,s=461845907,u=0;u<n;)l=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24,++u,i=27492+(65535&(o=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&t.charCodeAt(u+2))<<16;case 2:l^=(255&t.charCodeAt(u+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(u)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),ho=e((function(t){t.exports=function(t,e){for(var r,n=t.length,i=e^n,o=0;n>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),po=co,fo=ho;po.murmur3=co,po.murmur2=fo;var mo=function(){this.ids=[],this.positions=[],this.indexed=!1};mo.prototype.add=function(t,e,r,n){this.ids.push(_o(t)),this.positions.push(e,r,n)},mo.prototype.getPositions=function(t){for(var e=_o(t),r=0,n=this.ids.length-1;r<n;){var i=r+n>>1;this.ids[i]>=e?n=i:r=i+1}for(var o=[];this.ids[r]===e;)o.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return o},mo.serialize=function(t,e){var r=new Float64Array(t.ids),n=new Uint32Array(t.positions);return function t(e,r,n,i){for(;n<i;){for(var o=e[n+i>>1],a=n-1,s=i+1;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;vo(e,a,s),vo(r,3*a,3*s),vo(r,3*a+1,3*s+1),vo(r,3*a+2,3*s+2)}s-n<i-s?(t(e,r,n,s),n=s+1):(t(e,r,s+1,i),i=s)}}(r,n,0,r.length-1),e&&e.push(r.buffer,n.buffer),{ids:r,positions:n}},mo.deserialize=function(t){var e=new mo;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var go=Math.pow(2,53)-1;function _o(t){var e=+t;return!isNaN(e)&&e<=go?e:po(String(t))}function vo(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}kn("FeaturePositionMap",mo);var yo=function(t,e){this.gl=t.gl,this.location=e},xo=function(t){function e(e,r){t.call(this,e,r),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(yo),bo=function(t){function e(e,r){t.call(this,e,r),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(yo),Eo=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(yo),To=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(yo),So=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(yo),Ao=function(t){function e(e,r){t.call(this,e,r),this.current=te.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(yo),wo=new Float32Array(16),Co=function(t){function e(e,r){t.call(this,e,r),this.current=wo}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(yo);function Ro(t){return[lo(255*t.r,255*t.g),lo(255*t.b,255*t.a)]}var Lo=function(t,e,r){this.value=t,this.uniformNames=e.map((function(t){return"u_"+t})),this.type=r};Lo.prototype.setUniform=function(t,e,r){t.set(r.constantOr(this.value))},Lo.prototype.getBinding=function(t,e,r){return"color"===this.type?new Ao(t,e):new bo(t,e)};var Io=function(t,e){this.uniformNames=e.map((function(t){return"u_"+t})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Io.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},Io.prototype.setUniform=function(t,e,r,n){var i="u_pattern_to"===n?this.patternTo:"u_pattern_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;i&&t.set(i)},Io.prototype.getBinding=function(t,e,r){return"u_pattern"===r.substr(0,9)?new So(t,e):new bo(t,e)};var Mo=function(t,e,r,n){this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?2:1,offset:0}})),this.paintVertexArray=new n};Mo.prototype.populatePaintArray=function(t,e,r,n,i){var o=this.paintVertexArray.length,a=this.expression.evaluate(new si(0),e,{},n,[],i);this.paintVertexArray.resize(t),this._setPaintValue(o,t,a)},Mo.prototype.updatePaintArray=function(t,e,r,n){var i=this.expression.evaluate({zoom:0},r,n);this._setPaintValue(t,e,i)},Mo.prototype._setPaintValue=function(t,e,r){if("color"===this.type)for(var n=Ro(r),i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1]);else{for(var o=t;o<e;o++)this.paintVertexArray.emplace(o,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},Mo.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Mo.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Oo=function(t,e,r,n,i,o){this.expression=t,this.uniformNames=e.map((function(t){return"u_"+t+"_t"})),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?4:2,offset:0}})),this.paintVertexArray=new o};Oo.prototype.populatePaintArray=function(t,e,r,n,i){var o=this.expression.evaluate(new si(this.zoom),e,{},n,[],i),a=this.expression.evaluate(new si(this.zoom+1),e,{},n,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,o,a)},Oo.prototype.updatePaintArray=function(t,e,r,n){var i=this.expression.evaluate({zoom:this.zoom},r,n),o=this.expression.evaluate({zoom:this.zoom+1},r,n);this._setPaintValue(t,e,i,o)},Oo.prototype._setPaintValue=function(t,e,r,n){if("color"===this.type)for(var i=Ro(r),o=Ro(n),a=t;a<e;a++)this.paintVertexArray.emplace(a,i[0],i[1],o[0],o[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}},Oo.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Oo.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Oo.prototype.setUniform=function(t,e){var r=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,n=c(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);t.set(n)},Oo.prototype.getBinding=function(t,e,r){return new bo(t,e)};var Po=function(t,e,r,n,i,o){this.expression=t,this.type=e,this.useIntegerZoom=r,this.zoom=n,this.layerId=o,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i};Po.prototype.populatePaintArray=function(t,e,r){var n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(n,t,e.patterns&&e.patterns[this.layerId],r)},Po.prototype.updatePaintArray=function(t,e,r,n,i){this._setPaintValues(t,e,r.patterns&&r.patterns[this.layerId],i)},Po.prototype._setPaintValues=function(t,e,r,n){if(n&&r){var i=n[r.min],o=n[r.mid],a=n[r.max];if(i&&o&&a)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],o.pixelRatio,i.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],o.pixelRatio,a.pixelRatio)}},Po.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,uo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,uo.members,this.expression.isStateDependent))},Po.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Do=function(t,e,r){this.binders={},this._buffers=[];var n=[];for(var i in t.paint._values)if(r(i)){var o=t.paint.get(i);if(o instanceof fi&&Pr(o.property.specification)){var a=No(i,t.type),s=o.value,l=o.property.specification.type,u=o.property.useIntegerZoom,c=o.property.specification["property-type"],h="cross-faded"===c||"cross-faded-data-driven"===c;if("constant"===s.kind)this.binders[i]=h?new Io(s.value,a):new Lo(s.value,a,l),n.push("/u_"+i);else if("source"===s.kind||h){var p=Fo(i,l,"source");this.binders[i]=h?new Po(s,l,u,e,p,t.id):new Mo(s,a,l,p),n.push("/a_"+i)}else{var d=Fo(i,l,"composite");this.binders[i]=new Oo(s,a,l,u,e,d),n.push("/z_"+i)}}}this.cacheKey=n.sort().join("")};Do.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof Mo||e instanceof Oo?e.maxValue:0},Do.prototype.populatePaintArrays=function(t,e,r,n,i){for(var o in this.binders){var a=this.binders[o];(a instanceof Mo||a instanceof Oo||a instanceof Po)&&a.populatePaintArray(t,e,r,n,i)}},Do.prototype.setConstantPatternPositions=function(t,e){for(var r in this.binders){var n=this.binders[r];n instanceof Io&&n.setConstantPatternPositions(t,e)}},Do.prototype.updatePaintArrays=function(t,e,r,n,i){var o=!1;for(var a in t)for(var s=0,l=e.getPositions(a);s<l.length;s+=1){var u=l[s],c=r.feature(u.index);for(var h in this.binders){var p=this.binders[h];if((p instanceof Mo||p instanceof Oo||p instanceof Po)&&!0===p.expression.isStateDependent){var d=n.paint.get(h);p.expression=d.value,p.updatePaintArray(u.start,u.end,c,t[a],i),o=!0}}}return o},Do.prototype.defines=function(){var t=[];for(var e in this.binders){var r=this.binders[e];(r instanceof Lo||r instanceof Io)&&t.push.apply(t,r.uniformNames.map((function(t){return"#define HAS_UNIFORM_"+t})))}return t},Do.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var r=this.binders[e];if(r instanceof Mo||r instanceof Oo)for(var n=0;n<r.paintVertexAttributes.length;n++)t.push(r.paintVertexAttributes[n].name);else if(r instanceof Po)for(var i=0;i<uo.members.length;i++)t.push(uo.members[i].name)}return t},Do.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var r=this.binders[e];if(r instanceof Lo||r instanceof Io||r instanceof Oo)for(var n=0,i=r.uniformNames;n<i.length;n+=1)t.push(i[n])}return t},Do.prototype.getPaintVertexBuffers=function(){return this._buffers},Do.prototype.getUniforms=function(t,e){var r=[];for(var n in this.binders){var i=this.binders[n];if(i instanceof Lo||i instanceof Io||i instanceof Oo)for(var o=0,a=i.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var l=i.getBinding(t,e[s],s);r.push({name:s,property:n,binding:l})}}}return r},Do.prototype.setUniforms=function(t,e,r,n){for(var i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.name,l=a.property;this.binders[l].setUniform(a.binding,n,r.get(l),s)}},Do.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var r=this.binders[e];if(t&&r instanceof Po){var n=2===t.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;n&&this._buffers.push(n)}else(r instanceof Mo||r instanceof Oo)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},Do.prototype.upload=function(t){for(var e in this.binders){var r=this.binders[e];(r instanceof Mo||r instanceof Oo||r instanceof Po)&&r.upload(t)}this.updatePaintBuffers()},Do.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof Mo||e instanceof Oo||e instanceof Po)&&e.destroy()}};var Bo=function(t,e,r){void 0===r&&(r=function(){return!0}),this.programConfigurations={};for(var n=0,i=t;n<i.length;n+=1){var o=i[n];this.programConfigurations[o.id]=new Do(o,e,r)}this.needsUpload=!1,this._featureMap=new mo,this._bufferOffset=0};function No(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Fo(t,e,r){var n={color:{source:Oi,composite:Yi},number:{source:Hi,composite:Oi}},i=function(t){return{"line-pattern":{source:Pi,composite:Pi},"fill-pattern":{source:Pi,composite:Pi},"fill-extrusion-pattern":{source:Pi,composite:Pi}}[t]}(t);return i&&i[r]||n[e][r]}Bo.prototype.populatePaintArrays=function(t,e,r,n,i,o){for(var a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(t,e,n,i,o);void 0!==e.id&&this._featureMap.add(e.id,r,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Bo.prototype.updatePaintArrays=function(t,e,r,n){for(var i=0,o=r;i<o.length;i+=1){var a=o[i];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,e,a,n)||this.needsUpload}},Bo.prototype.get=function(t){return this.programConfigurations[t]},Bo.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},Bo.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},kn("ConstantBinder",Lo),kn("CrossFadedConstantBinder",Io),kn("SourceExpressionBinder",Mo),kn("CrossFadedCompositeBinder",Po),kn("CompositeExpressionBinder",Oo),kn("ProgramConfiguration",Do,{omit:["_buffers"]}),kn("ProgramConfigurationSet",Bo);var ko=Math.pow(2,14)-1,Uo=-ko-1;function zo(t){for(var e=8192/t.extent,r=t.loadGeometry(),n=0;n<r.length;n++)for(var i=r[n],o=0;o<i.length;o++){var a=i[o],s=Math.round(a.x*e),l=Math.round(a.y*e);a.x=c(s,Uo,ko),a.y=c(l,Uo,ko),(s<a.x||s>a.x+1||l<a.y||l>a.y+1)&&T("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function Go(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?zo(t):[]}}function jo(t,e,r,n,i){t.emplaceBack(2*e+(n+1)/2,2*r+(i+1)/2)}var Vo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ri,this.indexArray=new Gi,this.segments=new so,this.programConfigurations=new Bo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ho(t,e){for(var r=0;r<t.length;r++)if(Jo(e,t[r]))return!0;for(var n=0;n<e.length;n++)if(Jo(t,e[n]))return!0;return!!qo(t,e)}function Wo(t,e,r){return!!Jo(t,e)||!!Ko(e,t,r)}function Xo(t,e){if(1===t.length)return Qo(e,t[0]);for(var r=0;r<e.length;r++)for(var n=e[r],i=0;i<n.length;i++)if(Jo(t,n[i]))return!0;for(var o=0;o<t.length;o++)if(Qo(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(qo(t,e[a]))return!0;return!1}function Zo(t,e,r){if(t.length>1){if(qo(t,e))return!0;for(var n=0;n<e.length;n++)if(Ko(e[n],t,r))return!0}for(var i=0;i<t.length;i++)if(Ko(t[i],e,r))return!0;return!1}function qo(t,e){if(0===t.length||0===e.length)return!1;for(var r=0;r<t.length-1;r++)for(var n=t[r],i=t[r+1],o=0;o<e.length-1;o++)if(Yo(n,i,e[o],e[o+1]))return!0;return!1}function Yo(t,e,r,n){return S(t,r,n)!==S(e,r,n)&&S(t,e,r)!==S(t,e,n)}function Ko(t,e,r){var n=r*r;if(1===e.length)return t.distSqr(e[0])<n;for(var i=1;i<e.length;i++)if($o(t,e[i-1],e[i])<n)return!0;return!1}function $o(t,e,r){var n=e.distSqr(r);if(0===n)return t.distSqr(e);var i=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(i<0?e:i>1?r:r.sub(e)._mult(i)._add(e))}function Qo(t,e){for(var r,n,i,o=!1,a=0;a<t.length;a++)for(var s=0,l=(r=t[a]).length-1;s<r.length;l=s++)(n=r[s]).y>e.y!=(i=r[l]).y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(o=!o);return o}function Jo(t,e){for(var r=!1,n=0,i=t.length-1;n<t.length;i=n++){var o=t[n],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(r=!r)}return r}function ta(t,e,r){var n=r[0],i=r[2];if(t.x<n.x&&e.x<n.x||t.x>i.x&&e.x>i.x||t.y<n.y&&e.y<n.y||t.y>i.y&&e.y>i.y)return!1;var o=S(t,e,r[0]);return o!==S(t,e,r[1])||o!==S(t,e,r[2])||o!==S(t,e,r[3])}function ea(t,e,r){var n=e.paint.get(t).value;return"constant"===n.kind?n.value:r.programConfigurations.get(e.id).getMaxValue(t)}function ra(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function na(t,e,r,n,o){if(!e[0]&&!e[1])return t;var a=i.convert(e)._mult(o);"viewport"===r&&a._rotate(-n);for(var s=[],l=0;l<t.length;l++)s.push(t[l].sub(a));return s}Vo.prototype.populate=function(t,e,r){var n=this.layers[0],i=[],o=null;"circle"===n.type&&(o=n.layout.get("circle-sort-key"));for(var a=0,s=t;a<s.length;a+=1){var l=s[a],u=l.feature,c=l.id,h=l.index,p=l.sourceLayerIndex,d=this.layers[0]._featureFilter.needGeometry,f=Go(u,d);if(this.layers[0]._featureFilter.filter(new si(this.zoom),f,r)){var m=o?o.evaluate(f,{},r):void 0,g={id:c,properties:u.properties,type:u.type,sourceLayerIndex:p,index:h,geometry:d?f.geometry:zo(u),patterns:{},sortKey:m};i.push(g)}}o&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var _=0,v=i;_<v.length;_+=1){var y=v[_],x=y.geometry,b=y.index,E=y.sourceLayerIndex,T=t[b].feature;this.addFeature(y,x,b,r),e.featureIndex.insert(T,x,b,E,this.index)}},Vo.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Vo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Vo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Vo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ao),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Vo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Vo.prototype.addFeature=function(t,e,r,n){for(var i=0,o=e;i<o.length;i+=1)for(var a=0,s=o[i];a<s.length;a+=1){var l=s[a],u=l.x,c=l.y;if(!(u<0||u>=8192||c<0||c>=8192)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),p=h.vertexLength;jo(this.layoutVertexArray,u,c,-1,-1),jo(this.layoutVertexArray,u,c,1,-1),jo(this.layoutVertexArray,u,c,1,1),jo(this.layoutVertexArray,u,c,-1,1),this.indexArray.emplaceBack(p,p+1,p+2),this.indexArray.emplaceBack(p,p+3,p+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},n)},kn("CircleBucket",Vo,{omit:["layers"]});var ia=new bi({"circle-sort-key":new _i(Lt.layout_circle["circle-sort-key"])}),oa={paint:new bi({"circle-radius":new _i(Lt.paint_circle["circle-radius"]),"circle-color":new _i(Lt.paint_circle["circle-color"]),"circle-blur":new _i(Lt.paint_circle["circle-blur"]),"circle-opacity":new _i(Lt.paint_circle["circle-opacity"]),"circle-translate":new gi(Lt.paint_circle["circle-translate"]),"circle-translate-anchor":new gi(Lt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gi(Lt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gi(Lt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _i(Lt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _i(Lt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _i(Lt.paint_circle["circle-stroke-opacity"])}),layout:ia},aa="undefined"!=typeof Float32Array?Float32Array:Array;function sa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function la(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],g=e[13],_=e[14],v=e[15],y=r[0],x=r[1],b=r[2],E=r[3];return t[0]=y*n+x*s+b*h+E*m,t[1]=y*i+x*l+b*p+E*g,t[2]=y*o+x*u+b*d+E*_,t[3]=y*a+x*c+b*f+E*v,t[4]=(y=r[4])*n+(x=r[5])*s+(b=r[6])*h+(E=r[7])*m,t[5]=y*i+x*l+b*p+E*g,t[6]=y*o+x*u+b*d+E*_,t[7]=y*a+x*c+b*f+E*v,t[8]=(y=r[8])*n+(x=r[9])*s+(b=r[10])*h+(E=r[11])*m,t[9]=y*i+x*l+b*p+E*g,t[10]=y*o+x*u+b*d+E*_,t[11]=y*a+x*c+b*f+E*v,t[12]=(y=r[12])*n+(x=r[13])*s+(b=r[14])*h+(E=r[15])*m,t[13]=y*i+x*l+b*p+E*g,t[14]=y*o+x*u+b*d+E*_,t[15]=y*a+x*c+b*f+E*v,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,r=arguments.length;r--;)e+=t[r]*t[r];return Math.sqrt(e)});var ua,ca=la;function ha(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}ua=new aa(3),aa!=Float32Array&&(ua[0]=0,ua[1]=0,ua[2]=0),function(){var t=new aa(4);aa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var pa=(function(){var t=new aa(2);aa!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function e(e){t.call(this,e,oa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Vo(t)},e.prototype.queryRadius=function(t){var e=t;return ea("circle-radius",this,e)+ea("circle-stroke-width",this,e)+ra(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,o,a,s){for(var l=na(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),u=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),c="map"===this.paint.get("circle-pitch-alignment"),h=c?l:function(t,e){return t.map((function(t){return da(t,e)}))}(l,s),p=c?u*a:u,d=0,f=n;d<f.length;d+=1)for(var m=0,g=f[d];m<g.length;m+=1){var _=g[m],v=c?_:da(_,s),y=p,x=ha([],[_.x,_.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?y*=x[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(y*=o.cameraToCenterDistance/x[3]),Wo(h,v,y))return!0}return!1},e}(Ei));function da(t,e){var r=ha([],[t.x,t.y,0,1],e);return new i(r[0]/r[3],r[1]/r[3])}var fa=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Vo);function ma(t,e,r,n){var i=e.width,o=e.height;if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==i*o*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(i*o*r);return t.width=i,t.height=o,t.data=n,t}function ga(t,e,r){var n=e.width,i=e.height;if(n!==t.width||i!==t.height){var o=ma({},{width:n,height:i},r);_a(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,i)},r),t.width=n,t.height=i,t.data=o.data}}function _a(t,e,r,n,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,l=0;l<i.height;l++)for(var u=((r.y+l)*t.width+r.x)*o,c=((n.y+l)*e.width+n.x)*o,h=0;h<i.width*o;h++)s[c+h]=a[u+h];return e}kn("HeatmapBucket",fa,{omit:["layers"]});var va=function(t,e){ma(this,t,1,e)};va.prototype.resize=function(t){ga(this,t,1)},va.prototype.clone=function(){return new va({width:this.width,height:this.height},new Uint8Array(this.data))},va.copy=function(t,e,r,n,i){_a(t,e,r,n,i,1)};var ya=function(t,e){ma(this,t,4,e)};ya.prototype.resize=function(t){ga(this,t,4)},ya.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},ya.prototype.clone=function(){return new ya({width:this.width,height:this.height},new Uint8Array(this.data))},ya.copy=function(t,e,r,n,i){_a(t,e,r,n,i,4)},kn("AlphaImage",va),kn("RGBAImage",ya);var xa={paint:new bi({"heatmap-radius":new _i(Lt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _i(Lt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gi(Lt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xi(Lt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gi(Lt.paint_heatmap["heatmap-opacity"])})};function ba(t){var e={},r=t.resolution||256,n=t.clips?t.clips.length:1,i=t.image||new ya({width:r,height:n}),o=function(r,n,o){e[t.evaluationKey]=o;var a=t.expression.evaluate(e);i.data[r+n+0]=Math.floor(255*a.r/a.a),i.data[r+n+1]=Math.floor(255*a.g/a.a),i.data[r+n+2]=Math.floor(255*a.b/a.a),i.data[r+n+3]=Math.floor(255*a.a)};if(t.clips)for(var a=0,s=0;a<n;++a,s+=4*r)for(var l=0,u=0;l<r;l++,u+=4){var c=l/(r-1),h=t.clips[a];o(s,u,h.start*(1-c)+h.end*c)}else for(var p=0,d=0;p<r;p++,d+=4)o(0,d,p/(r-1));return i}var Ea=function(t){function e(e){t.call(this,e,xa),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new fa(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=ba({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(Ei),Ta={paint:new bi({"hillshade-illumination-direction":new gi(Lt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gi(Lt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gi(Lt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gi(Lt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gi(Lt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gi(Lt.paint_hillshade["hillshade-accent-color"])})},Sa=function(t){function e(e){t.call(this,e,Ta)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(Ei),Aa=wi([{name:"a_pos",components:2,type:"Int16"}],4).members,wa=Ra,Ca=Ra;function Ra(t,e,r){r=r||2;var n,i,o,a,s,l,u,c=e&&e.length,h=c?e[0]*r:t.length,p=La(t,0,h,r,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(t,e,r,n){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=La(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),s.push(za(a));for(s.sort(Na),i=0;i<s.length;i++)Fa(s[i],r),r=Ia(r,r.next);return r}(t,e,p,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var f=r;f<h;f+=r)(s=t[f])<n&&(n=s),(l=t[f+1])<i&&(i=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-n,a-i))?1/u:0}return Ma(p,d,r,n,i,u),d}function La(t,e,r,n,i){var o,a;if(i===Ja(t,e,r,n)>0)for(o=e;o<r;o+=n)a=Ka(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=Ka(o,t[o],t[o+1],a);return a&&Ha(a,a.next)&&($a(a),a=a.next),a}function Ia(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Ha(n,n.next)&&0!==Va(n.prev,n,n.next))n=n.next;else{if($a(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function Ma(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=Ua(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,l,u=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<u&&(s++,n=n.nextZ);e++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,u*=2}while(a>1)}(i)}(t,n,i,o);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?Pa(t,n,i,o):Oa(t))e.push(s.i/r),e.push(t.i/r),e.push(l.i/r),$a(t),t=l.next,u=l.next;else if((t=l)===u){a?1===a?Ma(t=Da(Ia(t),e,r),e,r,n,i,o,2):2===a&&Ba(t,e,r,n,i,o):Ma(Ia(t),e,r,n,i,o,1);break}}}function Oa(t){var e=t.prev,r=t,n=t.next;if(Va(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Ga(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Va(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Pa(t,e,r,n){var i=t.prev,o=t,a=t.next;if(Va(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,u=Ua(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,r,n),c=Ua(s,l,e,r,n),h=t.prevZ,p=t.nextZ;h&&h.z>=u&&p&&p.z<=c;){if(h!==t.prev&&h!==t.next&&Ga(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Va(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&Ga(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Va(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=u;){if(h!==t.prev&&h!==t.next&&Ga(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Va(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==t.prev&&p!==t.next&&Ga(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Va(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Da(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!Ha(i,o)&&Wa(i,n,n.next,o)&&qa(i,o)&&qa(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),$a(n),$a(n.next),n=t=o),n=n.next}while(n!==t);return Ia(n)}function Ba(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&ja(a,s)){var l=Ya(a,s);return a=Ia(a,a.next),l=Ia(l,l.next),Ma(a,e,r,n,i,o),void Ma(l,e,r,n,i,o)}s=s.next}a=a.next}while(a!==t)}function Na(t,e){return t.x-e.x}function Fa(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r;var l,u=r,c=r.x,h=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&Ga(o<h?i:a,o,c,h,o<h?a:i,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(i-n.x),qa(n,t)&&(l<p||l===p&&(n.x>r.x||n.x===r.x&&ka(r,n)))&&(r=n,p=l)),n=n.next}while(n!==u);return r}(t,e)){var r=Ya(e,t);Ia(e,e.next),Ia(r,r.next)}}function ka(t,e){return Va(t.prev,t,e.prev)<0&&Va(e.next,t,t.next)<0}function Ua(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function za(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Ga(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function ja(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Wa(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(qa(t,e)&&qa(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(Va(t.prev,t,e.prev)||Va(t,e.prev,e))||Ha(t,e)&&Va(t.prev,t,t.next)>0&&Va(e.prev,e,e.next)>0)}function Va(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Ha(t,e){return t.x===e.x&&t.y===e.y}function Wa(t,e,r,n){var i=Za(Va(t,e,r)),o=Za(Va(t,e,n)),a=Za(Va(r,n,t)),s=Za(Va(r,n,e));return i!==o&&a!==s||!(0!==i||!Xa(t,r,e))||!(0!==o||!Xa(t,n,e))||!(0!==a||!Xa(r,t,n))||!(0!==s||!Xa(r,e,n))}function Xa(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Za(t){return t>0?1:t<0?-1:0}function qa(t,e){return Va(t.prev,t,t.next)<0?Va(t,e,t.next)>=0&&Va(t,t.prev,e)>=0:Va(t,e,t.prev)<0||Va(t,t.next,e)<0}function Ya(t,e){var r=new Qa(t.i,t.x,t.y),n=new Qa(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function Ka(t,e,r,n){var i=new Qa(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function $a(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Qa(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ja(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function ts(t,e,r,n,i){!function t(e,r,n,i,o){for(;i>n;){if(i-n>600){var a=i-n+1,s=r-n+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(s-a/2<0?-1:1);t(e,r,Math.max(n,Math.floor(r-s*u/a+c)),Math.min(i,Math.floor(r+(a-s)*u/a+c)),o)}var h=e[r],p=n,d=i;for(es(e,n,r),o(e[i],h)>0&&es(e,n,i);p<d;){for(es(e,p,d),p++,d--;o(e[p],h)<0;)p++;for(;o(e[d],h)>0;)d--}0===o(e[n],h)?es(e,n,d):es(e,++d,i),d<=r&&(n=d+1),r<=d&&(i=d-1)}}(t,e,r||0,n||t.length-1,i||rs)}function es(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function rs(t,e){return t<e?-1:t>e?1:0}function ns(t,e){var r=t.length;if(r<=1)return[t];for(var n,i,o=[],a=0;a<r;a++){var s=A(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(n&&o.push(n),n=[t[a]]):n.push(t[a]))}if(n&&o.push(n),e>1)for(var l=0;l<o.length;l++)o[l].length<=e||(ts(o[l],e,1,o[l].length-1,is),o[l]=o[l].slice(0,e));return o}function is(t,e){return e.area-t.area}function os(t,e,r){for(var n=r.patternDependencies,i=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(i=!0);var l=s.constantOr(null);l&&(i=!0,n[l.to]=!0,n[l.from]=!0)}return i}function as(t,e,r,n,i){for(var o=i.patternDependencies,a=0,s=e;a<s.length;a+=1){var l=s[a],u=l.paint.get(t+"-pattern").value;if("constant"!==u.kind){var c=u.evaluate({zoom:n-1},r,{},i.availableImages),h=u.evaluate({zoom:n},r,{},i.availableImages),p=u.evaluate({zoom:n+1},r,{},i.availableImages);h=h&&h.name?h.name:h,p=p&&p.name?p.name:p,o[c=c&&c.name?c.name:c]=!0,o[h]=!0,o[p]=!0,r.patterns[l.id]={min:c,mid:h,max:p}}}return r}Ra.deviation=function(t,e,r,n){var i=e&&e.length,o=Math.abs(Ja(t,0,i?e[0]*r:t.length,r));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(Ja(t,e[a]*r,a<s-1?e[a+1]*r:t.length,r));var l=0;for(a=0;a<n.length;a+=3){var u=n[a]*r,c=n[a+1]*r,h=n[a+2]*r;l+=Math.abs((t[u]-t[h])*(t[c+1]-t[u+1])-(t[u]-t[c])*(t[h+1]-t[u+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Ra.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);i>0&&r.holes.push(n+=t[i-1].length)}return r},wa.default=Ca;var ss=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ri,this.indexArray=new Gi,this.indexArray2=new Zi,this.programConfigurations=new Bo(t.layers,t.zoom),this.segments=new so,this.segments2=new so,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};ss.prototype.populate=function(t,e,r){this.hasPattern=os("fill",this.layers,e);for(var n=this.layers[0].layout.get("fill-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],l=s.feature,u=s.id,c=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,d=Go(l,p);if(this.layers[0]._featureFilter.filter(new si(this.zoom),d,r)){var f=n?n.evaluate(d,{},r,e.availableImages):void 0,m={id:u,properties:l.properties,type:l.type,sourceLayerIndex:h,index:c,geometry:p?d.geometry:zo(l),patterns:{},sortKey:f};i.push(m)}}n&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var g=0,_=i;g<_.length;g+=1){var v=_[g],y=v.geometry,x=v.index,b=v.sourceLayerIndex;if(this.hasPattern){var E=as("fill",this.layers,v,this.zoom,e);this.patternFeatures.push(E)}else this.addFeature(v,y,x,r,{});e.featureIndex.insert(t[x].feature,y,x,b,this.index)}},ss.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},ss.prototype.addFeatures=function(t,e,r){for(var n=0,i=this.patternFeatures;n<i.length;n+=1){var o=i[n];this.addFeature(o,o.geometry,o.index,e,r)}},ss.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ss.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Aa),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ss.prototype.addFeature=function(t,e,r,n,i){for(var o=0,a=ns(e,500);o<a.length;o+=1){for(var s=a[o],l=0,u=0,c=s;u<c.length;u+=1)l+=c[u].length;for(var h=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray),p=h.vertexLength,d=[],f=[],m=0,g=s;m<g.length;m+=1){var _=g[m];if(0!==_.length){_!==s[0]&&f.push(d.length/2);var v=this.segments2.prepareSegment(_.length,this.layoutVertexArray,this.indexArray2),y=v.vertexLength;this.layoutVertexArray.emplaceBack(_[0].x,_[0].y),this.indexArray2.emplaceBack(y+_.length-1,y),d.push(_[0].x),d.push(_[0].y);for(var x=1;x<_.length;x++)this.layoutVertexArray.emplaceBack(_[x].x,_[x].y),this.indexArray2.emplaceBack(y+x-1,y+x),d.push(_[x].x),d.push(_[x].y);v.vertexLength+=_.length,v.primitiveLength+=_.length}}for(var b=wa(d,f),E=0;E<b.length;E+=3)this.indexArray.emplaceBack(p+b[E],p+b[E+1],p+b[E+2]);h.vertexLength+=l,h.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,n)},kn("FillBucket",ss,{omit:["layers","patternFeatures"]});var ls=new bi({"fill-sort-key":new _i(Lt.layout_fill["fill-sort-key"])}),us={paint:new bi({"fill-antialias":new gi(Lt.paint_fill["fill-antialias"]),"fill-opacity":new _i(Lt.paint_fill["fill-opacity"]),"fill-color":new _i(Lt.paint_fill["fill-color"]),"fill-outline-color":new _i(Lt.paint_fill["fill-outline-color"]),"fill-translate":new gi(Lt.paint_fill["fill-translate"]),"fill-translate-anchor":new gi(Lt.paint_fill["fill-translate-anchor"]),"fill-pattern":new vi(Lt.paint_fill["fill-pattern"])}),layout:ls},cs=function(t){function e(e){t.call(this,e,us)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,r){t.prototype.recalculate.call(this,e,r);var n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new ss(t)},e.prototype.queryRadius=function(){return ra(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,o,a){return Xo(na(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),n)},e.prototype.isTileClipped=function(){return!0},e}(Ei),hs=wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,ps=ds;function ds(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(fs,this,e)}function fs(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function ms(t){for(var e,r,n=0,i=0,o=t.length,a=o-1;i<o;a=i++)n+=((r=t[a]).x-(e=t[i]).x)*(e.y+r.y);return n}ds.types=["Unknown","Point","LineString","Polygon"],ds.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,o=0,a=0,s=0,l=[];t.pos<r;){if(o<=0){var u=t.readVarint();n=7&u,o=u>>3}if(o--,1===n||2===n)a+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push(new i(a,s));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&l.push(e),l},ds.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(n<=0){var c=t.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<l&&(l=o),o>u&&(u=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,s,u]},ds.prototype.toGeoJSON=function(t,e,r){var n,i,o=this.extent*Math.pow(2,r),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),u=ds.types[this.type];function c(t){for(var e=0;e<t.length;e++){var r=t[e];t[e]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];c(l=h);break;case 2:for(n=0;n<l.length;n++)c(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],o=0;o<e;o++){var a=ms(t[o]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(r&&i.push(r),r=[t[o]]):r.push(t[o]))}return r&&i.push(r),i}(l),n=0;n<l.length;n++)for(i=0;i<l[n].length;i++)c(l[n][i])}1===l.length?l=l[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var gs=_s;function _s(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(vs,this,e),this.length=this._features.length}function vs(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(r))}function ys(t,e,r){if(3===t){var n=new gs(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}_s.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new ps(this._pbf,e,this.extent,this._keys,this._values)};var xs={VectorTile:function(t,e){this.layers=t.readFields(ys,{},e)},VectorTileFeature:ps,VectorTileLayer:gs},bs=xs.VectorTileFeature.types,Es=Math.pow(2,13);function Ts(t,e,r,n,i,o,a,s){t.emplaceBack(e,r,2*Math.floor(n*Es)+a,i*Es*2,o*Es*2,Math.round(s))}var Ss=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ii,this.indexArray=new Gi,this.programConfigurations=new Bo(t.layers,t.zoom),this.segments=new so,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function As(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}Ss.prototype.populate=function(t,e,r){this.features=[],this.hasPattern=os("fill-extrusion",this.layers,e);for(var n=0,i=t;n<i.length;n+=1){var o=i[n],a=o.feature,s=o.id,l=o.index,u=o.sourceLayerIndex,c=this.layers[0]._featureFilter.needGeometry,h=Go(a,c);if(this.layers[0]._featureFilter.filter(new si(this.zoom),h,r)){var p={id:s,sourceLayerIndex:u,index:l,geometry:c?h.geometry:zo(a),properties:a.properties,type:a.type,patterns:{}};this.hasPattern?this.features.push(as("fill-extrusion",this.layers,p,this.zoom,e)):this.addFeature(p,p.geometry,l,r,{}),e.featureIndex.insert(a,p.geometry,l,u,this.index,!0)}}},Ss.prototype.addFeatures=function(t,e,r){for(var n=0,i=this.features;n<i.length;n+=1){var o=i[n];this.addFeature(o,o.geometry,o.index,e,r)}},Ss.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Ss.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ss.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ss.prototype.addFeature=function(t,e,r,n,i){for(var o=0,a=ns(e,500);o<a.length;o+=1){for(var s=a[o],l=0,u=0,c=s;u<c.length;u+=1)l+=c[u].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),p=0,d=s;p<d.length;p+=1){var f=d[p];if(0!==f.length&&!((O=f).every((function(t){return t.x<0}))||O.every((function(t){return t.x>8192}))||O.every((function(t){return t.y<0}))||O.every((function(t){return t.y>8192}))))for(var m=0,g=0;g<f.length;g++){var _=f[g];if(g>=1){var v=f[g-1];if(!As(_,v)){h.vertexLength+4>so.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var y=_.sub(v)._perp()._unit(),x=v.dist(_);m+x>32768&&(m=0),Ts(this.layoutVertexArray,_.x,_.y,y.x,y.y,0,0,m),Ts(this.layoutVertexArray,_.x,_.y,y.x,y.y,0,1,m),Ts(this.layoutVertexArray,v.x,v.y,y.x,y.y,0,0,m+=x),Ts(this.layoutVertexArray,v.x,v.y,y.x,y.y,0,1,m);var b=h.vertexLength;this.indexArray.emplaceBack(b,b+2,b+1),this.indexArray.emplaceBack(b+1,b+2,b+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+l>so.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray)),"Polygon"===bs[t.type]){for(var E=[],T=[],S=h.vertexLength,A=0,w=s;A<w.length;A+=1){var C=w[A];if(0!==C.length){C!==s[0]&&T.push(E.length/2);for(var R=0;R<C.length;R++){var L=C[R];Ts(this.layoutVertexArray,L.x,L.y,0,0,1,1,0),E.push(L.x),E.push(L.y)}}}for(var I=wa(E,T),M=0;M<I.length;M+=3)this.indexArray.emplaceBack(S+I[M],S+I[M+2],S+I[M+1]);h.primitiveLength+=I.length/3,h.vertexLength+=l}}var O;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,n)},kn("FillExtrusionBucket",Ss,{omit:["layers","features"]});var ws={paint:new bi({"fill-extrusion-opacity":new gi(Lt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _i(Lt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gi(Lt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gi(Lt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vi(Lt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _i(Lt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _i(Lt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gi(Lt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Cs=function(t){function e(e){t.call(this,e,ws)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Ss(t)},e.prototype.queryRadius=function(){return ra(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,r,n,o,a,s,l){var u=na(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,r),h=this.paint.get("fill-extrusion-base").evaluate(e,r),p=function(t,e,r,n){for(var o=[],a=0,s=t;a<s.length;a+=1){var l=s[a],u=[l.x,l.y,0,1];ha(u,u,e),o.push(new i(u[0]/u[3],u[1]/u[3]))}return o}(u,l),d=function(t,e,r,n){for(var o=[],a=[],s=n[8]*e,l=n[9]*e,u=n[10]*e,c=n[11]*e,h=n[8]*r,p=n[9]*r,d=n[10]*r,f=n[11]*r,m=0,g=t;m<g.length;m+=1){for(var _=[],v=[],y=0,x=g[m];y<x.length;y+=1){var b=x[y],E=b.x,T=b.y,S=n[0]*E+n[4]*T+n[12],A=n[1]*E+n[5]*T+n[13],w=n[2]*E+n[6]*T+n[14],C=n[3]*E+n[7]*T+n[15],R=w+u,L=C+c,I=S+h,M=A+p,O=w+d,P=C+f,D=new i((S+s)/L,(A+l)/L);D.z=R/L,_.push(D);var B=new i(I/P,M/P);B.z=O/P,v.push(B)}o.push(_),a.push(v)}return[o,a]}(n,h,c,l);return function(t,e,r){var n=1/0;Xo(r,e)&&(n=Ls(r,e[0]));for(var i=0;i<e.length;i++)for(var o=e[i],a=t[i],s=0;s<o.length-1;s++){var l=o[s],u=[l,o[s+1],a[s+1],a[s],l];Ho(r,u)&&(n=Math.min(n,Ls(r,u)))}return n!==1/0&&n}(d[0],d[1],p)},e}(Ei);function Rs(t,e){return t.x*e.x+t.y*e.y}function Ls(t,e){if(1===t.length){for(var r,n=0,i=e[n++];!r||i.equals(r);)if(!(r=e[n++]))return 1/0;for(;n<e.length;n++){var o=e[n],a=t[0],s=r.sub(i),l=o.sub(i),u=a.sub(i),c=Rs(s,s),h=Rs(s,l),p=Rs(l,l),d=Rs(u,s),f=Rs(u,l),m=c*p-h*h,g=(p*d-h*f)/m,_=(c*f-h*d)/m,v=i.z*(1-g-_)+r.z*g+o.z*_;if(isFinite(v))return v}return 1/0}for(var y=1/0,x=0,b=e;x<b.length;x+=1)y=Math.min(y,b[x].z);return y}var Is=wi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ms=wi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Os=xs.VectorTileFeature.types,Ps=Math.cos(Math.PI/180*37.5),Ds=Math.pow(2,14)/.5,Bs=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(t){e.gradients[t.id]={}})),this.layoutVertexArray=new Mi,this.layoutVertexArray2=new Oi,this.indexArray=new Gi,this.programConfigurations=new Bo(t.layers,t.zoom),this.segments=new so,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};Bs.prototype.populate=function(t,e,r){this.hasPattern=os("line",this.layers,e);for(var n=this.layers[0].layout.get("line-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],l=s.feature,u=s.id,c=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,d=Go(l,p);if(this.layers[0]._featureFilter.filter(new si(this.zoom),d,r)){var f=n?n.evaluate(d,{},r):void 0,m={id:u,properties:l.properties,type:l.type,sourceLayerIndex:h,index:c,geometry:p?d.geometry:zo(l),patterns:{},sortKey:f};i.push(m)}}n&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var g=0,_=i;g<_.length;g+=1){var v=_[g],y=v.geometry,x=v.index,b=v.sourceLayerIndex;if(this.hasPattern){var E=as("line",this.layers,v,this.zoom,e);this.patternFeatures.push(E)}else this.addFeature(v,y,x,r,{});e.featureIndex.insert(t[x].feature,y,x,b,this.index)}},Bs.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Bs.prototype.addFeatures=function(t,e,r){for(var n=0,i=this.patternFeatures;n<i.length;n+=1){var o=i[n];this.addFeature(o,o.geometry,o.index,e,r)}},Bs.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Bs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Bs.prototype.upload=function(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ms)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Is),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Bs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Bs.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Bs.prototype.addFeature=function(t,e,r,n,i){var o=this.layers[0].layout,a=o.get("line-join").evaluate(t,{}),s=o.get("line-cap"),l=o.get("line-miter-limit"),u=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var c=0,h=e;c<h.length;c+=1)this.addLine(h[c],t,a,s,l,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,n)},Bs.prototype.addLine=function(t,e,r,n,i,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var a=0;a<t.length-1;a++)this.totalDistance+=t[a].dist(t[a+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Os[e.type],l=t.length;l>=2&&t[l-1].equals(t[l-2]);)l--;for(var u=0;u<l-1&&t[u].equals(t[u+1]);)u++;if(!(l<(s?3:2))){"bevel"===r&&(i=1.05);var c,h=this.overscaling<=16?122880/(512*this.overscaling):0,p=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray),d=void 0,f=void 0,m=void 0,g=void 0;this.e1=this.e2=-1,s&&(g=t[u].sub(c=t[l-2])._unit()._perp());for(var _=u;_<l;_++)if(!(f=_===l-1?s?t[u+1]:void 0:t[_+1])||!t[_].equals(f)){g&&(m=g),c&&(d=c),c=t[_],g=f?f.sub(c)._unit()._perp():m;var v=(m=m||g).add(g);0===v.x&&0===v.y||v._unit();var y=m.x*g.x+m.y*g.y,x=v.x*g.x+v.y*g.y,b=0!==x?1/x:1/0,E=2*Math.sqrt(2-2*x),T=x<Ps&&d&&f,S=m.x*g.y-m.y*g.x>0;if(T&&_>u){var A=c.dist(d);if(A>2*h){var w=c.sub(c.sub(d)._mult(h/A)._round());this.updateDistance(d,w),this.addCurrentVertex(w,m,0,0,p),d=w}}var C=d&&f,R=C?r:s?"butt":n;if(C&&"round"===R&&(b<o?R="miter":b<=2&&(R="fakeround")),"miter"===R&&b>i&&(R="bevel"),"bevel"===R&&(b>2&&(R="flipbevel"),b<i&&(R="miter")),d&&this.updateDistance(d,c),"miter"===R)v._mult(b),this.addCurrentVertex(c,v,0,0,p);else if("flipbevel"===R){if(b>100)v=g.mult(-1);else{var L=b*m.add(g).mag()/m.sub(g).mag();v._perp()._mult(L*(S?-1:1))}this.addCurrentVertex(c,v,0,0,p),this.addCurrentVertex(c,v.mult(-1),0,0,p)}else if("bevel"===R||"fakeround"===R){var I=-Math.sqrt(b*b-1),M=S?I:0,O=S?0:I;if(d&&this.addCurrentVertex(c,m,M,O,p),"fakeround"===R)for(var P=Math.round(180*E/Math.PI/20),D=1;D<P;D++){var B=D/P;if(.5!==B){var N=B-.5;B+=B*N*(B-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*N*N+(.848013+y*(.215638*y-1.06021)))}var F=g.sub(m)._mult(B)._add(m)._unit()._mult(S?-1:1);this.addHalfVertex(c,F.x,F.y,!1,S,0,p)}f&&this.addCurrentVertex(c,g,-M,-O,p)}else if("butt"===R)this.addCurrentVertex(c,v,0,0,p);else if("square"===R){var k=d?1:-1;this.addCurrentVertex(c,v,k,k,p)}else"round"===R&&(d&&(this.addCurrentVertex(c,m,0,0,p),this.addCurrentVertex(c,m,1,1,p,!0)),f&&(this.addCurrentVertex(c,g,-1,-1,p,!0),this.addCurrentVertex(c,g,0,0,p)));if(T&&_<l-1){var U=c.dist(f);if(U>2*h){var z=c.add(f.sub(c)._mult(h/U)._round());this.updateDistance(c,z),this.addCurrentVertex(z,g,0,0,p),c=z}}}}},Bs.prototype.addCurrentVertex=function(t,e,r,n,i,o){void 0===o&&(o=!1);var a=e.y*n-e.x,s=-e.y-e.x*n;this.addHalfVertex(t,e.x+e.y*r,e.y-e.x*r,o,!1,r,i),this.addHalfVertex(t,a,s,o,!0,-n,i),this.distance>Ds/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,r,n,i,o))},Bs.prototype.addHalfVertex=function(t,e,r,n,i,o,a){var s=.5*(this.lineClips?this.scaledDistance*(Ds-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(n?1:0),(t.y<<1)+(i?1:0),Math.round(63*e)+128,Math.round(63*r)+128,1+(0===o?0:o<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),i?this.e2=l:this.e1=l},Bs.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Bs.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},kn("LineBucket",Bs,{omit:["layers","patternFeatures"]});var Ns=new bi({"line-cap":new gi(Lt.layout_line["line-cap"]),"line-join":new _i(Lt.layout_line["line-join"]),"line-miter-limit":new gi(Lt.layout_line["line-miter-limit"]),"line-round-limit":new gi(Lt.layout_line["line-round-limit"]),"line-sort-key":new _i(Lt.layout_line["line-sort-key"])}),Fs={paint:new bi({"line-opacity":new _i(Lt.paint_line["line-opacity"]),"line-color":new _i(Lt.paint_line["line-color"]),"line-translate":new gi(Lt.paint_line["line-translate"]),"line-translate-anchor":new gi(Lt.paint_line["line-translate-anchor"]),"line-width":new _i(Lt.paint_line["line-width"]),"line-gap-width":new _i(Lt.paint_line["line-gap-width"]),"line-offset":new _i(Lt.paint_line["line-offset"]),"line-blur":new _i(Lt.paint_line["line-blur"]),"line-dasharray":new yi(Lt.paint_line["line-dasharray"]),"line-pattern":new vi(Lt.paint_line["line-pattern"]),"line-gradient":new xi(Lt.paint_line["line-gradient"])}),layout:Ns},ks=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new si(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,n,i){return r=p({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,n,i)},e}(_i))(Fs.paint.properties["line-width"].specification);ks.useIntegerZoom=!0;var Us=function(t){function e(e){t.call(this,e,Fs),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ve,this.gradientVersion=(this.gradientVersion+1)%s)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(e,r){t.prototype.recalculate.call(this,e,r),this.paint._values["line-floorwidth"]=ks.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Bs(t)},e.prototype.queryRadius=function(t){var e=t,r=zs(ea("line-width",this,e),ea("line-gap-width",this,e)),n=ea("line-offset",this,e);return r/2+Math.abs(n)+ra(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,o,a,s){var l=na(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),u=s/2*zs(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),c=this.paint.get("line-offset").evaluate(e,r);return c&&(n=function(t,e){for(var r=[],n=new i(0,0),o=0;o<t.length;o++){for(var a=t[o],s=[],l=0;l<a.length;l++){var u=a[l],c=a[l+1],h=0===l?n:u.sub(a[l-1])._unit()._perp(),p=l===a.length-1?n:c.sub(u)._unit()._perp(),d=h._add(p)._unit();d._mult(1/(d.x*p.x+d.y*p.y)),s.push(d._mult(e)._add(u))}r.push(s)}return r}(n,c*s)),function(t,e,r){for(var n=0;n<e.length;n++){var i=e[n];if(t.length>=3)for(var o=0;o<i.length;o++)if(Jo(t,i[o]))return!0;if(Zo(t,i,r))return!0}return!1}(l,n,u)},e.prototype.isTileClipped=function(){return!0},e}(Ei);function zs(t,e){return e>0?e+2*t:t}var Gs=wi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),js=wi([{name:"a_projected_pos",components:3,type:"Float32"}],4),Vs=(wi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),wi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Hs=(wi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ws=wi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Xs(t,e,r){return t.sections.forEach((function(t){t.text=function(t,e,r){var n=e.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),ai.applyArabicShaping&&(t=ai.applyArabicShaping(t)),t}(t.text,e,r)})),t}wi([{name:"triangle",components:3,type:"Uint16"}]),wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),wi([{type:"Float32",name:"offsetX"}]),wi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Zs={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},qs=function(t,e,r,n,i){var o,a,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?i-1:0,p=r?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),o-=u}return(d?-1:1)*a*Math.pow(2,o-n)},Ys=function(t,e,r,n,i,o){var a,s,l,u=8*o-i-1,c=(1<<u)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,f=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*l-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[r+d]=255&s,d+=f,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;t[r+d]=255&a,d+=f,a/=256,u-=8);t[r+d-f]|=128*m},Ks=$s;function $s(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}$s.Varint=0,$s.Fixed64=1,$s.Bytes=2,$s.Fixed32=5;var Qs="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Js(t){return t.type===$s.Bytes?t.readVarint()+t.pos:t.pos+1}function tl(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function el(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function rl(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function nl(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function il(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function ol(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function al(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function sl(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function ll(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function ul(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function cl(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function hl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function pl(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function dl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function fl(t,e,r){1===t&&r.readMessage(ml,e)}function ml(t,e,r){if(3===t){var n=r.readMessage(gl,{}),i=n.width,o=n.height,a=n.left,s=n.top,l=n.advance;e.push({id:n.id,bitmap:new va({width:i+6,height:o+6},n.bitmap),metrics:{width:i,height:o,left:a,top:s,advance:l}})}}function gl(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint())}function _l(t){for(var e=0,r=0,n=0,i=t;n<i.length;n+=1){var o=i[n];e+=o.w*o.h,r=Math.max(r,o.w)}t.sort((function(t,e){return e.h-t.h}));for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],s=0,l=0,u=0,c=t;u<c.length;u+=1)for(var h=c[u],p=a.length-1;p>=0;p--){var d=a[p];if(!(h.w>d.w||h.h>d.h)){if(h.x=d.x,h.y=d.y,l=Math.max(l,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===d.w&&h.h===d.h){var f=a.pop();p<a.length&&(a[p]=f)}else h.h===d.h?(d.x+=h.w,d.w-=h.w):h.w===d.w?(d.y+=h.h,d.h-=h.h):(a.push({x:d.x+h.w,y:d.y,w:d.w-h.w,h:h.h}),d.y+=h.h,d.h-=h.h);break}}return{w:s,h:l,fill:e/(s*l)||0}}$s.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=hl(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=dl(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=hl(this.buf,this.pos)+4294967296*hl(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=hl(this.buf,this.pos)+4294967296*dl(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=qs(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=qs(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,o=r.buf;if(n=(112&(i=o[r.pos++]))>>4,i<128)return tl(t,n,e);if(n|=(127&(i=o[r.pos++]))<<3,i<128)return tl(t,n,e);if(n|=(127&(i=o[r.pos++]))<<10,i<128)return tl(t,n,e);if(n|=(127&(i=o[r.pos++]))<<17,i<128)return tl(t,n,e);if(n|=(127&(i=o[r.pos++]))<<24,i<128)return tl(t,n,e);if(n|=(1&(i=o[r.pos++]))<<31,i<128)return tl(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Qs?function(t,e,r){return Qs.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){for(var n="",i=e;i<r;){var o,a,s,l=t[i],u=null,c=l>239?4:l>223?3:l>191?2:1;if(i+c>r)break;1===c?l<128&&(u=l):2===c?128==(192&(o=t[i+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(a=t[i+2],128==(192&(o=t[i+1]))&&128==(192&a)&&((u=(15&l)<<12|(63&o)<<6|63&a)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(a=t[i+2],s=t[i+3],128==(192&(o=t[i+1]))&&128==(192&a)&&128==(192&s)&&((u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),i+=c}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==$s.Bytes)return t.push(this.readVarint(e));var r=Js(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==$s.Bytes)return t.push(this.readSVarint());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==$s.Bytes)return t.push(this.readBoolean());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==$s.Bytes)return t.push(this.readFloat());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==$s.Bytes)return t.push(this.readDouble());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==$s.Bytes)return t.push(this.readFixed32());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==$s.Bytes)return t.push(this.readSFixed32());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==$s.Bytes)return t.push(this.readFixed64());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==$s.Bytes)return t.push(this.readSFixed64());var e=Js(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===$s.Varint)for(;this.buf[this.pos++]>127;);else if(e===$s.Bytes)this.pos=this.readVarint()+this.pos;else if(e===$s.Fixed32)this.pos+=4;else{if(e!==$s.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),pl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),pl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),pl(this.buf,-1&t,this.pos),pl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),pl(this.buf,-1&t,this.pos),pl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;if(t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,r.buf[r.pos]=127&(t>>>=7)}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){n>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&el(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Ys(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Ys(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&el(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,$s.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,rl,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,nl,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,al,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,il,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,ol,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,sl,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,ll,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,ul,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,cl,e)},writeBytesField:function(t,e){this.writeTag(t,$s.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,$s.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,$s.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,$s.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,$s.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,$s.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,$s.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,$s.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,$s.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,$s.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var vl=function(t,e){var r=e.pixelRatio,n=e.version,i=e.stretchX,o=e.stretchY,a=e.content;this.paddedRect=t,this.pixelRatio=r,this.stretchX=i,this.stretchY=o,this.content=a,this.version=n},yl={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};yl.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},yl.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},yl.tlbr.get=function(){return this.tl.concat(this.br)},yl.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(vl.prototype,yl);var xl=function(t,e){var r={},n={};this.haveRenderCallbacks=[];var i=[];this.addImages(t,r,i),this.addImages(e,n,i);var o=_l(i),a=new ya({width:o.w||1,height:o.h||1});for(var s in t){var l=t[s],u=r[s].paddedRect;ya.copy(l.data,a,{x:0,y:0},{x:u.x+1,y:u.y+1},l.data)}for(var c in e){var h=e[c],p=n[c].paddedRect,d=p.x+1,f=p.y+1,m=h.data.width,g=h.data.height;ya.copy(h.data,a,{x:0,y:0},{x:d,y:f},h.data),ya.copy(h.data,a,{x:0,y:g-1},{x:d,y:f-1},{width:m,height:1}),ya.copy(h.data,a,{x:0,y:0},{x:d,y:f+g},{width:m,height:1}),ya.copy(h.data,a,{x:m-1,y:0},{x:d-1,y:f},{width:1,height:g}),ya.copy(h.data,a,{x:0,y:0},{x:d+m,y:f},{width:1,height:g})}this.image=a,this.iconPositions=r,this.patternPositions=n};xl.prototype.addImages=function(t,e,r){for(var n in t){var i=t[n],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};r.push(o),e[n]=new vl(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(n)}},xl.prototype.patchUpdatedImages=function(t,e){for(var r in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[r],t.getImage(r),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r),e)},xl.prototype.patchUpdatedImage=function(t,e,r){if(t&&e&&t.version!==e.version){t.version=e.version;var n=t.tl;r.update(e.data,void 0,{x:n[0],y:n[1]})}},kn("ImagePosition",vl),kn("ImageAtlas",xl);var bl={horizontal:1,vertical:2,horizontalOnly:3},El=function(){this.scale=1,this.fontStack="",this.imageName=null};El.forText=function(t,e){var r=new El;return r.scale=t||1,r.fontStack=e,r},El.forImage=function(t){var e=new El;return e.imageName=t,e};var Tl=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Sl(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m){var g,_=Tl.fromFeature(t,i);h===bl.vertical&&_.verticalizePunctuation();var v=ai.processBidirectionalText,y=ai.processStyledBidirectionalText;if(v&&1===_.sections.length){g=[];for(var x=0,b=v(_.toString(),Ml(_,u,o,e,n,d,f));x<b.length;x+=1){var E=b[x],T=new Tl;T.text=E,T.sections=_.sections;for(var S=0;S<E.length;S++)T.sectionIndex.push(0);g.push(T)}}else if(y){g=[];for(var A=0,w=y(_.text,_.sectionIndex,Ml(_,u,o,e,n,d,f));A<w.length;A+=1){var C=w[A],R=new Tl;R.text=C[0],R.sectionIndex=C[1],R.sections=_.sections,g.push(R)}}else g=function(t,e){for(var r=[],n=t.text,i=0,o=0,a=e;o<a.length;o+=1){var s=a[o];r.push(t.substring(i,s)),i=s}return i<n.length&&r.push(t.substring(i,n.length)),r}(_,Ml(_,u,o,e,n,d,f));var L=[],I={positionedLines:L,text:_.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,r,n,i,o,a,s,l,u,c,h){for(var p=0,d=-17,f=0,m=0,g="right"===s?1:"left"===s?0:.5,_=0,v=0,y=i;v<y.length;v+=1){var x=y[v];x.trim();var b=x.getMaxScale(),E=24*(b-1),T={positionedGlyphs:[],lineOffset:0};t.positionedLines[_]=T;var S=T.positionedGlyphs,A=0;if(x.length()){for(var w=0;w<x.length();w++){var C=x.getSection(w),R=x.getSectionIndex(w),L=x.getCharCode(w),I=0,M=null,O=null,P=null,D=24,B=!(l===bl.horizontal||!c&&!Zn(L)||c&&(Al[L]||(H=L,Wn.Arabic(H)||Wn["Arabic Supplement"](H)||Wn["Arabic Extended-A"](H)||Wn["Arabic Presentation Forms-A"](H)||Wn["Arabic Presentation Forms-B"](H))));if(C.imageName){var N=n[C.imageName];if(!N)continue;P=C.imageName,t.iconsInText=t.iconsInText||!0,O=N.paddedRect;var F=N.displaySize;C.scale=24*C.scale/h,I=E+(24-F[1]*C.scale),D=(M={width:F[0],height:F[1],left:1,top:-3,advance:B?F[1]:F[0]}).advance;var k=B?F[0]*C.scale-24*b:F[1]*C.scale-24*b;k>0&&k>A&&(A=k)}else{var U=r[C.fontStack],z=U&&U[L];if(z&&z.rect)O=z.rect,M=z.metrics;else{var G=e[C.fontStack],j=G&&G[L];if(!j)continue;M=j.metrics}I=24*(b-C.scale)}B?(t.verticalizable=!0,S.push({glyph:L,imageName:P,x:p,y:d+I,vertical:B,scale:C.scale,fontStack:C.fontStack,sectionIndex:R,metrics:M,rect:O}),p+=D*C.scale+u):(S.push({glyph:L,imageName:P,x:p,y:d+I,vertical:B,scale:C.scale,fontStack:C.fontStack,sectionIndex:R,metrics:M,rect:O}),p+=M.advance*C.scale+u)}0!==S.length&&(f=Math.max(p-u,f),Pl(S,0,S.length-1,g,A)),p=0;var V=o*b+A;T.lineOffset=Math.max(A,E),d+=V,m=Math.max(V,m),++_}else d+=o,++_}var H,W=d- -17,X=Ol(a),Z=X.horizontalAlign,q=X.verticalAlign;(function(t,e,r,n,i,o,a,s,l){var u,c=(e-r)*i;u=o!==a?-s*n- -17:(-n*l+.5)*a;for(var h=0,p=t;h<p.length;h+=1)for(var d=0,f=p[h].positionedGlyphs;d<f.length;d+=1){var m=f[d];m.x+=c,m.y+=u}})(t.positionedLines,g,Z,q,f,m,o,W,i.length),t.top+=-q*W,t.bottom=t.top+W,t.left+=-Z*f,t.right=t.left+f}(I,e,r,n,g,a,s,l,h,u,p,m),!function(t){for(var e=0,r=t;e<r.length;e+=1)if(0!==r[e].positionedGlyphs.length)return!1;return!0}(L)&&I}Tl.fromFeature=function(t,e){for(var r=new Tl,n=0;n<t.sections.length;n++){var i=t.sections[n];i.image?r.addImageSection(i):r.addTextSection(i,e)}return r},Tl.prototype.length=function(){return this.text.length},Tl.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Tl.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Tl.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Tl.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",r=0;r<t.length;r++){var n=t.charCodeAt(r+1)||null,i=t.charCodeAt(r-1)||null;e+=n&&qn(n)&&!Zs[t[r+1]]||i&&qn(i)&&!Zs[t[r-1]]||!Zs[t[r]]?t[r]:Zs[t[r]]}return e}(this.text)},Tl.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Al[this.text.charCodeAt(e)];e++)t++;for(var r=this.text.length,n=this.text.length-1;n>=0&&n>=t&&Al[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)},Tl.prototype.substring=function(t,e){var r=new Tl;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r},Tl.prototype.toString=function(){return this.text},Tl.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,r){return Math.max(e,t.sections[r].scale)}),0)},Tl.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(El.forText(t.scale,t.fontStack||e));for(var r=this.sections.length-1,n=0;n<t.text.length;++n)this.sectionIndex.push(r)},Tl.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(El.forImage(e)),this.sectionIndex.push(this.sections.length-1)):T("Reached maximum number of images 6401")}else T("Can't add FormattedSection with an empty image.")},Tl.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Al={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wl={};function Cl(t,e,r,n,i,o){if(e.imageName){var a=n[e.imageName];return a?a.displaySize[0]*e.scale*24/o+i:0}var s=r[e.fontStack],l=s&&s[t];return l?l.metrics.advance*e.scale+i:0}function Rl(t,e,r,n){var i=Math.pow(t-e,2);return n?t<e?i/2:2*i:i+Math.abs(r)*r}function Ll(t,e,r){var n=0;return 10===t&&(n-=1e4),r&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function Il(t,e,r,n,i,o){for(var a=null,s=Rl(e,r,i,o),l=0,u=n;l<u.length;l+=1){var c=u[l],h=Rl(e-c.x,r,i,o)+c.badness;h<=s&&(a=c,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function Ml(t,e,r,n,i,o,a){if("point"!==o)return[];if(!t)return[];for(var s,l=[],u=function(t,e,r,n,i,o){for(var a=0,s=0;s<t.length();s++){var l=t.getSection(s);a+=Cl(t.getCharCode(s),l,n,i,e,o)}return a/Math.max(1,Math.ceil(a/r))}(t,e,r,n,i,a),c=t.text.indexOf("​")>=0,h=0,p=0;p<t.length();p++){var d=t.getSection(p),f=t.getCharCode(p);if(Al[f]||(h+=Cl(f,d,n,i,e,a)),p<t.length()-1){var m=!((s=f)<11904||!(Wn["Bopomofo Extended"](s)||Wn.Bopomofo(s)||Wn["CJK Compatibility Forms"](s)||Wn["CJK Compatibility Ideographs"](s)||Wn["CJK Compatibility"](s)||Wn["CJK Radicals Supplement"](s)||Wn["CJK Strokes"](s)||Wn["CJK Symbols and Punctuation"](s)||Wn["CJK Unified Ideographs Extension A"](s)||Wn["CJK Unified Ideographs"](s)||Wn["Enclosed CJK Letters and Months"](s)||Wn["Halfwidth and Fullwidth Forms"](s)||Wn.Hiragana(s)||Wn["Ideographic Description Characters"](s)||Wn["Kangxi Radicals"](s)||Wn["Katakana Phonetic Extensions"](s)||Wn.Katakana(s)||Wn["Vertical Forms"](s)||Wn["Yi Radicals"](s)||Wn["Yi Syllables"](s)));(wl[f]||m||d.imageName)&&l.push(Il(p+1,h,u,l,Ll(f,t.getCharCode(p+1),m&&c),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Il(t.length(),h,u,l,0,!0))}function Ol(t){var e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Pl(t,e,r,n,i){if(n||i)for(var o=t[r],a=(t[r].x+o.metrics.advance*o.scale)*n,s=e;s<=r;s++)t[s].x-=a,t[s].y+=i}function Dl(t,e,r,n,i,o){var a,s=t.image;if(s.content){var l=s.content,u=s.pixelRatio||1;a=[l[0]/u,l[1]/u,s.displaySize[0]-l[2]/u,s.displaySize[1]-l[3]/u]}var c,h,p,d,f=e.left*o,m=e.right*o;"width"===r||"both"===r?(d=i[0]+f-n[3],h=i[0]+m+n[1]):h=(d=i[0]+(f+m-s.displaySize[0])/2)+s.displaySize[0];var g=e.top*o,_=e.bottom*o;return"height"===r||"both"===r?(c=i[1]+g-n[0],p=i[1]+_+n[2]):p=(c=i[1]+(g+_-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:c,right:h,bottom:p,left:d,collisionPadding:a}}wl[10]=!0,wl[32]=!0,wl[38]=!0,wl[40]=!0,wl[41]=!0,wl[43]=!0,wl[45]=!0,wl[47]=!0,wl[173]=!0,wl[183]=!0,wl[8203]=!0,wl[8208]=!0,wl[8211]=!0,wl[8231]=!0;var Bl=function(t){function e(e,r,n,i){t.call(this,e,r),this.angle=n,void 0!==i&&(this.segment=i)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(i);function Nl(t,e){var r=e.expression;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new si(t+1))};if("source"===r.kind)return{kind:"source"};for(var n=r.zoomStops,i=r.interpolationType,o=0;o<n.length&&n[o]<=t;)o++;for(var a=o=Math.max(0,o-1);a<n.length&&n[a]<t+1;)a++;a=Math.min(n.length-1,a);var s=n[o],l=n[a];return"composite"===r.kind?{kind:"composite",minZoom:s,maxZoom:l,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:l,minSize:r.evaluate(new si(s)),maxSize:r.evaluate(new si(l)),interpolationType:i}}function Fl(t,e,r){var n=e.uSize,i=r.lowerSize;return"source"===t.kind?i/128:"composite"===t.kind?He(i/128,r.upperSize/128,e.uSizeT):n}function kl(t,e){var r=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){var i=t.interpolationType,o=i?c(or.interpolationFactor(i,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?n=He(t.minSize,t.maxSize,o):r=o}return{uSizeT:r,uSize:n}}kn("Anchor",Bl);var Ul=Object.freeze({__proto__:null,getSizeData:Nl,evaluateSizeForFeature:Fl,evaluateSizeForZoom:kl,SIZE_PACK_FACTOR:128});function zl(t,e,r,n,i){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-r/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var l=[],u=0;s<r/2;){var c=t[a],h=t[a+1];if(!h)return!1;var p=t[a-1].angleTo(c)-c.angleTo(h);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:p}),u+=p;s-l[0].distance>n;)u-=l.shift().angleDelta;if(u>i)return!1;a++,s+=c.dist(h)}return!0}function Gl(t){for(var e=0,r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function jl(t,e,r){return t?.6*e*r:0}function Vl(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Hl(t,e,r,n,i,o){for(var a=jl(r,i,o),s=Vl(r,n)*o,l=0,u=Gl(t)/2,c=0;c<t.length-1;c++){var h=t[c],p=t[c+1],d=h.dist(p);if(l+d>u){var f=(u-l)/d,m=He(h.x,p.x,f),g=He(h.y,p.y,f),_=new Bl(m,g,p.angleTo(h),c);return _._round(),!a||zl(t,_,s,a,e)?_:void 0}l+=d}}function Wl(t,e,r,n,i,o,a,s,l){var u=jl(n,o,a),c=Vl(n,i),h=c*a,p=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),function t(e,r,n,i,o,a,s,l,u){for(var c=a/2,h=Gl(e),p=0,d=r-n,f=[],m=0;m<e.length-1;m++){for(var g=e[m],_=e[m+1],v=g.dist(_),y=_.angleTo(g);d+n<p+v;){var x=((d+=n)-p)/v,b=He(g.x,_.x,x),E=He(g.y,_.y,x);if(b>=0&&b<u&&E>=0&&E<u&&d-c>=0&&d+c<=h){var T=new Bl(b,E,y,m);T._round(),i&&!zl(e,T,a,i,o)||f.push(T)}}p+=v}return l||f.length||s||(f=t(e,p/2,n,i,o,a,s,!0,u)),f}(t,p?e/2*s%e:(c/2+2*o)*a*s%e,e,u,r,h,p,!1,l)}function Xl(t,e,r,n,o){for(var a=[],s=0;s<t.length;s++)for(var l=t[s],u=void 0,c=0;c<l.length-1;c++){var h=l[c],p=l[c+1];h.x<e&&p.x<e||(h.x<e?h=new i(e,h.y+(e-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x<e&&(p=new i(e,h.y+(e-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y<r&&p.y<r||(h.y<r?h=new i(h.x+(r-h.y)/(p.y-h.y)*(p.x-h.x),r)._round():p.y<r&&(p=new i(h.x+(r-h.y)/(p.y-h.y)*(p.x-h.x),r)._round()),h.x>=n&&p.x>=n||(h.x>=n?h=new i(n,h.y+(n-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x>=n&&(p=new i(n,h.y+(n-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y>=o&&p.y>=o||(h.y>=o?h=new i(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round():p.y>=o&&(p=new i(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round()),u&&h.equals(u[u.length-1])||a.push(u=[h]),u.push(p)))))}return a}function Zl(t,e,r,n){var o=[],a=t.image,s=a.pixelRatio,l=a.paddedRect.w-2,u=a.paddedRect.h-2,c=t.right-t.left,h=t.bottom-t.top,p=a.stretchX||[[0,l]],d=a.stretchY||[[0,u]],f=function(t,e){return t+e[1]-e[0]},m=p.reduce(f,0),g=d.reduce(f,0),_=l-m,v=u-g,y=0,x=m,b=0,E=g,T=0,S=_,A=0,w=v;if(a.content&&n){var C=a.content;y=ql(p,0,C[0]),b=ql(d,0,C[1]),x=ql(p,C[0],C[2]),E=ql(d,C[1],C[3]),T=C[0]-y,A=C[1]-b,S=C[2]-C[0]-x,w=C[3]-C[1]-E}var R=function(n,o,l,u){var p=Kl(n.stretch-y,x,c,t.left),d=$l(n.fixed-T,S,n.stretch,m),f=Kl(o.stretch-b,E,h,t.top),_=$l(o.fixed-A,w,o.stretch,g),v=Kl(l.stretch-y,x,c,t.left),C=$l(l.fixed-T,S,l.stretch,m),R=Kl(u.stretch-b,E,h,t.top),L=$l(u.fixed-A,w,u.stretch,g),I=new i(p,f),M=new i(v,f),O=new i(v,R),P=new i(p,R),D=new i(d/s,_/s),B=new i(C/s,L/s),N=e*Math.PI/180;if(N){var F=Math.sin(N),k=Math.cos(N),U=[k,-F,F,k];I._matMult(U),M._matMult(U),P._matMult(U),O._matMult(U)}var z=n.stretch+n.fixed,G=o.stretch+o.fixed;return{tl:I,tr:M,bl:P,br:O,tex:{x:a.paddedRect.x+1+z,y:a.paddedRect.y+1+G,w:l.stretch+l.fixed-z,h:u.stretch+u.fixed-G},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:B,minFontScaleX:S/s/c,minFontScaleY:w/s/h,isSDF:r}};if(n&&(a.stretchX||a.stretchY))for(var L=Yl(p,_,m),I=Yl(d,v,g),M=0;M<L.length-1;M++)for(var O=L[M],P=L[M+1],D=0;D<I.length-1;D++)o.push(R(O,I[D],P,I[D+1]));else o.push(R({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:u+1}));return o}function ql(t,e,r){for(var n=0,i=0,o=t;i<o.length;i+=1){var a=o[i];n+=Math.max(e,Math.min(r,a[1]))-Math.max(e,Math.min(r,a[0]))}return n}function Yl(t,e,r){for(var n=[{fixed:-1,stretch:0}],i=0,o=t;i<o.length;i+=1){var a=o[i],s=a[0],l=a[1],u=n[n.length-1];n.push({fixed:s-u.stretch,stretch:u.stretch}),n.push({fixed:s-u.stretch,stretch:u.stretch+(l-s)})}return n.push({fixed:e+1,stretch:r}),n}function Kl(t,e,r,n){return t/e*r+n}function $l(t,e,r,n){return t-e*r/n}var Ql=function(t,e,r,n,o,a,s,l,u,c){if(this.boxStartIndex=t.length,u){var h=a.top,p=a.bottom,d=a.collisionPadding;d&&(h-=d[1],p+=d[3]);var f=p-h;f>0&&(f=Math.max(10,f),this.circleDiameter=f)}else{var m=a.top*s-l,g=a.bottom*s+l,_=a.left*s-l,v=a.right*s+l,y=a.collisionPadding;if(y&&(_-=y[0]*s,m-=y[1]*s,v+=y[2]*s,g+=y[3]*s),c){var x=new i(_,m),b=new i(v,m),E=new i(_,g),T=new i(v,g),S=c*Math.PI/180;x._rotate(S),b._rotate(S),E._rotate(S),T._rotate(S),_=Math.min(x.x,b.x,E.x,T.x),v=Math.max(x.x,b.x,E.x,T.x),m=Math.min(x.y,b.y,E.y,T.y),g=Math.max(x.y,b.y,E.y,T.y)}t.emplaceBack(e.x,e.y,_,m,v,g,r,n,o)}this.boxEndIndex=t.length},Jl=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=tu),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function tu(t,e){return t<e?-1:t>e?1:0}function eu(t,e,r){void 0===e&&(e=1),void 0===r&&(r=!1);for(var n=1/0,o=1/0,a=-1/0,s=-1/0,l=t[0],u=0;u<l.length;u++){var c=l[u];(!u||c.x<n)&&(n=c.x),(!u||c.y<o)&&(o=c.y),(!u||c.x>a)&&(a=c.x),(!u||c.y>s)&&(s=c.y)}var h=Math.min(a-n,s-o),p=h/2,d=new Jl([],ru);if(0===h)return new i(n,o);for(var f=n;f<a;f+=h)for(var m=o;m<s;m+=h)d.push(new nu(f+p,m+p,p,t));for(var g=function(t){for(var e=0,r=0,n=0,i=t[0],o=0,a=i.length,s=a-1;o<a;s=o++){var l=i[o],u=i[s],c=l.x*u.y-u.x*l.y;r+=(l.x+u.x)*c,n+=(l.y+u.y)*c,e+=3*c}return new nu(r/e,n/e,0,t)}(t),_=d.length;d.length;){var v=d.pop();(v.d>g.d||!g.d)&&(g=v,r&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,_)),v.max-g.d<=e||(d.push(new nu(v.p.x-(p=v.h/2),v.p.y-p,p,t)),d.push(new nu(v.p.x+p,v.p.y-p,p,t)),d.push(new nu(v.p.x-p,v.p.y+p,p,t)),d.push(new nu(v.p.x+p,v.p.y+p,p,t)),_+=4)}return r&&(console.log("num probes: "+_),console.log("best distance: "+g.d)),g.p}function ru(t,e){return e.max-t.max}function nu(t,e,r,n){this.p=new i(t,e),this.h=r,this.d=function(t,e){for(var r=!1,n=1/0,i=0;i<e.length;i++)for(var o=e[i],a=0,s=o.length,l=s-1;a<s;l=a++){var u=o[a],c=o[l];u.y>t.y!=c.y>t.y&&t.x<(c.x-u.x)*(t.y-u.y)/(c.y-u.y)+u.x&&(r=!r),n=Math.min(n,$o(t,u,c))}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}Jl.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Jl.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},Jl.prototype.peek=function(){return this.data[0]},Jl.prototype._up=function(t){for(var e=this.data,r=this.compare,n=e[t];t>0;){var i=t-1>>1,o=e[i];if(r(n,o)>=0)break;e[t]=o,t=i}e[t]=n},Jl.prototype._down=function(t){for(var e=this.data,r=this.compare,n=this.length>>1,i=e[t];t<n;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&r(e[s],a)<0&&(o=s,a=e[s]),r(a,i)>=0)break;e[t]=a,t=o}e[t]=i};var iu=Number.POSITIVE_INFINITY;function ou(t,e){return e[1]!==iu?function(t,e,r){var n=0,i=0;switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":i=r-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-r}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}return[n,i]}(t,e[0],e[1]):function(t,e){var r=0,n=0;e<0&&(e=0);var i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":n=i-7;break;case"bottom-right":case"bottom-left":n=7-i;break;case"bottom":n=7-e;break;case"top":n=e-7}switch(t){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=e;break;case"right":r=-e}return[r,n]}(t,e[0])}function au(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function su(t,e,r,n,o,a,s,l,u,c,h,p,d,f,m){var g=function(t,e,r,n,o,a,s,l){for(var u=n.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,c=[],h=0,p=e.positionedLines;h<p.length;h+=1)for(var d=p[h],f=0,m=d.positionedGlyphs;f<m.length;f+=1){var g=m[f];if(g.rect){var _=g.rect||{},v=4,y=!0,x=1,b=0,E=(o||l)&&g.vertical,T=g.metrics.advance*g.scale/2;if(l&&e.verticalizable&&(b=d.lineOffset/2-(g.imageName?-(24-g.metrics.width*g.scale)/2:24*(g.scale-1))),g.imageName){var S=s[g.imageName];y=S.sdf,v=1/(x=S.pixelRatio)}var A=o?[g.x+T,g.y]:[0,0],w=o?[0,0]:[g.x+T+r[0],g.y+r[1]-b],C=[0,0];E&&(C=w,w=[0,0]);var R=(g.metrics.left-v)*g.scale-T+w[0],L=(-g.metrics.top-v)*g.scale+w[1],I=R+_.w*g.scale/x,M=L+_.h*g.scale/x,O=new i(R,L),P=new i(I,L),D=new i(R,M),B=new i(I,M);if(E){var N=new i(-T,T- -17),F=-Math.PI/2,k=12-T,U=new i(22-k,-(g.imageName?k:0)),z=new(Function.prototype.bind.apply(i,[null].concat(C)));O._rotateAround(F,N)._add(U)._add(z),P._rotateAround(F,N)._add(U)._add(z),D._rotateAround(F,N)._add(U)._add(z),B._rotateAround(F,N)._add(U)._add(z)}if(u){var G=Math.sin(u),j=Math.cos(u),V=[j,-G,G,j];O._matMult(V),P._matMult(V),D._matMult(V),B._matMult(V)}var H=new i(0,0),W=new i(0,0);c.push({tl:O,tr:P,bl:D,br:B,tex:_,writingMode:e.writingMode,glyphOffset:A,sectionIndex:g.sectionIndex,isSDF:y,pixelOffsetTL:H,pixelOffsetBR:W,minFontScaleX:0,minFontScaleY:0})}}return c}(0,r,l,o,a,s,n,t.allowVerticalPlacement),_=t.textSizeData,v=null;"source"===_.kind?(v=[128*o.layout.get("text-size").evaluate(s,{})])[0]>32640&&T(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===_.kind&&((v=[128*f.compositeTextSizes[0].evaluate(s,{},m),128*f.compositeTextSizes[1].evaluate(s,{},m)])[0]>32640||v[1]>32640)&&T(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,g,v,l,a,s,c,e,u.lineStartIndex,u.lineLength,d,m);for(var y=0,x=h;y<x.length;y+=1)p[x[y]]=t.text.placedSymbolArray.length-1;return 4*g.length}function lu(t){for(var e in t)return t[e];return null}function uu(t,e,r,n){var i=t.compareText;if(e in i){for(var o=i[e],a=o.length-1;a>=0;a--)if(n.dist(o[a])<r)return!0}else i[e]=[];return i[e].push(n),!1}var cu=xs.VectorTileFeature.types,hu=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function pu(t,e,r,n,i,o,a,s,l,u,c,h,p){var d=s?Math.min(32640,Math.round(s[0])):0,f=s?Math.min(32640,Math.round(s[1])):0;t.emplaceBack(e,r,Math.round(32*n),Math.round(32*i),o,a,(d<<1)+(l?1:0),f,16*u,16*c,256*h,256*p)}function du(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}function fu(t){for(var e=0,r=t.sections;e<r.length;e+=1)if($n(r[e].text))return!0;return!1}var mu=function(t){this.layoutVertexArray=new Di,this.indexArray=new Gi,this.programConfigurations=t,this.segments=new so,this.dynamicLayoutVertexArray=new Bi,this.opacityVertexArray=new Ni,this.placedSymbolArray=new Ji};mu.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},mu.prototype.upload=function(t,e,r,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gs.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,js.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,hu,!0),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(t))},mu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},kn("SymbolBuffers",mu);var gu=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new so,this.collisionVertexArray=new zi};gu.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Vs.members,!0)},gu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},kn("CollisionBuffers",gu);var _u=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=sa([]),this.placementViewportMatrix=sa([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nl(this.zoom,e["text-size"]),this.iconSizeData=Nl(this.zoom,e["icon-size"]);var r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map((function(t){return bl[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};_u.prototype.createArrays=function(){this.text=new mu(new Bo(this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new mu(new Bo(this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.glyphOffsetArray=new ro,this.lineVertexArray=new no,this.symbolInstances=new eo},_u.prototype.calculateGlyphDependencies=function(t,e,r,n,i){for(var o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(r||n)&&i){var a=Zs[t.charAt(o)];a&&(e[a.charCodeAt(0)]=!0)}},_u.prototype.populate=function(t,e,r){var n=this.layers[0],i=n.layout,o=i.get("text-font"),a=i.get("text-field"),s=i.get("icon-image"),l=("constant"!==a.value.kind||a.value.value instanceof ne&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),u="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,c=i.get("symbol-sort-key");if(this.features=[],l||u){for(var h=e.iconDependencies,p=e.glyphDependencies,d=e.availableImages,f=new si(this.zoom),m=0,g=t;m<g.length;m+=1){var _=g[m],v=_.feature,y=_.id,x=_.index,b=_.sourceLayerIndex,E=n._featureFilter.needGeometry,T=Go(v,E);if(n._featureFilter.filter(f,T,r)){E||(T.geometry=zo(v));var S=void 0;if(l){var A=n.getValueAndResolveTokens("text-field",T,r,d),w=ne.factory(A);fu(w)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ii()||this.hasRTLText&&ai.isParsed())&&(S=Xs(w,n,T))}var C=void 0;if(u){var R=n.getValueAndResolveTokens("icon-image",T,r,d);C=R instanceof ie?R:ie.fromString(R)}if(S||C){var L=this.sortFeaturesByKey?c.evaluate(T,{},r):void 0;if(this.features.push({id:y,text:S,icon:C,index:x,sourceLayerIndex:b,geometry:T.geometry,properties:v.properties,type:cu[v.type],sortKey:L}),C&&(h[C.name]=!0),S){var I=o.evaluate(T,{},r).join(","),M="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bl.vertical)>=0;for(var O=0,P=S.sections;O<P.length;O+=1){var D=P[O];if(D.image)h[D.image.name]=!0;else{var B=Xn(S.toString()),N=D.fontStack||I,F=p[N]=p[N]||{};this.calculateGlyphDependencies(D.text,F,M,this.allowVerticalPlacement,B)}}}}}}"line"===i.get("symbol-placement")&&(this.features=function(t){var e={},r={},n=[],i=0;function o(e){n.push(t[e]),i++}function a(t,e,i){var o=r[t];return delete r[t],r[e]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(i[0]),o}function s(t,r,i){var o=e[r];return delete e[r],e[t]=o,n[o].geometry[0].shift(),n[o].geometry[0]=i[0].concat(n[o].geometry[0]),o}function l(t,e,r){var n=r?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}for(var u=0;u<t.length;u++){var c=t[u],h=c.geometry,p=c.text?c.text.toString():null;if(p){var d=l(p,h),f=l(p,h,!0);if(d in r&&f in e&&r[d]!==e[f]){var m=s(d,f,h),g=a(d,f,n[m].geometry);delete e[d],delete r[f],r[l(p,n[g].geometry,!0)]=g,n[m].geometry=null}else d in r?a(d,f,h):f in e?s(d,f,h):(o(u),e[d]=i-1,r[f]=i-1)}else o(u)}return n.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},_u.prototype.update=function(t,e,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,r),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,r))},_u.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},_u.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},_u.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},_u.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},_u.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},_u.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(void 0!==t.segment){for(var n=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:n},a<e.length-1&&(n+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(var l=0;l<e.length;l++){var u=o[l];this.lineVertexArray.emplaceBack(u.x,u.y,u.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},_u.prototype.addSymbols=function(t,e,r,n,i,o,a,s,l,u,c,h){for(var p=t.indexArray,d=t.layoutVertexArray,f=t.segments.prepareSegment(4*e.length,d,p,this.canOverlap?o.sortKey:void 0),m=this.glyphOffsetArray.length,g=f.vertexLength,_=this.allowVerticalPlacement&&a===bl.vertical?Math.PI/2:0,v=o.text&&o.text.sections,y=0;y<e.length;y++){var x=e[y],b=x.tl,E=x.tr,T=x.bl,S=x.br,A=x.tex,w=x.pixelOffsetTL,C=x.pixelOffsetBR,R=x.minFontScaleX,L=x.minFontScaleY,I=x.glyphOffset,M=x.isSDF,O=x.sectionIndex,P=f.vertexLength,D=I[1];pu(d,s.x,s.y,b.x,D+b.y,A.x,A.y,r,M,w.x,w.y,R,L),pu(d,s.x,s.y,E.x,D+E.y,A.x+A.w,A.y,r,M,C.x,w.y,R,L),pu(d,s.x,s.y,T.x,D+T.y,A.x,A.y+A.h,r,M,w.x,C.y,R,L),pu(d,s.x,s.y,S.x,D+S.y,A.x+A.w,A.y+A.h,r,M,C.x,C.y,R,L),du(t.dynamicLayoutVertexArray,s,_),p.emplaceBack(P,P+1,P+2),p.emplaceBack(P+1,P+2,P+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(I[0]),y!==e.length-1&&O===e[y+1].sectionIndex||t.programConfigurations.populatePaintArrays(d.length,o,o.index,{},h,v&&v[O])}t.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,g,l,u,s.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],a,0,!1,0,c)},_u.prototype._addCollisionDebugVertex=function(t,e,r,n,i,o){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,n,i,Math.round(o.x),Math.round(o.y))},_u.prototype.addCollisionDebugVertices=function(t,e,r,n,o,a,s){var l=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),u=l.vertexLength,c=o.layoutVertexArray,h=o.collisionVertexArray,p=s.anchorX,d=s.anchorY;this._addCollisionDebugVertex(c,h,a,p,d,new i(t,e)),this._addCollisionDebugVertex(c,h,a,p,d,new i(r,e)),this._addCollisionDebugVertex(c,h,a,p,d,new i(r,n)),this._addCollisionDebugVertex(c,h,a,p,d,new i(t,n)),l.vertexLength+=4;var f=o.indexArray;f.emplaceBack(u,u+1),f.emplaceBack(u+1,u+2),f.emplaceBack(u+2,u+3),f.emplaceBack(u+3,u),l.primitiveLength+=4},_u.prototype.addDebugCollisionBoxes=function(t,e,r,n){for(var i=t;i<e;i++){var o=this.collisionBoxArray.get(i);this.addCollisionDebugVertices(o.x1,o.y1,o.x2,o.y2,n?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,r)}},_u.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gu(ki,Hs.members,Zi),this.iconCollisionBox=new gu(ki,Hs.members,Zi);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},_u.prototype._deserializeCollisionBoxesForSymbol=function(t,e,r,n,i,o,a,s,l){for(var u={},c=e;c<r;c++){var h=t.get(c);u.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},u.textFeatureIndex=h.featureIndex;break}for(var p=n;p<i;p++){var d=t.get(p);u.verticalTextBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},u.verticalTextFeatureIndex=d.featureIndex;break}for(var f=o;f<a;f++){var m=t.get(f);u.iconBox={x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,anchorPointX:m.anchorPointX,anchorPointY:m.anchorPointY},u.iconFeatureIndex=m.featureIndex;break}for(var g=s;g<l;g++){var _=t.get(g);u.verticalIconBox={x1:_.x1,y1:_.y1,x2:_.x2,y2:_.y2,anchorPointX:_.anchorPointX,anchorPointY:_.anchorPointY},u.verticalIconFeatureIndex=_.featureIndex;break}return u},_u.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},_u.prototype.hasTextData=function(){return this.text.segments.get().length>0},_u.prototype.hasIconData=function(){return this.icon.segments.get().length>0},_u.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},_u.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},_u.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},_u.prototype.addIndicesForPlacedSymbol=function(t,e){for(var r=t.placedSymbolArray.get(e),n=r.vertexStartIndex+4*r.numGlyphs,i=r.vertexStartIndex;i<n;i+=4)t.indexArray.emplaceBack(i,i+1,i+2),t.indexArray.emplaceBack(i+1,i+2,i+3)},_u.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),r=Math.cos(t),n=[],i=[],o=[],a=0;a<this.symbolInstances.length;++a){o.push(a);var s=this.symbolInstances.get(a);n.push(0|Math.round(e*s.anchorX+r*s.anchorY)),i.push(s.featureIndex)}return o.sort((function(t,e){return n[t]-n[e]||i[e]-i[t]})),o},_u.prototype.addToSortKeyRanges=function(t,e){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===e?r.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},_u.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,n=this.symbolInstanceIndexes;r<n.length;r+=1){var i=this.symbolInstances.get(n[r]);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((function(t,r,n){t>=0&&n.indexOf(t)===r&&e.addIndicesForPlacedSymbol(e.text,t)})),i.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),i.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),i.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},kn("SymbolBucket",_u,{omit:["layers","collisionBoxArray","features","compareText"]}),_u.MAX_GLYPHS=65535,_u.addDynamicAttributes=du;var vu=new bi({"symbol-placement":new gi(Lt.layout_symbol["symbol-placement"]),"symbol-spacing":new gi(Lt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gi(Lt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _i(Lt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gi(Lt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gi(Lt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gi(Lt.layout_symbol["icon-ignore-placement"]),"icon-optional":new gi(Lt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gi(Lt.layout_symbol["icon-rotation-alignment"]),"icon-size":new _i(Lt.layout_symbol["icon-size"]),"icon-text-fit":new gi(Lt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gi(Lt.layout_symbol["icon-text-fit-padding"]),"icon-image":new _i(Lt.layout_symbol["icon-image"]),"icon-rotate":new _i(Lt.layout_symbol["icon-rotate"]),"icon-padding":new gi(Lt.layout_symbol["icon-padding"]),"icon-keep-upright":new gi(Lt.layout_symbol["icon-keep-upright"]),"icon-offset":new _i(Lt.layout_symbol["icon-offset"]),"icon-anchor":new _i(Lt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gi(Lt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gi(Lt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gi(Lt.layout_symbol["text-rotation-alignment"]),"text-field":new _i(Lt.layout_symbol["text-field"]),"text-font":new _i(Lt.layout_symbol["text-font"]),"text-size":new _i(Lt.layout_symbol["text-size"]),"text-max-width":new _i(Lt.layout_symbol["text-max-width"]),"text-line-height":new gi(Lt.layout_symbol["text-line-height"]),"text-letter-spacing":new _i(Lt.layout_symbol["text-letter-spacing"]),"text-justify":new _i(Lt.layout_symbol["text-justify"]),"text-radial-offset":new _i(Lt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gi(Lt.layout_symbol["text-variable-anchor"]),"text-anchor":new _i(Lt.layout_symbol["text-anchor"]),"text-max-angle":new gi(Lt.layout_symbol["text-max-angle"]),"text-writing-mode":new gi(Lt.layout_symbol["text-writing-mode"]),"text-rotate":new _i(Lt.layout_symbol["text-rotate"]),"text-padding":new gi(Lt.layout_symbol["text-padding"]),"text-keep-upright":new gi(Lt.layout_symbol["text-keep-upright"]),"text-transform":new _i(Lt.layout_symbol["text-transform"]),"text-offset":new _i(Lt.layout_symbol["text-offset"]),"text-allow-overlap":new gi(Lt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gi(Lt.layout_symbol["text-ignore-placement"]),"text-optional":new gi(Lt.layout_symbol["text-optional"])}),yu={paint:new bi({"icon-opacity":new _i(Lt.paint_symbol["icon-opacity"]),"icon-color":new _i(Lt.paint_symbol["icon-color"]),"icon-halo-color":new _i(Lt.paint_symbol["icon-halo-color"]),"icon-halo-width":new _i(Lt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _i(Lt.paint_symbol["icon-halo-blur"]),"icon-translate":new gi(Lt.paint_symbol["icon-translate"]),"icon-translate-anchor":new gi(Lt.paint_symbol["icon-translate-anchor"]),"text-opacity":new _i(Lt.paint_symbol["text-opacity"]),"text-color":new _i(Lt.paint_symbol["text-color"],{runtimeType:Gt,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new _i(Lt.paint_symbol["text-halo-color"]),"text-halo-width":new _i(Lt.paint_symbol["text-halo-width"]),"text-halo-blur":new _i(Lt.paint_symbol["text-halo-blur"]),"text-translate":new gi(Lt.paint_symbol["text-translate"]),"text-translate-anchor":new gi(Lt.paint_symbol["text-translate-anchor"])}),layout:vu},xu=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ft,this.defaultValue=t};xu.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},xu.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},xu.prototype.outputDefined=function(){return!1},xu.prototype.serialize=function(){return null},kn("FormatSectionOverride",xu,{omit:["defaultValue"]});var bu=function(t){function e(e){t.call(this,e,yu)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,r){if(t.prototype.recalculate.call(this,e,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var n=this.layout.get("text-writing-mode");if(n){for(var i=[],o=0,a=n;o<a.length;o+=1){var s=a[o];i.indexOf(s)<0&&i.push(s)}this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,r,n){var i=this.layout.get(t).evaluate(e,{},r,n),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||Wr(o.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,r){return r in t?String(t[r]):""}))}(e.properties,i)},e.prototype.createBucket=function(t){return new _u(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,r=yu.paint.overridableProperties;t<r.length;t+=1){var n=r[t];if(e.hasPaintOverride(this.layout,n)){var i,o=this.paint.get(n),a=new xu(o),s=new Hr(a,o.property.specification);i="constant"===o.value.kind||"source"===o.value.kind?new Zr("source",s):new qr("composite",s,o.value.zoomStops,o.value._interpolationType),this.paint._values[n]=new fi(o.property,i,o.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var r=t.get("text-field"),n=yu.paint.properties[e],i=!1,o=function(t){for(var e=0,r=t;e<r.length;e+=1)if(n.overrides&&n.overrides.hasOverride(r[e]))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof ne)o(r.value.value.sections);else if("source"===r.value.kind){var a=function(t){i||(t instanceof ue&&se(t.value)===Wt?o(t.value.sections):t instanceof de?o(t.sections):t.eachChild(a))},s=r.value;s._styleExpression&&a(s._styleExpression.expression)}return i},e}(Ei),Eu={paint:new bi({"background-color":new gi(Lt.paint_background["background-color"]),"background-pattern":new yi(Lt.paint_background["background-pattern"]),"background-opacity":new gi(Lt.paint_background["background-opacity"])})},Tu=function(t){function e(e){t.call(this,e,Eu)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Ei),Su={paint:new bi({"raster-opacity":new gi(Lt.paint_raster["raster-opacity"]),"raster-hue-rotate":new gi(Lt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gi(Lt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gi(Lt.paint_raster["raster-brightness-max"]),"raster-saturation":new gi(Lt.paint_raster["raster-saturation"]),"raster-contrast":new gi(Lt.paint_raster["raster-contrast"]),"raster-resampling":new gi(Lt.paint_raster["raster-resampling"]),"raster-fade-duration":new gi(Lt.paint_raster["raster-fade-duration"])})},Au=function(t){function e(e){t.call(this,e,Su)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Ei),wu=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(Ei),Cu={circle:pa,heatmap:Ea,hillshade:Sa,fill:cs,"fill-extrusion":Cs,line:Us,symbol:bu,background:Tu,raster:Au},Ru=a.HTMLImageElement,Lu=a.HTMLCanvasElement,Iu=a.HTMLVideoElement,Mu=a.ImageData,Ou=a.ImageBitmap,Pu=function(t,e,r,n){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(e,n)};Pu.prototype.update=function(t,e,r){var n=t.width,i=t.height,o=!(this.size&&this.size[0]===n&&this.size[1]===i||r),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[n,i],t instanceof Ru||t instanceof Lu||t instanceof Iu||t instanceof Mu||Ou&&t instanceof Ou?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,n,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{var l=r||{x:0,y:0},u=l.x,c=l.y;t instanceof Ru||t instanceof Lu||t instanceof Iu||t instanceof Mu||Ou&&t instanceof Ou?s.texSubImage2D(s.TEXTURE_2D,0,u,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,u,c,n,i,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Pu.prototype.bind=function(t,e,r){var n=this.context.gl;n.bindTexture(n.TEXTURE_2D,this.texture),r!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=n.LINEAR),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)},Pu.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Pu.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Du=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};Du.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback()}),0))},Du.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Bu=function(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},_(["receive","process"],this),this.invoker=new Du(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=w()?t:a};function Nu(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}Bu.prototype.send=function(t,e,r,n,i){var o=this;void 0===i&&(i=!1);var a=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[a]=r);var s=L(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:t,hasCallback:!!r,targetMapId:n,mustQueue:i,sourceMapId:this.mapId,data:jn(e,s)},s),{cancel:function(){r&&delete o.callbacks[a],o.target.postMessage({id:a,type:"<cancel>",targetMapId:n,sourceMapId:o.mapId})}}},Bu.prototype.receive=function(t){var e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[r];var n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n()}else w()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)},Bu.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},Bu.prototype.processTask=function(t,e){var r=this;if("<response>"===e.type){var n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(Vn(e.error)):n(null,Vn(e.data)))}else{var i=!1,o=L(this.globalScope)?void 0:[],a=e.hasCallback?function(e,n){i=!0,delete r.cancelCallbacks[t],r.target.postMessage({id:t,type:"<response>",sourceMapId:r.mapId,error:e?jn(e):null,data:jn(n,o)},o)}:function(t){i=!0},s=null,l=Vn(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,l,a);else if(this.parent.getWorkerSource){var u=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,u[0],l.source)[u[1]](l,a)}else a(new Error("Could not find function "+e.type));!i&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}},Bu.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Fu=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Fu.prototype.setNorthEast=function(t){return this._ne=t instanceof ku?new ku(t.lng,t.lat):ku.convert(t),this},Fu.prototype.setSouthWest=function(t){return this._sw=t instanceof ku?new ku(t.lng,t.lat):ku.convert(t),this},Fu.prototype.extend=function(t){var e,r,n=this._sw,i=this._ne;if(t instanceof ku)e=t,r=t;else{if(!(t instanceof Fu))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Fu.convert(t)):this.extend(ku.convert(t)):this;if(r=t._ne,!(e=t._sw)||!r)return this}return n||i?(n.lng=Math.min(e.lng,n.lng),n.lat=Math.min(e.lat,n.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new ku(e.lng,e.lat),this._ne=new ku(r.lng,r.lat)),this},Fu.prototype.getCenter=function(){return new ku((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Fu.prototype.getSouthWest=function(){return this._sw},Fu.prototype.getNorthEast=function(){return this._ne},Fu.prototype.getNorthWest=function(){return new ku(this.getWest(),this.getNorth())},Fu.prototype.getSouthEast=function(){return new ku(this.getEast(),this.getSouth())},Fu.prototype.getWest=function(){return this._sw.lng},Fu.prototype.getSouth=function(){return this._sw.lat},Fu.prototype.getEast=function(){return this._ne.lng},Fu.prototype.getNorth=function(){return this._ne.lat},Fu.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Fu.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Fu.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Fu.prototype.contains=function(t){var e=ku.convert(t),r=e.lng,n=e.lat,i=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i},Fu.convert=function(t){return!t||t instanceof Fu?t:new Fu(t)};var ku=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ku.prototype.wrap=function(){return new ku(h(this.lng,-180,180),this.lat)},ku.prototype.toArray=function(){return[this.lng,this.lat]},ku.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ku.prototype.distanceTo=function(t){var e=Math.PI/180,r=this.lat*e,n=t.lat*e,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(i,1))},ku.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new Fu(new ku(this.lng-r,this.lat-e),new ku(this.lng+r,this.lat+e))},ku.convert=function(t){if(t instanceof ku)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new ku(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new ku(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Uu=2*Math.PI*6371008.8;function zu(t){return Uu*Math.cos(t*Math.PI/180)}function Gu(t){return(180+t)/360}function ju(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Vu(t,e){return t/zu(e)}function Hu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Wu=function(t,e,r){void 0===r&&(r=0),this.x=+t,this.y=+e,this.z=+r};Wu.fromLngLat=function(t,e){void 0===e&&(e=0);var r=ku.convert(t);return new Wu(Gu(r.lng),ju(r.lat),Vu(e,r.lat))},Wu.prototype.toLngLat=function(){return new ku(360*this.x-180,Hu(this.y))},Wu.prototype.toAltitude=function(){return this.z*zu(Hu(this.y))},Wu.prototype.meterInMercatorCoordinateUnits=function(){return 1/Uu*(t=Hu(this.y),1/Math.cos(t*Math.PI/180));var t};var Xu=function(t,e,r){this.z=t,this.x=e,this.y=r,this.key=Yu(0,t,t,e,r)};Xu.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Xu.prototype.url=function(t,e){var r,n,i,o,a,s=(n=this.y,i=this.z,o=Nu(256*(r=this.x),256*(n=Math.pow(2,i)-n-1),i),a=Nu(256*(r+1),256*(n+1),i),o[0]+","+o[1]+","+a[0]+","+a[1]),l=function(t,e,r){for(var n,i="",o=t;o>0;o--)i+=(e&(n=1<<o-1)?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)},Xu.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new i(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},Xu.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Zu=function(t,e){this.wrap=t,this.canonical=e,this.key=Yu(t,e.z,e.z,e.x,e.y)},qu=function(t,e,r,n,i){this.overscaledZ=t,this.wrap=e,this.canonical=new Xu(r,+n,+i),this.key=Yu(e,t,r,n,i)};function Yu(t,e,r,n,i){(t*=2)<0&&(t=-1*t-1);var o=1<<r;return(o*o*t+o*i+n).toString(36)+r.toString(36)+e.toString(36)}qu.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},qu.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new qu(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qu(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},qu.prototype.calculateScaledKey=function(t,e){var r=this.canonical.z-t;return t>this.canonical.z?Yu(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Yu(this.wrap*+e,t,t,this.canonical.x>>r,this.canonical.y>>r)},qu.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},qu.prototype.children=function(t){if(this.overscaledZ>=t)return[new qu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new qu(e,this.wrap,e,r,n),new qu(e,this.wrap,e,r+1,n),new qu(e,this.wrap,e,r,n+1),new qu(e,this.wrap,e,r+1,n+1)]},qu.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},qu.prototype.wrapped=function(){return new qu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},qu.prototype.unwrapTo=function(t){return new qu(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},qu.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},qu.prototype.toUnwrapped=function(){return new Zu(this.wrap,this.canonical)},qu.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},qu.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Wu(t.x-this.wrap,t.y))},kn("CanonicalTileID",Xu),kn("OverscaledTileID",qu,{omit:["posMatrix"]});var Ku=function(t,e,r){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return T('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var n=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=r||"mapbox";for(var i=0;i<n;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(n,i)]=this.data[this._idx(n-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,n)]=this.data[this._idx(i,n-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(n,-1)]=this.data[this._idx(n-1,0)],this.data[this._idx(-1,n)]=this.data[this._idx(0,n-1)],this.data[this._idx(n,n)]=this.data[this._idx(n-1,n-1)]};Ku.prototype.get=function(t,e){var r=new Uint8Array(this.data.buffer),n=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(r[n],r[n+1],r[n+2])},Ku.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Ku.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Ku.prototype._unpackMapbox=function(t,e,r){return(256*t*256+256*e+r)/10-1e4},Ku.prototype._unpackTerrarium=function(t,e,r){return 256*t+e+r/256-32768},Ku.prototype.getPixels=function(){return new ya({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Ku.prototype.backfillBorder=function(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var n=e*this.dim,i=e*this.dim+this.dim,o=r*this.dim,a=r*this.dim+this.dim;switch(e){case-1:n=i-1;break;case 1:i=n+1}switch(r){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,l=-r*this.dim,u=o;u<a;u++)for(var c=n;c<i;c++)this.data[this._idx(c,u)]=t.data[this._idx(c+s,u+l)]},kn("DEMData",Ku);var $u=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}};$u.prototype.encode=function(t){return this._stringToNumber[t]},$u.prototype.decode=function(t){return this._numberToString[t]};var Qu=function(t,e,r,n,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=r,t._y=n,this.properties=t.properties,this.id=i},Ju={geometry:{configurable:!0}};Ju.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Ju.geometry.set=function(t){this._geometry=t},Qu.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Qu.prototype,Ju);var tc=function(){this.state={},this.stateChanges={},this.deletedStates={}};tc.prototype.updateState=function(t,e,r){var n=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},p(this.stateChanges[t][n],r),null===this.deletedStates[t])for(var i in this.deletedStates[t]={},this.state[t])i!==n&&(this.deletedStates[t][i]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][n])for(var o in this.deletedStates[t][n]={},this.state[t][n])r[o]||(this.deletedStates[t][n][o]=null);else for(var a in r)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][a]&&delete this.deletedStates[t][n][a]},tc.prototype.removeFeatureState=function(t,e,r){if(null!==this.deletedStates[t]){var n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][r]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(r in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][r]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}},tc.prototype.getState=function(t,e){var r=String(e),n=p({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var i=this.deletedStates[t][e];if(null===i)return{};for(var o in i)delete n[o]}return n},tc.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},tc.prototype.coalesceChanges=function(t,e){var r={};for(var n in this.stateChanges){this.state[n]=this.state[n]||{};var i={};for(var o in this.stateChanges[n])this.state[n][o]||(this.state[n][o]={}),p(this.state[n][o],this.stateChanges[n][o]),i[o]=this.state[n][o];r[n]=i}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var l in this.state[a])s[l]={},this.state[a][l]={};else for(var u in this.deletedStates[a]){if(null===this.deletedStates[a][u])this.state[a][u]={};else for(var c=0,h=Object.keys(this.deletedStates[a][u]);c<h.length;c+=1)delete this.state[a][u][h[c]];s[u]=this.state[a][u]}r[a]=r[a]||{},p(r[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(var d in t)t[d].setFeatureState(r,e)};var ec=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Pn(8192,16,0),this.grid3D=new Pn(8192,16,0),this.featureIndexArray=new oo,this.promoteId=e};function rc(t,e,r,n,i){return y(t,(function(t,o){var a=e instanceof mi?e.get(o):null;return a&&a.evaluate?a.evaluate(r,n,i):a}))}function nc(t){for(var e=1/0,r=1/0,n=-1/0,i=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),r=Math.min(r,s.y),n=Math.max(n,s.x),i=Math.max(i,s.y)}return{minX:e,minY:r,maxX:n,maxY:i}}function ic(t,e){return e-t}ec.prototype.insert=function(t,e,r,n,i,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i);for(var s=o?this.grid3D:this.grid,l=0;l<e.length;l++){for(var u=e[l],c=[1/0,1/0,-1/0,-1/0],h=0;h<u.length;h++){var p=u[h];c[0]=Math.min(c[0],p.x),c[1]=Math.min(c[1],p.y),c[2]=Math.max(c[2],p.x),c[3]=Math.max(c[3],p.y)}c[0]<8192&&c[1]<8192&&c[2]>=0&&c[3]>=0&&s.insert(a,c[0],c[1],c[2],c[3])}},ec.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new xs.VectorTile(new Ks(this.rawTileData)).layers,this.sourceLayerCoder=new $u(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ec.prototype.query=function(t,e,r,n){var o=this;this.loadVTLayers();for(var a=t.params||{},s=8192/t.tileSize/t.scale,l=an(a.filter),u=t.queryGeometry,c=t.queryPadding*s,h=nc(u),p=this.grid.query(h.minX-c,h.minY-c,h.maxX+c,h.maxY+c),d=nc(t.cameraQueryGeometry),f=this.grid3D.query(d.minX-c,d.minY-c,d.maxX+c,d.maxY+c,(function(e,r,n,o){return function(t,e,r,n,o){for(var a=0,s=t;a<s.length;a+=1){var l=s[a];if(e<=l.x&&r<=l.y&&n>=l.x&&o>=l.y)return!0}var u=[new i(e,r),new i(e,o),new i(n,o),new i(n,r)];if(t.length>2)for(var c=0,h=u;c<h.length;c+=1)if(Jo(t,h[c]))return!0;for(var p=0;p<t.length-1;p++)if(ta(t[p],t[p+1],u))return!0;return!1}(t.cameraQueryGeometry,e-c,r-c,n+c,o+c)})),m=0,g=f;m<g.length;m+=1)p.push(g[m]);p.sort(ic);for(var _,v={},y=function(i){var c=p[i];if(c!==_){_=c;var h=o.featureIndexArray.get(c),d=null;o.loadMatchingFeature(v,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,l,a.layers,a.availableImages,e,r,n,(function(e,r,n){return d||(d=zo(e)),r.queryIntersectsFeature(u,e,n,d,o.z,t.transform,s,t.pixelPosMatrix)}))}},x=0;x<p.length;x++)y(x);return v},ec.prototype.loadMatchingFeature=function(t,e,r,n,i,o,a,s,l,u,c){var h=this.bucketLayerIDs[e];if(!o||function(t,e){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return!0;return!1}(o,h)){var d=this.sourceLayerCoder.decode(r),f=this.vtLayers[d].feature(n);if(i.needGeometry){var m=Go(f,!0);if(!i.filter(new si(this.tileID.overscaledZ),m,this.tileID.canonical))return}else if(!i.filter(new si(this.tileID.overscaledZ),f))return;for(var g=this.getId(f,d),_=0;_<h.length;_++){var v=h[_];if(!(o&&o.indexOf(v)<0)){var y=s[v];if(y){var x={};void 0!==g&&u&&(x=u.getState(y.sourceLayer||"_geojsonTileLayer",g));var b=p({},l[v]);b.paint=rc(b.paint,y.paint,f,x,a),b.layout=rc(b.layout,y.layout,f,x,a);var E=!c||c(f,y,x);if(E){var T=new Qu(f,this.z,this.x,this.y,g);T.layer=b;var S=t[v];void 0===S&&(S=t[v]=[]),S.push({featureIndex:n,feature:T,intersectionZ:E})}}}}}},ec.prototype.lookupSymbolFeatures=function(t,e,r,n,i,o,a,s){var l={};this.loadVTLayers();for(var u=an(i),c=0,h=t;c<h.length;c+=1)this.loadMatchingFeature(l,r,n,h[c],u,o,a,s,e);return l},ec.prototype.hasLayer=function(t){for(var e=0,r=this.bucketLayerIDs;e<r.length;e+=1)for(var n=0,i=r[e];n<i.length;n+=1)if(t===i[n])return!0;return!1},ec.prototype.getId=function(t,e){var r=t.id;return this.promoteId&&"boolean"==typeof(r=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(r=Number(r)),r},kn("FeatureIndex",ec,{omit:["rawTileData","sourceLayerCoder"]});var oc=function(t,e){this.tileID=t,this.uid=f(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};oc.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<k.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},oc.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},oc.prototype.loadVectorData=function(t,e,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var n in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var r={};if(!e)return r;for(var n=function(){var t=o[i],n=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==n.length){t.layers=n,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return n.filter((function(e){return e.id===t}))[0]})));for(var a=0,s=n;a<s.length;a+=1)r[s[a].id]=t}},i=0,o=t;i<o.length;i+=1)n();return r}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[n];if(i instanceof _u){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var o in this.buckets){var a=this.buckets[o];if(a instanceof _u&&a.hasRTLText){this.hasRTLText=!0,ai.isLoading()||ai.isLoaded()||"deferred"!==ii()||oi();break}}for(var s in this.queryPadding=0,this.buckets){var l=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(l))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new $i},oc.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},oc.prototype.getBucket=function(t){return this.buckets[t.id]},oc.prototype.upload=function(t){for(var e in this.buckets){var r=this.buckets[e];r.uploadPending()&&r.upload(t)}var n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Pu(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Pu(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)},oc.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},oc.prototype.queryRenderedFeatures=function(t,e,r,n,i,o,a,s,l,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:n,cameraQueryGeometry:i,scale:o,tileSize:this.tileSize,pixelPosMatrix:u,transform:s,params:a,queryPadding:this.queryPadding*l},t,e,r):{}},oc.prototype.querySourceFeatures=function(t,e){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var n=r.loadVTLayers(),i=e?e.sourceLayer:"",o=n._geojsonTileLayer||n[i];if(o)for(var a=an(e&&e.filter),s=this.tileID.canonical,l=s.z,u=s.x,c=s.y,h={z:l,x:u,y:c},p=0;p<o.length;p++){var d=o.feature(p);if(a.needGeometry){var f=Go(d,!0);if(!a.filter(new si(this.tileID.overscaledZ),f,this.tileID.canonical))continue}else if(!a.filter(new si(this.tileID.overscaledZ),d))continue;var m=r.getId(d,i),g=new Qu(d,l,u,c,m);g.tile=h,t.push(g)}}},oc.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},oc.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},oc.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var r=C(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var n=Date.now(),i=!1;if(this.expirationTime>n)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{var o=this.expirationTime-e;o?this.expirationTime=n+Math.max(o,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},oc.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},oc.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var r=this.latestFeatureIndex.loadVTLayers();for(var n in this.buckets)if(e.style.hasLayer(n)){var i=this.buckets[n],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=r[o],s=t[o];if(a&&s&&0!==Object.keys(s).length){i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{});var l=e&&e.style&&e.style.getLayer(n);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(i)))}}}},oc.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},oc.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<k.now()},oc.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},oc.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=k.now()+t},oc.prototype.setDependencies=function(t,e){for(var r={},n=0,i=e;n<i.length;n+=1)r[i[n]]=!0;this.dependencies[t]=r},oc.prototype.hasDependency=function(t,e){for(var r=0,n=t;r<n.length;r+=1){var i=this.dependencies[n[r]];if(i)for(var o=0,a=e;o<a.length;o+=1)if(i[a[o]])return!0}return!1};var ac=a.performance,sc=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},ac.mark(this._marks.start)};sc.prototype.finish=function(){ac.mark(this._marks.end);var t=ac.getEntriesByName(this._marks.measure);return 0===t.length&&(ac.measure(this._marks.measure,this._marks.start,this._marks.end),t=ac.getEntriesByName(this._marks.measure),ac.clearMarks(this._marks.start),ac.clearMarks(this._marks.end),ac.clearMeasures(this._marks.measure)),t},t.Actor=Bu,t.AlphaImage=va,t.CanonicalTileID=Xu,t.CollisionBoxArray=$i,t.Color=te,t.DEMData=Ku,t.DataConstantProperty=gi,t.DictionaryCoder=$u,t.EXTENT=8192,t.ErrorEvent=Ct,t.EvaluationParameters=si,t.Event=wt,t.Evented=Rt,t.FeatureIndex=ec,t.FillBucket=ss,t.FillExtrusionBucket=Ss,t.ImageAtlas=xl,t.ImagePosition=vl,t.LineBucket=Bs,t.LngLat=ku,t.LngLatBounds=Fu,t.MercatorCoordinate=Wu,t.ONE_EM=24,t.OverscaledTileID=qu,t.Point=i,t.Point$1=i,t.Properties=bi,t.Protobuf=Ks,t.RGBAImage=ya,t.RequestManager=W,t.RequestPerformance=sc,t.ResourceType=ft,t.SegmentVector=so,t.SourceFeatureState=tc,t.StructArrayLayout1ui2=qi,t.StructArrayLayout2f1f2i16=Ui,t.StructArrayLayout2i4=Ri,t.StructArrayLayout3ui6=Gi,t.StructArrayLayout4i8=Li,t.SymbolBucket=_u,t.Texture=Pu,t.Tile=oc,t.Transitionable=ci,t.Uniform1f=bo,t.Uniform1i=xo,t.Uniform2f=Eo,t.Uniform3f=To,t.Uniform4f=So,t.UniformColor=Ao,t.UniformMatrix4f=Co,t.UnwrappedTileID=Zu,t.ValidationError=It,t.WritingMode=bl,t.ZoomHistory=Hn,t.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},t.addDynamicAttributes=du,t.asyncAll=function(t,e,r){if(!t.length)return r(null,[]);var n=t.length,i=new Array(t.length),o=null;t.forEach((function(t,a){e(t,(function(t,e){t&&(o=t),i[a]=e,0==--n&&r(o,i)}))}))},t.bezier=l,t.bindAll=_,t.browser=k,t.cacheEntryPossiblyAdded=function(t){++pt>lt&&(t.getActor().send("enforceCacheSizeLimit",st),pt=0)},t.clamp=c,t.clearTileCache=function(t){var e=a.caches.delete("mapbox-tiles");t&&e.catch(t).then((function(){return t()}))},t.clipLine=Xl,t.clone=function(t){var e=new aa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=b,t.clone$2=function(t){var e=new aa(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.collisionCircleLayout=Ws,t.config=U,t.create=function(){var t=new aa(16);return aa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new aa(9);return aa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new aa(4);return aa!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=Xr,t.createLayout=wi,t.createStyleLayer=function(t){return"custom"===t.type?new wu(t):new Cu[t.type](t)},t.cross=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],l=r[2];return t[0]=i*l-o*s,t[1]=o*a-n*l,t[2]=n*s-i*a,t},t.deepEqual=function t(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],r[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==r){if("object"!=typeof r)return!1;if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var i in e)if(!t(e[i],r[i]))return!1;return!0}return e===r},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=u,t.emitValidationErrors=On,t.endsWith=v,t.enforceCacheSizeLimit=function(t){ut(),tt&&tt.then((function(e){e.keys().then((function(r){for(var n=0;n<r.length-t;n++)e.delete(r[n])}))}))},t.evaluateSizeForFeature=Fl,t.evaluateSizeForZoom=kl,t.evaluateVariableOffset=ou,t.evented=ni,t.extend=p,t.featureFilter=an,t.filterObject=x,t.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Ol,t.getAnchorJustification=au,t.getArrayBuffer=xt,t.getImage=Tt,t.getJSON=function(t,e){return yt(p(t,{type:"json"}),e)},t.getRTLTextPluginStatus=ii,t.getReferrer=vt,t.getVideo=function(t,e){var r,n,i=a.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(var o=0;o<t.length;o++){var s=a.document.createElement("source");r=t[o],n=void 0,(n=a.document.createElement("a")).href=r,(n.protocol!==a.document.location.protocol||n.host!==a.document.location.host)&&(i.crossOrigin="Anonymous"),s.src=t[o],i.appendChild(s)}return{cancel:function(){}}},t.identity=sa,t.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],_=e[15],v=r*s-n*a,y=r*l-i*a,x=r*u-o*a,b=n*l-i*s,E=n*u-o*s,T=i*u-o*l,S=c*m-h*f,A=c*g-p*f,w=c*_-d*f,C=h*g-p*m,R=h*_-d*m,L=p*_-d*g,I=v*L-y*R+x*C+b*w-E*A+T*S;return I?(t[0]=(s*L-l*R+u*C)*(I=1/I),t[1]=(i*R-n*L-o*C)*I,t[2]=(m*T-g*E+_*b)*I,t[3]=(p*E-h*T-d*b)*I,t[4]=(l*w-a*L-u*A)*I,t[5]=(r*L-i*w+o*A)*I,t[6]=(g*x-f*T-_*y)*I,t[7]=(c*T-p*x+d*y)*I,t[8]=(a*R-s*w+u*S)*I,t[9]=(n*w-r*R-o*S)*I,t[10]=(f*E-m*x+_*v)*I,t[11]=(h*x-c*E-d*v)*I,t[12]=(s*A-a*C-l*S)*I,t[13]=(r*C-n*A+i*S)*I,t[14]=(m*y-f*b-g*v)*I,t[15]=(c*b-h*y+p*v)*I,t):null},t.isChar=Wn,t.isMapboxURL=X,t.keysDifference=function(t,e){var r=[];for(var n in t)n in e||r.push(n);return r},t.makeRequest=yt,t.mapObject=y,t.mercatorXfromLng=Gu,t.mercatorYfromLat=ju,t.mercatorZfromAltitude=Vu,t.mul=ca,t.multiply=la,t.mvt=xs,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},t.number=He,t.offscreenCanvasSupported=dt,t.ortho=function(t,e,r,n,i,o,a){var s=1/(e-r),l=1/(n-i),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*l,t[14]=(a+o)*u,t[15]=1,t},t.parseGlyphPBF=function(t){return new Ks(t).readFields(fl,[])},t.pbf=Ks,t.performSymbolLayout=function(t,e,r,n,i,o,a){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,l=t.layers[0]._unevaluatedLayout._values,u={};if("composite"===t.textSizeData.kind){var c=t.textSizeData,h=c.maxZoom;u.compositeTextSizes=[l["text-size"].possiblyEvaluate(new si(c.minZoom),a),l["text-size"].possiblyEvaluate(new si(h),a)]}if("composite"===t.iconSizeData.kind){var p=t.iconSizeData,d=p.maxZoom;u.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new si(p.minZoom),a),l["icon-size"].possiblyEvaluate(new si(d),a)]}u.layoutTextSize=l["text-size"].possiblyEvaluate(new si(t.zoom+1),a),u.layoutIconSize=l["icon-size"].possiblyEvaluate(new si(t.zoom+1),a),u.textMaxSize=l["text-size"].possiblyEvaluate(new si(18));for(var f=24*s.get("text-line-height"),m="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),g=s.get("text-keep-upright"),_=s.get("text-size"),v=function(){var o=x[y],l=s.get("text-font").evaluate(o,{},a).join(","),c=_.evaluate(o,{},a),h=u.layoutTextSize.evaluate(o,{},a),p=u.layoutIconSize.evaluate(o,{},a),d={horizontal:{},vertical:void 0},v=o.text,b=[0,0];if(v){var E=v.toString(),S=24*s.get("text-letter-spacing").evaluate(o,{},a),A=function(t){for(var e=0,r=t;e<r.length;e+=1)if(n=r[e].charCodeAt(0),Wn.Arabic(n)||Wn["Arabic Supplement"](n)||Wn["Arabic Extended-A"](n)||Wn["Arabic Presentation Forms-A"](n)||Wn["Arabic Presentation Forms-B"](n))return!1;var n;return!0}(E)?S:0,w=s.get("text-anchor").evaluate(o,{},a),C=s.get("text-variable-anchor");if(!C){var R=s.get("text-radial-offset").evaluate(o,{},a);b=R?ou(w,[24*R,iu]):s.get("text-offset").evaluate(o,{},a).map((function(t){return 24*t}))}var L=m?"center":s.get("text-justify").evaluate(o,{},a),I=s.get("symbol-placement"),M="point"===I?24*s.get("text-max-width").evaluate(o,{},a):0,O=function(){t.allowVerticalPlacement&&Xn(E)&&(d.vertical=Sl(v,e,r,i,l,M,f,w,"left",A,b,bl.vertical,!0,I,h,c))};if(!m&&C){for(var P="auto"===L?C.map((function(t){return au(t)})):[L],D=!1,B=0;B<P.length;B++){var N=P[B];if(!d.horizontal[N])if(D)d.horizontal[N]=d.horizontal[0];else{var F=Sl(v,e,r,i,l,M,f,"center",N,A,b,bl.horizontal,!1,I,h,c);F&&(d.horizontal[N]=F,D=1===F.positionedLines.length)}}O()}else{"auto"===L&&(L=au(w));var k=Sl(v,e,r,i,l,M,f,w,L,A,b,bl.horizontal,!1,I,h,c);k&&(d.horizontal[L]=k),O(),Xn(E)&&m&&g&&(d.vertical=Sl(v,e,r,i,l,M,f,w,L,A,b,bl.vertical,!1,I,h,c))}}var U=void 0,z=!1;if(o.icon&&o.icon.name){var G=n[o.icon.name];G&&(U=function(t,e,r){var n=Ol(r),i=e[0]-t.displaySize[0]*n.horizontalAlign,o=e[1]-t.displaySize[1]*n.verticalAlign;return{image:t,top:o,bottom:o+t.displaySize[1],left:i,right:i+t.displaySize[0]}}(i[o.icon.name],s.get("icon-offset").evaluate(o,{},a),s.get("icon-anchor").evaluate(o,{},a)),z=G.sdf,void 0===t.sdfIcons?t.sdfIcons=G.sdf:t.sdfIcons!==G.sdf&&T("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(G.pixelRatio!==t.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}var j=lu(d.horizontal)||d.vertical;t.iconsInText=!!j&&j.iconsInText,(j||U)&&function(t,e,r,n,i,o,a,s,l,u,c){var h=o.textMaxSize.evaluate(e,{});void 0===h&&(h=a);var p,d=t.layers[0].layout,f=d.get("icon-offset").evaluate(e,{},c),m=lu(r.horizontal),g=a/24,_=t.tilePixelRatio*g,v=t.tilePixelRatio*h/24,y=t.tilePixelRatio*s,x=t.tilePixelRatio*d.get("symbol-spacing"),b=d.get("text-padding")*t.tilePixelRatio,E=d.get("icon-padding")*t.tilePixelRatio,S=d.get("text-max-angle")/180*Math.PI,A="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),w="map"===d.get("icon-rotation-alignment")&&"point"!==d.get("symbol-placement"),C=d.get("symbol-placement"),R=x/2,L=d.get("icon-text-fit");n&&"none"!==L&&(t.allowVerticalPlacement&&r.vertical&&(p=Dl(n,r.vertical,L,d.get("icon-text-fit-padding"),f,g)),m&&(n=Dl(n,m,L,d.get("icon-text-fit-padding"),f,g)));var I=function(s,h){h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m,g,_,v,y,x,b,E,S,A){var w,C,R,L,I,M=t.addToLineVertexArray(e,r),O=0,P=0,D=0,B=0,N=-1,F=-1,k={},U=po(""),z=0,G=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(z=(w=s.layout.get("text-offset").evaluate(x,{},S).map((function(t){return 24*t})))[0],G=w[1]):(z=24*s.layout.get("text-radial-offset").evaluate(x,{},S),G=iu),t.allowVerticalPlacement&&n.vertical){var j=s.layout.get("text-rotate").evaluate(x,{},S)+90;L=new Ql(l,e,u,c,h,n.vertical,p,d,f,j),a&&(I=new Ql(l,e,u,c,h,a,g,_,f,j))}if(i){var V=s.layout.get("icon-rotate").evaluate(x,{}),H="none"!==s.layout.get("icon-text-fit"),W=Zl(i,V,E,H),X=a?Zl(a,V,E,H):void 0;R=new Ql(l,e,u,c,h,i,g,_,!1,V),O=4*W.length;var Z=t.iconSizeData,q=null;"source"===Z.kind?(q=[128*s.layout.get("icon-size").evaluate(x,{})])[0]>32640&&T(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===Z.kind&&((q=[128*b.compositeIconSizes[0].evaluate(x,{},S),128*b.compositeIconSizes[1].evaluate(x,{},S)])[0]>32640||q[1]>32640)&&T(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),t.addSymbols(t.icon,W,q,y,v,x,!1,e,M.lineStartIndex,M.lineLength,-1,S),N=t.icon.placedSymbolArray.length-1,X&&(P=4*X.length,t.addSymbols(t.icon,X,q,y,v,x,bl.vertical,e,M.lineStartIndex,M.lineLength,-1,S),F=t.icon.placedSymbolArray.length-1)}for(var Y in n.horizontal){var K=n.horizontal[Y];if(!C){U=po(K.text);var $=s.layout.get("text-rotate").evaluate(x,{},S);C=new Ql(l,e,u,c,h,K,p,d,f,$)}var Q=1===K.positionedLines.length;if(D+=su(t,e,K,o,s,f,x,m,M,n.vertical?bl.horizontal:bl.horizontalOnly,Q?Object.keys(n.horizontal):[Y],k,N,b,S),Q)break}n.vertical&&(B+=su(t,e,n.vertical,o,s,f,x,m,M,bl.vertical,["vertical"],k,F,b,S));var J=C?C.boxStartIndex:t.collisionBoxArray.length,tt=C?C.boxEndIndex:t.collisionBoxArray.length,et=L?L.boxStartIndex:t.collisionBoxArray.length,rt=L?L.boxEndIndex:t.collisionBoxArray.length,nt=R?R.boxStartIndex:t.collisionBoxArray.length,it=R?R.boxEndIndex:t.collisionBoxArray.length,ot=I?I.boxStartIndex:t.collisionBoxArray.length,at=I?I.boxEndIndex:t.collisionBoxArray.length,st=-1,lt=function(t,e){return t&&t.circleDiameter?Math.max(t.circleDiameter,e):e};st=lt(C,st),st=lt(L,st),st=lt(R,st);var ut=(st=lt(I,st))>-1?1:0;ut&&(st*=A/24),t.glyphOffsetArray.length>=_u.MAX_GLYPHS&&T("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,k.right>=0?k.right:-1,k.center>=0?k.center:-1,k.left>=0?k.left:-1,k.vertical||-1,N,F,U,J,tt,et,rt,nt,it,ot,at,u,D,B,O,P,ut,0,p,z,G,st)}(t,h,s,r,n,i,p,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,_,b,A,l,y,E,w,f,e,o,u,c,a)};if("line"===C)for(var M=0,O=Xl(e.geometry,0,0,8192,8192);M<O.length;M+=1)for(var P=O[M],D=0,B=Wl(P,x,S,r.vertical||m,n,24,v,t.overscaling,8192);D<B.length;D+=1){var N=B[D];m&&uu(t,m.text,R,N)||I(P,N)}else if("line-center"===C)for(var F=0,k=e.geometry;F<k.length;F+=1){var U=k[F];if(U.length>1){var z=Hl(U,S,r.vertical||m,n,24,v);z&&I(U,z)}}else if("Polygon"===e.type)for(var G=0,j=ns(e.geometry,0);G<j.length;G+=1){var V=j[G],H=eu(V,16);I(V[0],new Bl(H.x,H.y,0))}else if("LineString"===e.type)for(var W=0,X=e.geometry;W<X.length;W+=1){var Z=X[W];I(Z,new Bl(Z[0].x,Z[0].y,0))}else if("Point"===e.type)for(var q=0,Y=e.geometry;q<Y.length;q+=1)for(var K=0,$=Y[q];K<$.length;K+=1){var Q=$[K];I([Q],new Bl(Q.x,Q.y,0))}}(t,o,d,U,n,u,h,p,b,z,a)},y=0,x=t.features;y<x.length;y+=1)v();o&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,r,n,i){var o,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(o=1/(n-i)),t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t},t.pick=function(t,e){for(var r={},n=0;n<e.length;n++){var i=e[n];i in t&&(r[i]=t[i])}return r},t.plugin=ai,t.polygonIntersectsPolygon=Ho,t.postMapLoadEvent=at,t.postTurnstileEvent=it,t.potpack=_l,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=kn,t.registerForPluginStateChange=function(t){return t({pluginStatus:Jn,pluginURL:ti}),ni.on("pluginStateChange",t),t},t.renderColorRamp=ba,t.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=n*l+o*s,t[1]=i*l+a*s,t[2]=n*-s+o*l,t[3]=i*-s+a*l,t},t.rotateX=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+u*n,t[5]=a*i+c*n,t[6]=s*i+h*n,t[7]=l*i+p*n,t[8]=u*i-o*n,t[9]=c*i-a*n,t[10]=h*i-s*n,t[11]=p*i-l*n,t},t.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+u*n,t[1]=a*i+c*n,t[2]=s*i+h*n,t[3]=l*i+p*n,t[4]=u*i-o*n,t[5]=c*i-a*n,t[6]=h*i-s*n,t[7]=p*i-l*n,t},t.scale=function(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},t.scale$2=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},t.setCacheLimits=function(t,e){st=t,lt=e},t.setRTLTextPlugin=function(t,e,r){if(void 0===r&&(r=!1),"deferred"===Jn||"loading"===Jn||"loaded"===Jn)throw new Error("setRTLTextPlugin cannot be called multiple times.");ti=k.resolveURL(t),Jn="deferred",Qn=e,ri(),r||oi()},t.sphericalToCartesian=function(t){var e=t[0],r=t[1],n=t[2];return r+=90,r*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(r)*Math.sin(n),y:e*Math.sin(r)*Math.sin(n),z:e*Math.cos(n)}},t.sqrLen=function(t){var e=t[0],r=t[1];return e*e+r*r},t.styleSpec=Lt,t.sub=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},t.symbolSize=Ul,t.transformMat3=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t},t.transformMat4=ha,t.translate=function(t,e,r){var n,i,o,a,s,l,u,c,h,p,d,f,m=r[0],g=r[1],_=r[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*_+e[12],t[13]=e[1]*m+e[5]*g+e[9]*_+e[13],t[14]=e[2]*m+e[6]*g+e[10]*_+e[14],t[15]=e[3]*m+e[7]*g+e[11]*_+e[15]):(i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=n=e[0],t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=n*m+s*g+h*_+e[12],t[13]=i*m+l*g+p*_+e[13],t[14]=o*m+u*g+d*_+e[14],t[15]=a*m+c*g+f*_+e[15]),t},t.triggerPluginCompletionEvent=ei,t.uniqueId=f,t.validateCustomStyleLayer=function(t){var e=[],r=t.id;return void 0===r&&e.push({message:"layers."+r+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+r+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=Ln,t.validateStyle=Rn,t.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},t.vectorTile=xs,t.version="1.13.3",t.warnOnce=T,t.webpSupported=z,t.window=a,t.wrap=h})),n(["./shared"],(function(t){function e(t){var r=typeof t;if("number"===r||"boolean"===r||"string"===r||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var n="[",i=0,o=t;i<o.length;i+=1)n+=e(o[i])+",";return n+"]"}for(var a=Object.keys(t).sort(),s="{",l=0;l<a.length;l++)s+=JSON.stringify(a[l])+":"+e(t[a[l]])+",";return s+"}"}function r(r){for(var n="",i=0,o=t.refProperties;i<o.length;i+=1)n+="/"+e(r[o[i]]);return n}var n=function(t){this.keyCache={},t&&this.replace(t)};n.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},n.prototype.update=function(e,n){for(var i=this,o=0,a=e;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var l=this._layers[s.id]=t.createStyleLayer(s);l._featureFilter=t.featureFilter(l.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var u=0,c=n;u<c.length;u+=1){var h=c[u];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,d=function(t,e){for(var n={},i=0;i<t.length;i++){var o=e&&e[t[i].id]||r(t[i]);e&&(e[t[i].id]=o);var a=n[o];a||(a=n[o]=[]),a.push(t[i])}var s=[];for(var l in n)s.push(n[l]);return s}(t.values(this._layerConfigs),this.keyCache);p<d.length;p+=1){var f=d[p].map((function(t){return i._layers[t.id]})),m=f[0];if("none"!==m.visibility){var g=m.source||"",_=this.familiesBySource[g];_||(_=this.familiesBySource[g]={});var v=m.sourceLayer||"_geojsonTileLayer",y=_[v];y||(y=_[v]=[]),y.push(f)}}};var i=function(e){var r={},n=[];for(var i in e){var o=e[i],a=r[i]={};for(var s in o){var l=o[+s];if(l&&0!==l.bitmap.width&&0!==l.bitmap.height){var u={x:0,y:0,w:l.bitmap.width+2,h:l.bitmap.height+2};n.push(u),a[s]={rect:u,metrics:l.metrics}}}}var c=t.potpack(n),h=new t.AlphaImage({width:c.w||1,height:c.h||1});for(var p in e){var d=e[p];for(var f in d){var m=d[+f];if(m&&0!==m.bitmap.width&&0!==m.bitmap.height){var g=r[p][f].rect;t.AlphaImage.copy(m.bitmap,h,{x:0,y:0},{x:g.x+1,y:g.y+1},m.bitmap)}}}this.image=h,this.positions=r};t.register("GlyphAtlas",i);var o=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId};function a(e,r,n){for(var i=new t.EvaluationParameters(r),o=0,a=e;o<a.length;o+=1)a[o].recalculate(i,n)}function s(e,r){var n=t.getArrayBuffer(e.request,(function(e,n,i,o){e?r(e):n&&r(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(n)),rawData:n,cacheControl:i,expires:o})}));return function(){n.cancel(),r()}}o.prototype.parse=function(e,r,n,o,s){var l=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var u=new t.DictionaryCoder(Object.keys(e.layers).sort()),c=new t.FeatureIndex(this.tileID,this.promoteId);c.bucketLayerIDs=[];var h,p,d,f,m={},g={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:n},_=r.familiesBySource[this.source];for(var v in _){var y=e.layers[v];if(y){1===y.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+v+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var x=u.encode(v),b=[],E=0;E<y.length;E++){var T=y.feature(E),S=c.getId(T,v);b.push({feature:T,id:S,index:E,sourceLayerIndex:x})}for(var A=0,w=_[v];A<w.length;A+=1){var C=w[A],R=C[0];R.minzoom&&this.zoom<Math.floor(R.minzoom)||R.maxzoom&&this.zoom>=R.maxzoom||"none"!==R.visibility&&(a(C,this.zoom,n),(m[R.id]=R.createBucket({index:c.bucketLayerIDs.length,layers:C,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:x,sourceID:this.source})).populate(b,g,this.tileID.canonical),c.bucketLayerIDs.push(C.map((function(t){return t.id}))))}}}var L=t.mapObject(g.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(L).length?o.send("getGlyphs",{uid:this.uid,stacks:L},(function(t,e){h||(h=t,p=e,O.call(l))})):p={};var I=Object.keys(g.iconDependencies);I.length?o.send("getImages",{icons:I,source:this.source,tileID:this.tileID,type:"icons"},(function(t,e){h||(h=t,d=e,O.call(l))})):d={};var M=Object.keys(g.patternDependencies);function O(){if(h)return s(h);if(p&&d&&f){var e=new i(p),r=new t.ImageAtlas(d,f);for(var o in m){var l=m[o];l instanceof t.SymbolBucket?(a(l.layers,this.zoom,n),t.performSymbolLayout(l,p,e.positions,d,r.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):l.hasPattern&&(l instanceof t.LineBucket||l instanceof t.FillBucket||l instanceof t.FillExtrusionBucket)&&(a(l.layers,this.zoom,n),l.addFeatures(g,this.tileID.canonical,r.patternPositions))}this.status="done",s(null,{buckets:t.values(m).filter((function(t){return!t.isEmpty()})),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:r,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?d:null,glyphPositions:this.returnDependencies?e.positions:null})}}M.length?o.send("getImages",{icons:M,source:this.source,tileID:this.tileID,type:"patterns"},(function(t,e){h||(h=t,f=e,O.call(l))})):f={},O.call(this)};var l=function(t,e,r,n){this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=n||s,this.loading={},this.loaded={}};l.prototype.loadTile=function(e,r){var n=this,i=e.uid;this.loading||(this.loading={});var a=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.RequestPerformance(e.request),s=this.loading[i]=new o(e);s.abort=this.loadVectorData(e,(function(e,o){if(delete n.loading[i],e||!o)return s.status="done",n.loaded[i]=s,r(e);var l=o.rawData,u={};o.expires&&(u.expires=o.expires),o.cacheControl&&(u.cacheControl=o.cacheControl);var c={};if(a){var h=a.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=o.vectorTile,s.parse(o.vectorTile,n.layerIndex,n.availableImages,n.actor,(function(e,n){if(e||!n)return r(e);r(null,t.extend({rawTileData:l.slice(0)},n,u,c))})),n.loaded=n.loaded||{},n.loaded[i]=s}))},l.prototype.reloadTile=function(t,e){var r=this,n=this.loaded,i=t.uid,o=this;if(n&&n[i]){var a=n[i];a.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,n){var i=a.reloadCallback;i&&(delete a.reloadCallback,a.parse(a.vectorTile,o.layerIndex,r.availableImages,o.actor,i)),e(t,n)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},l.prototype.abortTile=function(t,e){var r=this.loading,n=t.uid;r&&r[n]&&r[n].abort&&(r[n].abort(),delete r[n]),e()},l.prototype.removeTile=function(t,e){var r=this.loaded,n=t.uid;r&&r[n]&&delete r[n],e()};var u=t.window.ImageBitmap,c=function(){this.loaded={}};function h(t,e){if(0!==t.length){p(t[0],e);for(var r=1;r<t.length;r++)p(t[r],!e)}}function p(t,e){for(var r=0,n=0,i=0,o=t.length,a=o-1;i<o;a=i++){var s=(t[i][0]-t[a][0])*(t[a][1]+t[i][1]),l=r+s;n+=Math.abs(r)>=Math.abs(s)?r-l+s:s-l+r,r=l}r+n>=0!=!!e&&t.reverse()}c.prototype.loadTile=function(e,r){var n=e.uid,i=e.encoding,o=e.rawImageData,a=u&&o instanceof u?this.getImageData(o):o,s=new t.DEMData(n,a,i);this.loaded=this.loaded||{},this.loaded[n]=s,r(null,s)},c.prototype.getImageData=function(e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var r=this.offscreenCanvasContext.getImageData(-1,-1,e.width+2,e.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:r.width,height:r.height},r.data)},c.prototype.removeTile=function(t){var e=this.loaded,r=t.uid;e&&e[r]&&delete e[r]};var d=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,f=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};f.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],r=0,n=this._feature.geometry;r<n.length;r+=1){var i=n[r];e.push([new t.Point$1(i[0],i[1])])}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var l=[],u=0,c=s[a];u<c.length;u+=1){var h=c[u];l.push(new t.Point$1(h[0],h[1]))}o.push(l)}return o},f.prototype.toGeoJSON=function(t,e,r){return d.call(this,t,e,r)};var m=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};m.prototype.feature=function(t){return new f(this._features[t])};var g=t.vectorTile.VectorTileFeature,_=v;function v(t,e){this.options=e||{},this.features=t,this.length=t.length}function y(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}v.prototype.feature=function(t){return new y(this.features[t],this.options.extent)},y.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var r=0;r<e.length;r++){for(var n=e[r],i=[],o=0;o<n.length;o++)i.push(new t.Point$1(n[o][0],n[o][1]));this.geometry.push(i)}return this.geometry},y.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,r=-1/0,n=1/0,i=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),r=Math.max(r,l.x),n=Math.min(n,l.y),i=Math.max(i,l.y)}return[e,n,r,i]},y.prototype.toGeoJSON=g.prototype.toGeoJSON;var x=E,b=_;function E(e){var r=new t.pbf;return function(t,e){for(var r in t.layers)e.writeMessage(3,T,t.layers[r])}(e,r),r.finish()}function T(t,e){var r;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<t.length;r++)n.feature=t.feature(r),e.writeMessage(2,S,n);var i=n.keys;for(r=0;r<i.length;r++)e.writeStringField(3,i[r]);var o=n.values;for(r=0;r<o.length;r++)e.writeMessage(4,L,o[r])}function S(t,e){var r=t.feature;void 0!==r.id&&e.writeVarintField(1,r.id),e.writeMessage(2,A,t),e.writeVarintField(3,r.type),e.writeMessage(4,R,r)}function A(t,e){var r=t.feature,n=t.keys,i=t.values,o=t.keycache,a=t.valuecache;for(var s in r.properties){var l=o[s];void 0===l&&(n.push(s),o[s]=l=n.length-1),e.writeVarint(l);var u=r.properties[s],c=typeof u;"string"!==c&&"boolean"!==c&&"number"!==c&&(u=JSON.stringify(u));var h=c+":"+u,p=a[h];void 0===p&&(i.push(u),a[h]=p=i.length-1),e.writeVarint(p)}}function w(t,e){return(e<<3)+(7&t)}function C(t){return t<<1^t>>31}function R(t,e){for(var r=t.loadGeometry(),n=t.type,i=0,o=0,a=r.length,s=0;s<a;s++){var l=r[s],u=1;1===n&&(u=l.length),e.writeVarint(w(1,u));for(var c=3===n?l.length-1:l.length,h=0;h<c;h++){1===h&&1!==n&&e.writeVarint(w(2,c-1));var p=l[h].x-i,d=l[h].y-o;e.writeVarint(C(p)),e.writeVarint(C(d)),i+=p,o+=d}3===n&&e.writeVarint(w(7,1))}}function L(t,e){var r=typeof t;"string"===r?e.writeStringField(1,t):"boolean"===r?e.writeBooleanField(7,t):"number"===r&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function I(t,e,r,n){M(t,r,n),M(e,2*r,2*n),M(e,2*r+1,2*n+1)}function M(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function O(t,e,r,n){var i=t-r,o=e-n;return i*i+o*o}x.fromVectorTileJs=E,x.fromGeojsonVt=function(t,e){e=e||{};var r={};for(var n in t)r[n]=new _(t[n].features,e),r[n].name=n,r[n].version=e.version,r[n].extent=e.extent;return E({layers:r})},x.GeoJSONWrapper=b;var P=function(t){return t[0]},D=function(t){return t[1]},B=function(t,e,r,n,i){void 0===e&&(e=P),void 0===r&&(r=D),void 0===n&&(n=64),void 0===i&&(i=Float64Array),this.nodeSize=n,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length),l=0;l<t.length;l++)a[l]=l,s[2*l]=e(t[l]),s[2*l+1]=r(t[l]);!function t(e,r,n,i,o,a){if(!(o-i<=n)){var s=i+o>>1;!function t(e,r,n,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,l=n-i+1,u=Math.log(s),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);t(e,r,n,Math.max(i,Math.floor(n-l*c/s+h)),Math.min(o,Math.floor(n+(s-l)*c/s+h)),a)}var p=r[2*n+a],d=i,f=o;for(I(e,r,i,n),r[2*o+a]>p&&I(e,r,i,o);d<f;){for(I(e,r,d,f),d++,f--;r[2*d+a]<p;)d++;for(;r[2*f+a]>p;)f--}r[2*i+a]===p?I(e,r,i,f):I(e,r,++f,o),f<=n&&(i=f+1),n<=f&&(o=f-1)}}(e,r,s,i,o,a%2),t(e,r,n,i,s-1,a+1),t(e,r,n,s+1,o,a+1)}}(a,s,n,0,a.length-1,0)};B.prototype.range=function(t,e,r,n){return function(t,e,r,n,i,o,a){for(var s,l,u=[0,t.length-1,0],c=[];u.length;){var h=u.pop(),p=u.pop(),d=u.pop();if(p-d<=a)for(var f=d;f<=p;f++)l=e[2*f+1],(s=e[2*f])>=r&&s<=i&&l>=n&&l<=o&&c.push(t[f]);else{var m=Math.floor((d+p)/2);l=e[2*m+1],(s=e[2*m])>=r&&s<=i&&l>=n&&l<=o&&c.push(t[m]);var g=(h+1)%2;(0===h?r<=s:n<=l)&&(u.push(d),u.push(m-1),u.push(g)),(0===h?i>=s:o>=l)&&(u.push(m+1),u.push(p),u.push(g))}}return c}(this.ids,this.coords,t,e,r,n,this.nodeSize)},B.prototype.within=function(t,e,r){return function(t,e,r,n,i,o){for(var a=[0,t.length-1,0],s=[],l=i*i;a.length;){var u=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o)for(var p=h;p<=c;p++)O(e[2*p],e[2*p+1],r,n)<=l&&s.push(t[p]);else{var d=Math.floor((h+c)/2),f=e[2*d],m=e[2*d+1];O(f,m,r,n)<=l&&s.push(t[d]);var g=(u+1)%2;(0===u?r-i<=f:n-i<=m)&&(a.push(h),a.push(d-1),a.push(g)),(0===u?r+i>=f:n+i>=m)&&(a.push(d+1),a.push(c),a.push(g))}}return s}(this.ids,this.coords,t,e,r,this.nodeSize)};var N={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},F=function(t){this.options=H(Object.create(N),t),this.trees=new Array(this.options.maxZoom+1)};function k(t,e,r,n,i){return{x:t,y:e,zoom:1/0,id:r,parentId:-1,numPoints:n,properties:i}}function U(t,e){var r=t.geometry.coordinates,n=r[1];return{x:j(r[0]),y:V(n),zoom:1/0,index:e,parentId:-1}}function z(t){return{type:"Feature",id:t.id,properties:G(t),geometry:{type:"Point",coordinates:[(n=t.x,360*(n-.5)),(e=t.y,r=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(r))/Math.PI-90)]}};var e,r,n}function G(t){var e=t.numPoints,r=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return H(H({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function j(t){return t/360+.5}function V(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function H(t,e){for(var r in e)t[r]=e[r];return t}function W(t){return t.x}function X(t){return t.y}function Z(t,e,r,n,i,o){var a=i-r,s=o-n;if(0!==a||0!==s){var l=((t-r)*a+(e-n)*s)/(a*a+s*s);l>1?(r=i,n=o):l>0&&(r+=a*l,n+=s*l)}return(a=t-r)*a+(s=e-n)*s}function q(t,e,r,n){var i={id:void 0===t?null:t,type:e,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)Y(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<e.length;n++)Y(t,e[n]);else if("MultiPolygon"===r)for(n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)Y(t,e[n][i])}(i),i}function Y(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function K(t,e,r,n){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],l=e.id;if(r.promoteId?l=e.properties[r.promoteId]:r.generateId&&(l=n||0),"Point"===o)$(i,s);else if("MultiPoint"===o)for(var u=0;u<i.length;u++)$(i[u],s);else if("LineString"===o)Q(i,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(u=0;u<i.length;u++)Q(i[u],s=[],a,!1),t.push(q(l,"LineString",s,e.properties));return}J(i,s,a,!1)}else if("Polygon"===o)J(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(u=0;u<e.geometry.geometries.length;u++)K(t,{id:l,geometry:e.geometry.geometries[u],properties:e.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<i.length;u++){var c=[];J(i[u],c,a,!0),s.push(c)}}t.push(q(l,o,s,e.properties))}}function $(t,e){e.push(tt(t[0])),e.push(et(t[1])),e.push(0)}function Q(t,e,r,n){for(var i,o,a=0,s=0;s<t.length;s++){var l=tt(t[s][0]),u=et(t[s][1]);e.push(l),e.push(u),e.push(0),s>0&&(a+=n?(i*u-l*o)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(u-o,2))),i=l,o=u}var c=e.length-3;e[2]=1,function t(e,r,n,i){for(var o,a=i,s=n-r>>1,l=n-r,u=e[r],c=e[r+1],h=e[n],p=e[n+1],d=r+3;d<n;d+=3){var f=Z(e[d],e[d+1],u,c,h,p);if(f>a)o=d,a=f;else if(f===a){var m=Math.abs(d-s);m<l&&(o=d,l=m)}}a>i&&(o-r>3&&t(e,r,o,i),e[o+2]=a,n-o>3&&t(e,o,n,i))}(e,0,c,r),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function J(t,e,r,n){for(var i=0;i<t.length;i++){var o=[];Q(t[i],o,r,n),e.push(o)}}function tt(t){return t/360+.5}function et(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function rt(t,e,r,n,i,o,a,s){if(n/=e,o>=(r/=e)&&a<n)return t;if(a<r||o>=n)return null;for(var l=[],u=0;u<t.length;u++){var c=t[u],h=c.geometry,p=c.type,d=0===i?c.minX:c.minY,f=0===i?c.maxX:c.maxY;if(d>=r&&f<n)l.push(c);else if(!(f<r||d>=n)){var m=[];if("Point"===p||"MultiPoint"===p)nt(h,m,r,n,i);else if("LineString"===p)it(h,m,r,n,i,!1,s.lineMetrics);else if("MultiLineString"===p)at(h,m,r,n,i,!1);else if("Polygon"===p)at(h,m,r,n,i,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var _=[];at(h[g],_,r,n,i,!0),_.length&&m.push(_)}if(m.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<m.length;g++)l.push(q(c.id,p,m[g],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),l.push(q(c.id,p,m,c.tags))}}}return l.length?l:null}function nt(t,e,r,n,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=r&&a<=n&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function it(t,e,r,n,i,o,a){for(var s,l,u=ot(t),c=0===i?lt:ut,h=t.start,p=0;p<t.length-3;p+=3){var d=t[p],f=t[p+1],m=t[p+2],g=t[p+3],_=t[p+4],v=0===i?d:f,y=0===i?g:_,x=!1;a&&(s=Math.sqrt(Math.pow(d-g,2)+Math.pow(f-_,2))),v<r?y>r&&(l=c(u,d,f,g,_,r),a&&(u.start=h+s*l)):v>n?y<n&&(l=c(u,d,f,g,_,n),a&&(u.start=h+s*l)):st(u,d,f,m),y<r&&v>=r&&(l=c(u,d,f,g,_,r),x=!0),y>n&&v<=n&&(l=c(u,d,f,g,_,n),x=!0),!o&&x&&(a&&(u.end=h+s*l),e.push(u),u=ot(t)),a&&(h+=s)}var b=t.length-3;d=t[b],f=t[b+1],m=t[b+2],(v=0===i?d:f)>=r&&v<=n&&st(u,d,f,m),b=u.length-3,o&&b>=3&&(u[b]!==u[0]||u[b+1]!==u[1])&&st(u,u[0],u[1],u[2]),u.length&&e.push(u)}function ot(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function at(t,e,r,n,i,o){for(var a=0;a<t.length;a++)it(t[a],e,r,n,i,o,!1)}function st(t,e,r,n){t.push(e),t.push(r),t.push(n)}function lt(t,e,r,n,i,o){var a=(o-e)/(n-e);return t.push(o),t.push(r+(i-r)*a),t.push(1),a}function ut(t,e,r,n,i,o){var a=(o-r)/(i-r);return t.push(e+(n-e)*a),t.push(o),t.push(1),a}function ct(t,e){for(var r=[],n=0;n<t.length;n++){var i,o=t[n],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=ht(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(ht(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(ht(o.geometry[s][u],e));i.push(l)}r.push(q(o.id,a,i,o.tags))}return r}function ht(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var n=0;n<t.length;n+=3)r.push(t[n]+e,t[n+1],t[n+2]);return r}function pt(t,e){if(t.transformed)return t;var r,n,i,o=1<<t.z,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var l=t.features[r],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(n=0;n<u.length;n+=2)l.geometry.push(dt(u[n],u[n+1],e,o,a,s));else for(n=0;n<u.length;n++){var h=[];for(i=0;i<u[n].length;i+=2)h.push(dt(u[n][i],u[n][i+1],e,o,a,s));l.geometry.push(h)}}return t.transformed=!0,t}function dt(t,e,r,n,i,o){return[Math.round(r*(t*n-i)),Math.round(r*(e*n-o))]}function ft(t,e,r,n,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,mt(a,t[s],o,i);var l=t[s].minX,u=t[s].minY,c=t[s].maxX,h=t[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function mt(t,e,r,n){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)gt(a,i,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)gt(a,i[s],t,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<i.length;l++){var u=i[l];for(s=0;s<u.length;s++)gt(a,u[s],t,r,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function gt(t,e,r,n,i,o){var a=n*n;if(n>0&&e.size<(i?a:n))r.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===n||e[l+2]>a)&&(r.numSimplified++,s.push(e[l]),s.push(e[l+1])),r.numPoints++;i&&function(t,e){for(var r=0,n=0,i=t.length,o=i-2;n<i;o=n,n+=2)r+=(t[n]-t[o])*(t[n+1]+t[o+1]);if(r>0===e)for(n=0,i=t.length;n<i/2;n+=2){var a=t[n],s=t[n+1];t[n]=t[i-2-n],t[n+1]=t[i-1-n],t[i-2-n]=a,t[i-1-n]=s}}(s,o),t.push(s)}}function _t(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)K(r,t.features[n],e,n);else K(r,"Feature"===t.type?t:{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(t,e){var r=e.buffer/e.extent,n=t,i=rt(t,1,-1-r,r,0,-1,2,e),o=rt(t,1,1-r,2+r,0,-1,2,e);return(i||o)&&(n=rt(t,1,-r,1+r,0,-1,2,e)||[],i&&(n=ct(i,1).concat(n)),o&&(n=n.concat(ct(o,-1)))),n}(n,e)).length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function vt(t,e,r){return 32*((1<<t)*r+e)+t}function yt(t,e){var r=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return e(null,null);var i=new m(n.features),o=x(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}F.prototype.load=function(t){var e=this.options,r=e.log,n=e.minZoom,i=e.maxZoom,o=e.nodeSize;r&&console.time("total time");var a="prepare "+t.length+" points";r&&console.time(a),this.points=t;for(var s=[],l=0;l<t.length;l++)t[l].geometry&&s.push(U(t[l],l));this.trees[i+1]=new B(s,W,X,o,Float32Array),r&&console.timeEnd(a);for(var u=i;u>=n;u--){var c=+Date.now();s=this._cluster(s,u),this.trees[u]=new B(s,W,X,o,Float32Array),r&&console.log("z%d: %d clusters in %dms",u,s.length,+Date.now()-c)}return r&&console.timeEnd("total time"),this},F.prototype.getClusters=function(t,e){var r=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,i=180;else if(r>i){var a=this.getClusters([r,n,180,o],e),s=this.getClusters([-180,n,i,o],e);return a.concat(s)}for(var l=this.trees[this._limitZoom(e)],u=[],c=0,h=l.range(j(r),V(o),j(i),V(n));c<h.length;c+=1){var p=l.points[h[c]];u.push(p.numPoints?z(p):this.points[p.index])}return u},F.prototype.getChildren=function(t){var e=this._getOriginId(t),r=this._getOriginZoom(t),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);var o=i.points[e];if(!o)throw new Error(n);for(var a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=[],l=0,u=i.within(o.x,o.y,a);l<u.length;l+=1){var c=i.points[u[l]];c.parentId===t&&s.push(c.numPoints?z(c):this.points[c.index])}if(0===s.length)throw new Error(n);return s},F.prototype.getLeaves=function(t,e,r){var n=[];return this._appendLeaves(n,t,e=e||10,r=r||0,0),n},F.prototype.getTile=function(t,e,r){var n=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.radius/o.extent,s=(r-a)/i,l=(r+1+a)/i,u={features:[]};return this._addTileFeatures(n.range((e-a)/i,s,(e+1+a)/i,l),n.points,e,r,i,u),0===e&&this._addTileFeatures(n.range(1-a/i,s,1,l),n.points,i,r,i,u),e===i-1&&this._addTileFeatures(n.range(0,s,a/i,l),n.points,-1,r,i,u),u.features.length?u:null},F.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id}return e},F.prototype._appendLeaves=function(t,e,r,n,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],l=s.properties;if(l&&l.cluster?i+l.point_count<=n?i+=l.point_count:i=this._appendLeaves(t,l.cluster_id,r,n,i):i<n?i++:t.push(s),t.length===r)break}return i},F.prototype._addTileFeatures=function(t,e,r,n,i,o){for(var a=0,s=t;a<s.length;a+=1){var l=e[s[a]],u=l.numPoints,c={type:1,geometry:[[Math.round(this.options.extent*(l.x*i-r)),Math.round(this.options.extent*(l.y*i-n))]],tags:u?G(l):this.points[l.index].properties},h=void 0;u?h=l.id:this.options.generateId?h=l.index:this.points[l.index].id&&(h=this.points[l.index].id),void 0!==h&&(c.id=h),o.features.push(c)}},F.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},F.prototype._cluster=function(t,e){for(var r=[],n=this.options,i=n.reduce,o=n.minPoints,a=n.radius/(n.extent*Math.pow(2,e)),s=0;s<t.length;s++){var l=t[s];if(!(l.zoom<=e)){l.zoom=e;for(var u=this.trees[e+1],c=u.within(l.x,l.y,a),h=l.numPoints||1,p=h,d=0,f=c;d<f.length;d+=1){var m=u.points[f[d]];m.zoom>e&&(p+=m.numPoints||1)}if(p>=o){for(var g=l.x*h,_=l.y*h,v=i&&h>1?this._map(l,!0):null,y=(s<<5)+(e+1)+this.points.length,x=0,b=c;x<b.length;x+=1){var E=u.points[b[x]];if(!(E.zoom<=e)){E.zoom=e;var T=E.numPoints||1;g+=E.x*T,_+=E.y*T,E.parentId=y,i&&(v||(v=this._map(l,!0)),i(v,this._map(E)))}}l.parentId=y,r.push(k(g/p,_/p,y,p,v))}else if(r.push(l),p>1)for(var S=0,A=c;S<A.length;S+=1){var w=u.points[A[S]];w.zoom<=e||(w.zoom=e,r.push(w))}}}return r},F.prototype._getOriginId=function(t){return t-this.points.length>>5},F.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},F.prototype._map=function(t,e){if(t.numPoints)return e?H({},t.properties):t.properties;var r=this.points[t.index].properties,n=this.options.map(r);return e&&n===r?H({},n):n},_t.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_t.prototype.splitTile=function(t,e,r,n,i,o,a){for(var s=[t,e,r,n],l=this.options,u=l.debug;s.length;){n=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=vt(e,r,n),p=this.tiles[h];if(!p&&(u>1&&console.time("creation"),p=this.tiles[h]=ft(t,e,r,n,l),this.tileCoords.push({z:e,x:r,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=t,i){if(e===l.maxZoom||e===i)continue;var f=1<<i-e;if(r!==Math.floor(o/f)||n!==Math.floor(a/f))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){u>1&&console.time("clipping");var m,g,_,v,y,x,b=.5*l.buffer/l.extent,E=.5-b,T=.5+b,S=1+b;m=g=_=v=null,y=rt(t,c,r-b,r+T,0,p.minX,p.maxX,l),x=rt(t,c,r+E,r+S,0,p.minX,p.maxX,l),t=null,y&&(m=rt(y,c,n-b,n+T,1,p.minY,p.maxY,l),g=rt(y,c,n+E,n+S,1,p.minY,p.maxY,l),y=null),x&&(_=rt(x,c,n-b,n+T,1,p.minY,p.maxY,l),v=rt(x,c,n+E,n+S,1,p.minY,p.maxY,l),x=null),u>1&&console.timeEnd("clipping"),s.push(m||[],e+1,2*r,2*n),s.push(g||[],e+1,2*r,2*n+1),s.push(_||[],e+1,2*r+1,2*n),s.push(v||[],e+1,2*r+1,2*n+1)}}},_t.prototype.getTile=function(t,e,r){var n=this.options,i=n.extent,o=n.debug;if(t<0||t>24)return null;var a=1<<t,s=vt(t,e=(e%a+a)%a,r);if(this.tiles[s])return pt(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var l,u=t,c=e,h=r;!l&&u>0;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[vt(u,c,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,c,h),o>1&&console.time("drilling down"),this.splitTile(l.source,u,c,h,t,e,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?pt(this.tiles[s],i):null):null};var xt=function(e){function r(t,r,n,i){e.call(this,t,r,n,yt),i&&(this.loadGeoJSON=i)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},r.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var r=this._pendingCallback,n=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(n&&n.request&&n.request.collectResourceTiming)&&new t.RequestPerformance(n.request);this.loadGeoJSON(n,(function(o,a){if(o||!a)return r(o);if("object"!=typeof a)return r(new Error("Input data given to '"+n.source+"' is not a valid GeoJSON object."));!function t(e,r){var n,i=e&&e.type;if("FeatureCollection"===i)for(n=0;n<e.features.length;n++)t(e.features[n],r);else if("GeometryCollection"===i)for(n=0;n<e.geometries.length;n++)t(e.geometries[n],r);else if("Feature"===i)t(e.geometry,r);else if("Polygon"===i)h(e.coordinates,r);else if("MultiPolygon"===i)for(n=0;n<e.coordinates.length;n++)h(e.coordinates[n],r);return e}(a,!0);try{if(n.filter){var s=t.createExpression(n.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(t){return t.key+": "+t.message})).join(", "));var l=a.features.filter((function(t){return s.value.evaluate({zoom:0},t)}));a={type:"FeatureCollection",features:l}}e._geoJSONIndex=n.cluster?new F(function(e){var r=e.superclusterOptions,n=e.clusterProperties;if(!n||!r)return r;for(var i={},o={},a={accumulated:null,zoom:0},s={properties:null},l=Object.keys(n),u=0,c=l;u<c.length;u+=1){var h=c[u],p=n[h],d=p[0],f=t.createExpression(p[1]),m=t.createExpression("string"==typeof d?[d,["accumulated"],["get",h]]:d);i[h]=f.value,o[h]=m.value}return r.map=function(t){s.properties=t;for(var e={},r=0,n=l;r<n.length;r+=1){var o=n[r];e[o]=i[o].evaluate(a,s)}return e},r.reduce=function(t,e){s.properties=e;for(var r=0,n=l;r<n.length;r+=1){var i=n[r];a.accumulated=t[i],t[i]=o[i].evaluate(a,s)}},r}(n)).load(a.features):function(t,e){return new _t(t,e)}(a,n.geojsonVtOptions)}catch(o){return r(o)}e.loaded={};var u={};if(i){var c=i.finish();c&&(u.resourceTiming={},u.resourceTiming[n.source]=JSON.parse(JSON.stringify(c)))}r(null,u)}))}},r.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},r.prototype.reloadTile=function(t,r){var n=this.loaded;return n&&n[t.uid]?e.prototype.reloadTile.call(this,t,r):this.loadTile(t,r)},r.prototype.loadGeoJSON=function(e,r){if(e.request)t.getJSON(e.request,r);else{if("string"!=typeof e.data)return r(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return r(null,JSON.parse(e.data))}catch(t){return r(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},r.prototype.getClusterExpansionZoom=function(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}},r.prototype.getClusterChildren=function(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}},r.prototype.getClusterLeaves=function(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}},r}(l),bt=function(e){var r=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:l,geojson:xt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(r.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');r.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return bt.prototype.setReferrer=function(t,e){this.referrer=e},bt.prototype.setImages=function(t,e,r){for(var n in this.availableImages[t]=e,this.workerSources[t]){var i=this.workerSources[t][n];for(var o in i)i[o].availableImages=e}r()},bt.prototype.setLayers=function(t,e,r){this.getLayerIndex(t).replace(e),r()},bt.prototype.updateLayers=function(t,e,r){this.getLayerIndex(t).update(e.layers,e.removedIds),r()},bt.prototype.loadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).loadTile(e,r)},bt.prototype.loadDEMTile=function(t,e,r){this.getDEMWorkerSource(t,e.source).loadTile(e,r)},bt.prototype.reloadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).reloadTile(e,r)},bt.prototype.abortTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).abortTile(e,r)},bt.prototype.removeTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).removeTile(e,r)},bt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},bt.prototype.removeSource=function(t,e,r){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var n=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,r):r()}},bt.prototype.loadWorkerSource=function(t,e,r){try{this.self.importScripts(e.url),r()}catch(t){r(t.toString())}},bt.prototype.syncRTLPluginState=function(e,r,n){try{t.plugin.setState(r);var i=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=i){this.self.importScripts(i);var o=t.plugin.isParsed();n(o?void 0:new Error("RTL Text Plugin failed to import scripts from "+i),o)}}catch(t){n(t.toString())}},bt.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},bt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new n),e},bt.prototype.getWorkerSource=function(t,e,r){var n=this;return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][r]||(this.workerSources[t][e][r]=new this.workerSourceTypes[e]({send:function(e,r,i){n.actor.send(e,r,i,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][r]},bt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new c),this.demWorkerSources[t][e]},bt.prototype.enforceCacheSizeLimit=function(e,r){t.enforceCacheSizeLimit(r)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new bt(self)),bt})),n(["./shared"],(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!r(t)}function r(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,r=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(r);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var r=e.getImageData(0,0,1,1);return r&&r.width===t.width}()?(void 0===n[r=t&&t.failIfMajorPerformanceCaveat]&&(n[r]=function(t){var r=function(t){var r=document.createElement("canvas"),n=Object.create(e.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,r.probablySupportsContext?r.probablySupportsContext("webgl",n)||r.probablySupportsContext("experimental-webgl",n):r.supportsContext?r.supportsContext("webgl",n)||r.supportsContext("experimental-webgl",n):r.getContext("webgl",n)||r.getContext("experimental-webgl",n)}(t);if(!r)return!1;var n=r.createShader(r.VERTEX_SHADER);return!(!n||r.isContextLost())&&(r.shaderSource(n,"void main() {}"),r.compileShader(n),!0===r.getShaderParameter(n,r.COMPILE_STATUS))}(r)),n[r]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var r}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e,window.mapboxgl.notSupportedReason=r);var n={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),r={create:function(e,r,n){var i=t.window.document.createElement(e);return void 0!==r&&(i.className=r),n&&n.appendChild(i),i},createNS:function(e,r){return t.window.document.createElementNS(e,r)}},n=t.window.document&&t.window.document.documentElement.style;function i(t){if(!n)return t[0];for(var e=0;e<t.length;e++)if(t[e]in n)return t[e];return t[0]}var o,a=i(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);r.disableDrag=function(){n&&a&&(o=n[a],n[a]="none")},r.enableDrag=function(){n&&a&&(n[a]=o)};var s=i(["transform","WebkitTransform"]);r.setTransform=function(t,e){t.style[s]=e};var l=!1;try{var u=Object.defineProperty({},"passive",{get:function(){l=!0}});t.window.addEventListener("test",u,u),t.window.removeEventListener("test",u,u)}catch(t){l=!1}r.addEventListener=function(t,e,r,n){void 0===n&&(n={}),t.addEventListener(e,r,"passive"in n&&l?n:n.capture)},r.removeEventListener=function(t,e,r,n){void 0===n&&(n={}),t.removeEventListener(e,r,"passive"in n&&l?n:n.capture)};var c=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",c,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}r.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",c,!0)}),0)},r.mousePos=function(e,r){var n=e.getBoundingClientRect();return new t.Point(r.clientX-n.left-e.clientLeft,r.clientY-n.top-e.clientTop)},r.touchPos=function(e,r){for(var n=e.getBoundingClientRect(),i=[],o=0;o<r.length;o++)i.push(new t.Point(r[o].clientX-n.left-e.clientLeft,r[o].clientY-n.top-e.clientTop));return i},r.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},r.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var p=function(e){function r(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.isLoaded=function(){return this.loaded},r.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,r=this.requestors;e<r.length;e+=1){var n=r[e];this._notify(n.ids,n.callback)}this.requestors=[]}},r.prototype.getImage=function(t){return this.images[t]},r.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},r.prototype._validate=function(e,r){var n=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),n=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),n=!1),this._validateContent(r.content,r)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),n=!1),n},r.prototype._validateStretch=function(t,e){if(!t)return!0;for(var r=0,n=0,i=t;n<i.length;n+=1){var o=i[n];if(o[0]<r||o[1]<o[0]||e<o[1])return!1;r=o[1]}return!0},r.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},r.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},r.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},r.prototype.listImages=function(){return Object.keys(this.images)},r.prototype.getImages=function(t,e){var r=!0;if(!this.isLoaded())for(var n=0,i=t;n<i.length;n+=1)this.images[i[n]]||(r=!1);this.isLoaded()||r?this._notify(t,e):this.requestors.push({ids:t,callback:e})},r.prototype._notify=function(e,r){for(var n={},i=0,o=e;i<o.length;i+=1){var a=o[i];this.images[a]||this.fire(new t.Event("styleimagemissing",{id:a}));var s=this.images[a];s?n[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}r(null,n)},r.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},r.prototype.getPattern=function(e){var r=this.patterns[e],n=this.getImage(e);if(!n)return null;if(r&&r.position.version===n.version)return r.position;if(r)r.position.version=n.version;else{var i={w:n.data.width+2,h:n.data.height+2,x:0,y:0},o=new t.ImagePosition(i,n);this.patterns[e]={bin:i,position:o}}return this._updatePatternAtlas(),this.patterns[e].position},r.prototype.bind=function(e){var r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)},r.prototype._updatePatternAtlas=function(){var e=[];for(var r in this.patterns)e.push(this.patterns[r].bin);var n=t.potpack(e),i=n.w,o=n.h,a=this.atlasImage;for(var s in a.resize({width:i||1,height:o||1}),this.patterns){var l=this.patterns[s].bin,u=l.x+1,c=l.y+1,h=this.images[s].data,p=h.width,d=h.height;t.RGBAImage.copy(h,a,{x:0,y:0},{x:u,y:c},{width:p,height:d}),t.RGBAImage.copy(h,a,{x:0,y:d-1},{x:u,y:c-1},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:u,y:c+d},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:p-1,y:0},{x:u-1,y:c},{width:1,height:d}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:u+p,y:c},{width:1,height:d})}this.dirty=!0},r.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},r.prototype.dispatchRenderCallbacks=function(t){for(var e=0,r=t;e<r.length;e+=1){var n=r[e];if(!this.callbackDispatchedThisFrame[n]){this.callbackDispatchedThisFrame[n]=!0;var i=this.images[n];h(i)&&this.updateImage(n,i)}}},r}(t.Evented),d=g,f=g,m=1e20;function g(t,e,r,n,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=n||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=r||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function _(t,e,r,n,i,o,a){for(var s=0;s<e;s++){for(var l=0;l<r;l++)n[l]=t[l*e+s];for(v(n,i,o,a,r),l=0;l<r;l++)t[l*e+s]=i[l]}for(l=0;l<r;l++){for(s=0;s<e;s++)n[s]=t[l*e+s];for(v(n,i,o,a,e),s=0;s<e;s++)t[l*e+s]=Math.sqrt(i[s])}}function v(t,e,r,n,i){r[0]=0,n[0]=-m,n[1]=+m;for(var o=1,a=0;o<i;o++){for(var s=(t[o]+o*o-(t[r[a]]+r[a]*r[a]))/(2*o-2*r[a]);s<=n[a];)a--,s=(t[o]+o*o-(t[r[a]]+r[a]*r[a]))/(2*o-2*r[a]);r[++a]=o,n[a]=s,n[a+1]=+m}for(o=0,a=0;o<i;o++){for(;n[a+1]<o;)a++;e[o]=(o-r[a])*(o-r[a])+t[r[a]]}}g.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),r=new Uint8ClampedArray(this.size*this.size),n=0;n<this.size*this.size;n++){var i=e.data[4*n+3]/255;this.gridOuter[n]=1===i?0:0===i?m:Math.pow(Math.max(0,.5-i),2),this.gridInner[n]=1===i?m:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(_(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),_(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),n=0;n<this.size*this.size;n++)r[n]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[n]-this.gridInner[n])/this.radius+this.cutoff))));return r},d.default=f;var y=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};y.prototype.setURL=function(t){this.url=t},y.prototype.getGlyphs=function(e,r){var n=this,i=[];for(var o in e)for(var a=0,s=e[o];a<s.length;a+=1)i.push({stack:o,id:s[a]});t.asyncAll(i,(function(t,e){var r=t.stack,i=t.id,o=n.entries[r];o||(o=n.entries[r]={glyphs:{},requests:{},ranges:{}});var a=o.glyphs[i];if(void 0===a){if(a=n._tinySDF(o,r,i))return o.glyphs[i]=a,void e(null,{stack:r,id:i,glyph:a});var s=Math.floor(i/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else if(o.ranges[s])e(null,{stack:r,id:i,glyph:a});else{var l=o.requests[s];l||(l=o.requests[s]=[],y.loadGlyphRange(r,s,n.url,n.requestManager,(function(t,e){if(e){for(var r in e)n._doesCharSupportLocalGlyph(+r)||(o.glyphs[+r]=e[+r]);o.ranges[s]=!0}for(var i=0,a=l;i<a.length;i+=1)(0,a[i])(t,e);delete o.requests[s]}))),l.push((function(t,n){t?e(t):n&&e(null,{stack:r,id:i,glyph:n[i]||null})}))}}else e(null,{stack:r,id:i,glyph:a})}),(function(t,e){if(t)r(t);else if(e){for(var n={},i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.stack,l=a.id,u=a.glyph;(n[s]||(n[s]={}))[l]=u&&{id:u.id,bitmap:u.bitmap.clone(),metrics:u.metrics}}r(null,n)}}))},y.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},y.prototype._tinySDF=function(e,r,n){var i=this.localIdeographFontFamily;if(i&&this._doesCharSupportLocalGlyph(n)){var o=e.tinySDF;if(!o){var a="400";/bold/i.test(r)?a="900":/medium/i.test(r)?a="500":/light/i.test(r)&&(a="200"),o=e.tinySDF=new y.TinySDF(24,3,8,.25,i,a)}return{id:n,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(n))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},y.loadGlyphRange=function(e,r,n,i,o){var a=256*r,s=a+255,l=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(l,(function(e,r){if(e)o(e);else if(r){for(var n={},i=0,a=t.parseGlyphPBF(r);i<a.length;i+=1){var s=a[i];n[s.id]=s}o(null,n)}}))},y.TinySDF=d;var x=function(){this.specification=t.styleSpec.light.position};x.prototype.possiblyEvaluate=function(e,r){return t.sphericalToCartesian(e.expression.evaluate(r))},x.prototype.interpolate=function(e,r,n){return{x:t.number(e.x,r.x,n),y:t.number(e.y,r.y,n),z:t.number(e.z,r.z,n)}};var b=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new x,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),E=function(e){function r(r){e.call(this),this._transitionable=new t.Transitionable(b),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getLight=function(){return this._transitionable.serialize()},r.prototype.setLight=function(e,r){if(void 0===r&&(r={}),!this._validate(t.validateLight,e,r))for(var n in e){var i=e[n];t.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-11),i):this._transitionable.setValue(n,i)}},r.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},r.prototype.hasTransition=function(){return this._transitioning.hasTransition()},r.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},r.prototype._validate=function(e,r,n){return(!n||!1!==n.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},r}(t.Evented),T=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};T.prototype.getDash=function(t,e){var r=t.join(",")+String(e);return this.dashEntry[r]||(this.dashEntry[r]=this.addDash(t,e)),this.dashEntry[r]},T.prototype.getDashRanges=function(t,e,r){var n=[],i=t.length%2==1?-t[t.length-1]*r:0,o=t[0]*r,a=!0;n.push({left:i,right:o,isDash:a,zeroLength:0===t[0]});for(var s=t[0],l=1;l<t.length;l++){var u=t[l];n.push({left:i=s*r,right:o=(s+=u)*r,isDash:a=!a,zeroLength:0===u})}return n},T.prototype.addRoundDash=function(t,e,r){for(var n=e/2,i=-r;i<=r;i++)for(var o=this.width*(this.nextRow+r+i),a=0,s=t[a],l=0;l<this.width;l++){l/s.right>1&&(s=t[++a]);var u=Math.abs(l-s.left),c=Math.abs(l-s.right),h=Math.min(u,c),p=void 0,d=i/r*(n+1);if(s.isDash){var f=n-Math.abs(d);p=Math.sqrt(h*h+f*f)}else p=n-Math.sqrt(h*h+d*d);this.data[o+l]=Math.max(0,Math.min(255,p+128))}},T.prototype.addRegularDash=function(t){for(var e=t.length-1;e>=0;--e){var r=t[e],n=t[e+1];r.zeroLength?t.splice(e,1):n&&n.isDash===r.isDash&&(n.left=r.left,t.splice(e,1))}var i=t[0],o=t[t.length-1];i.isDash===o.isDash&&(i.left=o.left-this.width,o.right=i.right+this.width);for(var a=this.width*this.nextRow,s=0,l=t[s],u=0;u<this.width;u++){u/l.right>1&&(l=t[++s]);var c=Math.abs(u-l.left),h=Math.abs(u-l.right),p=Math.min(c,h);this.data[a+u]=Math.max(0,Math.min(255,(l.isDash?p:-p)+128))}},T.prototype.addDash=function(e,r){var n=r?7:0,i=2*n+1;if(this.nextRow+i>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<e.length;a++)o+=e[a];if(0!==o){var s=this.width/o,l=this.getDashRanges(e,this.width,s);r?this.addRoundDash(l,s,n):this.addRegularDash(l)}var u={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:o};return this.nextRow+=i,this.dirty=!0,u},T.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))};var S=function e(r,n){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var i=this.workerPool.acquire(this.id),o=0;o<i.length;o++){var a=new e.Actor(i[o],n,this.id);a.name="Worker "+o,this.actors.push(a)}};function A(e,r,n){var i=function(i,o){if(i)return n(i);if(o){var a=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(a.vectorLayers=o.vector_layers,a.vectorLayerIds=a.vectorLayers.map((function(t){return t.id}))),a.tiles=r.canonicalizeTileset(a,e.url),n(null,a)}};return e.url?t.getJSON(r.transformRequest(r.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.browser.frame((function(){return i(null,e)}))}S.prototype.broadcast=function(e,r,n){t.asyncAll(this.actors,(function(t,n){t.send(e,r,n)}),n=n||function(){})},S.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},S.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},S.Actor=t.Actor;var w=function(e,r,n){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=n||24};w.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},w.prototype.contains=function(e){var r=Math.pow(2,e.z),n=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*r),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*r),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*r),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*r);return e.x>=n&&e.x<o&&e.y>=i&&e.y<a};var C=function(e){function r(r,n,i,o){if(e.call(this),this.id=r,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(n,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=A(this._options,this.map._requestManager,(function(r,n){e._tileJSONRequest=null,e._loaded=!0,r?e.fire(new t.ErrorEvent(r)):n&&(t.extend(e,n),n.bounds&&(e.tileBounds=new w(n.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(n.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(n.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},r.prototype.loaded=function(){return this._loaded},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setSourceProperty=function(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},r.prototype.setTiles=function(t){var e=this;return this.setSourceProperty((function(){e._options.tiles=t})),this},r.prototype.setUrl=function(t){var e=this;return this.setSourceProperty((function(){e.url=t,e._options.url=t})),this},r.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},r.prototype.serialize=function(){return t.extend({},this._options)},r.prototype.loadTile=function(e,r){var n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function o(n,i){return delete e.request,e.aborted?r(null):n&&404!==n.status?r(n):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=r:e.request=e.actor.send("reloadTile",i,o.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",i,o.bind(this)))},r.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},r.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},r.prototype.hasTransition=function(){return!1},r}(t.Evented),R=function(e){function r(r,n,i,o){e.call(this),this.id=r,this.dispatcher=i,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},n),t.extend(this,t.pick(n,["url","scheme","tileSize"]))}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=A(this._options,this.map._requestManager,(function(r,n){e._tileJSONRequest=null,e._loaded=!0,r?e.fire(new t.ErrorEvent(r)):n&&(t.extend(e,n),n.bounds&&(e.tileBounds=new w(n.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(n.tiles),t.postMapLoadEvent(n.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},r.prototype.loaded=function(){return this._loaded},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},r.prototype.serialize=function(){return t.extend({},this._options)},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.loadTile=function(e,r){var n=this,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),(function(i,o){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(i)e.state="errored",r(i);else if(o){n.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=n.map.painter.context,s=a.gl;e.texture=n.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.Texture(a,o,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(n.dispatcher),r(null)}}))},r.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},r.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},r.prototype.hasTransition=function(){return!1},r}(t.Evented),L=function(e){function r(r,n,i,o){e.call(this,r,n,i,o),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},r.prototype.loadTile=function(e,r){var n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function i(t,n){t&&(e.state="errored",r(t)),n&&(e.dem=n,e.needsHillshadePrepare=!0,e.state="loaded",r(null))}e.request=t.getImage(this.map._requestManager.transformRequest(n,t.ResourceType.Tile),function(n,o){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(n)e.state="errored",r(n);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported()?o:t.browser.getImageData(o,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:a,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,i.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},r.prototype._getNeighboringTiles=function(e){var r=e.canonical,n=Math.pow(2,r.z),i=(r.x-1+n)%n,o=0===r.x?e.wrap-1:e.wrap,a=(r.x+1+n)%n,s=r.x+1===n?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,o,r.z,i,r.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,r.z,a,r.y).key]={backfilled:!1},r.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,o,r.z,i,r.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,r.z,a,r.y-1).key]={backfilled:!1}),r.y+1<n&&(l[new t.OverscaledTileID(e.overscaledZ,o,r.z,i,r.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,r.z,a,r.y+1).key]={backfilled:!1}),l},r.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},r}(R),I=function(e){function r(r,n,i,o){e.call(this),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(o),this._data=n.data,this._options=t.extend({},n),this._collectResourceTiming=n.collectResourceTiming,this._resourceTiming=[],void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;var a=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*a,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*a,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?Math.min(n.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:t.EXTENT,radius:(n.clusterRadius||50)*a,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(r){if(r)e.fire(new t.ErrorEvent(r));else{var n={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(n.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",n))}}))},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setData=function(e){var r=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)r.fire(new t.ErrorEvent(e));else{var n={dataType:"source",sourceDataType:"content"};r._collectResourceTiming&&r._resourceTiming&&r._resourceTiming.length>0&&(n.resourceTiming=r._resourceTiming,r._resourceTiming=[]),r.fire(new t.Event("data",n))}})),this},r.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},r.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},r.prototype.getClusterLeaves=function(t,e,r,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:r},n),this},r.prototype._updateWorkerData=function(e){var r=this;this._loaded=!1;var n=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(n.request=this.map._requestManager.transformRequest(t.browser.resolveURL(i),t.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(i),this.actor.send(this.type+".loadData",n,(function(t,i){r._removed||i&&i.abandoned||(r._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[r.id]&&(r._resourceTiming=i.resourceTiming[r.id].slice(0)),r.actor.send(r.type+".coalesce",{source:n.source},null),e(t))}))},r.prototype.loaded=function(){return this._loaded},r.prototype.loadTile=function(e,r){var n=this,i=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(i,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(t,o){return delete e.request,e.unloadVectorData(),e.aborted?r(null):t?r(t):(e.loadVectorData(o,n.map.painter,"reloadTile"===i),r(null))}))},r.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},r.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},r.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},r.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},r.prototype.hasTransition=function(){return!1},r}(t.Evented),M=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),O=function(e){function r(t,r,n,i){e.call(this),this.id=t,this.dispatcher=n,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=r}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(e,r){var n=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(i,o){n._loaded=!0,i?n.fire(new t.ErrorEvent(i)):o&&(n.image=o,e&&(n.coordinates=e),r&&r(),n._finishLoading())}))},r.prototype.loaded=function(){return this._loaded},r.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},r.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setCoordinates=function(e){var r=this;this.coordinates=e;var n=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var r=1/0,n=1/0,i=-1/0,o=-1/0,a=0,s=e;a<s.length;a+=1){var l=s[a];r=Math.min(r,l.x),n=Math.min(n,l.y),i=Math.max(i,l.x),o=Math.max(o,l.y)}var u=Math.max(i-r,o-n),c=Math.max(0,Math.floor(-Math.log(u)/Math.LN2)),h=Math.pow(2,c);return new t.CanonicalTileID(c,Math.floor((r+i)/2*h),Math.floor((n+o)/2*h))}(n),this.minzoom=this.maxzoom=this.tileID.z;var i=n.map((function(t){return r.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},r.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,r=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,M.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[n];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},r.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},r.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},r.prototype.hasTransition=function(){return!1},r}(t.Evented),P=function(e){function r(t,r,n,i){e.call(this,t,r,n,i),this.roundZoom=!0,this.type="video",this.options=r}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this._loaded=!1;var r=this.options;this.urls=[];for(var n=0,i=r.urls;n<i.length;n+=1)this.urls.push(this.map._requestManager.transformRequest(i[n],t.ResourceType.Source).url);t.getVideo(this.urls,(function(r,n){e._loaded=!0,r?e.fire(new t.ErrorEvent(r)):n&&(e.video=n,e.video.loop=!0,e.video.setAttribute("playsinline",""),e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},r.prototype.pause=function(){this.video&&this.video.pause()},r.prototype.play=function(){this.video&&this.video.play()},r.prototype.seek=function(e){if(this.video){var r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+r.start(0)+" and "+r.end(0)+"-second mark."))):this.video.currentTime=e}},r.prototype.getVideo=function(){return this.video},r.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},r.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,r=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,M.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[n];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},r.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},r.prototype.hasTransition=function(){return this.video&&!this.video.paused},r}(O),D=function(e){function r(r,n,i,o){e.call(this,r,n,i,o),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},r.prototype.getCanvas=function(){return this.canvas},r.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},r.prototype.onRemove=function(){this.pause()},r.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var r=this.map.painter.context,n=r.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,M.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(r,this.canvas,n.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[i];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},r.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},r.prototype.hasTransition=function(){return this._playing},r.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var r=e[t];if(isNaN(r)||r<=0)return!0}return!1},r}(O),B={vector:C,raster:R,"raster-dem":L,geojson:I,video:P,image:O,canvas:D};function N(e,r){var n=t.identity([]);return t.translate(n,n,[1,1,0]),t.scale(n,n,[.5*e.width,.5*e.height,1]),t.multiply(n,n,e.calculatePosMatrix(r.toUnwrapped()))}function F(t,e,r,n,i,o){var a=function(t,e,r){if(t)for(var n=0,i=t;n<i.length;n+=1){var o=e[i[n]];if(o&&o.source===r&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===r&&"fill-extrusion"===s.type)return!0}return!1}(i&&i.layers,e,t.id),s=o.maxPitchScaleFactor(),l=t.tilesIn(n,s,a);l.sort(k);for(var u=[],c=0,h=l;c<h.length;c+=1){var p=h[c];u.push({wrappedTileID:p.tileID.wrapped().key,queryResults:p.tile.queryRenderedFeatures(e,r,t._state,p.queryGeometry,p.cameraQueryGeometry,p.scale,i,o,s,N(t.transform,p.tileID))})}var d=function(t){for(var e={},r={},n=0,i=t;n<i.length;n+=1){var o=i[n],a=o.queryResults,s=o.wrappedTileID,l=r[s]=r[s]||{};for(var u in a)for(var c=a[u],h=l[u]=l[u]||{},p=e[u]=e[u]||[],d=0,f=c;d<f.length;d+=1){var m=f[d];h[m.featureIndex]||(h[m.featureIndex]=!0,p.push(m))}}return e}(u);for(var f in d)d[f].forEach((function(e){var r=e.feature,n=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=n}));return d}function k(t,e){var r=t.tileID,n=e.tileID;return r.overscaledZ-n.overscaledZ||r.canonical.y-n.canonical.y||r.wrap-n.wrap||r.canonical.x-n.canonical.x}var U=function(t,e){this.max=t,this.onRemove=e,this.reset()};U.prototype.reset=function(){for(var t in this.data)for(var e=0,r=this.data[t];e<r.length;e+=1){var n=r[e];n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value)}return this.data={},this.order=[],this},U.prototype.add=function(t,e,r){var n=this,i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var o={value:e,timeout:void 0};if(void 0!==r&&(o.timeout=setTimeout((function(){n.remove(t,o)}),r)),this.data[i].push(o),this.order.push(i),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},U.prototype.has=function(t){return t.wrapped().key in this.data},U.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},U.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},U.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},U.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},U.prototype.remove=function(t,e){if(!this.has(t))return this;var r=t.wrapped().key,n=void 0===e?0:this.data[r].indexOf(e),i=this.data[r][n];return this.data[r].splice(n,1),i.timeout&&clearTimeout(i.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(i.value),this.order.splice(this.order.indexOf(r),1),this},U.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},U.prototype.filter=function(t){var e=[];for(var r in this.data)for(var n=0,i=this.data[r];n<i.length;n+=1){var o=i[n];t(o.value)||e.push(o)}for(var a=0,s=e;a<s.length;a+=1){var l=s[a];this.remove(l.value.tileID,l)}};var z=function(t,e,r){this.context=t;var n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};z.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},z.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},z.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var G={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},j=function(t,e,r,n){this.length=e.length,this.attributes=r,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.context=t;var i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};j.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},j.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},j.prototype.enableAttributes=function(t,e){for(var r=0;r<this.attributes.length;r++){var n=e.attributes[this.attributes[r].name];void 0!==n&&t.enableVertexAttribArray(n)}},j.prototype.setVertexAttribPointers=function(t,e,r){for(var n=0;n<this.attributes.length;n++){var i=this.attributes[n],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[G[i.type]],!1,this.itemSize,i.offset+this.itemSize*(r||0))}},j.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var V=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};V.prototype.get=function(){return this.current},V.prototype.set=function(t){},V.prototype.getDefault=function(){return this.default},V.prototype.setDefault=function(){this.set(this.default)};var H=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getDefault=function(){return t.Color.transparent},r.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},r}(V),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(V),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(V),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(V),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(V),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(V),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(V),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(V),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(V),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(V),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(V),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(V),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(V),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(V),it=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getDefault=function(){return t.Color.transparent},r.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},r}(V),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(V),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(V),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(V),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(V),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(V),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(V),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(V),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(V),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(V),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(V),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(V),gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(V),_t=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(V),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(V),yt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(V),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(V),bt=function(t){function e(e,r){t.call(this,e),this.context=e,this.parent=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(V),Et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(bt),Tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(bt),St=function(t,e,r,n){this.context=t,this.width=e,this.height=r;var i=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Et(t,i),n&&(this.depthAttachment=new Tt(t,i))};St.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}t.deleteFramebuffer(this.framebuffer)};var At=function(t,e,r){this.func=t,this.mask=e,this.range=r};At.ReadOnly=!1,At.ReadWrite=!0,At.disabled=new At(519,At.ReadOnly,[0,1]);var wt=function(t,e,r,n,i,o){this.test=t,this.ref=e,this.mask=r,this.fail=n,this.depthFail=i,this.pass=o};wt.disabled=new wt({func:519,mask:0},0,0,7680,7680,7680);var Ct=function(t,e,r){this.blendFunction=t,this.blendColor=e,this.mask=r};Ct.disabled=new Ct(Ct.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Ct.unblended=new Ct(Ct.Replace,t.Color.transparent,[!0,!0,!0,!0]),Ct.alphaBlended=new Ct([1,771],t.Color.transparent,[!0,!0,!0,!0]);var Rt=function(t,e,r){this.enable=t,this.mode=e,this.frontFace=r};Rt.disabled=new Rt(!1,1029,2305),Rt.backCCW=new Rt(!0,1029,2305);var Lt=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new H(this),this.clearDepth=new W(this),this.clearStencil=new X(this),this.colorMask=new Z(this),this.depthMask=new q(this),this.stencilMask=new Y(this),this.stencilFunc=new K(this),this.stencilOp=new $(this),this.stencilTest=new Q(this),this.depthRange=new J(this),this.depthTest=new tt(this),this.depthFunc=new et(this),this.blend=new rt(this),this.blendFunc=new nt(this),this.blendColor=new it(this),this.blendEquation=new ot(this),this.cullFace=new at(this),this.cullFaceSide=new st(this),this.frontFace=new lt(this),this.program=new ut(this),this.activeTexture=new ct(this),this.viewport=new ht(this),this.bindFramebuffer=new pt(this),this.bindRenderbuffer=new dt(this),this.bindTexture=new ft(this),this.bindVertexBuffer=new mt(this),this.bindElementBuffer=new gt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new _t(this),this.pixelStoreUnpack=new vt(this),this.pixelStoreUnpackPremultiplyAlpha=new yt(this),this.pixelStoreUnpackFlipY=new xt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)};Lt.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Lt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Lt.prototype.createIndexBuffer=function(t,e){return new z(this,t,e)},Lt.prototype.createVertexBuffer=function(t,e,r){return new j(this,t,e,r)},Lt.prototype.createRenderbuffer=function(t,e,r){var n=this.gl,i=n.createRenderbuffer();return this.bindRenderbuffer.set(i),n.renderbufferStorage(n.RENDERBUFFER,t,e,r),this.bindRenderbuffer.set(null),i},Lt.prototype.createFramebuffer=function(t,e,r){return new St(this,t,e,r)},Lt.prototype.clear=function(t){var e=t.color,r=t.depth,n=this.gl,i=0;e&&(i|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==r&&(i|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),n.clear(i)},Lt.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},Lt.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},Lt.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},Lt.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Ct.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},Lt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var It=function(e){function r(r,n,i){var o=this;e.call(this),this.id=r,this.dispatcher=i,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),this.on("error",(function(){o._sourceErrored=!0})),this._source=function(e,r,n,i){var o=new B[r.type](e,r,n,i);if(o.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+o.id);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o}(r,n,i,this),this._tiles={},this._cache=new U(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},r.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},r.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},r.prototype.getSource=function(){return this._source},r.prototype.pause=function(){this._paused=!0},r.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},r.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},r.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},r.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},r.prototype.serialize=function(){return this._source.serialize()},r.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var r=this._tiles[e];r.upload(t),r.prepare(this.map.style.imageManager)}},r.prototype.getIds=function(){return t.values(this._tiles).map((function(t){return t.tileID})).sort(Mt).map((function(t){return t.key}))},r.prototype.getRenderableIds=function(e){var r=this,n=[];for(var i in this._tiles)this._isIdRenderable(i,e)&&n.push(this._tiles[i]);return e?n.sort((function(e,n){var i=e.tileID,o=n.tileID,a=new t.Point(i.canonical.x,i.canonical.y)._rotate(r.transform.angle),s=new t.Point(o.canonical.x,o.canonical.y)._rotate(r.transform.angle);return i.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x})).map((function(t){return t.tileID.key})):n.map((function(t){return t.tileID})).sort(Mt).map((function(t){return t.key}))},r.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},r.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},r.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},r.prototype._reloadTile=function(t,e){var r=this._tiles[t];r&&("loading"!==r.state&&(r.state=e),this._loadTile(r,this._tileLoaded.bind(this,r,t,e)))},r.prototype._tileLoaded=function(e,r,n,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new t.ErrorEvent(i,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},r.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),r=0;r<e.length;r++){var n=e[r];if(t.neighboringTiles&&t.neighboringTiles[n]){var i=this.getTileByID(n);o(t,i),o(i,t)}}function o(t,e){t.needsHillshadePrepare=!0;var r=e.tileID.canonical.x-t.tileID.canonical.x,n=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===r&&0===n||Math.abs(n)>1||(Math.abs(r)>1&&(1===Math.abs(r+i)?r+=i:1===Math.abs(r-i)&&(r-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,r,n),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},r.prototype.getTile=function(t){return this.getTileByID(t.key)},r.prototype.getTileByID=function(t){return this._tiles[t]},r.prototype._retainLoadedChildren=function(t,e,r,n){for(var i in this._tiles){var o=this._tiles[i];if(!(n[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>r)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var l=a;l.overscaledZ>e;)if(t[(l=l.scaledTo(l.overscaledZ-1)).key]){n[a.key]=a;break}}}},r.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var r=this._loadedParentTiles[t.key];return r&&r.tileID.overscaledZ>=e?r:null}for(var n=t.overscaledZ-1;n>=e;n--){var i=t.scaledTo(n),o=this._getLoadedTile(i);if(o)return o}},r.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},r.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,r=Math.ceil(t.height/this._source.tileSize)+1,n=Math.floor(e*r*5),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(i)},r.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var r={};for(var n in this._tiles){var i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),r[i.tileID.key]=i}for(var o in this._tiles=r,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var a in this._tiles)this._setTileReloadTimer(a,this._tiles[a])}},r.prototype.update=function(e){var n=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter((function(t){return n._source.hasTile(t)})))):i=[];var o=e.coveringZoomLevel(this._source),a=Math.max(o-r.maxOverzooming,this._source.minzoom),s=Math.max(o+r.maxUnderzooming,this._source.minzoom),l=this._updateRetainedTiles(i,o);if(Ot(this._source.type)){for(var u={},c={},h=0,p=Object.keys(l);h<p.length;h+=1){var d=p[h],f=l[d],m=this._tiles[d];if(m&&!(m.fadeEndTime&&m.fadeEndTime<=t.browser.now())){var g=this.findLoadedParent(f,a);g&&(this._addTile(g.tileID),u[g.tileID.key]=g.tileID),c[d]=f}}for(var _ in this._retainLoadedChildren(c,o,s,l),u)l[_]||(this._coveredTiles[_]=!0,l[_]=u[_])}for(var v in l)this._tiles[v].clearFadeHold();for(var y=0,x=t.keysDifference(this._tiles,l);y<x.length;y+=1){var b=x[y],E=this._tiles[b];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(b)}this._updateLoadedParentTileCache()}},r.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},r.prototype._updateRetainedTiles=function(t,e){for(var n={},i={},o=Math.max(e-r.maxOverzooming,this._source.minzoom),a=Math.max(e+r.maxUnderzooming,this._source.minzoom),s={},l=0,u=t;l<u.length;l+=1){var c=u[l],h=this._addTile(c);n[c.key]=c,h.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,a,n);for(var p=0,d=t;p<d.length;p+=1){var f=d[p],m=this._tiles[f.key];if(!m.hasData()){if(e+1>this._source.maxzoom){var g=f.children(this._source.maxzoom)[0],_=this.getTile(g);if(_&&_.hasData()){n[g.key]=g;continue}}else{var v=f.children(this._source.maxzoom);if(n[v[0].key]&&n[v[1].key]&&n[v[2].key]&&n[v[3].key])continue}for(var y=m.wasRequested(),x=f.overscaledZ-1;x>=o;--x){var b=f.scaledTo(x);if(i[b.key])break;if(i[b.key]=!0,!(m=this.getTile(b))&&y&&(m=this._addTile(b)),m&&(n[b.key]=b,y=m.wasRequested(),m.hasData()))break}}}return n},r.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],r=void 0,n=this._tiles[t].tileID;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}e.push(n.key);var i=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(i))break;n=i}for(var o=0,a=e;o<a.length;o+=1)this._loadedParentTiles[a[o]]=r}},r.prototype._addTile=function(e){var r=this._tiles[e.key];if(r)return r;(r=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));var n=Boolean(r);return n||(r=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))),r?(r.uses++,this._tiles[e.key]=r,n||this._source.fire(new t.Event("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null},r.prototype._setTileReloadTimer=function(t,e){var r=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout((function(){r._reloadTile(t,"expired"),delete r._timers[t]}),n))},r.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},r.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},r.prototype.tilesIn=function(e,r,n){var i=this,o=[],a=this.transform;if(!a)return o;for(var s=n?a.getCameraQueryGeometry(e):e,l=e.map((function(t){return a.pointCoordinate(t)})),u=s.map((function(t){return a.pointCoordinate(t)})),c=this.getIds(),h=1/0,p=1/0,d=-1/0,f=-1/0,m=0,g=u;m<g.length;m+=1){var _=g[m];h=Math.min(h,_.x),p=Math.min(p,_.y),d=Math.max(d,_.x),f=Math.max(f,_.y)}for(var v=function(e){var n=i._tiles[c[e]];if(!n.holdingForFade()){var s=n.tileID,m=Math.pow(2,a.zoom-n.tileID.overscaledZ),g=r*n.queryPadding*t.EXTENT/n.tileSize/m,_=[s.getTilePoint(new t.MercatorCoordinate(h,p)),s.getTilePoint(new t.MercatorCoordinate(d,f))];if(_[0].x-g<t.EXTENT&&_[0].y-g<t.EXTENT&&_[1].x+g>=0&&_[1].y+g>=0){var v=l.map((function(t){return s.getTilePoint(t)})),y=u.map((function(t){return s.getTilePoint(t)}));o.push({tile:n,tileID:s,queryGeometry:v,cameraQueryGeometry:y,scale:m})}}},y=0;y<c.length;y++)v(y);return o},r.prototype.getVisibleCoordinates=function(t){for(var e=this,r=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),n=0,i=r;n<i.length;n+=1){var o=i[n];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return r},r.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Ot(this._source.type))for(var e in this._tiles){var r=this._tiles[e];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=t.browser.now())return!0}return!1},r.prototype.setFeatureState=function(t,e,r){this._state.updateState(t=t||"_geojsonTileLayer",e,r)},r.prototype.removeFeatureState=function(t,e,r){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,r)},r.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},r.prototype.setDependencies=function(t,e,r){var n=this._tiles[t];n&&n.setDependencies(e,r)},r.prototype.reloadTilesForDependencies=function(t,e){for(var r in this._tiles)this._tiles[r].hasDependency(t,e)&&this._reloadTile(r,"reloading");this._cache.filter((function(r){return!r.hasDependency(t,e)}))},r}(t.Evented);function Mt(t,e){var r=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Ot(t){return"raster"===t||"image"===t||"video"===t}function Pt(){return new t.window.Worker(Yi.workerUrl)}It.maxOverzooming=10,It.maxUnderzooming=3;var Dt="mapboxgl_preloaded_worker_pool",Bt=function(){this.active={}};Bt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Bt.workerCount;)this.workers.push(new Pt);return this.active[t]=!0,this.workers.slice()},Bt.prototype.release=function(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},Bt.prototype.isPreloaded=function(){return!!this.active[Dt]},Bt.prototype.numActive=function(){return Object.keys(this.active).length};var Nt,Ft=Math.floor(t.browser.hardwareConcurrency/2);function kt(){return Nt||(Nt=new Bt),Nt}function Ut(e,r){var n={};for(var i in e)"ref"!==i&&(n[i]=e[i]);return t.refProperties.forEach((function(t){t in r&&(n[t]=r[t])})),n}function zt(t){t=t.slice();for(var e=Object.create(null),r=0;r<t.length;r++)e[t[r].id]=t[r];for(var n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=Ut(t[n],e[t[n].ref]));return t}Bt.workerCount=Math.max(Math.min(Ft,6),1);var Gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function jt(t,e,r){r.push({command:Gt.addSource,args:[t,e[t]]})}function Vt(t,e,r){e.push({command:Gt.removeSource,args:[t]}),r[t]=!0}function Ht(t,e,r,n){Vt(t,r,n),jt(t,e,r)}function Wt(e,r,n){var i;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[n][i],r[n][i]))return!1;for(i in r[n])if(r[n].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[n][i],r[n][i]))return!1;return!0}function Xt(e,r,n,i,o,a){var s;for(s in r=r||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],r[s])||n.push({command:a,args:[i,s,r[s],o]}));for(s in r)r.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],r[s])||n.push({command:a,args:[i,s,r[s],o]}))}function Zt(t){return t.id}function qt(t,e){return t[e.id]=e,t}var Yt=function(t,e){this.reset(t,e)};Yt.prototype.reset=function(t,e){this.points=t||[],this._distances=[0];for(var r=1;r<this.points.length;r++)this._distances[r]=this._distances[r-1]+this.points[r].dist(this.points[r-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Yt.prototype.lerp=function(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);for(var r=1,n=this._distances[r],i=e*this.paddedLength+this.padding;n<i&&r<this._distances.length;)n=this._distances[++r];var o=r-1,a=this._distances[o],s=n-a,l=s>0?(i-a)/s:0;return this.points[o].mult(1-l).add(this.points[r].mult(l))};var Kt=function(t,e,r){var n=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(e/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)n.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function $t(e,r,n,i,o){var a=t.create();return r?(t.scale(a,a,[1/o,1/o,1]),n||t.rotateZ(a,a,i.angle)):t.multiply(a,i.labelPlaneMatrix,e),a}function Qt(e,r,n,i,o){if(r){var a=t.clone(e);return t.scale(a,a,[o,o,1]),n||t.rotateZ(a,a,-i.angle),a}return i.glCoordMatrix}function Jt(e,r){var n=[e.x,e.y,0,1];ce(n,n,r);var i=n[3];return{point:new t.Point(n[0]/i,n[1]/i),signedDistanceFromCamera:i}}function te(t,e){return.5+t/e*.5}function ee(t,e){var r=t[0]/t[3],n=t[1]/t[3];return r>=-e[0]&&r<=e[0]&&n>=-e[1]&&n<=e[1]}function re(e,r,n,i,o,a,s,l){var u=i?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(u,n.transform.zoom),h=[256/n.width*2+1,256/n.height*2+1],p=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var d=e.lineVertexArray,f=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,m=n.transform.width/n.transform.height,g=!1,_=0;_<f.length;_++){var v=f.get(_);if(v.hidden||v.writingMode===t.WritingMode.vertical&&!g)ue(v.numGlyphs,p);else{g=!1;var y=[v.anchorX,v.anchorY,0,1];if(t.transformMat4(y,y,r),ee(y,h)){var x=te(n.transform.cameraToCenterDistance,y[3]),b=t.evaluateSizeForFeature(u,c,v),E=s?b/x:b*x,T=new t.Point(v.anchorX,v.anchorY),S=Jt(T,o).point,A={},w=oe(v,E,!1,l,r,o,a,e.glyphOffsetArray,d,p,S,T,A,m);g=w.useVertical,(w.notEnoughRoom||g||w.needsFlipping&&oe(v,E,!0,l,r,o,a,e.glyphOffsetArray,d,p,S,T,A,m).notEnoughRoom)&&ue(v.numGlyphs,p)}else ue(v.numGlyphs,p)}}i?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function ne(t,e,r,n,i,o,a,s,l,u,c){var h=s.glyphStartIndex+s.numGlyphs,p=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,f=e.getoffsetX(s.glyphStartIndex),m=e.getoffsetX(h-1),g=se(t*f,r,n,i,o,a,s.segment,p,d,l,u,c);if(!g)return null;var _=se(t*m,r,n,i,o,a,s.segment,p,d,l,u,c);return _?{first:g,last:_}:null}function ie(e,r,n,i){return e===t.WritingMode.horizontal&&Math.abs(n.y-r.y)>Math.abs(n.x-r.x)*i?{useVertical:!0}:(e===t.WritingMode.vertical?r.y<n.y:r.x>n.x)?{needsFlipping:!0}:null}function oe(e,r,n,i,o,a,s,l,u,c,h,p,d,f){var m,g=r/24,_=e.lineOffsetX*g,v=e.lineOffsetY*g;if(e.numGlyphs>1){var y=e.glyphStartIndex+e.numGlyphs,x=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,E=ne(g,l,_,v,n,h,p,e,u,a,d);if(!E)return{notEnoughRoom:!0};var T=Jt(E.first.point,s).point,S=Jt(E.last.point,s).point;if(i&&!n){var A=ie(e.writingMode,T,S,f);if(A)return A}m=[E.first];for(var w=e.glyphStartIndex+1;w<y-1;w++)m.push(se(g*l.getoffsetX(w),_,v,n,h,p,e.segment,x,b,u,a,d));m.push(E.last)}else{if(i&&!n){var C=Jt(p,o).point,R=e.lineStartIndex+e.segment+1,L=new t.Point(u.getx(R),u.gety(R)),I=Jt(L,o),M=I.signedDistanceFromCamera>0?I.point:ae(p,L,C,1,o),O=ie(e.writingMode,C,M,f);if(O)return O}var P=se(g*l.getoffsetX(e.glyphStartIndex),_,v,n,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,u,a,d);if(!P)return{notEnoughRoom:!0};m=[P]}for(var D=0,B=m;D<B.length;D+=1){var N=B[D];t.addDynamicAttributes(c,N.point,N.angle)}return{}}function ae(t,e,r,n,i){var o=Jt(t.add(t.sub(e)._unit()),i).point,a=r.sub(o);return r.add(a._mult(n/a.mag()))}function se(e,r,n,i,o,a,s,l,u,c,h,p){var d=i?e-r:e+r,f=d>0?1:-1,m=0;i&&(f*=-1,m=Math.PI),f<0&&(m+=Math.PI);for(var g=f>0?l+s:l+s+1,_=o,v=o,y=0,x=0,b=Math.abs(d),E=[];y+x<=b;){if((g+=f)<l||g>=u)return null;if(v=_,E.push(_),void 0===(_=p[g])){var T=new t.Point(c.getx(g),c.gety(g)),S=Jt(T,h);if(S.signedDistanceFromCamera>0)_=p[g]=S.point;else{var A=g-f;_=ae(0===y?a:new t.Point(c.getx(A),c.gety(A)),T,v,b-y+1,h)}}y+=x,x=v.dist(_)}var w=(b-y)/x,C=_.sub(v),R=C.mult(w)._add(v);R._add(C._unit()._perp()._mult(n*f));var L=m+Math.atan2(_.y-v.y,_.x-v.x);return E.push(R),{point:R,angle:L,path:E}}Kt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Kt.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},Kt.prototype.insertCircle=function(t,e,r,n){this._forEachCell(e-n,r-n,e+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(r),this.circles.push(n)},Kt.prototype._insertBoxCell=function(t,e,r,n,i,o){this.boxCells[i].push(o)},Kt.prototype._insertCircleCell=function(t,e,r,n,i,o){this.circleCells[i].push(o)},Kt.prototype._query=function(t,e,r,n,i,o){if(r<0||t>this.width||n<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=r&&this.height<=n){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var u=this.circles[3*l],c=this.circles[3*l+1],h=this.circles[3*l+2];a.push({key:this.circleKeys[l],x1:u-h,y1:c-h,x2:u+h,y2:c+h})}return o?a.filter(o):a}return this._forEachCell(t,e,r,n,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?a.length>0:a},Kt.prototype._queryCircle=function(t,e,r,n,i){var o=t-r,a=t+r,s=e-r,l=e+r;if(a<0||o>this.width||l<0||s>this.height)return!n&&[];var u=[];return this._forEachCell(o,s,a,l,this._queryCellCircle,u,{hitTest:n,circle:{x:t,y:e,radius:r},seenUids:{box:{},circle:{}}},i),n?u.length>0:u},Kt.prototype.query=function(t,e,r,n,i){return this._query(t,e,r,n,!1,i)},Kt.prototype.hitTest=function(t,e,r,n,i){return this._query(t,e,r,n,!0,i)},Kt.prototype.hitTestCircle=function(t,e,r,n){return this._queryCircle(t,e,r,!0,n)},Kt.prototype._queryCell=function(t,e,r,n,i,o,a,s){var l=a.seenUids,u=this.boxCells[i];if(null!==u)for(var c=this.bboxes,h=0,p=u;h<p.length;h+=1){var d=p[h];if(!l.box[d]){l.box[d]=!0;var f=4*d;if(t<=c[f+2]&&e<=c[f+3]&&r>=c[f+0]&&n>=c[f+1]&&(!s||s(this.boxKeys[d]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[d],x1:c[f],y1:c[f+1],x2:c[f+2],y2:c[f+3]})}}}var m=this.circleCells[i];if(null!==m)for(var g=this.circles,_=0,v=m;_<v.length;_+=1){var y=v[_];if(!l.circle[y]){l.circle[y]=!0;var x=3*y;if(this._circleAndRectCollide(g[x],g[x+1],g[x+2],t,e,r,n)&&(!s||s(this.circleKeys[y]))){if(a.hitTest)return o.push(!0),!0;var b=g[x],E=g[x+1],T=g[x+2];o.push({key:this.circleKeys[y],x1:b-T,y1:E-T,x2:b+T,y2:E+T})}}}},Kt.prototype._queryCellCircle=function(t,e,r,n,i,o,a,s){var l=a.circle,u=a.seenUids,c=this.boxCells[i];if(null!==c)for(var h=this.bboxes,p=0,d=c;p<d.length;p+=1){var f=d[p];if(!u.box[f]){u.box[f]=!0;var m=4*f;if(this._circleAndRectCollide(l.x,l.y,l.radius,h[m+0],h[m+1],h[m+2],h[m+3])&&(!s||s(this.boxKeys[f])))return o.push(!0),!0}}var g=this.circleCells[i];if(null!==g)for(var _=this.circles,v=0,y=g;v<y.length;v+=1){var x=y[v];if(!u.circle[x]){u.circle[x]=!0;var b=3*x;if(this._circlesCollide(_[b],_[b+1],_[b+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[x])))return o.push(!0),!0}}},Kt.prototype._forEachCell=function(t,e,r,n,i,o,a,s){for(var l=this._convertToXCellCoord(t),u=this._convertToYCellCoord(e),c=this._convertToXCellCoord(r),h=this._convertToYCellCoord(n),p=l;p<=c;p++)for(var d=u;d<=h;d++)if(i.call(this,t,e,r,n,this.xCellCount*d+p,o,a,s))return},Kt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Kt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Kt.prototype._circlesCollide=function(t,e,r,n,i,o){var a=n-t,s=i-e,l=r+o;return l*l>a*a+s*s},Kt.prototype._circleAndRectCollide=function(t,e,r,n,i,o,a){var s=(o-n)/2,l=Math.abs(t-(n+s));if(l>s+r)return!1;var u=(a-i)/2,c=Math.abs(e-(i+u));if(c>u+r)return!1;if(l<=s||c<=u)return!0;var h=l-s,p=c-u;return h*h+p*p<=r*r};var le=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ue(t,e){for(var r=0;r<t;r++){var n=e.length;e.resize(n+4),e.float32.set(le,3*n)}}function ce(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t[3]=r[3]*n+r[7]*i+r[15],t}var he=function(t,e,r){void 0===e&&(e=new Kt(t.width+200,t.height+200,25)),void 0===r&&(r=new Kt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=r,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function pe(e,r,n){return r*(t.EXTENT/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}he.prototype.placeCollisionBox=function(t,e,r,n,i){var o=this.projectAndGetPerspectiveRatio(n,t.anchorPointX,t.anchorPointY),a=r*o.perspectiveRatio,s=t.x1*a+o.point.x,l=t.y1*a+o.point.y,u=t.x2*a+o.point.x,c=t.y2*a+o.point.y;return!this.isInsideGrid(s,l,u,c)||!e&&this.grid.hitTest(s,l,u,c,i)?{box:[],offscreen:!1}:{box:[s,l,u,c],offscreen:this.isOffscreen(s,l,u,c)}},he.prototype.placeCollisionCircles=function(e,r,n,i,o,a,s,l,u,c,h,p,d){var f=[],m=new t.Point(r.anchorX,r.anchorY),g=Jt(m,a),_=te(this.transform.cameraToCenterDistance,g.signedDistanceFromCamera),v=(c?o/_:o*_)/t.ONE_EM,y=Jt(m,s).point,x=ne(v,i,r.lineOffsetX*v,r.lineOffsetY*v,!1,y,m,r,n,s,{}),b=!1,E=!1,T=!0;if(x){for(var S=.5*p*_+d,A=new t.Point(-100,-100),w=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),C=new Yt,R=x.first,L=x.last,I=[],M=R.path.length-1;M>=1;M--)I.push(R.path[M]);for(var O=1;O<L.path.length;O++)I.push(L.path[O]);var P=2.5*S;if(l){var D=I.map((function(t){return Jt(t,l)}));I=D.some((function(t){return t.signedDistanceFromCamera<=0}))?[]:D.map((function(t){return t.point}))}var B=[];if(I.length>0){for(var N=I[0].clone(),F=I[0].clone(),k=1;k<I.length;k++)N.x=Math.min(N.x,I[k].x),N.y=Math.min(N.y,I[k].y),F.x=Math.max(F.x,I[k].x),F.y=Math.max(F.y,I[k].y);B=N.x>=A.x&&F.x<=w.x&&N.y>=A.y&&F.y<=w.y?[I]:F.x<A.x||N.x>w.x||F.y<A.y||N.y>w.y?[]:t.clipLine([I],A.x,A.y,w.x,w.y)}for(var U=0,z=B;U<z.length;U+=1){var G;C.reset(z[U],.25*S),G=C.length<=.5*S?1:Math.ceil(C.paddedLength/P)+1;for(var j=0;j<G;j++){var V=j/Math.max(G-1,1),H=C.lerp(V),W=H.x+100,X=H.y+100;f.push(W,X,S,0);var Z=W-S,q=X-S,Y=W+S,K=X+S;if(T=T&&this.isOffscreen(Z,q,Y,K),E=E||this.isInsideGrid(Z,q,Y,K),!e&&this.grid.hitTestCircle(W,X,S,h)&&(b=!0,!u))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!u&&b||!E?[]:f,offscreen:T,collisionDetected:b}},he.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var r=[],n=1/0,i=1/0,o=-1/0,a=-1/0,s=0,l=e;s<l.length;s+=1){var u=l[s],c=new t.Point(u.x+100,u.y+100);n=Math.min(n,c.x),i=Math.min(i,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y),r.push(c)}for(var h={},p={},d=0,f=this.grid.query(n,i,o,a).concat(this.ignoredGrid.query(n,i,o,a));d<f.length;d+=1){var m=f[d],g=m.key;if(void 0===h[g.bucketInstanceId]&&(h[g.bucketInstanceId]={}),!h[g.bucketInstanceId][g.featureIndex]){var _=[new t.Point(m.x1,m.y1),new t.Point(m.x2,m.y1),new t.Point(m.x2,m.y2),new t.Point(m.x1,m.y2)];t.polygonIntersectsPolygon(r,_)&&(h[g.bucketInstanceId][g.featureIndex]=!0,void 0===p[g.bucketInstanceId]&&(p[g.bucketInstanceId]=[]),p[g.bucketInstanceId].push(g.featureIndex))}}return p},he.prototype.insertCollisionBox=function(t,e,r,n,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:i},t[0],t[1],t[2],t[3])},he.prototype.insertCollisionCircles=function(t,e,r,n,i){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:n,collisionGroupID:i},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},he.prototype.projectAndGetPerspectiveRatio=function(e,r,n){var i=[r,n,0,1];return ce(i,i,e),{point:new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5}},he.prototype.isOffscreen=function(t,e,r,n){return r<100||t>=this.screenRightBoundary||n<100||e>this.screenBottomBoundary},he.prototype.isInsideGrid=function(t,e,r,n){return r>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary},he.prototype.getViewportMatrix=function(){var e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e};var de=function(t,e,r,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&r?1:0,this.placed=r};de.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var fe=function(t,e,r,n,i){this.text=new de(t?t.text:null,e,r,i),this.icon=new de(t?t.icon:null,e,n,i)};fe.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var me=function(t,e,r){this.text=t,this.icon=e,this.skipFade=r},ge=function(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]},_e=function(t,e,r,n,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=i},ve=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function ye(e,r,n,i,o){var a=t.getAnchorAlignment(e),s=-(a.horizontalAlign-.5)*r,l=-(a.verticalAlign-.5)*n,u=t.evaluateVariableOffset(e,i);return new t.Point(s+u[0]*o,l+u[1]*o)}function xe(e,r,n,i,o,a){var s=e.x1,l=e.x2,u=e.y1,c=e.y2,h=e.anchorPointX,p=e.anchorPointY,d=new t.Point(r,n);return i&&d._rotate(o?a:-a),{x1:s+d.x,y1:u+d.y,x2:l+d.x,y2:c+d.y,anchorPointX:h,anchorPointY:p}}ve.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var be=function(t,e,r,n){this.transform=t.clone(),this.collisionIndex=new he(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new ve(r),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}};function Ee(t,e,r,n,i){t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0)}be.prototype.getBucketParts=function(e,r,n,i){var o=n.getBucket(r),a=n.latestFeatureIndex;if(o&&a&&r.id===o.layerIds[0]){var s=n.collisionBoxArray,l=o.layers[0].layout,u=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),c=n.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(n.tileID.toUnwrapped()),p="map"===l.get("text-pitch-alignment"),d="map"===l.get("text-rotation-alignment"),f=pe(n,1,this.transform.zoom),m=$t(h,p,d,this.transform,f),g=null;if(p){var _=Qt(h,p,d,this.transform,f);g=t.multiply([],this.transform.labelPlaneMatrix,_)}this.retainedQueryData[o.bucketInstanceId]=new _e(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,n.tileID);var v={bucket:o,layout:l,posMatrix:h,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:u,textPixelRatio:c,holdingForFade:n.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(i)for(var y=0,x=o.sortKeyRanges;y<x.length;y+=1){var b=x[y];e.push({sortKey:b.sortKey,symbolInstanceStart:b.symbolInstanceStart,symbolInstanceEnd:b.symbolInstanceEnd,parameters:v})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:v})}},be.prototype.attemptAnchorPlacement=function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f){var m,g=[h.textOffset0,h.textOffset1],_=ye(t,r,n,g,i),v=this.collisionIndex.placeCollisionBox(xe(e,_.x,_.y,o,a,this.transform.angle),c,s,l,u.predicate);if(!f||0!==this.collisionIndex.placeCollisionBox(xe(f,_.x,_.y,o,a,this.transform.angle),c,s,l,u.predicate).box.length)return v.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(m=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:g,width:r,height:n,anchor:t,textBoxScale:i,prevAnchor:m},this.markUsedJustification(p,t,h,d),p.allowVerticalPlacement&&(this.markUsedOrientation(p,d,h),this.placedOrientations[h.crossTileID]=d),{shift:_,placedGlyphBoxes:v}):void 0},be.prototype.placeLayerBucketPart=function(e,r,n){var i=this,o=e.parameters,a=o.bucket,s=o.layout,l=o.posMatrix,u=o.textLabelPlaneMatrix,c=o.labelToScreenMatrix,h=o.textPixelRatio,p=o.holdingForFade,d=o.collisionBoxArray,f=o.partiallyEvaluatedTextSize,m=o.collisionGroup,g=s.get("text-optional"),_=s.get("icon-optional"),v=s.get("text-allow-overlap"),y=s.get("icon-allow-overlap"),x="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),E="none"!==s.get("icon-text-fit"),T="viewport-y"===s.get("symbol-z-order"),S=v&&(y||!a.hasIconData()||_),A=y&&(v||!a.hasTextData()||g);!a.collisionArrays&&d&&a.deserializeCollisionBoxes(d);var w=function(e,o){if(!r[e.crossTileID])if(p)i.placements[e.crossTileID]=new me(!1,!1,!1);else{var d,T=!1,w=!1,C=!0,R=null,L={box:null,offscreen:null},I={box:null,offscreen:null},M=null,O=null,P=0,D=0,B=0;o.textFeatureIndex?P=o.textFeatureIndex:e.useRuntimeCollisionCircles&&(P=e.featureIndex),o.verticalTextFeatureIndex&&(D=o.verticalTextFeatureIndex);var N=o.textBox;if(N){var F=function(r){var n=t.WritingMode.horizontal;if(a.allowVerticalPlacement&&!r&&i.prevPlacement){var o=i.prevPlacement.placedOrientations[e.crossTileID];o&&(i.placedOrientations[e.crossTileID]=o,i.markUsedOrientation(a,n=o,e))}return n},k=function(r,n){if(a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&o.verticalTextBox)for(var i=0,s=a.writingModes;i<s.length&&(s[i]===t.WritingMode.vertical?(L=n(),I=L):L=r(),!(L&&L.box&&L.box.length));i+=1);else L=r()};if(s.get("text-variable-anchor")){var U=s.get("text-variable-anchor");if(i.prevPlacement&&i.prevPlacement.variableOffsets[e.crossTileID]){var z=i.prevPlacement.variableOffsets[e.crossTileID];U.indexOf(z.anchor)>0&&(U=U.filter((function(t){return t!==z.anchor}))).unshift(z.anchor)}var G=function(t,r,n){for(var o=t.x2-t.x1,s=t.y2-t.y1,u=e.textBoxScale,c=E&&!y?r:null,p={box:[],offscreen:!1},d=v?2*U.length:U.length,f=0;f<d;++f){var g=i.attemptAnchorPlacement(U[f%U.length],t,o,s,u,x,b,h,l,m,f>=U.length,e,a,n,c);if(g&&(p=g.placedGlyphBoxes)&&p.box&&p.box.length){T=!0,R=g.shift;break}}return p};k((function(){return G(N,o.iconBox,t.WritingMode.horizontal)}),(function(){var r=o.verticalTextBox;return a.allowVerticalPlacement&&!(L&&L.box&&L.box.length)&&e.numVerticalGlyphVertices>0&&r?G(r,o.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),L&&(T=L.box,C=L.offscreen);var j=F(L&&L.box);if(!T&&i.prevPlacement){var V=i.prevPlacement.variableOffsets[e.crossTileID];V&&(i.variableOffsets[e.crossTileID]=V,i.markUsedJustification(a,V.anchor,e,j))}}else{var H=function(t,r){var n=i.collisionIndex.placeCollisionBox(t,v,h,l,m.predicate);return n&&n.box&&n.box.length&&(i.markUsedOrientation(a,r,e),i.placedOrientations[e.crossTileID]=r),n};k((function(){return H(N,t.WritingMode.horizontal)}),(function(){var r=o.verticalTextBox;return a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&r?H(r,t.WritingMode.vertical):{box:null,offscreen:null}})),F(L&&L.box&&L.box.length)}}if(T=(d=L)&&d.box&&d.box.length>0,C=d&&d.offscreen,e.useRuntimeCollisionCircles){var W=a.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),X=t.evaluateSizeForFeature(a.textSizeData,f,W),Z=s.get("text-padding");M=i.collisionIndex.placeCollisionCircles(v,W,a.lineVertexArray,a.glyphOffsetArray,X,l,u,c,n,b,m.predicate,e.collisionCircleDiameter,Z),T=v||M.circles.length>0&&!M.collisionDetected,C=C&&M.offscreen}if(o.iconFeatureIndex&&(B=o.iconFeatureIndex),o.iconBox){var q=function(t){var e=E&&R?xe(t,R.x,R.y,x,b,i.transform.angle):t;return i.collisionIndex.placeCollisionBox(e,y,h,l,m.predicate)};w=I&&I.box&&I.box.length&&o.verticalIconBox?(O=q(o.verticalIconBox)).box.length>0:(O=q(o.iconBox)).box.length>0,C=C&&O.offscreen}var Y=g||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,K=_||0===e.numIconVertices;if(Y||K?K?Y||(w=w&&T):T=w&&T:w=T=w&&T,T&&d&&d.box&&i.collisionIndex.insertCollisionBox(d.box,s.get("text-ignore-placement"),a.bucketInstanceId,I&&I.box&&D?D:P,m.ID),w&&O&&i.collisionIndex.insertCollisionBox(O.box,s.get("icon-ignore-placement"),a.bucketInstanceId,B,m.ID),M&&(T&&i.collisionIndex.insertCollisionCircles(M.circles,s.get("text-ignore-placement"),a.bucketInstanceId,P,m.ID),n)){var $=a.bucketInstanceId,Q=i.collisionCircleArrays[$];void 0===Q&&(Q=i.collisionCircleArrays[$]=new ge);for(var J=0;J<M.circles.length;J+=4)Q.circles.push(M.circles[J+0]),Q.circles.push(M.circles[J+1]),Q.circles.push(M.circles[J+2]),Q.circles.push(M.collisionDetected?1:0)}i.placements[e.crossTileID]=new me(T||S,w||A,C||a.justReloaded),r[e.crossTileID]=!0}};if(T)for(var C=a.getSortedSymbolIndexes(this.transform.angle),R=C.length-1;R>=0;--R){var L=C[R];w(a.symbolInstances.get(L),a.collisionArrays[L])}else for(var I=e.symbolInstanceStart;I<e.symbolInstanceEnd;I++)w(a.symbolInstances.get(I),a.collisionArrays[I]);if(n&&a.bucketInstanceId in this.collisionCircleArrays){var M=this.collisionCircleArrays[a.bucketInstanceId];t.invert(M.invProjMatrix,l),M.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1},be.prototype.markUsedJustification=function(e,r,n,i){var o;o=i===t.WritingMode.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(r)];for(var a=0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];a<s.length;a+=1){var l=s[a];l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=o>=0&&l!==o?0:n.crossTileID)}},be.prototype.markUsedOrientation=function(e,r,n){for(var i=r===t.WritingMode.horizontal||r===t.WritingMode.horizontalOnly?r:0,o=r===t.WritingMode.vertical?r:0,a=0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];a<s.length;a+=1)e.text.placedSymbolArray.get(s[a]).placedOrientation=i;n.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=o)},be.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,r=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var n=e?e.symbolFadeChange(t):1,i=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(var s in this.placements){var l=this.placements[s],u=i[s];u?(this.opacities[s]=new fe(u,n,l.text,l.icon),r=r||l.text!==u.text.placed||l.icon!==u.icon.placed):(this.opacities[s]=new fe(null,n,l.text,l.icon,l.skipFade),r=r||l.text||l.icon)}for(var c in i){var h=i[c];if(!this.opacities[c]){var p=new fe(h,n,!1,!1);p.isHidden()||(this.opacities[c]=p,r=r||h.text.placed||h.icon.placed)}}for(var d in o)this.variableOffsets[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.variableOffsets[d]=o[d]);for(var f in a)this.placedOrientations[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.placedOrientations[f]=a[f]);r?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},be.prototype.updateLayerOpacities=function(t,e){for(var r={},n=0,i=e;n<i.length;n+=1){var o=i[n],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,r,o.collisionBoxArray)}},be.prototype.updateBucketOpacities=function(e,r,n){var i=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();var o=e.layers[0].layout,a=new fe(null,0,!1,!1,!0),s=o.get("text-allow-overlap"),l=o.get("icon-allow-overlap"),u=o.get("text-variable-anchor"),c="map"===o.get("text-rotation-alignment"),h="map"===o.get("text-pitch-alignment"),p="none"!==o.get("icon-text-fit"),d=new fe(null,0,s&&(l||!e.hasIconData()||o.get("icon-optional")),l&&(s||!e.hasTextData()||o.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);for(var f=function(t,e,r){for(var n=0;n<e/4;n++)t.opacityVertexArray.emplaceBack(r)},m=function(n){var o=e.symbolInstances.get(n),s=o.numHorizontalGlyphVertices,l=o.numVerticalGlyphVertices,m=o.crossTileID,g=i.opacities[m];r[m]?g=a:g||(i.opacities[m]=g=d),r[m]=!0;var _=o.numIconVertices>0,v=i.placedOrientations[o.crossTileID],y=v===t.WritingMode.vertical,x=v===t.WritingMode.horizontal||v===t.WritingMode.horizontalOnly;if(s>0||l>0){var b=Ie(g.text);f(e.text,s,y?Me:b),f(e.text,l,x?Me:b);var E=g.text.isHidden();[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=E||y?1:0)})),o.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).hidden=E||x?1:0);var T=i.variableOffsets[o.crossTileID];T&&i.markUsedJustification(e,T.anchor,o,v);var S=i.placedOrientations[o.crossTileID];S&&(i.markUsedJustification(e,"left",o,S),i.markUsedOrientation(e,S,o))}if(_){var A=Ie(g.icon),w=!(p&&o.verticalPlacedIconSymbolIndex&&y);o.placedIconSymbolIndex>=0&&(f(e.icon,o.numIconVertices,w?A:Me),e.icon.placedSymbolArray.get(o.placedIconSymbolIndex).hidden=g.icon.isHidden()),o.verticalPlacedIconSymbolIndex>=0&&(f(e.icon,o.numVerticalIconVertices,w?Me:A),e.icon.placedSymbolArray.get(o.verticalPlacedIconSymbolIndex).hidden=g.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){var C=e.collisionArrays[n];if(C){var R=new t.Point(0,0);if(C.textBox||C.verticalTextBox){var L=!0;if(u){var I=i.variableOffsets[m];I?(R=ye(I.anchor,I.width,I.height,I.textOffset,I.textBoxScale),c&&R._rotate(h?i.transform.angle:-i.transform.angle)):L=!1}C.textBox&&Ee(e.textCollisionBox.collisionVertexArray,g.text.placed,!L||y,R.x,R.y),C.verticalTextBox&&Ee(e.textCollisionBox.collisionVertexArray,g.text.placed,!L||x,R.x,R.y)}var M=Boolean(!x&&C.verticalIconBox);C.iconBox&&Ee(e.iconCollisionBox.collisionVertexArray,g.icon.placed,M,p?R.x:0,p?R.y:0),C.verticalIconBox&&Ee(e.iconCollisionBox.collisionVertexArray,g.icon.placed,!M,p?R.x:0,p?R.y:0)}}},g=0;g<e.symbolInstances.length;g++)m(g);if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){var _=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=_.invProjMatrix,e.placementViewportMatrix=_.viewportMatrix,e.collisionCircleArray=_.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}},be.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},be.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},be.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},be.prototype.stillRecent=function(t,e){var r=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*r>t},be.prototype.setStale=function(){this.stale=!0};var Te=Math.pow(2,25),Se=Math.pow(2,24),Ae=Math.pow(2,17),we=Math.pow(2,16),Ce=Math.pow(2,9),Re=Math.pow(2,8),Le=Math.pow(2,1);function Ie(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,r=Math.floor(127*t.opacity);return r*Te+e*Se+r*Ae+e*we+r*Ce+e*Re+r*Le+e}var Me=0,Oe=function(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Oe.prototype.continuePlacement=function(t,e,r,n,i){for(var o=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(o,n,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((function(t,e){return t.sortKey-e.sortKey})));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,r),this._currentPartIndex++,i())return!0;return!1};var Pe=function(t,e,r,n,i,o,a){this.placement=new be(t,i,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1};Pe.prototype.isDone=function(){return this._done},Pe.prototype.continuePlacement=function(e,r,n){for(var i=this,o=t.browser.now(),a=function(){var e=t.browser.now()-o;return!i._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=r[e[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){if(this._inProgressLayer||(this._inProgressLayer=new Oe(s)),this._inProgressLayer.continuePlacement(n[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Pe.prototype.commit=function(t){return this.placement.commit(t),this.placement};var De=512/t.EXTENT/2,Be=function(t,e,r){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=r;for(var n=0;n<e.length;n++){var i=e.get(n),o=i.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}};Be.prototype.getScaledCoordinates=function(e,r){var n=De/Math.pow(2,r.canonical.z-this.tileID.canonical.z);return{x:Math.floor((r.canonical.x*t.EXTENT+e.anchorX)*n),y:Math.floor((r.canonical.y*t.EXTENT+e.anchorY)*n)}},Be.prototype.findMatches=function(t,e,r){for(var n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),i=0;i<t.length;i++){var o=t.get(i);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),l=0,u=a;l<u.length;l+=1){var c=u[l];if(Math.abs(c.coord.x-s.x)<=n&&Math.abs(c.coord.y-s.y)<=n&&!r[c.crossTileID]){r[c.crossTileID]=!0,o.crossTileID=c.crossTileID;break}}}}};var Ne=function(){this.maxCrossTileID=0};Ne.prototype.generate=function(){return++this.maxCrossTileID};var Fe=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Fe.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var r in this.indexes){var n=this.indexes[r],i={};for(var o in n){var a=n[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),i[a.tileID.key]=a}this.indexes[r]=i}this.lng=t},Fe.prototype.addBucket=function(t,e,r){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var n=0;n<e.symbolInstances.length;n++)e.symbolInstances.get(n).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var i=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var l=a[s];l.tileID.isChildOf(t)&&l.findMatches(e.symbolInstances,t,i)}else{var u=a[t.scaledTo(Number(o)).key];u&&u.findMatches(e.symbolInstances,t,i)}}for(var c=0;c<e.symbolInstances.length;c++){var h=e.symbolInstances.get(c);h.crossTileID||(h.crossTileID=r.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Be(t,e.symbolInstances,e.bucketInstanceId),!0},Fe.prototype.removeBucketCrossTileIDs=function(t,e){for(var r in e.indexedSymbolInstances)for(var n=0,i=e.indexedSymbolInstances[r];n<i.length;n+=1)delete this.usedCrossTileIDs[t][i[n].crossTileID]},Fe.prototype.removeStaleBuckets=function(t){var e=!1;for(var r in this.indexes){var n=this.indexes[r];for(var i in n)t[n[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,n[i]),delete n[i],e=!0)}return e};var ke=function(){this.layerIndexes={},this.crossTileIDs=new Ne,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ke.prototype.addLayer=function(t,e,r){var n=this.layerIndexes[t.id];void 0===n&&(n=this.layerIndexes[t.id]=new Fe);var i=!1,o={};n.handleWrapJump(r);for(var a=0,s=e;a<s.length;a+=1){var l=s[a],u=l.getBucket(t);u&&t.id===u.layerIds[0]&&(u.bucketInstanceId||(u.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(l.tileID,u,this.crossTileIDs)&&(i=!0),o[u.bucketInstanceId]=!0)}return n.removeStaleBuckets(o)&&(i=!0),i},ke.prototype.pruneUnusedLayers=function(t){var e={};for(var r in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[r]||delete this.layerIndexes[r]};var Ue=function(e,r){return t.emitValidationErrors(e,r&&r.filter((function(t){return"source.canvas"!==t.identifier})))},ze=t.pick(Gt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ge=t.pick(Gt,["setCenter","setZoom","setBearing","setPitch"]),je=function(){var e={},r=t.styleSpec.$version;for(var n in t.styleSpec.$root){var i,o=t.styleSpec.$root[n];o.required&&null!=(i="version"===n?r:"array"===o.type?[]:{})&&(e[n]=i)}return e}(),Ve=function(e){function r(n,i){var o=this;void 0===i&&(i={}),e.call(this),this.map=n,this.dispatcher=new S(kt(),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new y(n._requestManager,i.localIdeographFontFamily),this.lineAtlas=new T(256,512),this.crossTileSymbolIndex=new ke,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var a=this;this._rtlTextPluginCallback=r.registerForPluginStateChange((function(e){a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(function(e,r){if(t.triggerPluginCompletionEvent(e),r&&r.every((function(t){return t})))for(var n in a.sourceCaches)a.sourceCaches[n].reload()}))})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var r=e.getSource();if(r&&r.vectorLayerIds)for(var n in o._layers){var i=o._layers[n];i.source===r.id&&o._validateLayer(i)}}}}))}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.loadURL=function(e,r){var n=this;void 0===r&&(r={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof r.validate?r.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,r.accessToken);var o=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(o,(function(e,r){n._request=null,e?n.fire(new t.ErrorEvent(e)):r&&n._load(r,i)}))},r.prototype.loadJSON=function(e,r){var n=this;void 0===r&&(r={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){n._request=null,n._load(e,!1!==r.validate)}))},r.prototype.loadEmpty=function(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(je,!1)},r.prototype._load=function(e,r){if(!r||!Ue(this,t.validateStyle(e))){for(var n in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(n,e.sources[n],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var i=zt(this.stylesheet.layers);this._order=i.map((function(t){return t.id})),this._layers={},this._serializedLayers={};for(var o=0,a=i;o<a.length;o+=1){var s=a[o];(s=t.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new E(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},r.prototype._loadSprite=function(e){var r=this;this._spriteRequest=function(e,r,n){var i,o,a,s=t.browser.devicePixelRatio>1?"@2x":"",l=t.getJSON(r.transformRequest(r.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){l=null,a||(a=t,i=e,c())})),u=t.getImage(r.transformRequest(r.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){u=null,a||(a=t,o=e,c())}));function c(){if(a)n(a);else if(i&&o){var e=t.browser.getImageData(o),r={};for(var s in i){var l=i[s],u=l.width,c=l.height,h=l.x,p=l.y,d=l.sdf,f=l.pixelRatio,m=l.stretchX,g=l.stretchY,_=l.content,v=new t.RGBAImage({width:u,height:c});t.RGBAImage.copy(e,v,{x:h,y:p},{x:0,y:0},{width:u,height:c}),r[s]={data:v,pixelRatio:f,sdf:d,stretchX:m,stretchY:g,content:_}}n(null,r)}}return{cancel:function(){l&&(l.cancel(),l=null),u&&(u.cancel(),u=null)}}}(e,this.map._requestManager,(function(e,n){if(r._spriteRequest=null,e)r.fire(new t.ErrorEvent(e));else if(n)for(var i in n)r.imageManager.addImage(i,n[i]);r.imageManager.setLoaded(!0),r._availableImages=r.imageManager.listImages(),r.dispatcher.broadcast("setImages",r._availableImages),r.fire(new t.Event("data",{dataType:"style"}))}))},r.prototype._validateLayer=function(e){var r=this.sourceCaches[e.source];if(r){var n=e.sourceLayer;if(n){var i=r.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+n+'" does not exist on source "'+i.id+'" as specified by style layer "'+e.id+'"')))}}},r.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},r.prototype._serializeLayers=function(t){for(var e=[],r=0,n=t;r<n.length;r+=1){var i=this._layers[n[r]];"custom"!==i.type&&e.push(i.serialize())}return e},r.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},r.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},r.prototype.update=function(e){if(this._loaded){var r=this._changed;if(this._changed){var n=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var o in(n.length||i.length)&&this._updateWorkerLayers(n,i),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}var l={};for(var u in this.sourceCaches){var c=this.sourceCaches[u];l[u]=c.used,c.used=!1}for(var h=0,p=this._order;h<p.length;h+=1){var d=this._layers[p[h]];d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(var f in l){var m=this.sourceCaches[f];l[f]!==m.used&&m.fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(e),this.z=e.zoom,r&&this.fire(new t.Event("data",{dataType:"style"}))}},r.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},r.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},r.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},r.prototype.setState=function(e){var r=this;if(this._checkLoaded(),Ue(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=zt(e.layers);var n=function(e,r){if(!e)return[{command:Gt.setStyle,args:[r]}];var n=[];try{if(!t.deepEqual(e.version,r.version))return[{command:Gt.setStyle,args:[r]}];t.deepEqual(e.center,r.center)||n.push({command:Gt.setCenter,args:[r.center]}),t.deepEqual(e.zoom,r.zoom)||n.push({command:Gt.setZoom,args:[r.zoom]}),t.deepEqual(e.bearing,r.bearing)||n.push({command:Gt.setBearing,args:[r.bearing]}),t.deepEqual(e.pitch,r.pitch)||n.push({command:Gt.setPitch,args:[r.pitch]}),t.deepEqual(e.sprite,r.sprite)||n.push({command:Gt.setSprite,args:[r.sprite]}),t.deepEqual(e.glyphs,r.glyphs)||n.push({command:Gt.setGlyphs,args:[r.glyphs]}),t.deepEqual(e.transition,r.transition)||n.push({command:Gt.setTransition,args:[r.transition]}),t.deepEqual(e.light,r.light)||n.push({command:Gt.setLight,args:[r.light]});var i={},o=[];!function(e,r,n,i){var o;for(o in r=r||{},e=e||{})e.hasOwnProperty(o)&&(r.hasOwnProperty(o)||Vt(o,n,i));for(o in r)r.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],r[o])||("geojson"===e[o].type&&"geojson"===r[o].type&&Wt(e,r,o)?n.push({command:Gt.setGeoJSONSourceData,args:[o,r[o].data]}):Ht(o,r,n,i)):jt(o,r,n))}(e.sources,r.sources,o,i);var a=[];e.layers&&e.layers.forEach((function(t){i[t.source]?n.push({command:Gt.removeLayer,args:[t.id]}):a.push(t)})),n=n.concat(o),function(e,r,n){r=r||[];var i,o,a,s,l,u,c,h=(e=e||[]).map(Zt),p=r.map(Zt),d=e.reduce(qt,{}),f=r.reduce(qt,{}),m=h.slice(),g=Object.create(null);for(i=0,o=0;i<h.length;i++)f.hasOwnProperty(a=h[i])?o++:(n.push({command:Gt.removeLayer,args:[a]}),m.splice(m.indexOf(a,o),1));for(i=0,o=0;i<p.length;i++)m[m.length-1-i]!==(a=p[p.length-1-i])&&(d.hasOwnProperty(a)?(n.push({command:Gt.removeLayer,args:[a]}),m.splice(m.lastIndexOf(a,m.length-o),1)):o++,n.push({command:Gt.addLayer,args:[f[a],u=m[m.length-i]]}),m.splice(m.length-i,0,a),g[a]=!0);for(i=0;i<p.length;i++)if(s=d[a=p[i]],l=f[a],!g[a]&&!t.deepEqual(s,l))if(t.deepEqual(s.source,l.source)&&t.deepEqual(s["source-layer"],l["source-layer"])&&t.deepEqual(s.type,l.type)){for(c in Xt(s.layout,l.layout,n,a,null,Gt.setLayoutProperty),Xt(s.paint,l.paint,n,a,null,Gt.setPaintProperty),t.deepEqual(s.filter,l.filter)||n.push({command:Gt.setFilter,args:[a,l.filter]}),t.deepEqual(s.minzoom,l.minzoom)&&t.deepEqual(s.maxzoom,l.maxzoom)||n.push({command:Gt.setLayerZoomRange,args:[a,l.minzoom,l.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Xt(s[c],l[c],n,a,c.slice(6),Gt.setPaintProperty):t.deepEqual(s[c],l[c])||n.push({command:Gt.setLayerProperty,args:[a,c,l[c]]}));for(c in l)l.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Xt(s[c],l[c],n,a,c.slice(6),Gt.setPaintProperty):t.deepEqual(s[c],l[c])||n.push({command:Gt.setLayerProperty,args:[a,c,l[c]]}))}else n.push({command:Gt.removeLayer,args:[a]}),u=m[m.lastIndexOf(a)+1],n.push({command:Gt.addLayer,args:[l,u]})}(a,r.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:Gt.setStyle,args:[r]}]}return n}(this.serialize(),e).filter((function(t){return!(t.command in Ge)}));if(0===n.length)return!1;var i=n.filter((function(t){return!(t.command in ze)}));if(i.length>0)throw new Error("Unimplemented: "+i.map((function(t){return t.command})).join(", ")+".");return n.forEach((function(t){"setTransition"!==t.command&&r[t.command].apply(r,t.args)})),this.stylesheet=e,!0},r.prototype.addImage=function(e,r){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,r),this._afterImageUpdated(e)},r.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},r.prototype.getImage=function(t){return this.imageManager.getImage(t)},r.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)},r.prototype._afterImageUpdated=function(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))},r.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},r.prototype.addSource=function(e,r,n){var i=this;if(void 0===n&&(n={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!r.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(r).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,r,null,n))){this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);var o=this.sourceCaches[e]=new It(e,r,this.dispatcher);o.style=this,o.setEventedParent(this,(function(){return{isSourceLoaded:i.loaded(),source:o.serialize(),sourceId:e}})),o.onAdd(this.map),this._changed=!0}},r.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var r in this._layers)if(this._layers[r].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+r+'" is using it.')));var n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.clearTiles(),n.onRemove&&n.onRemove(this.map),this._changed=!0},r.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},r.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},r.prototype.addLayer=function(e,r,n){void 0===n&&(n={}),this._checkLoaded();var i=e.id;if(this.getLayer(i))this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" already exists on this map')));else{var o;if("custom"===e.type){if(Ue(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateStyle.layer,"layers."+i,e,{arrayIndex:-1},n))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[o.id]=o.serialize()}var a=r?this._order.indexOf(r):this._order.length;if(r&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" does not exist on this map.')));else{if(this._order.splice(a,0,i),this._layerOrderChanged=!0,this._layers[i]=o,this._removedLayers[i]&&o.source&&"custom"!==o.type){var s=this._removedLayers[i];delete this._removedLayers[i],s.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}},r.prototype.moveLayer=function(e,r){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==r){var n=this._order.indexOf(e);this._order.splice(n,1);var i=r?this._order.indexOf(r):this._order.length;r&&-1===i?this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" does not exist on this map.'))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},r.prototype.removeLayer=function(e){this._checkLoaded();var r=this._layers[e];if(r){r.setEventedParent(null);var n=this._order.indexOf(e);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},r.prototype.getLayer=function(t){return this._layers[t]},r.prototype.hasLayer=function(t){return t in this._layers},r.prototype.setLayerZoomRange=function(e,r,n){this._checkLoaded();var i=this.getLayer(e);i?i.minzoom===r&&i.maxzoom===n||(null!=r&&(i.minzoom=r),null!=n&&(i.maxzoom=n),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},r.prototype.setFilter=function(e,r,n){void 0===n&&(n={}),this._checkLoaded();var i=this.getLayer(e);if(i){if(!t.deepEqual(i.filter,r))return null==r?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(t.validateStyle.filter,"layers."+i.id+".filter",r,null,n)||(i.filter=t.clone$1(r),this._updateLayer(i)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},r.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},r.prototype.setLayoutProperty=function(e,r,n,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(r),n)||(o.setLayoutProperty(r,n,i),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},r.prototype.getLayoutProperty=function(e,r){var n=this.getLayer(e);if(n)return n.getLayoutProperty(r);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},r.prototype.setPaintProperty=function(e,r,n,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(r),n)||(o.setPaintProperty(r,n,i)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},r.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},r.prototype.setFeatureState=function(e,r){this._checkLoaded();var n=e.source,i=e.sourceLayer,o=this.sourceCaches[n];if(void 0!==o){var a=o.getSource().type;"geojson"===a&&i?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==a||i?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),o.setFeatureState(i,e.id,r)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},r.prototype.removeFeatureState=function(e,r){this._checkLoaded();var n=e.source,i=this.sourceCaches[n];if(void 0!==i){var o=i.getSource().type,a="vector"===o?e.sourceLayer:void 0;"vector"!==o||a?r&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):i.removeFeatureState(a,e.id,r):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},r.prototype.getFeatureState=function(e){this._checkLoaded();var r=e.source,n=e.sourceLayer,i=this.sourceCaches[r];if(void 0!==i){if("vector"!==i.getSource().type||n)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),i.getFeatureState(n,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},r.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},r.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},r.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},r.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,r=function(t){return"fill-extrusion"===e._layers[t].type},n={},i=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(r(a)){n[a]=o;for(var s=0,l=t;s<l.length;s+=1){var u=l[s][a];if(u)for(var c=0,h=u;c<h.length;c+=1)i.push(h[c])}}}i.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var p=[],d=this._order.length-1;d>=0;d--){var f=this._order[d];if(r(f))for(var m=i.length-1;m>=0;m--){var g=i[m].feature;if(n[g.layer.id]<d)break;p.push(g),i.pop()}else for(var _=0,v=t;_<v.length;_+=1){var y=v[_][f];if(y)for(var x=0,b=y;x<b.length;x+=1)p.push(b[x].feature)}}return p},r.prototype.queryRenderedFeatures=function(e,r,n){r&&r.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",r.filter,null,r);var i={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=r.layers;o<a.length;o+=1){var s=a[o],l=this._layers[s];if(!l)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];i[l.source]=!0}}var u=[];for(var c in r.availableImages=this._availableImages,this.sourceCaches)r.layers&&!i[c]||u.push(F(this.sourceCaches[c],this._layers,this._serializedLayers,e,r,n));return this.placement&&u.push(function(t,e,r,n,i,o,a){for(var s={},l=o.queryRenderedSymbols(n),u=[],c=0,h=Object.keys(l).map(Number);c<h.length;c+=1)u.push(a[h[c]]);u.sort(k);for(var p=function(){var r=f[d],n=r.featureIndex.lookupSymbolFeatures(l[r.bucketInstanceId],e,r.bucketIndex,r.sourceLayerIndex,i.filter,i.layers,i.availableImages,t);for(var o in n){var a=s[o]=s[o]||[],u=n[o];u.sort((function(t,e){var n=r.featureSortOrder;if(n){var i=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(var c=0,h=u;c<h.length;c+=1)a.push(h[c])}},d=0,f=u;d<f.length;d+=1)p();var m=function(e){s[e].forEach((function(n){var i=n.feature,o=r[t[e].source].getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o}))};for(var g in s)m(g);return s}(this._layers,this._serializedLayers,this.sourceCaches,e,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)},r.prototype.querySourceFeatures=function(e,r){r&&r.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",r.filter,null,r);var n=this.sourceCaches[e];return n?function(t,e){for(var r=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),n=[],i={},o=0;o<r.length;o++){var a=r[o],s=a.tileID.canonical.key;i[s]||(i[s]=!0,a.querySourceFeatures(n,e))}return n}(n,r):[]},r.prototype.addSourceType=function(t,e,n){return r.getSourceType(t)?n(new Error('A source type called "'+t+'" already exists.')):(r.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))},r.prototype.getLight=function(){return this.light.getLight()},r.prototype.setLight=function(e,r){void 0===r&&(r={}),this._checkLoaded();var n=this.light.getLight(),i=!1;for(var o in e)if(!t.deepEqual(e[o],n[o])){i=!0;break}if(i){var a={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(a)}},r.prototype._validate=function(e,r,n,i,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&Ue(this,e.call(t.validateStyle,t.extend({key:r,style:this.serialize(),value:n,styleSpec:t.styleSpec},i)))},r.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var r in this.sourceCaches)this.sourceCaches[r].clearTiles(),this.sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},r.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},r.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},r.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},r.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},r.prototype._updatePlacement=function(e,r,n,i,o){void 0===o&&(o=!1);for(var a=!1,s=!1,l={},u=0,c=this._order;u<c.length;u+=1){var h=this._layers[c[u]];if("symbol"===h.type){if(!l[h.source]){var p=this.sourceCaches[h.source];l[h.source]=p.getRenderableIds(!0).map((function(t){return p.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var d=this.crossTileSymbolIndex.addLayer(h,l[h.source],e.center.lng);a=a||d}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((o=o||this._layerOrderChanged||0===n)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Pe(e,this._order,o,r,n,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(var f=0,m=this._order;f<m.length;f+=1){var g=this._layers[m[f]];"symbol"===g.type&&this.placement.updateLayerOpacities(g,l[g.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},r.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},r.prototype.getImages=function(t,e,r){this.imageManager.getImages(e.icons,r),this._updateTilesForChangedImages();var n=this.sourceCaches[e.source];n&&n.setDependencies(e.tileID.key,e.type,e.icons)},r.prototype.getGlyphs=function(t,e,r){this.glyphManager.getGlyphs(e.stacks,r)},r.prototype.getResource=function(e,r,n){return t.makeRequest(r,n)},r}(t.Evented);Ve.getSourceType=function(t){return B[t]},Ve.setSourceType=function(t,e){B[t]=e},Ve.registerForPluginStateChange=t.registerForPluginStateChange;var He=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),We=_r("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),Xe=_r("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ze=_r("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),qe=_r("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ye=_r("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ke=_r("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),$e=_r("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Qe=_r("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Je=_r("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),tr=_r("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),er=_r("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),rr=_r("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),nr=_r("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),ir=_r("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),or=_r("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),ar=_r("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),sr=_r("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),lr=_r("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ur=_r("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),cr=_r("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),hr=_r("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),pr=_r("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),dr=_r("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),fr=_r("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),mr=_r("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),gr=_r("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function _r(t,e){var r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=e.match(/attribute ([\w]+) ([\w]+)/g),i=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=o?o.concat(i):i,s={};return{fragmentSource:t=t.replace(r,(function(t,e,r,n,i){return s[i]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nvarying "+r+" "+n+" "+i+";\n#else\nuniform "+r+" "+n+" u_"+i+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+i+"\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n"})),vertexSource:e=e.replace(r,(function(t,e,r,n,i){var o="float"===n?"vec2":"vec4",a=i.match(/color/)?"color":o;return s[i]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+r+" "+o+" a_"+i+";\nvarying "+r+" "+n+" "+i+";\n#else\nuniform "+r+" "+n+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = a_"+i+";\n#else\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+r+" "+o+" a_"+i+";\n#else\nuniform "+r+" "+n+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+r+" "+n+" "+i+" = a_"+i+";\n#else\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+r+" "+n+" "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n"})),staticAttributes:n,staticUniforms:a}}var vr=Object.freeze({__proto__:null,prelude:We,background:Xe,backgroundPattern:Ze,circle:qe,clippingMask:Ye,heatmap:Ke,heatmapTexture:$e,collisionBox:Qe,collisionCircle:Je,debug:tr,fill:er,fillOutline:rr,fillOutlinePattern:nr,fillPattern:ir,fillExtrusion:or,fillExtrusionPattern:ar,hillshadePrepare:sr,hillshade:lr,line:ur,lineGradient:cr,linePattern:hr,lineSDF:pr,raster:dr,symbolIcon:fr,symbolSDF:mr,symbolTextAndIcon:gr}),yr=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function xr(t){for(var e=[],r=0;r<t.length;r++)if(null!==t[r]){var n=t[r].split(" ");e.push(n.pop())}return e}yr.prototype.bind=function(t,e,r,n,i,o,a,s){this.context=t;for(var l=this.boundPaintVertexBuffers.length!==n.length,u=0;!l&&u<n.length;u++)this.boundPaintVertexBuffers[u]!==n[u]&&(l=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===r&&!l&&this.boundIndexBuffer===i&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(e,r,n,i,o,a,s)},yr.prototype.freshBind=function(t,e,r,n,i,o,a){var s,l=t.numAttributes,u=this.context,c=u.gl;if(u.extVertexArrayObject)this.vao&&this.destroy(),this.vao=u.extVertexArrayObject.createVertexArrayOES(),u.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=u.currentNumAttributes||0;for(var h=l;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var p=0,d=r;p<d.length;p+=1)d[p].enableAttributes(c,t);o&&o.enableAttributes(c,t),a&&a.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,i);for(var f=0,m=r;f<m.length;f+=1){var g=m[f];g.bind(),g.setVertexAttribPointers(c,t,i)}o&&(o.bind(),o.setVertexAttribPointers(c,t,i)),n&&n.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,t,i)),u.currentNumAttributes=l},yr.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var br=function(t,e,r,n,i,o){var a=t.gl;this.program=a.createProgram();for(var s=xr(r.staticAttributes),l=n?n.getBinderAttributes():[],u=s.concat(l),c=r.staticUniforms?xr(r.staticUniforms):[],h=n?n.getBinderUniforms():[],p=[],d=0,f=c.concat(h);d<f.length;d+=1){var m=f[d];p.indexOf(m)<0&&p.push(m)}var g=n?n.defines():[];o&&g.push("#define OVERDRAW_INSPECTOR;");var _=g.concat(We.fragmentSource,r.fragmentSource).join("\n"),v=g.concat(We.vertexSource,r.vertexSource).join("\n"),y=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(y,_),a.compileShader(y),a.attachShader(this.program,y);var x=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(x,v),a.compileShader(x),a.attachShader(this.program,x),this.attributes={};var b={};this.numAttributes=u.length;for(var E=0;E<this.numAttributes;E++)u[E]&&(a.bindAttribLocation(this.program,E,u[E]),this.attributes[u[E]]=E);a.linkProgram(this.program),a.deleteShader(x),a.deleteShader(y);for(var T=0;T<p.length;T++){var S=p[T];if(S&&!b[S]){var A=a.getUniformLocation(this.program,S);A&&(b[S]=A)}}this.fixedUniforms=i(t,b),this.binderUniforms=n?n.getUniforms(t,b):[]}}};function Er(t,e,r){var n=1/pe(r,1,e.transform.tileZoom),i=Math.pow(2,r.tileID.overscaledZ),o=r.tileSize*Math.pow(2,e.transform.tileZoom)/i,a=o*(r.tileID.canonical.x+r.tileID.wrap*i),s=o*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[n,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s]}}br.prototype.draw=function(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f,m){var g,_=t.gl;if(!this.failedToCreate){for(var v in t.program.set(this.program),t.setDepthMode(r),t.setStencilMode(n),t.setColorMode(i),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[v].set(a[v]);d&&d.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var y=(g={},g[_.LINES]=2,g[_.TRIANGLES]=3,g[_.LINE_STRIP]=1,g)[e],x=0,b=c.get();x<b.length;x+=1){var E=b[x],T=E.vaos||(E.vaos={});(T[s]||(T[s]=new yr)).bind(t,this,l,d?d.getPaintVertexBuffers():[],u,E.vertexOffset,f,m),_.drawElements(e,E.primitiveLength*y,_.UNSIGNED_SHORT,E.primitiveOffset*y*2)}}};var Tr=function(e,r,n,i){var o=r.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],l=t.create$1();"viewport"===o.properties.get("anchor")&&t.fromRotation(l,-r.transform.angle),t.transformMat3(s,s,l);var u=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+n,u_opacity:i}},Sr=function(e,r,n,i,o,a,s){return t.extend(Tr(e,r,n,i),Er(a,r,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},Ar=function(t){return{u_matrix:t}},wr=function(e,r,n,i){return t.extend(Ar(e),Er(n,r,i))},Cr=function(t,e){return{u_matrix:t,u_world:e}},Rr=function(e,r,n,i,o){return t.extend(wr(e,r,n,i),{u_world:o})},Lr=function(e,r,n,i){var o,a,s=e.transform;if("map"===i.paint.get("circle-pitch-alignment")){var l=pe(n,1,s.zoom);o=!0,a=[l,l]}else o=!1,a=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(r.posMatrix,n,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:a}},Ir=function(t,e,r){var n=pe(r,1,e.zoom),i=Math.pow(2,e.zoom-r.tileID.overscaledZ),o=r.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:n,u_extrude_scale:[e.pixelsToGLUnits[0]/(n*i),e.pixelsToGLUnits[1]/(n*i)],u_overscale_factor:o}},Mr=function(t,e,r){return{u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:r.cameraToCenterDistance,u_viewport_size:[r.width,r.height]}},Or=function(t,e,r){return void 0===r&&(r=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:r}},Pr=function(t){return{u_matrix:t}},Dr=function(t,e,r,n){return{u_matrix:t,u_extrude_scale:pe(e,1,r),u_intensity:n}},Br=function(e,r,n){var i=e.transform;return{u_matrix:zr(e,r,n),u_ratio:1/pe(r,1,i.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},Nr=function(e,r,n,i){return t.extend(Br(e,r,n),{u_image:0,u_image_height:i})},Fr=function(e,r,n,i){var o=e.transform,a=Ur(r,o);return{u_matrix:zr(e,r,n),u_texsize:r.imageAtlasTexture.size,u_ratio:1/pe(r,1,o.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[a,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},kr=function(e,r,n,i,o){var a=e.lineAtlas,s=Ur(r,e.transform),l="round"===n.layout.get("line-cap"),u=a.getDash(i.from,l),c=a.getDash(i.to,l),h=u.width*o.fromScale,p=c.width*o.toScale;return t.extend(Br(e,r,n),{u_patternscale_a:[s/h,-u.height/2],u_patternscale_b:[s/p,-c.height/2],u_sdfgamma:a.width/(256*Math.min(h,p)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:c.y,u_mix:o.t})};function Ur(t,e){return 1/pe(t,1,e.tileZoom)}function zr(t,e,r){return t.translatePosMatrix(e.tileID.posMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}var Gr=function(t,e,r,n,i){return{u_matrix:t,u_tl_parent:e,u_scale_parent:r,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=i.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:jr(i.paint.get("raster-hue-rotate"))};var o,a};function jr(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}var Vr,Hr=function(t,e,r,n,i,o,a,s,l,u){var c=i.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:c.width/c.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+n,u_texsize:u,u_texture:0}},Wr=function(e,r,n,i,o,a,s,l,u,c,h){var p=o.transform;return t.extend(Hr(e,r,n,i,o,a,s,l,u,c),{u_gamma_scale:i?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},Xr=function(e,r,n,i,o,a,s,l,u,c){return t.extend(Wr(e,r,n,i,o,a,s,l,!0,u,!0),{u_texsize_icon:c,u_texture_icon:1})},Zr=function(t,e,r){return{u_matrix:t,u_opacity:e,u_color:r}},qr=function(e,r,n,i,o,a){return t.extend(function(t,e,r,n){var i=r.imageManager.getPattern(t.from.toString()),o=r.imageManager.getPattern(t.to.toString()),a=r.imageManager.getPixelSize(),s=a.width,l=a.height,u=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,r.transform.tileZoom)/u,h=c*(n.tileID.canonical.x+n.tileID.wrap*u),p=c*n.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,l],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/pe(n,1,r.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(i,a,n,o),{u_matrix:e,u_opacity:r})},Yr={fillExtrusion:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_opacity:new t.Uniform1f(e,r.u_opacity)}},fillExtrusionPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,r.u_height_factor),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade),u_opacity:new t.Uniform1f(e,r.u_opacity)}},fill:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},fillPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},fillOutline:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world)}},fillOutlinePattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},circle:function(e,r){return{u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,r.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},collisionBox:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,r.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,r.u_overscale_factor)}},collisionCircle:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,r.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,r.u_viewport_size)}},debug:function(e,r){return{u_color:new t.UniformColor(e,r.u_color),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_overlay:new t.Uniform1i(e,r.u_overlay),u_overlay_scale:new t.Uniform1f(e,r.u_overlay_scale)}},clippingMask:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},heatmap:function(e,r){return{u_extrude_scale:new t.Uniform1f(e,r.u_extrude_scale),u_intensity:new t.Uniform1f(e,r.u_intensity),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},heatmapTexture:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_color_ramp:new t.Uniform1i(e,r.u_color_ramp),u_opacity:new t.Uniform1f(e,r.u_opacity)}},hillshade:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_latrange:new t.Uniform2f(e,r.u_latrange),u_light:new t.Uniform2f(e,r.u_light),u_shadow:new t.UniformColor(e,r.u_shadow),u_highlight:new t.UniformColor(e,r.u_highlight),u_accent:new t.UniformColor(e,r.u_accent)}},hillshadePrepare:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_dimension:new t.Uniform2f(e,r.u_dimension),u_zoom:new t.Uniform1f(e,r.u_zoom),u_unpack:new t.Uniform4f(e,r.u_unpack)}},line:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels)}},lineGradient:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_image:new t.Uniform1i(e,r.u_image),u_image_height:new t.Uniform1f(e,r.u_image_height)}},linePattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_texsize:new t.Uniform2f(e,r.u_texsize),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_image:new t.Uniform1i(e,r.u_image),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},lineSDF:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,r.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,r.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,r.u_sdfgamma),u_image:new t.Uniform1i(e,r.u_image),u_tex_y_a:new t.Uniform1f(e,r.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,r.u_tex_y_b),u_mix:new t.Uniform1f(e,r.u_mix)}},raster:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_tl_parent:new t.Uniform2f(e,r.u_tl_parent),u_scale_parent:new t.Uniform1f(e,r.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,r.u_buffer_scale),u_fade_t:new t.Uniform1f(e,r.u_fade_t),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image0:new t.Uniform1i(e,r.u_image0),u_image1:new t.Uniform1i(e,r.u_image1),u_brightness_low:new t.Uniform1f(e,r.u_brightness_low),u_brightness_high:new t.Uniform1f(e,r.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,r.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,r.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,r.u_spin_weights)}},symbolIcon:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1i(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture)}},symbolSDF:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1i(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture),u_gamma_scale:new t.Uniform1f(e,r.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,r.u_is_halo)}},symbolTextAndIcon:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1i(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texsize_icon:new t.Uniform2f(e,r.u_texsize_icon),u_texture:new t.Uniform1i(e,r.u_texture),u_texture_icon:new t.Uniform1i(e,r.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,r.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,r.u_is_halo)}},background:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_color:new t.UniformColor(e,r.u_color)}},backgroundPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image:new t.Uniform1i(e,r.u_image),u_pattern_tl_a:new t.Uniform2f(e,r.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,r.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,r.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,r.u_pattern_br_b),u_texsize:new t.Uniform2f(e,r.u_texsize),u_mix:new t.Uniform1f(e,r.u_mix),u_pattern_size_a:new t.Uniform2f(e,r.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,r.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,r.u_scale_a),u_scale_b:new t.Uniform1f(e,r.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,r.u_tile_units_to_pixels)}}};function Kr(e,r,n,i,o,a,s){for(var l=e.context,u=l.gl,c=e.useProgram("collisionBox"),h=[],p=0,d=0,f=0;f<i.length;f++){var m=i[f],g=r.getTile(m),_=g.getBucket(n);if(_){var v=m.posMatrix;0===o[0]&&0===o[1]||(v=e.translatePosMatrix(m.posMatrix,g,o,a));var y=s?_.textCollisionBox:_.iconCollisionBox,x=_.collisionCircleArray;if(x.length>0){var b=t.create(),E=v;t.mul(b,_.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(b,b,_.placementViewportMatrix),h.push({circleArray:x,circleOffset:d,transform:E,invTransform:b}),d=p+=x.length/4}y&&c.draw(l,u.LINES,At.disabled,wt.disabled,e.colorModeForRenderPass(),Rt.disabled,Ir(v,e.transform,g),n.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,null,e.transform.zoom,null,null,y.collisionVertexBuffer)}}if(s&&h.length){var T=e.useProgram("collisionCircle"),S=new t.StructArrayLayout2f1f2i16;S.resize(4*p),S._trim();for(var A=0,w=0,C=h;w<C.length;w+=1)for(var R=C[w],L=0;L<R.circleArray.length/4;L++){var I=4*L,M=R.circleArray[I+0],O=R.circleArray[I+1],P=R.circleArray[I+2],D=R.circleArray[I+3];S.emplace(A++,M,O,P,D,0),S.emplace(A++,M,O,P,D,1),S.emplace(A++,M,O,P,D,2),S.emplace(A++,M,O,P,D,3)}(!Vr||Vr.length<2*p)&&(Vr=function(e){var r=2*e,n=new t.StructArrayLayout3ui6;n.resize(r),n._trim();for(var i=0;i<r;i++){var o=6*i;n.uint16[o+0]=4*i+0,n.uint16[o+1]=4*i+1,n.uint16[o+2]=4*i+2,n.uint16[o+3]=4*i+2,n.uint16[o+4]=4*i+3,n.uint16[o+5]=4*i+0}return n}(p));for(var B=l.createIndexBuffer(Vr,!0),N=l.createVertexBuffer(S,t.collisionCircleLayout.members,!0),F=0,k=h;F<k.length;F+=1){var U=k[F],z=Mr(U.transform,U.invTransform,e.transform);T.draw(l,u.TRIANGLES,At.disabled,wt.disabled,e.colorModeForRenderPass(),Rt.disabled,z,n.id,N,B,t.SegmentVector.simpleSegment(0,2*U.circleOffset,U.circleArray.length,U.circleArray.length/2),null,e.transform.zoom,null,null,null)}N.destroy(),B.destroy()}}var $r=t.identity(new Float32Array(16));function Qr(e,r,n,i,o,a){var s=t.getAnchorAlignment(e),l=-(s.horizontalAlign-.5)*r,u=-(s.verticalAlign-.5)*n,c=t.evaluateVariableOffset(e,i);return new t.Point((l/o+c[0])*a,(u/o+c[1])*a)}function Jr(e,r,n,i,o,a,s,l,u,c,h){var p=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,f=e.icon.dynamicLayoutVertexArray,m={};d.clear();for(var g=0;g<p.length;g++){var _=p.get(g),v=_.hidden||!_.crossTileID||e.allowVerticalPlacement&&!_.placedOrientation?null:i[_.crossTileID];if(v){var y=new t.Point(_.anchorX,_.anchorY),x=Jt(y,n?l:s),b=te(a.cameraToCenterDistance,x.signedDistanceFromCamera),E=o.evaluateSizeForFeature(e.textSizeData,c,_)*b/t.ONE_EM;n&&(E*=e.tilePixelRatio/u);for(var T=Qr(v.anchor,v.width,v.height,v.textOffset,v.textBoxScale,E),S=n?Jt(y.add(T),s).point:x.point.add(r?T.rotate(-a.angle):T),A=e.allowVerticalPlacement&&_.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,w=0;w<_.numGlyphs;w++)t.addDynamicAttributes(d,S,A);h&&_.associatedIconIndex>=0&&(m[_.associatedIconIndex]={shiftedAnchor:S,angle:A})}else ue(_.numGlyphs,d)}if(h){f.clear();for(var C=e.icon.placedSymbolArray,R=0;R<C.length;R++){var L=C.get(R);if(L.hidden)ue(L.numGlyphs,f);else{var I=m[R];if(I)for(var M=0;M<L.numGlyphs;M++)t.addDynamicAttributes(f,I.shiftedAnchor,I.angle);else ue(L.numGlyphs,f)}}e.icon.dynamicLayoutVertexBuffer.updateData(f)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function tn(t,e,r){return r.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function en(e,r,n,i,o,a,s,l,u,c,h,p){for(var d=e.context,f=d.gl,m=e.transform,g="map"===l,_="map"===u,v=g&&"point"!==n.layout.get("symbol-placement"),y=g&&!_&&!v,x=void 0!==n.layout.get("symbol-sort-key").constantOr(1),b=!1,E=e.depthModeForSublayer(0,At.ReadOnly),T=n.layout.get("text-variable-anchor"),S=[],A=0,w=i;A<w.length;A+=1){var C=w[A],R=r.getTile(C),L=R.getBucket(n);if(L){var I=o?L.text:L.icon;if(I&&I.segments.get().length){var M=I.programConfigurations.get(n.id),O=o||L.sdfIcons,P=o?L.textSizeData:L.iconSizeData,D=_||0!==m.pitch,B=e.useProgram(tn(O,o,L),M),N=t.evaluateSizeForZoom(P,m.zoom),F=void 0,k=[0,0],U=void 0,z=void 0,G=null,j=void 0;if(o)U=R.glyphAtlasTexture,z=f.LINEAR,F=R.glyphAtlasTexture.size,L.iconsInText&&(k=R.imageAtlasTexture.size,G=R.imageAtlasTexture,j=D||e.options.rotating||e.options.zooming||"composite"===P.kind||"camera"===P.kind?f.LINEAR:f.NEAREST);else{var V=1!==n.layout.get("icon-size").constantOr(0)||L.iconsNeedLinear;U=R.imageAtlasTexture,z=O||e.options.rotating||e.options.zooming||V||D?f.LINEAR:f.NEAREST,F=R.imageAtlasTexture.size}var H=pe(R,1,e.transform.zoom),W=$t(C.posMatrix,_,g,e.transform,H),X=Qt(C.posMatrix,_,g,e.transform,H),Z=T&&L.hasTextData(),q="none"!==n.layout.get("icon-text-fit")&&Z&&L.hasIconData();v&&re(L,C.posMatrix,e,o,W,X,_,c);var Y=e.translatePosMatrix(C.posMatrix,R,a,s),K=v||o&&T||q?$r:W,$=e.translatePosMatrix(X,R,a,s,!0),Q=O&&0!==n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),J={program:B,buffers:I,uniformValues:O?L.iconsInText?Xr(P.kind,N,y,_,e,Y,K,$,F,k):Wr(P.kind,N,y,_,e,Y,K,$,o,F,!0):Hr(P.kind,N,y,_,e,Y,K,$,o,F),atlasTexture:U,atlasTextureIcon:G,atlasInterpolation:z,atlasInterpolationIcon:j,isSDF:O,hasHalo:Q};if(x&&L.canOverlap){b=!0;for(var tt=0,et=I.segments.get();tt<et.length;tt+=1){var rt=et[tt];S.push({segments:new t.SegmentVector([rt]),sortKey:rt.sortKey,state:J})}}else S.push({segments:I.segments,sortKey:0,state:J})}}}b&&S.sort((function(t,e){return t.sortKey-e.sortKey}));for(var nt=0,it=S;nt<it.length;nt+=1){var ot=it[nt],at=ot.state;if(d.activeTexture.set(f.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,f.CLAMP_TO_EDGE),at.atlasTextureIcon&&(d.activeTexture.set(f.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),at.isSDF){var st=at.uniformValues;at.hasHalo&&(st.u_is_halo=1,rn(at.buffers,ot.segments,n,e,at.program,E,h,p,st)),st.u_is_halo=0}rn(at.buffers,ot.segments,n,e,at.program,E,h,p,at.uniformValues)}}function rn(t,e,r,n,i,o,a,s,l){var u=n.context;i.draw(u,u.gl.TRIANGLES,o,a,s,Rt.disabled,l,r.id,t.layoutVertexBuffer,t.indexBuffer,e,r.paint,n.transform.zoom,t.programConfigurations.get(r.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function nn(t,e,r,n,i,o,a){var s,l,u,c,h,p=t.context.gl,d=r.paint.get("fill-pattern"),f=d&&d.constantOr(1),m=r.getCrossfadeParameters();a?(l=f&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(l=f?"fillPattern":"fill",s=p.TRIANGLES);for(var g=0,_=n;g<_.length;g+=1){var v=_[g],y=e.getTile(v);if(!f||y.patternsLoaded()){var x=y.getBucket(r);if(x){var b=x.programConfigurations.get(r.id),E=t.useProgram(l,b);f&&(t.context.activeTexture.set(p.TEXTURE0),y.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),b.updatePaintBuffers(m));var T=d.constantOr(null);if(T&&y.imageAtlas){var S=y.imageAtlas,A=S.patternPositions[T.to.toString()],w=S.patternPositions[T.from.toString()];A&&w&&b.setConstantPatternPositions(A,w)}var C=t.translatePosMatrix(v.posMatrix,y,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(a){c=x.indexBuffer2,h=x.segments2;var R=[p.drawingBufferWidth,p.drawingBufferHeight];u="fillOutlinePattern"===l&&f?Rr(C,t,m,y,R):Cr(C,R)}else c=x.indexBuffer,h=x.segments,u=f?wr(C,t,m,y):Ar(C);E.draw(t.context,s,i,t.stencilModeForClipping(v),o,Rt.disabled,u,r.id,x.layoutVertexBuffer,c,h,r.paint,t.transform.zoom,b)}}}}function on(t,e,r,n,i,o,a){for(var s=t.context,l=s.gl,u=r.paint.get("fill-extrusion-pattern"),c=u.constantOr(1),h=r.getCrossfadeParameters(),p=r.paint.get("fill-extrusion-opacity"),d=0,f=n;d<f.length;d+=1){var m=f[d],g=e.getTile(m),_=g.getBucket(r);if(_){var v=_.programConfigurations.get(r.id),y=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",v);c&&(t.context.activeTexture.set(l.TEXTURE0),g.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),v.updatePaintBuffers(h));var x=u.constantOr(null);if(x&&g.imageAtlas){var b=g.imageAtlas,E=b.patternPositions[x.to.toString()],T=b.patternPositions[x.from.toString()];E&&T&&v.setConstantPatternPositions(E,T)}var S=t.translatePosMatrix(m.posMatrix,g,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),A=r.paint.get("fill-extrusion-vertical-gradient"),w=c?Sr(S,t,A,p,m,h,g):Tr(S,t,A,p);y.draw(s,s.gl.TRIANGLES,i,o,a,Rt.backCCW,w,r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,r.paint,t.transform.zoom,v)}}}function an(e,r,n,i,o,a){var s=e.context,l=s.gl,u=r.fbo;if(u){var c=e.useProgram("hillshade");s.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,u.colorAttachment.get());var h=function(e,r,n){var i=n.paint.get("hillshade-shadow-color"),o=n.paint.get("hillshade-highlight-color"),a=n.paint.get("hillshade-accent-color"),s=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var l,u,c,h=!e.options.moving;return{u_matrix:e.transform.calculatePosMatrix(r.tileID.toUnwrapped(),h),u_image:0,u_latrange:(l=r.tileID,u=Math.pow(2,l.canonical.z),c=l.canonical.y,[new t.MercatorCoordinate(0,c/u).toLngLat().lat,new t.MercatorCoordinate(0,(c+1)/u).toLngLat().lat]),u_light:[n.paint.get("hillshade-exaggeration"),s],u_shadow:i,u_highlight:o,u_accent:a}}(e,r,n);c.draw(s,l.TRIANGLES,i,o,a,Rt.disabled,h,n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}}function sn(e,r,n,i,o,a){var s=e.context,l=s.gl,u=r.dem;if(u&&u.data){var c=u.dim,h=u.stride,p=u.getPixels();if(s.activeTexture.set(l.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||e.getTileTexture(h),r.demTexture){var d=r.demTexture;d.update(p,{premultiply:!1}),d.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else r.demTexture=new t.Texture(s,p,l.RGBA,{premultiply:!1}),r.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);s.activeTexture.set(l.TEXTURE0);var f=r.fbo;if(!f){var m=new t.Texture(s,{width:c,height:c,data:null},l.RGBA);m.bind(l.LINEAR,l.CLAMP_TO_EDGE),(f=r.fbo=s.createFramebuffer(c,c,!0)).colorAttachment.set(m.texture)}s.bindFramebuffer.set(f.framebuffer),s.viewport.set([0,0,c,c]),e.useProgram("hillshadePrepare").draw(s,l.TRIANGLES,i,o,a,Rt.disabled,function(e,r){var n=r.stride,i=t.create();return t.ortho(i,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(i,i,[0,-t.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[n,n],u_zoom:e.overscaledZ,u_unpack:r.getUnpackVector()}}(r.tileID,u),n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function ln(e,r,n,i,o){var a=i.paint.get("raster-fade-duration");if(a>0){var s=t.browser.now(),l=(s-e.timeAdded)/a,u=r?(s-r.timeAdded)/a:-1,c=n.getSource(),h=o.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),p=!r||Math.abs(r.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),d=p&&e.refreshedUponExpiration?1:t.clamp(p?l:1-u,0,1);return e.refreshedUponExpiration&&l>=1&&(e.refreshedUponExpiration=!1),r?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}var un=new t.Color(1,0,0,1),cn=new t.Color(0,1,0,1),hn=new t.Color(0,0,1,1),pn=new t.Color(1,0,1,1),dn=new t.Color(0,1,1,1);function fn(t,e,r,n){gn(t,0,e+r/2,t.transform.width,r,n)}function mn(t,e,r,n){gn(t,e-r/2,0,r,t.transform.height,n)}function gn(e,r,n,i,o,a){var s=e.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(r*t.browser.devicePixelRatio,n*t.browser.devicePixelRatio,i*t.browser.devicePixelRatio,o*t.browser.devicePixelRatio),s.clear({color:a}),l.disable(l.SCISSOR_TEST)}function _n(e,r,n){var i=e.context,o=i.gl,a=n.posMatrix,s=e.useProgram("debug"),l=At.disabled,u=wt.disabled,c=e.colorModeForRenderPass();i.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.draw(i,o.LINE_STRIP,l,u,c,Rt.disabled,Or(a,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var h=r.getTileByID(n.key).latestRawTileData,p=Math.floor((h&&h.byteLength||0)/1024),d=r.getTile(n).tileSize,f=512/Math.min(d,512)*(n.overscaledZ/e.transform.zoom)*.5,m=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(m+=" => "+n.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var r=t.debugOverlayCanvas,n=t.context.gl,i=t.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,r.width,r.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(e,5,5),i.strokeText(e,5,5),t.debugOverlayTexture.update(r),t.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(e,m+" "+p+"kb"),s.draw(i,o.TRIANGLES,l,u,Ct.alphaBlended,Rt.disabled,Or(a,t.Color.transparent,f),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}var vn={symbol:function(e,r,n,i,o){if("translucent"===e.renderPass){var a=wt.disabled,s=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(e,r,n,i,o,a,s){for(var l=r.transform,u="map"===o,c="map"===a,h=0,p=e;h<p.length;h+=1){var d=p[h],f=i.getTile(d),m=f.getBucket(n);if(m&&m.text&&m.text.segments.get().length){var g=t.evaluateSizeForZoom(m.textSizeData,l.zoom),_=pe(f,1,r.transform.zoom),v=$t(d.posMatrix,c,u,r.transform,_),y="none"!==n.layout.get("icon-text-fit")&&m.hasIconData();if(g){var x=Math.pow(2,l.zoom-f.tileID.overscaledZ);Jr(m,u,c,s,t.symbolSize,l,v,d.posMatrix,x,g,y)}}}}(i,e,n,r,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),o),0!==n.paint.get("icon-opacity").constantOr(1)&&en(e,r,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),a,s),0!==n.paint.get("text-opacity").constantOr(1)&&en(e,r,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),a,s),r.map.showCollisionBoxes&&(Kr(e,r,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Kr(e,r,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))}},circle:function(e,r,n,i){if("translucent"===e.renderPass){var o=n.paint.get("circle-opacity"),a=n.paint.get("circle-stroke-width"),s=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1);if(0!==o.constantOr(1)||0!==a.constantOr(1)&&0!==s.constantOr(1)){for(var u=e.context,c=u.gl,h=e.depthModeForSublayer(0,At.ReadOnly),p=wt.disabled,d=e.colorModeForRenderPass(),f=[],m=0;m<i.length;m++){var g=i[m],_=r.getTile(g),v=_.getBucket(n);if(v){var y=v.programConfigurations.get(n.id),x={programConfiguration:y,program:e.useProgram("circle",y),layoutVertexBuffer:v.layoutVertexBuffer,indexBuffer:v.indexBuffer,uniformValues:Lr(e,g,_,n)};if(l)for(var b=0,E=v.segments.get();b<E.length;b+=1){var T=E[b];f.push({segments:new t.SegmentVector([T]),sortKey:T.sortKey,state:x})}else f.push({segments:v.segments,sortKey:0,state:x})}}l&&f.sort((function(t,e){return t.sortKey-e.sortKey}));for(var S=0,A=f;S<A.length;S+=1){var w=A[S],C=w.state;C.program.draw(u,c.TRIANGLES,h,p,d,Rt.disabled,C.uniformValues,n.id,C.layoutVertexBuffer,C.indexBuffer,w.segments,n.paint,e.transform.zoom,C.programConfiguration)}}}},heatmap:function(e,r,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,a=o.gl,s=wt.disabled,l=new Ct([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,r){var n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var i=r.heatmapFbo;if(i)n.bindTexture(n.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{var o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),i=r.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,r,n){var i=t.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.width/4,e.height/4,0,i.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),n.colorAttachment.set(r)}(t,e,o,i)}}(o,e,n),o.clear({color:t.Color.transparent});for(var u=0;u<i.length;u++){var c=i[u];if(!r.hasRenderableParent(c)){var h=r.getTile(c),p=h.getBucket(n);if(p){var d=p.programConfigurations.get(n.id);e.useProgram("heatmap",d).draw(o,a.TRIANGLES,At.disabled,s,l,Rt.disabled,Dr(c.posMatrix,h,e.transform.zoom,n.paint.get("heatmap-intensity")),n.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,n.paint,e.transform.zoom,d)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,r){var n=e.context,i=n.gl,o=r.heatmapFbo;if(o){n.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),n.activeTexture.set(i.TEXTURE1);var a=r.colorRampTexture;a||(a=r.colorRampTexture=new t.Texture(n,r.colorRamp,i.RGBA)),a.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(n,i.TRIANGLES,At.disabled,wt.disabled,e.colorModeForRenderPass(),Rt.disabled,function(e,r,n,i){var o=t.create();t.ortho(o,0,e.width,e.height,0,0,1);var a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:r.paint.get("heatmap-opacity")}}(e,r),r.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,r.paint,e.transform.zoom)}}(e,n))},line:function(e,r,n,i){if("translucent"===e.renderPass){var o=n.paint.get("line-opacity"),a=n.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1))for(var s=e.depthModeForSublayer(0,At.ReadOnly),l=e.colorModeForRenderPass(),u=n.paint.get("line-dasharray"),c=n.paint.get("line-pattern"),h=c.constantOr(1),p=n.paint.get("line-gradient"),d=n.getCrossfadeParameters(),f=h?"linePattern":u?"lineSDF":p?"lineGradient":"line",m=e.context,g=m.gl,_=!0,v=0,y=i;v<y.length;v+=1){var x=y[v],b=r.getTile(x);if(!h||b.patternsLoaded()){var E=b.getBucket(n);if(E){var T=E.programConfigurations.get(n.id),S=e.context.program.get(),A=e.useProgram(f,T),w=_||A.program!==S,C=c.constantOr(null);if(C&&b.imageAtlas){var R=b.imageAtlas,L=R.patternPositions[C.to.toString()],I=R.patternPositions[C.from.toString()];L&&I&&T.setConstantPatternPositions(L,I)}var M=h?Fr(e,b,n,d):u?kr(e,b,n,u,d):p?Nr(e,b,n,E.lineClipsArray.length):Br(e,b,n);if(h)m.activeTexture.set(g.TEXTURE0),b.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),T.updatePaintBuffers(d);else if(u&&(w||e.lineAtlas.dirty))m.activeTexture.set(g.TEXTURE0),e.lineAtlas.bind(m);else if(p){var O=E.gradients[n.id],P=O.texture;if(n.gradientVersion!==O.version){var D=256;if(n.stepInterpolant){var B=r.getSource().maxzoom,N=x.canonical.z===B?Math.ceil(1<<e.transform.maxZoom-x.canonical.z):1;D=t.clamp(t.nextPowerOfTwo(E.maxLineLength/t.EXTENT*1024*N),256,m.maxTextureSize)}O.gradient=t.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:D,image:O.gradient||void 0,clips:E.lineClipsArray}),O.texture?O.texture.update(O.gradient):O.texture=new t.Texture(m,O.gradient,g.RGBA),O.version=n.gradientVersion,P=O.texture}m.activeTexture.set(g.TEXTURE0),P.bind(n.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}A.draw(m,g.TRIANGLES,s,e.stencilModeForClipping(x),l,Rt.disabled,M,n.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,n.paint,e.transform.zoom,T,E.layoutVertexBuffer2),_=!1}}}}},fill:function(e,r,n,i){var o=n.paint.get("fill-color"),a=n.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.colorModeForRenderPass(),l=n.paint.get("fill-pattern"),u=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===u){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?At.ReadWrite:At.ReadOnly);nn(e,r,n,i,c,s,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){var h=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,At.ReadOnly);nn(e,r,n,i,h,s,!0)}}},"fill-extrusion":function(t,e,r,n){var i=r.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===t.renderPass){var o=new At(t.context.gl.LEQUAL,At.ReadWrite,t.depthRangeFor3D);if(1!==i||r.paint.get("fill-extrusion-pattern").constantOr(1))on(t,e,r,n,o,wt.disabled,Ct.disabled),on(t,e,r,n,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();on(t,e,r,n,o,wt.disabled,a)}}},hillshade:function(t,e,r,n){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var i=t.context,o=t.depthModeForSublayer(0,At.ReadOnly),a=t.colorModeForRenderPass(),s="translucent"===t.renderPass?t.stencilConfigForOverlap(n):[{},n],l=s[0],u=0,c=s[1];u<c.length;u+=1){var h=c[u],p=e.getTile(h);p.needsHillshadePrepare&&"offscreen"===t.renderPass?sn(t,p,r,o,wt.disabled,a):"translucent"===t.renderPass&&an(t,p,r,o,l[h.overscaledZ],a)}i.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,r,n){if("translucent"===t.renderPass&&0!==r.paint.get("raster-opacity")&&n.length)for(var i=t.context,o=i.gl,a=e.getSource(),s=t.useProgram("raster"),l=t.colorModeForRenderPass(),u=a instanceof O?[{},n]:t.stencilConfigForOverlap(n),c=u[0],h=u[1],p=h[h.length-1].overscaledZ,d=!t.options.moving,f=0,m=h;f<m.length;f+=1){var g=m[f],_=t.depthModeForSublayer(g.overscaledZ-p,1===r.paint.get("raster-opacity")?At.ReadWrite:At.ReadOnly,o.LESS),v=e.getTile(g),y=t.transform.calculatePosMatrix(g.toUnwrapped(),d);v.registerFadeDuration(r.paint.get("raster-fade-duration"));var x=e.findLoadedParent(g,0),b=ln(v,x,e,r,t.transform),E=void 0,T=void 0,S="nearest"===r.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;i.activeTexture.set(o.TEXTURE0),v.texture.bind(S,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(o.TEXTURE1),x?(x.texture.bind(S,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),E=Math.pow(2,x.tileID.overscaledZ-v.tileID.overscaledZ),T=[v.tileID.canonical.x*E%1,v.tileID.canonical.y*E%1]):v.texture.bind(S,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var A=Gr(y,T||[0,0],E||1,b,r);a instanceof O?s.draw(i,o.TRIANGLES,_,wt.disabled,l,Rt.disabled,A,r.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):s.draw(i,o.TRIANGLES,_,c[g.overscaledZ],l,Rt.disabled,A,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,r){var n=r.paint.get("background-color"),i=r.paint.get("background-opacity");if(0!==i){var o=t.context,a=o.gl,s=t.transform,l=s.tileSize,u=r.paint.get("background-pattern");if(!t.isPatternMissing(u)){var c=!u&&1===n.a&&1===i&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===c){var h=wt.disabled,p=t.depthModeForSublayer(0,"opaque"===c?At.ReadWrite:At.ReadOnly),d=t.colorModeForRenderPass(),f=t.useProgram(u?"backgroundPattern":"background"),m=s.coveringTiles({tileSize:l});u&&(o.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));for(var g=r.getCrossfadeParameters(),_=0,v=m;_<v.length;_+=1){var y=v[_],x=t.transform.calculatePosMatrix(y.toUnwrapped()),b=u?qr(x,i,t,u,{tileID:y,tileSize:l},g):Zr(x,i,n);f.draw(o,a.TRIANGLES,p,h,d,Rt.disabled,b,r.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,r){for(var n=0;n<r.length;n++)_n(t,e,r[n])},custom:function(t,e,r){var n=t.context,i=r.implementation;if("offscreen"===t.renderPass){var o=i.prerender;o&&(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),o.call(i,n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(wt.disabled);var a="3d"===i.renderingMode?new At(t.context.gl.LEQUAL,At.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,At.ReadOnly);n.setDepthMode(a),i.render(n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}},yn=function(t,e){this.context=new Lt(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=It.maxUnderzooming+It.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ke,this.gpuTimers={}};yn.prototype.resize=function(e,r){if(this.width=e*t.browser.devicePixelRatio,this.height=r*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var n=0,i=this.style._order;n<i.length;n+=1)this.style._layers[i[n]].resize()},yn.prototype.setup=function(){var e=this.context,r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(r,He.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(n,He.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var i=new t.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(t.EXTENT,0,t.EXTENT,0),i.emplaceBack(0,t.EXTENT,0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(i,M.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,He.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);var l=this.context.gl;this.stencilClearMode=new wt({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)},yn.prototype.clearStencil=function(){var e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var n=t.create();t.ortho(n,0,this.width,this.height,0,0,1),t.scale(n,n,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,r.TRIANGLES,At.disabled,this.stencilClearMode,Ct.disabled,Rt.disabled,Pr(n),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},yn.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var r=this.context,n=r.gl;this.nextStencilID+e.length>256&&this.clearStencil(),r.setColorMode(Ct.disabled),r.setDepthMode(At.disabled);var i=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],l=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(r,n.TRIANGLES,At.disabled,new wt({func:n.ALWAYS,mask:0},l,255,n.KEEP,n.KEEP,n.REPLACE),Ct.disabled,Rt.disabled,Pr(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},yn.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new wt({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},yn.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new wt({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},yn.prototype.stencilConfigForOverlap=function(t){var e,r=this.context.gl,n=t.sort((function(t,e){return e.overscaledZ-t.overscaledZ})),i=n[n.length-1].overscaledZ,o=n[0].overscaledZ-i+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();for(var a={},s=0;s<o;s++)a[s+i]=new wt({func:r.GEQUAL,mask:255},s+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=o,[a,n]}return[(e={},e[i]=wt.disabled,e),n]},yn.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Ct([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Ct.unblended:Ct.alphaBlended},yn.prototype.depthModeForSublayer=function(t,e,r){if(!this.opaquePassEnabledForLayer())return At.disabled;var n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new At(r||this.context.gl.LEQUAL,e,[n,n])},yn.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},yn.prototype.render=function(e,r){var n=this;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var i=this.style._order,o=this.style.sourceCaches;for(var a in o){var s=o[a];s.used&&s.prepare(this.context)}var l,u,c={},h={},p={};for(var d in o){var f=o[d];c[d]=f.getVisibleCoordinates(),h[d]=c[d].slice().reverse(),p[d]=f.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var m=0;m<i.length;m++)if(this.style._layers[i[m]].is3D()){this.opaquePassCutoff=m;break}this.renderPass="offscreen";for(var g=0,_=i;g<_.length;g+=1){var v=this.style._layers[_[g]];if(v.hasOffscreenPass()&&!v.isHidden(this.transform.zoom)){var y=h[v.source];("custom"===v.type||y.length)&&this.renderLayer(this,o[v.source],v,y)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){var x=this.style._layers[i[this.currentLayer]],b=o[x.source],E=c[x.source];this._renderTileClippingMasks(x,E),this.renderLayer(this,b,x,E)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var T=this.style._layers[i[this.currentLayer]],S=o[T.source],A=("symbol"===T.type?p:h)[T.source];this._renderTileClippingMasks(T,c[T.source]),this.renderLayer(this,S,T,A)}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(n.transform.zoom)&&(t.source!==(u&&u.id)&&(u=n.style.sourceCaches[t.source]),(!l||l.getSource().maxzoom<u.getSource().maxzoom)&&(l=u))})),l&&vn.debug(this,l,l.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;fn(t,t.transform.height-(e.top||0),3,un),fn(t,e.bottom||0,3,cn),mn(t,e.left||0,3,hn),mn(t,t.transform.width-(e.right||0),3,pn);var r=t.transform.centerPoint;!function(t,e,r,n){gn(t,e-1,r-10,2,20,n),gn(t,e-10,r-1,20,2,n)}(t,r.x,t.transform.height-r.y,dn)}(this),this.context.setDefault()},yn.prototype.renderLayer=function(t,e,r,n){r.isHidden(this.transform.zoom)||("background"===r.type||"custom"===r.type||n.length)&&(this.id=r.id,this.gpuTimingStart(r),vn[r.type](t,e,r,n,this.style.placement.variableOffsets),this.gpuTimingEnd())},yn.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,r=this.gpuTimers[t.id];r||(r=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),r.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,r.query)}},yn.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},yn.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},yn.prototype.queryGpuTimers=function(t){var e={};for(var r in t){var n=t[r],i=this.context.extTimerQuery,o=i.getQueryObjectEXT(n.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(n.query),e[r]=o}return e},yn.prototype.translatePosMatrix=function(e,r,n,i,o){if(!n[0]&&!n[1])return e;var a=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){var s=Math.sin(a),l=Math.cos(a);n=[n[0]*l-n[1]*s,n[0]*s+n[1]*l]}var u=[o?n[0]:pe(r,n[0],this.transform.zoom),o?n[1]:pe(r,n[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,u),c},yn.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},yn.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},yn.prototype.isPatternMissing=function(t){if(!t)return!1;if(!t.from||!t.to)return!0;var e=this.imageManager.getPattern(t.from.toString()),r=this.imageManager.getPattern(t.to.toString());return!e||!r},yn.prototype.useProgram=function(t,e){this.cache=this.cache||{};var r=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[r]||(this.cache[r]=new br(this.context,t,vr[t],e,Yr[t],this._showOverdrawInspector)),this.cache[r]},yn.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},yn.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)},yn.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},yn.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var xn=function(t,e){this.points=t,this.planes=e};xn.fromInvProjectionMatrix=function(e,r,n){var i=Math.pow(2,n),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(r){return t.transformMat4([],r,e)})).map((function(e){return t.scale$1([],e,1/e[3]/r*i)})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var r=t.sub([],o[e[0]],o[e[1]]),n=t.sub([],o[e[2]],o[e[1]]),i=t.normalize([],t.cross([],r,n)),a=-t.dot(i,o[e[1]]);return i.concat(a)}));return new xn(o,a)};var bn=function(e,r){this.min=e,this.max=r,this.center=t.scale$2([],t.add([],this.min,this.max),.5)};bn.prototype.quadrant=function(e){for(var r=[e%2==0,e<2],n=t.clone$2(this.min),i=t.clone$2(this.max),o=0;o<r.length;o++)n[o]=r[o]?this.min[o]:this.center[o],i[o]=r[o]?this.center[o]:this.max[o];return i[2]=this.max[2],new bn(n,i)},bn.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},bn.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},bn.prototype.intersects=function(e){for(var r=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],n=!0,i=0;i<e.planes.length;i++){for(var o=e.planes[i],a=0,s=0;s<r.length;s++)a+=t.dot$1(o,r[s])>=0;if(0===a)return 0;a!==r.length&&(n=!1)}if(n)return 2;for(var l=0;l<3;l++){for(var u=Number.MAX_VALUE,c=-Number.MAX_VALUE,h=0;h<e.points.length;h++){var p=e.points[h][l]-this.min[l];u=Math.min(u,p),c=Math.max(c,p)}if(c<0||u>this.max[l]-this.min[l])return 0}return 1};var En=function(t,e,r,n){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(r)||r<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=r,this.right=n};En.prototype.interpolate=function(e,r,n){return null!=r.top&&null!=e.top&&(this.top=t.number(e.top,r.top,n)),null!=r.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,r.bottom,n)),null!=r.left&&null!=e.left&&(this.left=t.number(e.left,r.left,n)),null!=r.right&&null!=e.right&&(this.right=t.number(e.right,r.right,n)),this},En.prototype.getCenter=function(e,r){var n=t.clamp((this.left+e-this.right)/2,0,e),i=t.clamp((this.top+r-this.bottom)/2,0,r);return new t.Point(n,i)},En.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},En.prototype.clone=function(){return new En(this.top,this.bottom,this.left,this.right)},En.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Tn=function(e,r,n,i,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=r||22,this._minPitch=null==n?0:n,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new En,this._posMatrixCache={},this._alignedPosMatrixCache={}},Sn={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Tn.prototype.clone=function(){var t=new Tn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t},Sn.minZoom.get=function(){return this._minZoom},Sn.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},Sn.maxZoom.get=function(){return this._maxZoom},Sn.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},Sn.minPitch.get=function(){return this._minPitch},Sn.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},Sn.maxPitch.get=function(){return this._maxPitch},Sn.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},Sn.renderWorldCopies.get=function(){return this._renderWorldCopies},Sn.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},Sn.worldSize.get=function(){return this.tileSize*this.scale},Sn.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Sn.size.get=function(){return new t.Point(this.width,this.height)},Sn.bearing.get=function(){return-this.angle/Math.PI*180},Sn.bearing.set=function(e){var r=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Sn.pitch.get=function(){return this._pitch/Math.PI*180},Sn.pitch.set=function(e){var r=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())},Sn.fov.get=function(){return this._fov/Math.PI*180},Sn.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},Sn.zoom.get=function(){return this._zoom},Sn.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},Sn.center.get=function(){return this._center},Sn.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Sn.padding.get=function(){return this._edgeInsets.toJSON()},Sn.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())},Sn.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Tn.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},Tn.prototype.interpolatePadding=function(t,e,r){this._unmodified=!1,this._edgeInsets.interpolate(t,e,r),this._constrain(),this._calcMatrices()},Tn.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},Tn.prototype.getVisibleUnwrappedCoordinates=function(e){var r=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var n=this.pointCoordinate(new t.Point(0,0)),i=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(n.x,i.x,o.x,a.x)),l=Math.floor(Math.max(n.x,i.x,o.x,a.x)),u=s-1;u<=l+1;u++)0!==u&&r.push(new t.UnwrappedTileID(u,e));return r},Tn.prototype.coveringTiles=function(e){var r=this.coveringZoomLevel(e),n=r;if(void 0!==e.minzoom&&r<e.minzoom)return[];void 0!==e.maxzoom&&r>e.maxzoom&&(r=e.maxzoom);var i=t.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,r),a=[o*i.x,o*i.y,0],s=xn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r),l=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(l=r);var u=function(t){return{aabb:new bn([t*o,0,0],[(t+1)*o,o,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},c=[],h=[],p=r,d=e.reparseOverscaled?n:r;if(this._renderWorldCopies)for(var f=1;f<=3;f++)c.push(u(-f)),c.push(u(f));for(c.push(u(0));c.length>0;){var m=c.pop(),g=m.x,_=m.y,v=m.fullyVisible;if(!v){var y=m.aabb.intersects(s);if(0===y)continue;v=2===y}var x=m.aabb.distanceX(a),b=m.aabb.distanceY(a),E=Math.max(Math.abs(x),Math.abs(b));if(m.zoom===p||E>3+(1<<p-m.zoom)-2&&m.zoom>=l)h.push({tileID:new t.OverscaledTileID(m.zoom===p?d:m.zoom,m.wrap,m.zoom,g,_),distanceSq:t.sqrLen([a[0]-.5-g,a[1]-.5-_])});else for(var T=0;T<4;T++){var S=(g<<1)+T%2,A=(_<<1)+(T>>1);c.push({aabb:m.aabb.quadrant(T),zoom:m.zoom+1,x:S,y:A,wrap:m.wrap,fullyVisible:v})}}return h.sort((function(t,e){return t.distanceSq-e.distanceSq})).map((function(t){return t.tileID}))},Tn.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},Sn.unmodified.get=function(){return this._unmodified},Tn.prototype.zoomScale=function(t){return Math.pow(2,t)},Tn.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Tn.prototype.project=function(e){var r=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(r)*this.worldSize)},Tn.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},Sn.point.get=function(){return this.project(this.center)},Tn.prototype.setLocationAtPoint=function(e,r){var n=this.pointCoordinate(r),i=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(n.x-i.x),o.y-(n.y-i.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},Tn.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Tn.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Tn.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},Tn.prototype.coordinateLocation=function(t){return t.toLngLat()},Tn.prototype.pointCoordinate=function(e){var r=[e.x,e.y,0,1],n=[e.x,e.y,1,1];t.transformMat4(r,r,this.pixelMatrixInverse),t.transformMat4(n,n,this.pixelMatrixInverse);var i=r[3],o=n[3],a=r[1]/i,s=n[1]/o,l=r[2]/i,u=n[2]/o,c=l===u?0:(0-l)/(u-l);return new t.MercatorCoordinate(t.number(r[0]/i,n[0]/o,c)/this.worldSize,t.number(a,s,c)/this.worldSize)},Tn.prototype.coordinatePoint=function(e){var r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(r,r,this.pixelMatrix),new t.Point(r[0]/r[3],r[1]/r[3])},Tn.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},Tn.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Tn.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Tn.prototype.calculatePosMatrix=function(e,r){void 0===r&&(r=!1);var n=e.key,i=r?this._alignedPosMatrixCache:this._posMatrixCache;if(i[n])return i[n];var o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,l=t.identity(new Float64Array(16));return t.translate(l,l,[s*a,o.y*a,0]),t.scale(l,l,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(l,r?this.alignedProjMatrix:this.projMatrix,l),i[n]=new Float32Array(l),i[n]},Tn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Tn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,r,n,i,o=-90,a=90,s=-180,l=180,u=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;o=t.mercatorYfromLat(h[1])*this.worldSize,e=(a=t.mercatorYfromLat(h[0])*this.worldSize)-o<u.y?u.y/(a-o):0}if(this.lngRange){var p=this.lngRange;s=t.mercatorXfromLng(p[0])*this.worldSize,r=(l=t.mercatorXfromLng(p[1])*this.worldSize)-s<u.x?u.x/(l-s):0}var d=this.point,f=Math.max(r||0,e||0);if(f)return this.center=this.unproject(new t.Point(r?(l+s)/2:d.x,e?(a+o)/2:d.y)),this.zoom+=this.scaleZoom(f),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var m=d.y,g=u.y/2;m-g<o&&(i=o+g),m+g>a&&(i=a-g)}if(this.lngRange){var _=d.x,v=u.x/2;_-v<s&&(n=s+v),_+v>l&&(n=l-v)}void 0===n&&void 0===i||(this.center=this.unproject(new t.Point(void 0!==n?n:d.x,void 0!==i?i:d.y))),this._unmodified=c,this._constraining=!1}},Tn.prototype._calcMatrices=function(){if(this.height){var e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var r=Math.PI/2+this._pitch,n=this._fov*(.5+e.y/this.height),i=Math.sin(n)*this.cameraToCenterDistance/Math.sin(t.clamp(Math.PI-r-n,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,l=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),u=this.height/50,c=new Float64Array(16);t.perspective(c,this._fov,this.width/this.height,u,l),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,t.scale(c,c,[1,-1,1]),t.translate(c,c,[0,0,-this.cameraToCenterDistance]),t.rotateX(c,c,this._pitch),t.rotateZ(c,c,this.angle),t.translate(c,c,[-a,-s,0]),this.mercatorMatrix=t.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),t.scale(c,c,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=t.invert([],this.projMatrix);var h=this.width%2/2,p=this.height%2/2,d=Math.cos(this.angle),f=Math.sin(this.angle),m=a-Math.round(a)+d*h+f*p,g=s-Math.round(s)+d*p+f*h,_=new Float64Array(c);if(t.translate(_,_,[m>.5?m-1:m,g>.5?g-1:g,0]),this.alignedProjMatrix=_,c=t.create(),t.scale(c,c,[this.width/2,-this.height/2,1]),t.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=t.create(),t.scale(c,c,[1,-1,1]),t.translate(c,c,[-1,-1,0]),t.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Tn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance},Tn.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},Tn.prototype.getCameraQueryGeometry=function(e){var r=this.getCameraPoint();if(1===e.length)return[e[0],r];for(var n=r.x,i=r.y,o=r.x,a=r.y,s=0,l=e;s<l.length;s+=1){var u=l[s];n=Math.min(n,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}return[new t.Point(n,i),new t.Point(o,i),new t.Point(o,a),new t.Point(n,a),new t.Point(n,i)]},Object.defineProperties(Tn.prototype,Sn);var An=function(e){var r,n,i,o;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(r=this._updateHashUnthrottled.bind(this),n=!1,i=null,o=function(){i=null,n&&(r(),i=setTimeout(o,300),n=!1)},function(){return n=!0,i||o(),i})};An.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},An.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},An.prototype.getHashString=function(e){var r=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,i),a=Math.round(r.lng*o)/o,s=Math.round(r.lat*o)/o,l=this._map.getBearing(),u=this._map.getPitch(),c="";if(c+=e?"/"+a+"/"+s+"/"+n:n+"/"+s+"/"+a,(l||u)&&(c+="/"+Math.round(10*l)/10),u&&(c+="/"+Math.round(u)),this._hashName){var h=this._hashName,p=!1,d=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===h?(p=!0,e+"="+c):t})).filter((function(t){return t}));return p||d.push(h+"="+c),"#"+d.join("&")}return"#"+c},An.prototype._getCurrentHash=function(){var e,r=this,n=t.window.location.hash.replace("#","");return this._hashName?(n.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===r._hashName&&(e=t)})),(e&&e[1]||"").split("/")):n.split("/")},An.prototype._onHashChange=function(){var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(t)}))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},An.prototype._updateHashUnthrottled=function(){var e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());try{t.window.history.replaceState(t.window.history.state,null,e)}catch(t){}};var wn={linearity:.3,easing:t.bezier(0,0,.3,1)},Cn=t.extend({deceleration:2500,maxSpeed:1400},wn),Rn=t.extend({deceleration:20,maxSpeed:1400},wn),Ln=t.extend({deceleration:1e3,maxSpeed:360},wn),In=t.extend({deceleration:1e3,maxSpeed:90},wn),Mn=function(t){this._map=t,this.clear()};function On(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Pn(e,r,n){var i=n.maxSpeed,o=n.linearity,a=n.deceleration,s=t.clamp(e*o/(r/1e3),-i,i),l=Math.abs(s)/(a*o);return{easing:n.easing,duration:1e3*l,amount:s*(l/2)}}Mn.prototype.clear=function(){this._inertiaBuffer=[]},Mn.prototype.record=function(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.browser.now(),settings:e})},Mn.prototype._drainInertiaBuffer=function(){for(var e=this._inertiaBuffer,r=t.browser.now();e.length>0&&r-e[0].time>160;)e.shift()},Mn.prototype._onMoveEnd=function(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var r={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0},n=0,i=this._inertiaBuffer;n<i.length;n+=1){var o=i[n].settings;r.zoom+=o.zoomDelta||0,r.bearing+=o.bearingDelta||0,r.pitch+=o.pitchDelta||0,o.panDelta&&r.pan._add(o.panDelta),o.around&&(r.around=o.around),o.pinchAround&&(r.pinchAround=o.pinchAround)}var a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(r.pan.mag()){var l=Pn(r.pan.mag(),a,t.extend({},Cn,e||{}));s.offset=r.pan.mult(l.amount/r.pan.mag()),s.center=this._map.transform.center,On(s,l)}if(r.zoom){var u=Pn(r.zoom,a,Rn);s.zoom=this._map.transform.zoom+u.amount,On(s,u)}if(r.bearing){var c=Pn(r.bearing,a,Ln);s.bearing=this._map.transform.bearing+t.clamp(c.amount,-179,179),On(s,c)}if(r.pitch){var h=Pn(r.pitch,a,In);s.pitch=this._map.transform.pitch+h.amount,On(s,h)}if(s.zoom||s.bearing){var p=void 0===r.pinchAround?r.around:r.pinchAround;s.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),t.extend(s,{noMoveStart:!0})}};var Dn=function(e){function n(n,i,o,a){void 0===a&&(a={});var s=r.mousePos(i.getCanvasContainer(),o),l=i.unproject(s);e.call(this,n,t.extend({point:s,lngLat:l,originalEvent:o},a)),this._defaultPrevented=!1,this.target=i}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={defaultPrevented:{configurable:!0}};return n.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(n.prototype,i),n}(t.Event),Bn=function(e){function n(n,i,o){var a="touchend"===n?o.changedTouches:o.touches,s=r.touchPos(i.getCanvasContainer(),a),l=s.map((function(t){return i.unproject(t)})),u=s.reduce((function(t,e,r,n){return t.add(e.div(n.length))}),new t.Point(0,0)),c=i.unproject(u);e.call(this,n,{points:s,point:u,lngLats:l,lngLat:c,originalEvent:o}),this._defaultPrevented=!1}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={defaultPrevented:{configurable:!0}};return n.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(n.prototype,i),n}(t.Event),Nn=function(t){function e(e,r,n){t.call(this,e,{originalEvent:n}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,r),e}(t.Event),Fn=function(t,e){this._map=t,this._clickTolerance=e.clickTolerance};Fn.prototype.reset=function(){delete this._mousedownPos},Fn.prototype.wheel=function(t){return this._firePreventable(new Nn(t.type,this._map,t))},Fn.prototype.mousedown=function(t,e){return this._mousedownPos=e,this._firePreventable(new Dn(t.type,this._map,t))},Fn.prototype.mouseup=function(t){this._map.fire(new Dn(t.type,this._map,t))},Fn.prototype.click=function(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Dn(t.type,this._map,t))},Fn.prototype.dblclick=function(t){return this._firePreventable(new Dn(t.type,this._map,t))},Fn.prototype.mouseover=function(t){this._map.fire(new Dn(t.type,this._map,t))},Fn.prototype.mouseout=function(t){this._map.fire(new Dn(t.type,this._map,t))},Fn.prototype.touchstart=function(t){return this._firePreventable(new Bn(t.type,this._map,t))},Fn.prototype.touchmove=function(t){this._map.fire(new Bn(t.type,this._map,t))},Fn.prototype.touchend=function(t){this._map.fire(new Bn(t.type,this._map,t))},Fn.prototype.touchcancel=function(t){this._map.fire(new Bn(t.type,this._map,t))},Fn.prototype._firePreventable=function(t){if(this._map.fire(t),t.defaultPrevented)return{}},Fn.prototype.isEnabled=function(){return!0},Fn.prototype.isActive=function(){return!1},Fn.prototype.enable=function(){},Fn.prototype.disable=function(){};var kn=function(t){this._map=t};kn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},kn.prototype.mousemove=function(t){this._map.fire(new Dn(t.type,this._map,t))},kn.prototype.mousedown=function(){this._delayContextMenu=!0},kn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},kn.prototype.contextmenu=function(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Dn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()},kn.prototype.isEnabled=function(){return!0},kn.prototype.isActive=function(){return!1},kn.prototype.enable=function(){},kn.prototype.disable=function(){};var Un=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1};function zn(t,e){for(var r={},n=0;n<t.length;n++)r[t[n].identifier]=e[n];return r}Un.prototype.isEnabled=function(){return!!this._enabled},Un.prototype.isActive=function(){return!!this._active},Un.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Un.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Un.prototype.mousedown=function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(r.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)},Un.prototype.mousemoveWindow=function(t,e){if(this._active){var n=e;if(!(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=n,this._box||(this._box=r.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var o=Math.min(i.x,n.x),a=Math.max(i.x,n.x),s=Math.min(i.y,n.y),l=Math.max(i.y,n.y);r.setTransform(this._box,"translate("+o+"px,"+s+"px)"),this._box.style.width=a-o+"px",this._box.style.height=l-s+"px"}}},Un.prototype.mouseupWindow=function(e,n){var i=this;if(this._active&&0===e.button){var o=this._startPos,a=n;if(this.reset(),r.suppressClick(),o.x!==a.x||o.y!==a.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:function(t){return t.fitScreenCoordinates(o,a,i._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",e)}},Un.prototype.keydown=function(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))},Un.prototype.blur=function(){this.reset()},Un.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(r.remove(this._box),this._box=null),r.enableDrag(),delete this._startPos,delete this._lastPos},Un.prototype._fireEvent=function(e,r){return this._map.fire(new t.Event(e,{originalEvent:r}))};var Gn=function(t){this.reset(),this.numTouches=t.numTouches};Gn.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Gn.prototype.touchstart=function(e,r,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){for(var r=new t.Point(0,0),n=0,i=e;n<i.length;n+=1)r._add(i[n]);return r.div(e.length)}(r),this.touches=zn(n,r)))},Gn.prototype.touchmove=function(t,e,r){if(!this.aborted&&this.centroid){var n=zn(r,e);for(var i in this.touches){var o=n[i];(!o||o.dist(this.touches[i])>30)&&(this.aborted=!0)}}},Gn.prototype.touchend=function(t,e,r){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){var n=!this.aborted&&this.centroid;if(this.reset(),n)return n}};var jn=function(t){this.singleTap=new Gn(t),this.numTaps=t.numTaps,this.reset()};jn.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},jn.prototype.touchstart=function(t,e,r){this.singleTap.touchstart(t,e,r)},jn.prototype.touchmove=function(t,e,r){this.singleTap.touchmove(t,e,r)},jn.prototype.touchend=function(t,e,r){var n=this.singleTap.touchend(t,e,r);if(n){var i=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(n)<30;if(i&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}};var Vn=function(){this._zoomIn=new jn({numTouches:1,numTaps:2}),this._zoomOut=new jn({numTouches:2,numTaps:1}),this.reset()};Vn.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Vn.prototype.touchstart=function(t,e,r){this._zoomIn.touchstart(t,e,r),this._zoomOut.touchstart(t,e,r)},Vn.prototype.touchmove=function(t,e,r){this._zoomIn.touchmove(t,e,r),this._zoomOut.touchmove(t,e,r)},Vn.prototype.touchend=function(t,e,r){var n=this,i=this._zoomIn.touchend(t,e,r),o=this._zoomOut.touchend(t,e,r);return i?(this._active=!0,t.preventDefault(),setTimeout((function(){return n.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):o?(this._active=!0,t.preventDefault(),setTimeout((function(){return n.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0},Vn.prototype.touchcancel=function(){this.reset()},Vn.prototype.enable=function(){this._enabled=!0},Vn.prototype.disable=function(){this._enabled=!1,this.reset()},Vn.prototype.isEnabled=function(){return this._enabled},Vn.prototype.isActive=function(){return this._active};var Hn={0:1,2:2},Wn=function(t){this.reset(),this._clickTolerance=t.clickTolerance||1};Wn.prototype.blur=function(){this.reset()},Wn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Wn.prototype._correctButton=function(t,e){return!1},Wn.prototype._move=function(t,e){return{}},Wn.prototype.mousedown=function(t,e){if(!this._lastPoint){var n=r.mouseButton(t);this._correctButton(t,n)&&(this._lastPoint=e,this._eventButton=n)}},Wn.prototype.mousemoveWindow=function(t,e){var r=this._lastPoint;if(r)if(t.preventDefault(),function(t,e){var r=Hn[e];return void 0===t.buttons||(t.buttons&r)!==r}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(r,e)},Wn.prototype.mouseupWindow=function(t){this._lastPoint&&r.mouseButton(t)===this._eventButton&&(this._moved&&r.suppressClick(),this.reset())},Wn.prototype.enable=function(){this._enabled=!0},Wn.prototype.disable=function(){this._enabled=!1,this.reset()},Wn.prototype.isEnabled=function(){return this._enabled},Wn.prototype.isActive=function(){return this._active};var Xn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.mousedown=function(e,r){t.prototype.mousedown.call(this,e,r),this._lastPoint&&(this._active=!0)},e.prototype._correctButton=function(t,e){return 0===e&&!t.ctrlKey},e.prototype._move=function(t,e){return{around:e,panDelta:e.sub(t)}},e}(Wn),Zn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var r=.8*(e.x-t.x);if(r)return this._active=!0,{bearingDelta:r}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Wn),qn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var r=-.5*(e.y-t.y);if(r)return this._active=!0,{pitchDelta:r}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Wn),Yn=function(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()};Yn.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)},Yn.prototype.touchstart=function(t,e,r){return this._calculateTransform(t,e,r)},Yn.prototype.touchmove=function(t,e,r){if(this._active&&!(r.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,r)},Yn.prototype.touchend=function(t,e,r){this._calculateTransform(t,e,r),this._active&&r.length<this._minTouches&&this.reset()},Yn.prototype.touchcancel=function(){this.reset()},Yn.prototype._calculateTransform=function(e,r,n){n.length>0&&(this._active=!0);var i=zn(n,r),o=new t.Point(0,0),a=new t.Point(0,0),s=0;for(var l in i){var u=i[l],c=this._touches[l];c&&(o._add(u),a._add(u.sub(c)),s++,i[l]=u)}if(this._touches=i,!(s<this._minTouches)&&a.mag()){var h=a.div(s);if(this._sum._add(h),!(this._sum.mag()<this._clickTolerance))return{around:o.div(s),panDelta:h}}},Yn.prototype.enable=function(){this._enabled=!0},Yn.prototype.disable=function(){this._enabled=!1,this.reset()},Yn.prototype.isEnabled=function(){return this._enabled},Yn.prototype.isActive=function(){return this._active};var Kn=function(){this.reset()};function $n(t,e,r){for(var n=0;n<t.length;n++)if(t[n].identifier===r)return e[n]}function Qn(t,e){return Math.log(t/e)/Math.LN2}Kn.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Kn.prototype._start=function(t){},Kn.prototype._move=function(t,e,r){return{}},Kn.prototype.touchstart=function(t,e,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([e[0],e[1]]))},Kn.prototype.touchmove=function(t,e,r){if(this._firstTwoTouches){t.preventDefault();var n=this._firstTwoTouches,i=n[1],o=$n(r,e,n[0]),a=$n(r,e,i);if(o&&a){var s=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],s,t)}}},Kn.prototype.touchend=function(t,e,n){if(this._firstTwoTouches){var i=this._firstTwoTouches,o=i[1],a=$n(n,e,i[0]),s=$n(n,e,o);a&&s||(this._active&&r.suppressClick(),this.reset())}},Kn.prototype.touchcancel=function(){this.reset()},Kn.prototype.enable=function(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around},Kn.prototype.disable=function(){this._enabled=!1,this.reset()},Kn.prototype.isEnabled=function(){return this._enabled},Kn.prototype.isActive=function(){return this._active};var Jn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._distance,delete this._startDistance},e.prototype._start=function(t){this._startDistance=this._distance=t[0].dist(t[1])},e.prototype._move=function(t,e){var r=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Qn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qn(this._distance,r),pinchAround:e}},e}(Kn);function ti(t,e){return 180*t.angleWith(e)/Math.PI}var ei=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},e.prototype._start=function(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])},e.prototype._move=function(t,e){var r=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ti(this._vector,r),pinchAround:e}},e.prototype._isBelowThreshold=function(t){this._minDiameter=Math.min(this._minDiameter,t.mag());var e=25/(Math.PI*this._minDiameter)*360,r=ti(t,this._startVector);return Math.abs(r)<e},e}(Kn);function ri(t){return Math.abs(t.y)>Math.abs(t.x)}var ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},e.prototype._start=function(t){this._lastPoints=t,ri(t[0].sub(t[1]))&&(this._valid=!1)},e.prototype._move=function(t,e,r){var n=t[0].sub(this._lastPoints[0]),i=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(n,i,r.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(n.y+i.y)/2*-.5}},e.prototype.gestureBeginsVertically=function(t,e,r){if(void 0!==this._valid)return this._valid;var n=t.mag()>=2,i=e.mag()>=2;if(n||i){if(!n||!i)return void 0===this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;var o=t.y>0==e.y>0;return ri(t)&&ri(e)&&o}},e}(Kn),ii={panStep:100,bearingStep:15,pitchStep:10},oi=function(){var t=ii;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1};function ai(t){return t*(2-t)}oi.prototype.blur=function(){this.reset()},oi.prototype.reset=function(){this._active=!1},oi.prototype.keydown=function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var r=0,n=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:function(s){var l=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:ai,zoom:r?Math.round(l)+r*(t.shiftKey?2:1):l,bearing:s.getBearing()+n*e._bearingStep,pitch:s.getPitch()+i*e._pitchStep,offset:[-o*e._panStep,-a*e._panStep],center:s.getCenter()},{originalEvent:t})}}}},oi.prototype.enable=function(){this._enabled=!0},oi.prototype.disable=function(){this._enabled=!1,this.reset()},oi.prototype.isEnabled=function(){return this._enabled},oi.prototype.isActive=function(){return this._active},oi.prototype.disableRotation=function(){this._rotationDisabled=!0},oi.prototype.enableRotation=function(){this._rotationDisabled=!1};var si=function(e,r){this._map=e,this._el=e.getCanvasContainer(),this._handler=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onTimeout"],this)};si.prototype.setZoomRate=function(t){this._defaultZoomRate=t},si.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},si.prototype.isEnabled=function(){return!!this._enabled},si.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},si.prototype.isZooming=function(){return!!this._zooming},si.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},si.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},si.prototype.wheel=function(e){if(this.isEnabled()){var r=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=t.browser.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==r&&r%4.000244140625==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}},si.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},si.prototype._start=function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var n=r.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(n)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},si.prototype.renderFrame=function(){var e=this;if(this._frameId&&(this._frameId=null,this.isActive())){var r=this._map.transform;if(0!==this._delta){var n="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==i&&(i=1/i);var o="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(o*i))),"wheel"===this._type&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a,s="number"==typeof this._targetZoom?this._targetZoom:r.zoom,l=this._startZoom,u=this._easing,c=!1;if("wheel"===this._type&&l&&u){var h=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),p=u(h);a=t.number(l,s,p),h<1?this._frameId||(this._frameId=!0):c=!0}else a=s,c=!0;return this._active=!0,c&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._handler._triggerRenderFrame(),delete e._targetZoom,delete e._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:a-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},si.prototype._smoothOutEasing=function(e){var r=t.ease;if(this._prevEase){var n=this._prevEase,i=(t.browser.now()-n.start)/n.duration,o=n.easing(i+.01)-n.easing(i),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);r=t.bezier(a,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:r},r},si.prototype.blur=function(){this.reset()},si.prototype.reset=function(){this._active=!1};var li=function(t,e){this._clickZoom=t,this._tapZoom=e};li.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},li.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},li.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},li.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var ui=function(){this.reset()};ui.prototype.reset=function(){this._active=!1},ui.prototype.blur=function(){this.reset()},ui.prototype.dblclick=function(t,e){return t.preventDefault(),{cameraAnimation:function(r){r.easeTo({duration:300,zoom:r.getZoom()+(t.shiftKey?-1:1),around:r.unproject(e)},{originalEvent:t})}}},ui.prototype.enable=function(){this._enabled=!0},ui.prototype.disable=function(){this._enabled=!1,this.reset()},ui.prototype.isEnabled=function(){return this._enabled},ui.prototype.isActive=function(){return this._active};var ci=function(){this._tap=new jn({numTouches:1,numTaps:1}),this.reset()};ci.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ci.prototype.touchstart=function(t,e,r){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=e[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(t,e,r))},ci.prototype.touchmove=function(t,e,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;var n=e[0],i=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(t,e,r)},ci.prototype.touchend=function(t,e,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(t,e,r)&&(this._tapTime=t.timeStamp)},ci.prototype.touchcancel=function(){this.reset()},ci.prototype.enable=function(){this._enabled=!0},ci.prototype.disable=function(){this._enabled=!1,this.reset()},ci.prototype.isEnabled=function(){return this._enabled},ci.prototype.isActive=function(){return this._active};var hi=function(t,e,r){this._el=t,this._mousePan=e,this._touchPan=r};hi.prototype.enable=function(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},hi.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},hi.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},hi.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var pi=function(t,e,r){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=r};pi.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},pi.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},pi.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},pi.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var di=function(t,e,r,n){this._el=t,this._touchZoom=e,this._touchRotate=r,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0};di.prototype.enable=function(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},di.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},di.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},di.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},di.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},di.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var fi=function(t){return t.zoom||t.drag||t.pitch||t.rotate},mi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(t.Event);function gi(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var _i=function(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mn(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n),t.bindAll(["handleEvent","handleWindowEvent"],this);var i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[t.window,"blur",void 0]];for(var o=0,a=this._listeners;o<a.length;o+=1){var s=a[o],l=s[0];r.addEventListener(l,s[1],l===t.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};_i.prototype.destroy=function(){for(var e=0,n=this._listeners;e<n.length;e+=1){var i=n[e],o=i[0];r.removeEventListener(o,i[1],o===t.window.document?this.handleWindowEvent:this.handleEvent,i[2])}},_i.prototype._addDefaultHandlers=function(t){var e=this._map,r=e.getCanvasContainer();this._add("mapEvent",new Fn(e,t));var n=e.boxZoom=new Un(e,t);this._add("boxZoom",n);var i=new Vn,o=new ui;e.doubleClickZoom=new li(o,i),this._add("tapZoom",i),this._add("clickZoom",o);var a=new ci;this._add("tapDragZoom",a);var s=e.touchPitch=new ni;this._add("touchPitch",s);var l=new Zn(t),u=new qn(t);e.dragRotate=new pi(t,l,u),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",u,["mouseRotate"]);var c=new Xn(t),h=new Yn(t);e.dragPan=new hi(r,c,h),this._add("mousePan",c),this._add("touchPan",h,["touchZoom","touchRotate"]);var p=new ei,d=new Jn;e.touchZoomRotate=new di(r,d,p,a),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",d,["touchPan","touchRotate"]);var f=e.scrollZoom=new si(e,this);this._add("scrollZoom",f,["mousePan"]);var m=e.keyboard=new oi;this._add("keyboard",m),this._add("blockableMapEvent",new kn(e));for(var g=0,_=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];g<_.length;g+=1){var v=_[g];t.interactive&&t[v]&&e[v].enable(t[v])}},_i.prototype._add=function(t,e,r){this._handlers.push({handlerName:t,handler:e,allowed:r}),this._handlersById[t]=e},_i.prototype.stop=function(t){if(!this._updatingCamera){for(var e=0,r=this._handlers;e<r.length;e+=1)r[e].handler.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}},_i.prototype.isActive=function(){for(var t=0,e=this._handlers;t<e.length;t+=1)if(e[t].handler.isActive())return!0;return!1},_i.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},_i.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},_i.prototype.isMoving=function(){return Boolean(fi(this._eventsInProgress))||this.isZooming()},_i.prototype._blockedByActive=function(t,e,r){for(var n in t)if(n!==r&&(!e||e.indexOf(n)<0))return!0;return!1},_i.prototype.handleWindowEvent=function(t){this.handleEvent(t,t.type+"Window")},_i.prototype._getMapTouches=function(t){for(var e=[],r=0,n=t;r<n.length;r+=1){var i=n[r];this._el.contains(i.target)&&e.push(i)}return e},_i.prototype.handleEvent=function(t,e){this._updatingCamera=!0;for(var n="renderFrame"===t.type?void 0:t,i={needsRenderFrame:!1},o={},a={},s=t.touches?this._getMapTouches(t.touches):void 0,l=s?r.touchPos(this._el,s):r.mousePos(this._el,t),u=0,c=this._handlers;u<c.length;u+=1){var h=c[u],p=h.handlerName,d=h.handler,f=h.allowed;if(d.isEnabled()){var m=void 0;this._blockedByActive(a,f,p)?d.reset():d[e||t.type]&&(m=d[e||t.type](t,l,s),this.mergeHandlerResult(i,o,m,p,n),m&&m.needsRenderFrame&&this._triggerRenderFrame()),(m||d.isActive())&&(a[p]=d)}}var g={};for(var _ in this._previousActiveHandlers)a[_]||(g[_]=n);this._previousActiveHandlers=a,(Object.keys(g).length||gi(i))&&(this._changes.push([i,o,g]),this._triggerRenderFrame()),(Object.keys(a).length||gi(i))&&this._map._stop(!0),this._updatingCamera=!1;var v=i.cameraAnimation;v&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],v(this._map))},_i.prototype.mergeHandlerResult=function(e,r,n,i,o){if(n){t.extend(e,n);var a={handlerName:i,originalEvent:n.originalEvent||o};void 0!==n.zoomDelta&&(r.zoom=a),void 0!==n.panDelta&&(r.drag=a),void 0!==n.pitchDelta&&(r.pitch=a),void 0!==n.bearingDelta&&(r.rotate=a)}},_i.prototype._applyChanges=function(){for(var e={},r={},n={},i=0,o=this._changes;i<o.length;i+=1){var a=o[i],s=a[0],l=a[1],u=a[2];s.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),t.extend(r,l),t.extend(n,u)}this._updateMapTransform(e,r,n),this._changes=[]},_i.prototype._updateMapTransform=function(t,e,r){var n=this._map,i=n.transform;if(!gi(t))return this._fireEvents(e,r,!0);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,l=t.pitchDelta,u=t.around,c=t.pinchAround;void 0!==c&&(u=c),n._stop(!0),u=u||n.transform.centerPoint;var h=i.pointLocation(o?u.sub(o):u);s&&(i.bearing+=s),l&&(i.pitch+=l),a&&(i.zoom+=a),i.setLocationAtPoint(h,u),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,r,!0)},_i.prototype._fireEvents=function(e,r,n){var i=this,o=fi(this._eventsInProgress),a=fi(e),s={};for(var l in e)this._eventsInProgress[l]||(s[l+"start"]=e[l].originalEvent),this._eventsInProgress[l]=e[l];for(var u in!o&&a&&this._fireEvent("movestart",a.originalEvent),s)this._fireEvent(u,s[u]);for(var c in a&&this._fireEvent("move",a.originalEvent),e)this._fireEvent(c,e[c].originalEvent);var h,p={};for(var d in this._eventsInProgress){var f=this._eventsInProgress[d],m=f.handlerName,g=f.originalEvent;this._handlersById[m].isActive()||(delete this._eventsInProgress[d],p[d+"end"]=h=r[m]||g)}for(var _ in p)this._fireEvent(_,p[_]);var v=fi(this._eventsInProgress);if(n&&(o||a)&&!v){this._updatingCamera=!0;var y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),x=function(t){return 0!==t&&-i._bearingSnap<t&&t<i._bearingSnap};y?(x(y.bearing||this._map.getBearing())&&(y.bearing=0),this._map.easeTo(y,{originalEvent:h})):(this._map.fire(new t.Event("moveend",{originalEvent:h})),x(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},_i.prototype._fireEvent=function(e,r){this._map.fire(new t.Event(e,r?{originalEvent:r}:{}))},_i.prototype._requestFrame=function(){var t=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(e){delete t._frameId,t.handleEvent(new mi("renderFrame",{timeStamp:e})),t._applyChanges()}))},_i.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var vi=function(e){function r(r,n){e.call(this),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=n.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},r.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},r.prototype.panBy=function(e,r,n){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},r),n)},r.prototype.panTo=function(e,r,n){return this.easeTo(t.extend({center:e},r),n)},r.prototype.getZoom=function(){return this.transform.zoom},r.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},r.prototype.zoomTo=function(e,r,n){return this.easeTo(t.extend({zoom:e},r),n)},r.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},r.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},r.prototype.getBearing=function(){return this.transform.bearing},r.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},r.prototype.getPadding=function(){return this.transform.padding},r.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},r.prototype.rotateTo=function(e,r,n){return this.easeTo(t.extend({bearing:e},r),n)},r.prototype.resetNorth=function(e,r){return this.rotateTo(0,t.extend({duration:1e3},e),r),this},r.prototype.resetNorthPitch=function(e,r){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),r),this},r.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},r.prototype.getPitch=function(){return this.transform.pitch},r.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},r.prototype.cameraForBounds=function(e,r){e=t.LngLatBounds.convert(e);var n=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,r)},r.prototype._cameraForBoxAndBearing=function(e,r,n,i){var o={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=t.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var a=i.padding;i.padding={top:a,bottom:a,right:a,left:a}}i.padding=t.extend(o,i.padding);var s=this.transform,l=s.padding,u=s.project(t.LngLat.convert(e)),c=s.project(t.LngLat.convert(r)),h=u.rotate(-n*Math.PI/180),p=c.rotate(-n*Math.PI/180),d=new t.Point(Math.max(h.x,p.x),Math.max(h.y,p.y)),f=new t.Point(Math.min(h.x,p.x),Math.min(h.y,p.y)),m=d.sub(f),g=(s.width-(l.left+l.right+i.padding.left+i.padding.right))/m.x,_=(s.height-(l.top+l.bottom+i.padding.top+i.padding.bottom))/m.y;if(!(_<0||g<0)){var v=Math.min(s.scaleZoom(s.scale*Math.min(g,_)),i.maxZoom),y="number"==typeof i.offset.x?new t.Point(i.offset.x,i.offset.y):t.Point.convert(i.offset),x=new t.Point((i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2).rotate(n*Math.PI/180),b=y.add(x).mult(s.scale/s.zoomScale(v));return{center:s.unproject(u.add(c).div(2).sub(b)),zoom:v,bearing:n}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},r.prototype.fitBounds=function(t,e,r){return this._fitInternal(this.cameraForBounds(t,e),e,r)},r.prototype.fitScreenCoordinates=function(e,r,n,i,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(r)),n,i),i,o)},r.prototype._fitInternal=function(e,r,n){return e?(delete(r=t.extend(e,r)).padding,r.linear?this.easeTo(r,n):this.flyTo(r,n)):this},r.prototype.jumpTo=function(e,r){this.stop();var n=this.transform,i=!1,o=!1,a=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(i=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=t.LngLat.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(o=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(a=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this.fire(new t.Event("movestart",r)).fire(new t.Event("move",r)),i&&this.fire(new t.Event("zoomstart",r)).fire(new t.Event("zoom",r)).fire(new t.Event("zoomend",r)),o&&this.fire(new t.Event("rotatestart",r)).fire(new t.Event("rotate",r)).fire(new t.Event("rotateend",r)),a&&this.fire(new t.Event("pitchstart",r)).fire(new t.Event("pitch",r)).fire(new t.Event("pitchend",r)),this.fire(new t.Event("moveend",r))},r.prototype.easeTo=function(e,r){var n=this;this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),l=this.getPadding(),u="zoom"in e?+e.zoom:o,c="bearing"in e?this._normalizeBearing(e.bearing,a):a,h="pitch"in e?+e.pitch:s,p="padding"in e?e.padding:i.padding,d=t.Point.convert(e.offset),f=i.centerPoint.add(d),m=i.pointLocation(f),g=t.LngLat.convert(e.center||m);this._normalizeCenter(g);var _,v,y=i.project(m),x=i.project(g).sub(y),b=i.zoomScale(u-o);e.around&&(_=t.LngLat.convert(e.around),v=i.locationPoint(_));var E={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||u!==o,this._rotating=this._rotating||a!==c,this._pitching=this._pitching||h!==s,this._padding=!i.isPaddingEqual(p),this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,E),this._ease((function(e){if(n._zooming&&(i.zoom=t.number(o,u,e)),n._rotating&&(i.bearing=t.number(a,c,e)),n._pitching&&(i.pitch=t.number(s,h,e)),n._padding&&(i.interpolatePadding(l,p,e),f=i.centerPoint.add(d)),_)i.setLocationAtPoint(_,v);else{var m=i.zoomScale(i.zoom-o),g=u>o?Math.min(2,b):Math.max(.5,b),E=Math.pow(g,1-e),T=i.unproject(y.add(x.mult(e*E)).mult(m));i.setLocationAtPoint(i.renderWorldCopies?T.wrap():T,f)}n._fireMoveEvents(r)}),(function(t){n._afterEase(r,t)}),e),this},r.prototype._prepareEase=function(e,r,n){void 0===n&&(n={}),this._moving=!0,r||n.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!n.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new t.Event("pitchstart",e))},r.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},r.prototype._afterEase=function(e,r){if(!this._easeId||!r||this._easeId!==r){delete this._easeId;var n=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}},r.prototype.flyTo=function(e,r){var n=this;if(!e.essential&&t.browser.prefersReducedMotion){var i=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,r)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var o=this.transform,a=this.getZoom(),s=this.getBearing(),l=this.getPitch(),u=this.getPadding(),c="zoom"in e?t.clamp(+e.zoom,o.minZoom,o.maxZoom):a,h="bearing"in e?this._normalizeBearing(e.bearing,s):s,p="pitch"in e?+e.pitch:l,d="padding"in e?e.padding:o.padding,f=o.zoomScale(c-a),m=t.Point.convert(e.offset),g=o.centerPoint.add(m),_=o.pointLocation(g),v=t.LngLat.convert(e.center||_);this._normalizeCenter(v);var y=o.project(_),x=o.project(v).sub(y),b=e.curve,E=Math.max(o.width,o.height),T=E/f,S=x.mag();if("minZoom"in e){var A=t.clamp(Math.min(e.minZoom,a,c),o.minZoom,o.maxZoom),w=E/o.zoomScale(A-a);b=Math.sqrt(w/S*2)}var C=b*b;function R(t){var e=(T*T-E*E+(t?-1:1)*C*C*S*S)/(2*(t?T:E)*C*S);return Math.log(Math.sqrt(e*e+1)-e)}function L(t){return(Math.exp(t)-Math.exp(-t))/2}function I(t){return(Math.exp(t)+Math.exp(-t))/2}var M=R(0),O=function(t){return I(M)/I(M+b*t)},P=function(t){return E*((I(M)*(L(e=M+b*t)/I(e))-L(M))/C)/S;var e},D=(R(1)-M)/b;if(Math.abs(S)<1e-6||!isFinite(D)){if(Math.abs(E-T)<1e-6)return this.easeTo(e,r);var B=T<E?-1:1;D=Math.abs(Math.log(T/E))/b,P=function(){return 0},O=function(t){return Math.exp(B*b*t)}}return e.duration="duration"in e?+e.duration:1e3*D/("screenSpeed"in e?+e.screenSpeed/b:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=p!==l,this._padding=!o.isPaddingEqual(d),this._prepareEase(r,!1),this._ease((function(e){var i=e*D,f=1/O(i);o.zoom=1===e?c:a+o.scaleZoom(f),n._rotating&&(o.bearing=t.number(s,h,e)),n._pitching&&(o.pitch=t.number(l,p,e)),n._padding&&(o.interpolatePadding(u,d,e),g=o.centerPoint.add(m));var _=1===e?v:o.unproject(y.add(x.mult(P(i))).mult(f));o.setLocationAtPoint(o.renderWorldCopies?_.wrap():_,g),n._fireMoveEvents(r)}),(function(){return n._afterEase(r)}),e),this},r.prototype.isEasing=function(){return!!this._easeFrameId},r.prototype.stop=function(){return this._stop()},r.prototype._stop=function(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var r=this._onEaseEnd;delete this._onEaseEnd,r.call(this,e)}if(!t){var n=this.handlers;n&&n.stop(!1)}return this},r.prototype._ease=function(e,r,n){!1===n.animate||0===n.duration?(e(1),r()):(this._easeStart=t.browser.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},r.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},r.prototype._normalizeBearing=function(e,r){e=t.wrap(e,-180,180);var n=Math.abs(e-r);return Math.abs(e-360-r)<n&&(e-=360),Math.abs(e+360-r)<n&&(e+=360),e},r.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var r=t.lng-e.center.lng;t.lng+=r>180?-360:r<-180?360:0}},r}(t.Evented),yi=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};yi.prototype.getDefaultPosition=function(){return"bottom-right"},yi.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=r.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=r.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},yi.prototype.onRemove=function(){r.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},yi.prototype._setElementTitle=function(t,e){var r=this._map._getUIString("AttributionControl."+e);t.title=r,t.setAttribute("aria-label",r)},yi.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},yi.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var n=r.reduce((function(t,e,n){return e.value&&(t+=e.key+"="+e.value+(n<r.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+n+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}},yi.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},yi.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var r=this._map.style.sourceCaches;for(var n in r){var i=r[n];if(i.used){var o=i.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort((function(t,e){return t.length-e.length}));var a=(t=t.filter((function(e,r){for(var n=r+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0}))).join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},yi.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var xi=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};xi.prototype.onAdd=function(t){this._map=t,this._container=r.create("div","mapboxgl-ctrl");var e=r.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},xi.prototype.onRemove=function(){r.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},xi.prototype.getDefaultPosition=function(){return"bottom-left"},xi.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},xi.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},xi.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var bi=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};bi.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},bi.prototype.remove=function(t){for(var e=this._currentlyRunning,r=0,n=e?this._queue.concat(e):this._queue;r<n.length;r+=1){var i=n[r];if(i.id===t)return void(i.cancelled=!0)}},bi.prototype.run=function(t){void 0===t&&(t=0);var e=this._currentlyRunning=this._queue;this._queue=[];for(var r=0,n=e;r<n.length;r+=1){var i=n[r];if(!i.cancelled&&(i.callback(t),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},bi.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ei={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ti=t.window.HTMLImageElement,Si=t.window.HTMLElement,Ai=t.window.ImageBitmap,wi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Ci=function(n){function i(e){var r=this;if(null!=(e=t.extend({},wi,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var i=new Tn(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(n.call(this,i,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new bi,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},Ei,e.locale),this._clickTolerance=e.clickTolerance,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Si))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return r._update(!1)})),this.on("moveend",(function(){return r._update(!1)})),this.on("zoom",(function(){return r._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new _i(this,e),this._hash=e.hash&&new An("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new yi({customAttribution:e.customAttribution})),this.addControl(new xi,e.logoPosition),this.on("style.load",(function(){r.transform.unmodified&&r.jumpTo(r.style.stylesheet)})),this.on("data",(function(e){r._update("style"===e.dataType),r.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){r.fire(new t.Event(e.dataType+"dataloading",e))}))}n&&(i.__proto__=n),(i.prototype=Object.create(n&&n.prototype)).constructor=i;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return i.prototype._getMapId=function(){return this._mapId},i.prototype.addControl=function(e,r){if(void 0===r&&(r=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var n=e.onAdd(this);this._controls.push(e);var i=this._controlPositions[r];return-1!==r.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this},i.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var r=this._controls.indexOf(e);return r>-1&&this._controls.splice(r,1),e.onRemove(this),this},i.prototype.hasControl=function(t){return this._controls.indexOf(t)>-1},i.prototype.resize=function(e){var r=this._containerDimensions(),n=r[0],i=r[1];if(n===this.transform.width&&i===this.transform.height)return this;this._resizeCanvas(n,i),this.transform.resize(n,i),this.painter.resize(n,i);var o=!this._moving;return o&&this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)),this.fire(new t.Event("resize",e)),o&&this.fire(new t.Event("moveend",e)),this},i.prototype.getBounds=function(){return this.transform.getBounds()},i.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},i.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},i.prototype.setMinZoom=function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.setMinPitch=function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},i.prototype.getMinPitch=function(){return this.transform.minPitch},i.prototype.setMaxPitch=function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to 60");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},i.prototype.getMaxPitch=function(){return this.transform.maxPitch},i.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},i.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},i.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},i.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},i.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},i.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},i.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},i.prototype._createDelegatedListener=function(t,e,r){var n,i=this;if("mouseenter"===t||"mouseover"===t){var o=!1;return{layer:e,listener:r,delegates:{mousemove:function(n){var a=i.getLayer(e)?i.queryRenderedFeatures(n.point,{layers:[e]}):[];a.length?o||(o=!0,r.call(i,new Dn(t,i,n.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:r,delegates:{mousemove:function(n){(i.getLayer(e)?i.queryRenderedFeatures(n.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,r.call(i,new Dn(t,i,n.originalEvent)))},mouseout:function(e){a&&(a=!1,r.call(i,new Dn(t,i,e.originalEvent)))}}}}return{layer:e,listener:r,delegates:(n={},n[t]=function(t){var n=i.getLayer(e)?i.queryRenderedFeatures(t.point,{layers:[e]}):[];n.length&&(t.features=n,r.call(i,t),delete t.features)},n)}},i.prototype.on=function(t,e,r){if(void 0===r)return n.prototype.on.call(this,t,e);var i=this._createDelegatedListener(t,e,r);for(var o in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i),i.delegates)this.on(o,i.delegates[o]);return this},i.prototype.once=function(t,e,r){if(void 0===r)return n.prototype.once.call(this,t,e);var i=this._createDelegatedListener(t,e,r);for(var o in i.delegates)this.once(o,i.delegates[o]);return this},i.prototype.off=function(t,e,r){var i=this;return void 0===r?n.prototype.off.call(this,t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&function(n){for(var o=n[t],a=0;a<o.length;a++){var s=o[a];if(s.layer===e&&s.listener===r){for(var l in s.delegates)i.off(l,s.delegates[l]);return o.splice(a,1),i}}}(this._delegatedListeners),this)},i.prototype.queryRenderedFeatures=function(e,r){if(!this.style)return[];var n;if(void 0!==r||void 0===e||e instanceof t.Point||Array.isArray(e)||(r=e,e=void 0),r=r||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])n=[t.Point.convert(e)];else{var i=t.Point.convert(e[0]),o=t.Point.convert(e[1]);n=[i,new t.Point(o.x,i.y),o,new t.Point(i.x,o.y),i]}return this.style.queryRenderedFeatures(n,r,this.transform)},i.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},i.prototype.setStyle=function(e,r){return!1!==(r=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(e,r))},i.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},i.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Ve(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},i.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ve(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},i.prototype._diffStyle=function(e,r){var n=this;if("string"==typeof e){var i=this._requestManager.normalizeStyleURL(e),o=this._requestManager.transformRequest(i,t.ResourceType.Style);t.getJSON(o,(function(e,i){e?n.fire(new t.ErrorEvent(e)):i&&n._updateDiff(i,r)}))}else"object"==typeof e&&this._updateDiff(e,r)},i.prototype._updateDiff=function(e,r){try{this.style.setState(e)&&this._update(!0)}catch(n){t.warnOnce("Unable to perform style diff: "+(n.message||n.error||n)+".  Rebuilding the style from scratch."),this._updateStyle(e,r)}},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},i.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},i.prototype.isSourceLoaded=function(e){var r=this.style&&this.style.sourceCaches[e];if(void 0!==r)return r.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},i.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var r=t[e]._tiles;for(var n in r){var i=r[n];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0},i.prototype.addSourceType=function(t,e,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,r)},i.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},i.prototype.getSource=function(t){return this.style.getSource(t)},i.prototype.addImage=function(e,r,n){void 0===n&&(n={});var i=n.pixelRatio;void 0===i&&(i=1);var o=n.sdf;void 0===o&&(o=!1);var a=n.stretchX,s=n.stretchY,l=n.content;if(this._lazyInitEmptyStyle(),r instanceof Ti||Ai&&r instanceof Ai){var u=t.browser.getImageData(r);this.style.addImage(e,{data:new t.RGBAImage({width:u.width,height:u.height},u.data),pixelRatio:i,stretchX:a,stretchY:s,content:l,sdf:o,version:0})}else{if(void 0===r.width||void 0===r.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=r;this.style.addImage(e,{data:new t.RGBAImage({width:r.width,height:r.height},new Uint8Array(r.data)),pixelRatio:i,stretchX:a,stretchY:s,content:l,sdf:o,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}},i.prototype.updateImage=function(e,r){var n=this.style.getImage(e);if(!n)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=r instanceof Ti||Ai&&r instanceof Ai?t.browser.getImageData(r):r,o=i.width,a=i.height,s=i.data;return void 0===o||void 0===a?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==n.data.width||a!==n.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(n.data.replace(s,!(r instanceof Ti||Ai&&r instanceof Ai)),void this.style.updateImage(e,n))},i.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},i.prototype.removeImage=function(t){this.style.removeImage(t)},i.prototype.loadImage=function(e,r){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),r)},i.prototype.listImages=function(){return this.style.listImages()},i.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},i.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},i.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},i.prototype.getLayer=function(t){return this.style.getLayer(t)},i.prototype.setLayerZoomRange=function(t,e,r){return this.style.setLayerZoomRange(t,e,r),this._update(!0)},i.prototype.setFilter=function(t,e,r){return void 0===r&&(r={}),this.style.setFilter(t,e,r),this._update(!0)},i.prototype.getFilter=function(t){return this.style.getFilter(t)},i.prototype.setPaintProperty=function(t,e,r,n){return void 0===n&&(n={}),this.style.setPaintProperty(t,e,r,n),this._update(!0)},i.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},i.prototype.setLayoutProperty=function(t,e,r,n){return void 0===n&&(n={}),this.style.setLayoutProperty(t,e,r,n),this._update(!0)},i.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},i.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},i.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},i.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},i.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},i.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=r.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=r.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=r.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);var i=this._controlContainer=r.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){o[t]=r.create("div","mapboxgl-ctrl-"+t,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},i.prototype._resizeCanvas=function(e,r){var n=t.browser.devicePixelRatio||1;this._canvas.width=n*e,this._canvas.height=n*r,this._canvas.style.width=e+"px",this._canvas.style.height=r+"px"},i.prototype._setupPainter=function(){var r=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",r)||this._canvas.getContext("experimental-webgl",r);n?(this.painter=new yn(n,this.transform),t.webpSupported.testSupport(n)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},i.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},i.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},i.prototype._onMapScroll=function(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},i.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},i.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},i.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},i.prototype._render=function(e){var r,n=this,i=0,o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(r=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,r),i=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),!this._removed){var a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,l=t.browser.now();this.style.zoomHistory.update(s,l);var u=new t.EvaluationParameters(s,{now:l,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),c=u.crossFadingFactor();1===c&&c===this._crossFadingFactor||(a=!0,this._crossFadingFactor=c),this.style.update(u)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var h=t.browser.now()-i;o.endQueryEXT(o.TIME_ELAPSED_EXT,r),setTimeout((function(){var e=o.getQueryObjectEXT(r,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(r),n.fire(new t.Event("gpu-timing-frame",{cpuTime:h,gpuTime:e}))}),50)}if(this.listens("gpu-timing-layer")){var p=this.painter.collectGpuTimers();setTimeout((function(){var e=n.painter.queryGpuTimers(p);n.fire(new t.Event("gpu-timing-layer",{layerTimes:e}))}),50)}var d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0),this}},i.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,r=this._controls;e<r.length;e+=1)r[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var n=this.painter.context.gl.getExtension("WEBGL_lose_context");n&&n.loseContext(),Ri(this._canvasContainer),Ri(this._controlContainer),Ri(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new t.Event("remove"))},i.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(t){e._frame=null,e._render(t)})))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(t){this._vertices=t,this._update()},i.prototype._setCacheLimits=function(e,r){t.setCacheLimits(e,r)},o.version.get=function(){return t.version},Object.defineProperties(i.prototype,o),i}(vi);function Ri(t){t.parentNode&&t.parentNode.removeChild(t)}var Li={showCompass:!0,showZoom:!0,visualizePitch:!1},Ii=function(e){var n=this;this.options=t.extend({},Li,e),this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(t){return n._map.zoomIn({},{originalEvent:t})})),r.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(t){return n._map.zoomOut({},{originalEvent:t})})),r.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(t){n.options.visualizePitch?n._map.resetNorthPitch({},{originalEvent:t}):n._map.resetNorth({},{originalEvent:t})})),this._compassIcon=r.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Ii.prototype._updateZoomButtons=function(){var t=this._map.getZoom(),e=t===this._map.getMaxZoom(),r=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())},Ii.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},Ii.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Mi(this._map,this._compass,this.options.visualizePitch)),this._container},Ii.prototype.onRemove=function(){r.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Ii.prototype._createButton=function(t,e){var n=r.create("button",t,this._container);return n.type="button",n.addEventListener("click",e),n},Ii.prototype._setButtonTitle=function(t,e){var r=this._map._getUIString("NavigationControl."+e);t.title=r,t.setAttribute("aria-label",r)};var Mi=function(e,n,i){void 0===i&&(i=!1),this._clickTolerance=10,this.element=n,this.mouseRotate=new Zn({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new qn({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener(n,"mousedown",this.mousedown),r.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),r.addEventListener(n,"touchmove",this.touchmove),r.addEventListener(n,"touchend",this.touchend),r.addEventListener(n,"touchcancel",this.reset)};function Oi(e,r,n){if(e=new t.LngLat(e.lng,e.lat),r){var i=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=n.locationPoint(e).distSqr(r);n.locationPoint(i).distSqr(r)<a?e=i:n.locationPoint(o).distSqr(r)<a&&(e=o)}for(;Math.abs(e.lng-n.center.lng)>180;){var s=n.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=n.width&&s.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}Mi.prototype.down=function(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),r.disableDrag()},Mi.prototype.move=function(t,e){var r=this.map,n=this.mouseRotate.mousemoveWindow(t,e);if(n&&n.bearingDelta&&r.setBearing(r.getBearing()+n.bearingDelta),this.mousePitch){var i=this.mousePitch.mousemoveWindow(t,e);i&&i.pitchDelta&&r.setPitch(r.getPitch()+i.pitchDelta)}},Mi.prototype.off=function(){var t=this.element;r.removeEventListener(t,"mousedown",this.mousedown),r.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),r.removeEventListener(t,"touchmove",this.touchmove),r.removeEventListener(t,"touchend",this.touchend),r.removeEventListener(t,"touchcancel",this.reset),this.offTemp()},Mi.prototype.offTemp=function(){r.enableDrag(),r.removeEventListener(t.window,"mousemove",this.mousemove),r.removeEventListener(t.window,"mouseup",this.mouseup)},Mi.prototype.mousedown=function(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:function(){return e.preventDefault()}}),r.mousePos(this.element,e)),r.addEventListener(t.window,"mousemove",this.mousemove),r.addEventListener(t.window,"mouseup",this.mouseup)},Mi.prototype.mousemove=function(t){this.move(t,r.mousePos(this.element,t))},Mi.prototype.mouseup=function(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()},Mi.prototype.touchstart=function(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=r.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return t.preventDefault()}},this._startPos))},Mi.prototype.touchmove=function(t){1!==t.targetTouches.length?this.reset():(this._lastPos=r.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:function(){return t.preventDefault()}},this._lastPos))},Mi.prototype.touchend=function(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Mi.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Pi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Di(t,e,r){var n=t.classList;for(var i in Pi)n.remove("mapboxgl-"+r+"-anchor-"+i);n.add("mapboxgl-"+r+"-anchor-"+e)}var Bi,Ni=function(e){function n(n,i){if(e.call(this),(n instanceof t.window.HTMLElement||i)&&(n=t.extend({element:n},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&"auto"!==n.pitchAlignment?n.pitchAlignment:this._rotationAlignment,n&&n.element)this._element=n.element,this._offset=t.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=r.create("div"),this._element.setAttribute("aria-label","Map marker");var o=r.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","41px"),o.setAttributeNS(null,"width","27px"),o.setAttributeNS(null,"viewBox","0 0 27 41");var a=r.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");var s=r.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var l=r.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");for(var u=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];u<c.length;u+=1){var h=c[u],p=r.createNS("http://www.w3.org/2000/svg","ellipse");p.setAttributeNS(null,"opacity","0.04"),p.setAttributeNS(null,"cx","10.5"),p.setAttributeNS(null,"cy","5.80029008"),p.setAttributeNS(null,"rx",h.rx),p.setAttributeNS(null,"ry",h.ry),l.appendChild(p)}var d=r.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"fill",this._color);var f=r.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),d.appendChild(f);var m=r.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"fill","#000000");var g=r.createNS("http://www.w3.org/2000/svg","path");g.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),m.appendChild(g);var _=r.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(6.0, 7.0)"),_.setAttributeNS(null,"fill","#FFFFFF");var v=r.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(8.0, 8.0)");var y=r.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#000000"),y.setAttributeNS(null,"opacity","0.25"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962");var x=r.createNS("http://www.w3.org/2000/svg","circle");x.setAttributeNS(null,"fill","#FFFFFF"),x.setAttributeNS(null,"cx","5.5"),x.setAttributeNS(null,"cy","5.5"),x.setAttributeNS(null,"r","5.4999962"),v.appendChild(y),v.appendChild(x),s.appendChild(l),s.appendChild(d),s.appendChild(m),s.appendChild(_),s.appendChild(v),o.appendChild(s),o.setAttributeNS(null,"height",41*this._scale+"px"),o.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(o),this._offset=t.Point.convert(n&&n.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),this._element.addEventListener("mousedown",(function(t){t.preventDefault()})),Di(this._element,this._anchor,"marker"),this._popup=null}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},n.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),r.remove(this._element),this._popup&&this._popup.remove(),this},n.prototype.getLngLat=function(){return this._lngLat},n.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},n.prototype.getElement=function(){return this._element},n.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},n.prototype._onKeyPress=function(t){var e=t.code,r=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==r&&13!==r||this.togglePopup()},n.prototype._onMapClick=function(t){var e=t.originalEvent.target,r=this._element;this._popup&&(e===r||r.contains(e))&&this.togglePopup()},n.prototype.getPopup=function(){return this._popup},n.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},n.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Oi(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),r.setTransform(this._element,Pi[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+n+" "+e)}},n.prototype.getOffset=function(){return this._offset},n.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},n.prototype._onMove=function(e){if(!this._isDragging){var r=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=r}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))},n.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},n.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},n.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},n.prototype.isDraggable=function(){return this._draggable},n.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},n.prototype.getRotation=function(){return this._rotation},n.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},n.prototype.getRotationAlignment=function(){return this._rotationAlignment},n.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},n.prototype.getPitchAlignment=function(){return this._pitchAlignment},n}(t.Evented),Fi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ki=0,Ui=!1,zi=function(e){function n(r){e.call(this),this.options=t.extend({},Fi,r),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.onAdd=function(e){var n;return this._map=e,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==Bi?n(Bi):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){n(Bi="denied"!==t.state)})):n(Bi=!!t.window.navigator.geolocation),this._container},n.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),r.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ki=0,Ui=!1},n.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),r=t.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())},n.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},n.prototype._onSuccess=function(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}},n.prototype._updateCamera=function(e){var r=new t.LngLat(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,i=this._map.getBearing(),o=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(n),o,{geolocateSource:!0})},n.prototype._updateMarker=function(e){if(e){var r=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},n.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),r=this._map.unproject([1,t]),n=e.distanceTo(r),i=Math.ceil(2*this._accuracy/n);this._circleElement.style.width=i+"px",this._circleElement.style.height=i+"px"},n.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},n.prototype._onError=function(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Ui)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}},n.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},n.prototype._setupUI=function(e){var n=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=r.create("button","mapboxgl-ctrl-geolocate",this._container),r.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{var o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=r.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ni(this._dotElement),this._circleElement=r.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ni({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==n._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(n._watchState="BACKGROUND",n._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),n._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),n.fire(new t.Event("trackuserlocationend")))}))},n.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ki--,Ui=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ki>1?(e={maximumAge:6e5,timeout:0},Ui=!0):(e=this.options.positionOptions,Ui=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},n.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},n}(t.Evented),Gi={maxWidth:100,unit:"metric"},ji=function(e){this.options=t.extend({},Gi,e),t.bindAll(["_onMove","setUnit"],this)};function Vi(t,e,r){var n=r&&r.maxWidth||100,i=t._container.clientHeight/2,o=t.unproject([0,i]),a=t.unproject([n,i]),s=o.distanceTo(a);if(r&&"imperial"===r.unit){var l=3.2808*s;l>5280?Hi(e,n,l/5280,t._getUIString("ScaleControl.Miles")):Hi(e,n,l,t._getUIString("ScaleControl.Feet"))}else r&&"nautical"===r.unit?Hi(e,n,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?Hi(e,n,s/1e3,t._getUIString("ScaleControl.Kilometers")):Hi(e,n,s,t._getUIString("ScaleControl.Meters"))}function Hi(t,e,r,n){var i,o,a,s=(i=r,(o=Math.pow(10,(""+Math.floor(i)).length-1))*(a=(a=i/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(a)));t.style.width=e*(s/r)+"px",t.innerHTML=s+"&nbsp;"+n}ji.prototype.getDefaultPosition=function(){return"bottom-left"},ji.prototype._onMove=function(){Vi(this._map,this._container,this.options)},ji.prototype.onAdd=function(t){return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},ji.prototype.onRemove=function(){r.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},ji.prototype.setUnit=function(t){this.options.unit=t,Vi(this._map,this._container,this.options)};var Wi=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange")};Wi.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Wi.prototype.onRemove=function(){r.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Wi.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Wi.prototype._setupUI=function(){var e=this._fullscreenButton=r.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);r.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Wi.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Wi.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Wi.prototype._isFullscreen=function(){return this._fullscreen},Wi.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Wi.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Xi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),qi=function(e){function n(r){e.call(this),this.options=t.extend(Object.create(Xi),r),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.addTo=function(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},n.prototype.isOpen=function(){return!!this._map},n.prototype.remove=function(){return this._content&&r.remove(this._content),this._container&&(r.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this},n.prototype.getLngLat=function(){return this._lngLat},n.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},n.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},n.prototype.getElement=function(){return this._container},n.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},n.prototype.setHTML=function(e){var r,n=t.window.document.createDocumentFragment(),i=t.window.document.createElement("body");for(i.innerHTML=e;r=i.firstChild;)n.appendChild(r);return this.setDOMContent(n)},n.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},n.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},n.prototype.setDOMContent=function(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=r.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this},n.prototype.addClassName=function(t){this._container&&this._container.classList.add(t)},n.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t)},n.prototype.setOffset=function(t){return this.options.offset=t,this._update(),this},n.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},n.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=r.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},n.prototype._onMouseUp=function(t){this._update(t.point)},n.prototype._onMouseMove=function(t){this._update(t.point)},n.prototype._onDrag=function(t){this._update(t.point)},n.prototype._update=function(e){var n=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=r.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=r.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return n._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Oi(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var i=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),o=this.options.anchor,a=function e(r){if(r){if("number"==typeof r){var n=Math.round(Math.sqrt(.5*Math.pow(r,2)));return{center:new t.Point(0,0),top:new t.Point(0,r),"top-left":new t.Point(n,n),"top-right":new t.Point(-n,n),bottom:new t.Point(0,-r),"bottom-left":new t.Point(n,-n),"bottom-right":new t.Point(-n,-n),left:new t.Point(r,0),right:new t.Point(-r,0)}}if(r instanceof t.Point||Array.isArray(r)){var i=t.Point.convert(r);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.Point.convert(r.center||[0,0]),top:t.Point.convert(r.top||[0,0]),"top-left":t.Point.convert(r["top-left"]||[0,0]),"top-right":t.Point.convert(r["top-right"]||[0,0]),bottom:t.Point.convert(r.bottom||[0,0]),"bottom-left":t.Point.convert(r["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(r["bottom-right"]||[0,0]),left:t.Point.convert(r.left||[0,0]),right:t.Point.convert(r.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!o){var s,l=this._container.offsetWidth,u=this._container.offsetHeight;s=i.y+a.bottom.y<u?["top"]:i.y>this._map.transform.height-u?["bottom"]:[],i.x<l/2?s.push("left"):i.x>this._map.transform.width-l/2&&s.push("right"),o=0===s.length?"bottom":s.join("-")}var c=i.add(a[o]).round();r.setTransform(this._container,Pi[o]+" translate("+c.x+"px,"+c.y+"px)"),Di(this._container,o,"popup")}},n.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var t=this._container.querySelector(Zi);t&&t.focus()}},n.prototype._onClose=function(){this.remove()},n}(t.Evented),Yi={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:Ci,NavigationControl:Ii,GeolocateControl:zi,AttributionControl:yi,ScaleControl:ji,FullscreenControl:Wi,Popup:qi,Marker:Ni,Style:Ve,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,prewarm:function(){kt().acquire(Dt)},clearPrewarmedResources:function(){var t=Nt;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Dt),Nt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Bt.workerCount},set workerCount(t){Bt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:""};return Yi})),r}()}(HP);var WP=HP.exports;const XP=["id","attributionControl","style","token","rotation","mapInstance"];!function(t,e){var r="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,n="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!r&&!n&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}"),window.mapboxgl=WP;let ZP=0;const qP="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg";class YP extends aO{constructor(...t){super(...t),g_(this,"version","MAPBOX"),g_(this,"viewport",void 0)}getType(){return"mapbox"}lngLatToCoord(t,e={x:0,y:0,z:0}){const{x:r,y:n}=this.lngLatToMercator(t,0);return[r-e.x,n-e.y]}lngLatToMercator(t,e){const{x:r=0,y:n=0,z:i=0}=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e);return{x:r,y:n,z:i}}getModelMatrix(t,e,r,n=[1,1,1],i={x:0,y:0,z:0}){const o=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),a=o.meterInMercatorCoordinateUnits(),s=wv();return Iv(s,s,kv(o.x-i.x,o.y-i.y,o.z||0-i.z)),Mv(s,s,kv(a*n[0],-a*n[1],a*n[2])),Ov(s,s,r[0]),Pv(s,s,r[1]),Dv(s,s,r[2]),s}init(){var t=this;return Ev((function*(){const e=t.config,{id:r="map",attributionControl:n=!1,style:i="light",token:o=qP,rotation:a=0,mapInstance:s}=e,l=Ay(e,XP);t.viewport=new YM,s||window.mapboxgl||console.error(t.configService.getSceneWarninfo("SDK")),o!==qP||"blank"===i||window.mapboxgl.accessToken||s||console.warn(t.configService.getSceneWarninfo("MapToken")),s||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=o),s?(t.map=s,t.$mapContainer=t.map.getContainer()):(t.$mapContainer=t.creatMapContainer(r),t.map=new window.mapboxgl.Map(v_({container:t.$mapContainer,style:t.getMapStyleValue(i),attributionControl:n,bearing:a},l))),t.map.on("load",(()=>{t.handleCameraChanged()})),t.map.on("move",t.handleCameraChanged),t.handleCameraChanged()}))()}destroy(){var t;null===(t=this.$mapContainer)||void 0===t||null===(t=t.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(t,...e){this.eventEmitter.emit(t,...e)}once(t,...e){this.eventEmitter.once(t,...e)}getMapContainer(){return this.$mapContainer}getCanvasOverlays(){var t;return null===(t=this.getMapContainer())||void 0===t?void 0:t.querySelector(".mapboxgl-canvas-container")}meterToCoord(t,e){const r=new WP.LngLat(t[0],t[1]),n=new WP.LngLat(e[0],e[1]),i=r.distanceTo(n),o=WP.MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),a=WP.MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),{x:s,y:l}=o,{x:u,y:c}=a;return 4194304*Math.sqrt(Math.pow(s-u,2)+Math.pow(l-c,2))*2/i}exportMap(t){const e=this.map.getCanvas();return"jpg"===t?null==e?void 0:e.toDataURL("image/jpeg"):null==e?void 0:e.toDataURL("image/png")}creatMapContainer(t){let e=t;"string"==typeof t&&(e=document.getElementById(t));const r=document.createElement("div");return r.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",r.id="l7_mapbox_div"+ZP++,e.appendChild(r),r}}!function(t,e){var r="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,n="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!r&&!n&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a)}}(".mapboxgl-ctrl-logo {\n  display: none !important;\n}\n");class KP extends yM{getServiceConstructor(){return YP}}const $P=nO,QP=nO,JP=nO;var tD=function(t){return null==t},eD={}.toString,rD=function(t,e){return eD.call(t)==="[object "+e+"]"},nD=function(t,e,r){return t<e?e:t>r?r:t},iD=function(t){return rD(t,"Number")},oD={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}function i(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function o(t,e,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||t,a),l=r?r+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],s]:t._events[l].push(s):(t._events[l]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var t,n,i=[];if(0===this._eventsCount)return i;for(n in t=this._events)e.call(t,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},s.prototype.emit=function(t,e,n,i,o,a){var s=r?r+t:t;if(!this._events[s])return!1;var l,u,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,i),!0;case 5:return c.fn.call(c.context,e,n,i,o),!0;case 6:return c.fn.call(c.context,e,n,i,o,a),!0}for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var p,d=c.length;for(u=0;u<d;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,n);break;case 4:c[u].fn.call(c[u].context,e,n,i);break;default:if(!l)for(p=1,l=new Array(h-1);p<h;p++)l[p-1]=arguments[p];c[u].fn.apply(c[u].context,l)}}return!0},s.prototype.on=function(t,e,r){return o(this,t,e,r,!1)},s.prototype.once=function(t,e,r){return o(this,t,e,r,!0)},s.prototype.removeListener=function(t,e,n,i){var o=r?r+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var l=0,u=[],c=s.length;l<c;l++)(s[l].fn!==e||i&&!s[l].once||n&&s[l].context!==n)&&u.push(s[l]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&a(this,e)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,t.exports=s}(oD);var aD,sD,lD,uD,cD,hD,pD,dD,fD,mD,gD,_D,vD,yD,xD,bD,ED,TD,SD,AD,wD,CD,RD,LD,ID,MD,OD,PD=oD.exports;function DD(t,e,r){return t<<16|e<<8|r}function BD(t){return t>>>8&255}function ND(t){return t>>>16&255}function FD(t){return 255&t}function kD(t){switch(t){case LD.F32:case LD.U32:case LD.S32:return 4;case LD.U16:case LD.S16:case LD.F16:return 2;case LD.U8:case LD.S8:return 1;default:throw new Error("whoops")}}function UD(t){return kD(ND(t))}function zD(t){var e=FD(t);if(e&MD.Depth)return AD.Depth;if(e&MD.Normalized)return AD.Float;var r=ND(t);if(r===LD.F16||r===LD.F32)return AD.Float;if(r===LD.U8||r===LD.U16||r===LD.U32)return AD.Uint;if(r===LD.S8||r===LD.S16||r===LD.S32)return AD.Sint;throw new Error("whoops")}function GD(t,e){if(void 0===e&&(e=""),!t)throw new Error("Assert fail: ".concat(e))}function jD(t){if(null!=t)return t;throw new Error("Missing object")}function VD(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a}function HD(t,e){t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a}function WD(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}function XD(t,e,r,n){return void 0===n&&(n=1),{r:t,g:e,b:r,a:n}}!function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.ALWAYS=519]="ALWAYS",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.GEQUAL=518]="GEQUAL",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.RGBA32F_EXT=34836]="RGBA32F_EXT",t[t.RGB32F_EXT=34837]="RGB32F_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",t[t.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",t[t.MIN_EXT=32775]="MIN_EXT",t[t.MAX_EXT=32776]="MAX_EXT",t[t.SRGB_EXT=35904]="SRGB_EXT",t[t.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",t[t.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",t[t.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",t[t.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",t[t.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",t[t.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",t[t.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",t[t.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",t[t.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",t[t.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",t[t.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",t[t.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",t[t.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",t[t.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",t[t.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",t[t.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",t[t.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",t[t.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",t[t.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",t[t.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",t[t.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",t[t.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",t[t.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",t[t.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",t[t.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",t[t.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",t[t.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",t[t.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",t[t.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",t[t.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",t[t.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",t[t.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",t[t.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",t[t.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",t[t.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",t[t.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",t[t.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"}(aD||(aD={})),function(t){t[t.Buffer=0]="Buffer",t[t.Texture=1]="Texture",t[t.RenderTarget=2]="RenderTarget",t[t.Sampler=3]="Sampler",t[t.Program=4]="Program",t[t.Bindings=5]="Bindings",t[t.InputLayout=6]="InputLayout",t[t.RenderPipeline=7]="RenderPipeline",t[t.ComputePipeline=8]="ComputePipeline",t[t.Readback=9]="Readback",t[t.QueryPool=10]="QueryPool",t[t.RenderBundle=11]="RenderBundle"}(sD||(sD={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(lD||(lD={})),function(t){t[t.CCW=2305]="CCW",t[t.CW=2304]="CW"}(uD||(uD={})),function(t){t[t.NONE=0]="NONE",t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK",t[t.FRONT_AND_BACK=3]="FRONT_AND_BACK"}(cD||(cD={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC=768]="SRC",t[t.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",t[t.DST=774]="DST",t[t.ONE_MINUS_DST=775]="ONE_MINUS_DST",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.CONST=32769]="CONST",t[t.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(hD||(hD={})),function(t){t[t.ADD=32774]="ADD",t[t.SUBSTRACT=32778]="SUBSTRACT",t[t.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX"}(pD||(pD={})),function(t){t[t.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",t[t.REPEAT=1]="REPEAT",t[t.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"}(dD||(dD={})),function(t){t[t.POINT=0]="POINT",t[t.BILINEAR=1]="BILINEAR"}(fD||(fD={})),function(t){t[t.NO_MIP=0]="NO_MIP",t[t.NEAREST=1]="NEAREST",t[t.LINEAR=2]="LINEAR"}(mD||(mD={})),function(t){t[t.POINTS=0]="POINTS",t[t.TRIANGLES=1]="TRIANGLES",t[t.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",t[t.LINES=3]="LINES",t[t.LINE_STRIP=4]="LINE_STRIP"}(gD||(gD={})),function(t){t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE"}(_D||(_D={})),function(t){t[t.STATIC=1]="STATIC",t[t.DYNAMIC=2]="DYNAMIC"}(vD||(vD={})),function(t){t[t.VERTEX=1]="VERTEX",t[t.INSTANCE=2]="INSTANCE"}(yD||(yD={})),function(t){t.LOADED="loaded"}(xD||(xD={})),function(t){t[t.TEXTURE_2D=0]="TEXTURE_2D",t[t.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",t[t.TEXTURE_3D=2]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"}(bD||(bD={})),function(t){t[t.SAMPLED=1]="SAMPLED",t[t.RENDER_TARGET=2]="RENDER_TARGET",t[t.STORAGE=4]="STORAGE"}(ED||(ED={})),function(t){t[t.NONE=0]="NONE",t[t.RED=1]="RED",t[t.GREEN=2]="GREEN",t[t.BLUE=4]="BLUE",t[t.ALPHA=8]="ALPHA",t[t.RGB=7]="RGB",t[t.ALL=15]="ALL"}(TD||(TD={})),function(t){t[t.KEEP=7680]="KEEP",t[t.ZERO=0]="ZERO",t[t.REPLACE=7681]="REPLACE",t[t.INVERT=5386]="INVERT",t[t.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",t[t.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",t[t.INCREMENT_WRAP=34055]="INCREMENT_WRAP",t[t.DECREMENT_WRAP=34056]="DECREMENT_WRAP"}(SD||(SD={})),function(t){t[t.Float=0]="Float",t[t.UnfilterableFloat=1]="UnfilterableFloat",t[t.Uint=2]="Uint",t[t.Sint=3]="Sint",t[t.Depth=4]="Depth"}(AD||(AD={})),function(t){t[t.LOWER_LEFT=0]="LOWER_LEFT",t[t.UPPER_LEFT=1]="UPPER_LEFT"}(wD||(wD={})),function(t){t[t.NEGATIVE_ONE=0]="NEGATIVE_ONE",t[t.ZERO=1]="ZERO"}(CD||(CD={})),function(t){t[t.OcclusionConservative=0]="OcclusionConservative"}(RD||(RD={})),function(t){t[t.U8=1]="U8",t[t.U16=2]="U16",t[t.U32=3]="U32",t[t.S8=4]="S8",t[t.S16=5]="S16",t[t.S32=6]="S32",t[t.F16=7]="F16",t[t.F32=8]="F32",t[t.BC1=65]="BC1",t[t.BC2=66]="BC2",t[t.BC3=67]="BC3",t[t.BC4_UNORM=68]="BC4_UNORM",t[t.BC4_SNORM=69]="BC4_SNORM",t[t.BC5_UNORM=70]="BC5_UNORM",t[t.BC5_SNORM=71]="BC5_SNORM",t[t.U16_PACKED_5551=97]="U16_PACKED_5551",t[t.U16_PACKED_565=98]="U16_PACKED_565",t[t.D24=129]="D24",t[t.D32F=130]="D32F",t[t.D24S8=131]="D24S8",t[t.D32FS8=132]="D32FS8"}(LD||(LD={})),function(t){t[t.R=1]="R",t[t.RG=2]="RG",t[t.RGB=3]="RGB",t[t.RGBA=4]="RGBA",t[t.A=5]="A"}(ID||(ID={})),function(t){t[t.None=0]="None",t[t.Normalized=1]="Normalized",t[t.sRGB=2]="sRGB",t[t.Depth=4]="Depth",t[t.Stencil=8]="Stencil",t[t.RenderTarget=16]="RenderTarget",t[t.Luminance=32]="Luminance"}(MD||(MD={})),function(t){t[t.ALPHA=DD(LD.U8,ID.A,MD.None)]="ALPHA",t[t.U8_LUMINANCE=DD(LD.U8,ID.A,MD.Luminance)]="U8_LUMINANCE",t[t.F16_LUMINANCE=DD(LD.F16,ID.A,MD.Luminance)]="F16_LUMINANCE",t[t.F32_LUMINANCE=DD(LD.F32,ID.A,MD.Luminance)]="F32_LUMINANCE",t[t.F16_R=DD(LD.F16,ID.R,MD.None)]="F16_R",t[t.F16_RG=DD(LD.F16,ID.RG,MD.None)]="F16_RG",t[t.F16_RGB=DD(LD.F16,ID.RGB,MD.None)]="F16_RGB",t[t.F16_RGBA=DD(LD.F16,ID.RGBA,MD.None)]="F16_RGBA",t[t.F32_R=DD(LD.F32,ID.R,MD.None)]="F32_R",t[t.F32_RG=DD(LD.F32,ID.RG,MD.None)]="F32_RG",t[t.F32_RGB=DD(LD.F32,ID.RGB,MD.None)]="F32_RGB",t[t.F32_RGBA=DD(LD.F32,ID.RGBA,MD.None)]="F32_RGBA",t[t.U8_R=DD(LD.U8,ID.R,MD.None)]="U8_R",t[t.U8_R_NORM=DD(LD.U8,ID.R,MD.Normalized)]="U8_R_NORM",t[t.U8_RG=DD(LD.U8,ID.RG,MD.None)]="U8_RG",t[t.U8_RG_NORM=DD(LD.U8,ID.RG,MD.Normalized)]="U8_RG_NORM",t[t.U8_RGB=DD(LD.U8,ID.RGB,MD.None)]="U8_RGB",t[t.U8_RGB_NORM=DD(LD.U8,ID.RGB,MD.Normalized)]="U8_RGB_NORM",t[t.U8_RGB_SRGB=DD(LD.U8,ID.RGB,MD.sRGB|MD.Normalized)]="U8_RGB_SRGB",t[t.U8_RGBA=DD(LD.U8,ID.RGBA,MD.None)]="U8_RGBA",t[t.U8_RGBA_NORM=DD(LD.U8,ID.RGBA,MD.Normalized)]="U8_RGBA_NORM",t[t.U8_RGBA_SRGB=DD(LD.U8,ID.RGBA,MD.sRGB|MD.Normalized)]="U8_RGBA_SRGB",t[t.U16_R=DD(LD.U16,ID.R,MD.None)]="U16_R",t[t.U16_R_NORM=DD(LD.U16,ID.R,MD.Normalized)]="U16_R_NORM",t[t.U16_RG_NORM=DD(LD.U16,ID.RG,MD.Normalized)]="U16_RG_NORM",t[t.U16_RGBA_NORM=DD(LD.U16,ID.RGBA,MD.Normalized)]="U16_RGBA_NORM",t[t.U16_RGBA=DD(LD.U16,ID.RGBA,MD.None)]="U16_RGBA",t[t.U16_RGB=DD(LD.U16,ID.RGB,MD.None)]="U16_RGB",t[t.U16_RG=DD(LD.U16,ID.RG,MD.None)]="U16_RG",t[t.U32_R=DD(LD.U32,ID.R,MD.None)]="U32_R",t[t.U32_RG=DD(LD.U32,ID.RG,MD.None)]="U32_RG",t[t.U32_RGB=DD(LD.U32,ID.RGB,MD.None)]="U32_RGB",t[t.U32_RGBA=DD(LD.U32,ID.RGBA,MD.None)]="U32_RGBA",t[t.S8_R=DD(LD.S8,ID.R,MD.None)]="S8_R",t[t.S8_R_NORM=DD(LD.S8,ID.R,MD.Normalized)]="S8_R_NORM",t[t.S8_RG_NORM=DD(LD.S8,ID.RG,MD.Normalized)]="S8_RG_NORM",t[t.S8_RGB_NORM=DD(LD.S8,ID.RGB,MD.Normalized)]="S8_RGB_NORM",t[t.S8_RGBA_NORM=DD(LD.S8,ID.RGBA,MD.Normalized)]="S8_RGBA_NORM",t[t.S16_R=DD(LD.S16,ID.R,MD.None)]="S16_R",t[t.S16_RG=DD(LD.S16,ID.RG,MD.None)]="S16_RG",t[t.S16_RG_NORM=DD(LD.S16,ID.RG,MD.Normalized)]="S16_RG_NORM",t[t.S16_RGB_NORM=DD(LD.S16,ID.RGB,MD.Normalized)]="S16_RGB_NORM",t[t.S16_RGBA=DD(LD.S16,ID.RGBA,MD.None)]="S16_RGBA",t[t.S16_RGBA_NORM=DD(LD.S16,ID.RGBA,MD.Normalized)]="S16_RGBA_NORM",t[t.S32_R=DD(LD.S32,ID.R,MD.None)]="S32_R",t[t.S32_RG=DD(LD.S32,ID.RG,MD.None)]="S32_RG",t[t.S32_RGB=DD(LD.S32,ID.RGB,MD.None)]="S32_RGB",t[t.S32_RGBA=DD(LD.S32,ID.RGBA,MD.None)]="S32_RGBA",t[t.U16_RGBA_5551=DD(LD.U16_PACKED_5551,ID.RGBA,MD.Normalized)]="U16_RGBA_5551",t[t.U16_RGB_565=DD(LD.U16_PACKED_565,ID.RGB,MD.Normalized)]="U16_RGB_565",t[t.BC1=DD(LD.BC1,ID.RGBA,MD.Normalized)]="BC1",t[t.BC1_SRGB=DD(LD.BC1,ID.RGBA,MD.Normalized|MD.sRGB)]="BC1_SRGB",t[t.BC2=DD(LD.BC2,ID.RGBA,MD.Normalized)]="BC2",t[t.BC2_SRGB=DD(LD.BC2,ID.RGBA,MD.Normalized|MD.sRGB)]="BC2_SRGB",t[t.BC3=DD(LD.BC3,ID.RGBA,MD.Normalized)]="BC3",t[t.BC3_SRGB=DD(LD.BC3,ID.RGBA,MD.Normalized|MD.sRGB)]="BC3_SRGB",t[t.BC4_UNORM=DD(LD.BC4_UNORM,ID.R,MD.Normalized)]="BC4_UNORM",t[t.BC4_SNORM=DD(LD.BC4_SNORM,ID.R,MD.Normalized)]="BC4_SNORM",t[t.BC5_UNORM=DD(LD.BC5_UNORM,ID.RG,MD.Normalized)]="BC5_UNORM",t[t.BC5_SNORM=DD(LD.BC5_SNORM,ID.RG,MD.Normalized)]="BC5_SNORM",t[t.D24=DD(LD.D24,ID.R,MD.Depth)]="D24",t[t.D24_S8=DD(LD.D24S8,ID.RG,MD.Depth|MD.Stencil)]="D24_S8",t[t.D32F=DD(LD.D32F,ID.R,MD.Depth)]="D32F",t[t.D32F_S8=DD(LD.D32FS8,ID.RG,MD.Depth|MD.Stencil)]="D32F_S8",t[t.U8_RGB_RT=DD(LD.U8,ID.RGB,MD.RenderTarget|MD.Normalized)]="U8_RGB_RT",t[t.U8_RGBA_RT=DD(LD.U8,ID.RGBA,MD.RenderTarget|MD.Normalized)]="U8_RGBA_RT",t[t.U8_RGBA_RT_SRGB=DD(LD.U8,ID.RGBA,MD.RenderTarget|MD.Normalized|MD.sRGB)]="U8_RGBA_RT_SRGB"}(OD||(OD={}));var ZD=XD(0,0,0,0);XD(0,0,0,1);var qD=XD(1,1,1,0);function YD(t){return!(!t||t&t-1)}function KD(t,e){return null!=t?t:e}function $D(t,e){var r=e-1;return t+r&~r}function QD(t,e){t.blendDstFactor=e.blendDstFactor,t.blendSrcFactor=e.blendSrcFactor,t.blendMode=e.blendMode}function JD(t,e){return void 0===t&&(t={}),t.compare=e.compare,t.depthFailOp=e.depthFailOp,t.passOp=e.passOp,t.failOp=e.failOp,t.mask=e.mask,t}function tB(t,e){return void 0===t&&(t={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),QD(t.rgbBlendState,e.rgbBlendState),QD(t.alphaBlendState,e.alphaBlendState),t.channelWriteMask=e.channelWriteMask,t}function eB(t,e){t.length!==e.length&&(t.length=e.length);for(var r=0;r<e.length;r++)t[r]=tB(t[r],e[r])}function rB(t){var e=Object.assign({},t);return e.attachmentsState=[],eB(e.attachmentsState,t.attachmentsState),e.blendConstant=e.blendConstant&&WD(e.blendConstant),e.stencilFront=JD(void 0,t.stencilFront),e.stencilBack=JD(void 0,t.stencilBack),e}XD(1,1,1,1);var nB={blendMode:pD.ADD,blendSrcFactor:hD.ONE,blendDstFactor:hD.ZERO},iB={attachmentsState:[{channelWriteMask:TD.ALL,rgbBlendState:nB,alphaBlendState:nB}],blendConstant:WD(ZD),depthWrite:!0,depthCompare:lD.LEQUAL,stencilWrite:!1,stencilFront:{compare:lD.ALWAYS,passOp:SD.KEEP,depthFailOp:SD.KEEP,failOp:SD.KEEP},stencilBack:{compare:lD.ALWAYS,passOp:SD.KEEP,depthFailOp:SD.KEEP,failOp:SD.KEEP},cullMode:cD.NONE,frontFace:uD.CCW,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0};!function(t,e){void 0===t&&(t=null),void 0===e&&(e=iB);var r=rB(e);null!==t&&function(t,e){void 0!==e.attachmentsState&&eB(t.attachmentsState,e.attachmentsState),t.blendConstant&&e.blendConstant&&HD(t.blendConstant,e.blendConstant),t.depthCompare=KD(e.depthCompare,t.depthCompare),t.depthWrite=KD(e.depthWrite,t.depthWrite),t.stencilWrite=KD(e.stencilWrite,t.stencilWrite),t.stencilFront&&e.stencilFront&&JD(t.stencilFront,e.stencilFront),t.stencilBack&&e.stencilBack&&JD(t.stencilBack,e.stencilBack),t.cullMode=KD(e.cullMode,t.cullMode),t.frontFace=KD(e.frontFace,t.frontFace),t.polygonOffset=KD(e.polygonOffset,t.polygonOffset),t.polygonOffsetFactor=KD(e.polygonOffsetFactor,t.polygonOffsetFactor),t.polygonOffsetUnits=KD(e.polygonOffsetUnits,t.polygonOffsetUnits)}(r,t)}({depthCompare:lD.ALWAYS,depthWrite:!1},iB);var oB,aB={texture:null,sampler:null,formatKind:AD.Float,dimension:bD.TEXTURE_2D};function sB(t,e,r){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!r(t[n],e[n]))return!1;return!0}function lB(t,e){for(var r=Array(t.length),n=0;n<t.length;n++)r[n]=e(t[n]);return r}function uB(t,e){return t.texture===e.texture&&t.binding===e.binding}function cB(t,e){return t.buffer===e.buffer&&t.size===e.size&&t.binding===e.binding&&t.offset===e.offset}function hB(t,e){return null===t?null===e:null!==e&&(t.sampler===e.sampler&&t.texture===e.texture&&t.dimension===e.dimension&&t.formatKind===e.formatKind&&t.comparison===e.comparison)}function pB(t,e){return t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],t.samplerBindings.length===e.samplerBindings.length&&(!!sB(t.samplerBindings,e.samplerBindings,hB)&&(!!sB(t.uniformBufferBindings,e.uniformBufferBindings,cB)&&(!!sB(t.storageBufferBindings,e.storageBufferBindings,cB)&&!!sB(t.storageTextureBindings,e.storageTextureBindings,uB))))}function dB(t,e){return t.blendMode==e.blendMode&&t.blendSrcFactor===e.blendSrcFactor&&t.blendDstFactor===e.blendDstFactor}function fB(t,e){return!!dB(t.rgbBlendState,e.rgbBlendState)&&(!!dB(t.alphaBlendState,e.alphaBlendState)&&t.channelWriteMask===e.channelWriteMask)}function mB(t,e){return t.compare==e.compare&&t.depthFailOp===e.depthFailOp&&t.failOp===e.failOp&&t.passOp===e.passOp&&t.mask===e.mask}function gB(t,e){return t.id===e.id}function _B(t,e){return t===e}function vB(t,e){return t.topology===e.topology&&(t.inputLayout===e.inputLayout&&(t.sampleCount===e.sampleCount&&(!(t.megaStateDescriptor&&e.megaStateDescriptor&&!function(t,e){return!(!sB(t.attachmentsState,e.attachmentsState,fB)||t.blendConstant&&e.blendConstant&&!VD(t.blendConstant,e.blendConstant)||t.stencilFront&&e.stencilFront&&!mB(t.stencilFront,e.stencilFront)||t.stencilBack&&e.stencilBack&&!mB(t.stencilBack,e.stencilBack)||t.depthCompare!==e.depthCompare||t.depthWrite!==e.depthWrite||t.stencilWrite!==e.stencilWrite||t.cullMode!==e.cullMode||t.frontFace!==e.frontFace||t.polygonOffset!==e.polygonOffset||t.polygonOffsetFactor!==e.polygonOffsetFactor||t.polygonOffsetUnits!==e.polygonOffsetUnits)}(t.megaStateDescriptor,e.megaStateDescriptor))&&(!!gB(t.program,e.program)&&(!!sB(t.colorAttachmentFormats,e.colorAttachmentFormats,_B)&&t.depthStencilAttachmentFormat===e.depthStencilAttachmentFormat)))))}function yB(t,e){return t.offset===e.offset&&t.shaderLocation===e.shaderLocation&&t.format===e.format&&t.divisor===e.divisor}function xB(t,e){return tD(t)?tD(e):!tD(e)&&(t.arrayStride===e.arrayStride&&t.stepMode===e.stepMode&&sB(t.attributes,e.attributes,yB))}function bB(t,e){return t.indexBufferFormat===e.indexBufferFormat&&(!!sB(t.vertexBufferDescriptors,e.vertexBufferDescriptors,xB)&&!!gB(t.program,e.program))}function EB(t){return{sampler:t.sampler,texture:t.texture,dimension:t.dimension,formatKind:t.formatKind,comparison:t.comparison}}function TB(t){var e=t.buffer,r=t.size;return{binding:t.binding,buffer:e,offset:t.offset,size:r}}function SB(t){return{binding:t.binding,texture:t.texture}}function AB(t){return{shaderLocation:t.shaderLocation,format:t.format,offset:t.offset,divisor:t.divisor}}function wB(t){return tD(t)?t:{arrayStride:t.arrayStride,stepMode:t.stepMode,attributes:lB(t.attributes,AB)}}var CB=/([^[]*)(\[[0-9]+\])?/;function RB(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};var e=t.match(CB);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:Number(e[2])||1,isArray:Boolean(e[2])}}function LB(){var t=null;return function(e,r,n){var i=t!==n;return i&&(e.uniform1i(r,n),t=n),i}}function IB(t,e,r,n){var i=null,o=null;return function(a,s,l){var u=e(l,r),c=u.length,h=!1;if(null===i)i=new Float32Array(c),o=c,h=!0;else{GD(o===c,"Uniform length cannot change.");for(var p=0;p<c;++p)if(u[p]!==i[p]){h=!0;break}}return h&&(n(a,t,s,u),i.set(u)),h}}function MB(t,e,r,n){t[e](r,n)}function OB(t,e,r,n){t[e](r,!1,n)}var PB={},DB={},BB={},NB=[0];function FB(t,e,r,n){1===e&&"boolean"==typeof t&&(t=t?1:0),Number.isFinite(t)&&(NB[0]=t,t=NB);var i=t.length;if(t instanceof r)return t;var o=n[i];o||(o=new r(i),n[i]=o);for(var a=0;a<i;a++)o[a]=t[a];return o}function kB(t,e){return FB(t,e,Float32Array,PB)}function UB(t,e){return FB(t,e,Int32Array,DB)}function zB(t,e){return FB(t,e,Uint32Array,BB)}var GB=((oB={})[aD.FLOAT]=IB.bind(null,"uniform1fv",kB,1,MB),oB[aD.FLOAT_VEC2]=IB.bind(null,"uniform2fv",kB,2,MB),oB[aD.FLOAT_VEC3]=IB.bind(null,"uniform3fv",kB,3,MB),oB[aD.FLOAT_VEC4]=IB.bind(null,"uniform4fv",kB,4,MB),oB[aD.INT]=IB.bind(null,"uniform1iv",UB,1,MB),oB[aD.INT_VEC2]=IB.bind(null,"uniform2iv",UB,2,MB),oB[aD.INT_VEC3]=IB.bind(null,"uniform3iv",UB,3,MB),oB[aD.INT_VEC4]=IB.bind(null,"uniform4iv",UB,4,MB),oB[aD.BOOL]=IB.bind(null,"uniform1iv",UB,1,MB),oB[aD.BOOL_VEC2]=IB.bind(null,"uniform2iv",UB,2,MB),oB[aD.BOOL_VEC3]=IB.bind(null,"uniform3iv",UB,3,MB),oB[aD.BOOL_VEC4]=IB.bind(null,"uniform4iv",UB,4,MB),oB[aD.FLOAT_MAT2]=IB.bind(null,"uniformMatrix2fv",kB,4,OB),oB[aD.FLOAT_MAT3]=IB.bind(null,"uniformMatrix3fv",kB,9,OB),oB[aD.FLOAT_MAT4]=IB.bind(null,"uniformMatrix4fv",kB,16,OB),oB[aD.UNSIGNED_INT]=IB.bind(null,"uniform1uiv",zB,1,MB),oB[aD.UNSIGNED_INT_VEC2]=IB.bind(null,"uniform2uiv",zB,2,MB),oB[aD.UNSIGNED_INT_VEC3]=IB.bind(null,"uniform3uiv",zB,3,MB),oB[aD.UNSIGNED_INT_VEC4]=IB.bind(null,"uniform4uiv",zB,4,MB),oB[aD.FLOAT_MAT2x3]=IB.bind(null,"uniformMatrix2x3fv",kB,6,OB),oB[aD.FLOAT_MAT2x4]=IB.bind(null,"uniformMatrix2x4fv",kB,8,OB),oB[aD.FLOAT_MAT3x2]=IB.bind(null,"uniformMatrix3x2fv",kB,6,OB),oB[aD.FLOAT_MAT3x4]=IB.bind(null,"uniformMatrix3x4fv",kB,12,OB),oB[aD.FLOAT_MAT4x2]=IB.bind(null,"uniformMatrix4x2fv",kB,8,OB),oB[aD.FLOAT_MAT4x3]=IB.bind(null,"uniformMatrix4x3fv",kB,12,OB),oB[aD.SAMPLER_2D]=LB,oB[aD.SAMPLER_CUBE]=LB,oB[aD.SAMPLER_3D]=LB,oB[aD.SAMPLER_2D_SHADOW]=LB,oB[aD.SAMPLER_2D_ARRAY]=LB,oB[aD.SAMPLER_2D_ARRAY_SHADOW]=LB,oB[aD.SAMPLER_CUBE_SHADOW]=LB,oB[aD.INT_SAMPLER_2D]=LB,oB[aD.INT_SAMPLER_3D]=LB,oB[aD.INT_SAMPLER_CUBE]=LB,oB[aD.INT_SAMPLER_2D_ARRAY]=LB,oB[aD.UNSIGNED_INT_SAMPLER_2D]=LB,oB[aD.UNSIGNED_INT_SAMPLER_3D]=LB,oB[aD.UNSIGNED_INT_SAMPLER_CUBE]=LB,oB[aD.UNSIGNED_INT_SAMPLER_2D_ARRAY]=LB,oB);function jB(t,e,r){var n=GB[r.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(r.type));return n().bind(null,t,e)}var VB={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function HB(t,e){return"#define ".concat(t," ").concat(e)}function WB(t){if(void 0===t)return null;var e=/binding\s*=\s*(\d+)/.exec(t);if(null!==e){var r=parseInt(e[1],10);if(!Number.isNaN(r))return r}return null}function XB(t){return[t,""]}function ZB(t,e,r,n,i){var o;void 0===n&&(n=null),void 0===i&&(i=!0);var a="#version 100"===t.glslVersion,s="frag"===e&&(null===(o=r.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))||void 0===o?void 0:o.length)>1,l=r.replace("\r\n","\n").split("\n").map((function(t){return t.replace(/[/][/].*$/,"")})).filter((function(t){return!(!t||/^\s+$/.test(t))})),u="";null!==n&&(u=Object.keys(n).map((function(t){return HB(t,n[t])})).join("\n"));var c=l.find((function(t){return t.startsWith("precision")}))||"precision mediump float;",h=i?l.filter((function(t){return!t.startsWith("precision")})).join("\n"):l.join("\n"),p="";if(t.viewportOrigin===wD.UPPER_LEFT&&(p+="".concat(HB("VIEWPORT_ORIGIN_TL","1"),"\n")),t.clipSpaceNearZ===CD.ZERO&&(p+="".concat(HB("CLIPSPACE_NEAR_ZERO","1"),"\n")),t.explicitBindingLocations){var d=0,f=0,m=0;h=h.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,(function(t,e,r,n){var i=r?"".concat(r,", "):"";return"layout(".concat(i,"set = ").concat(d,", binding = ").concat(f++,") uniform ").concat(n)})),d++,f=0,GD(t.separateSamplerTextures),h=h.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(t,r,n,i,o){var a=WB(n);null===a&&(a=f++);var s=B(XB(i),2),l=s[0],u=s[1];return"frag"===e?"\nlayout(set = ".concat(d,", binding = ").concat(2*a+0,") uniform texture").concat(l," T_").concat(o,";\nlayout(set = ").concat(d,", binding = ").concat(2*a+1,") uniform sampler").concat(u," S_").concat(o,";").trim():""})),h=h.replace("frag"===e?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,(function(t,e){return"layout(location = ".concat(m++,") ").concat(e)})),p+="".concat(HB("gl_VertexID","gl_VertexIndex"),"\n"),p+="".concat(HB("gl_InstanceID","gl_InstanceIndex"),"\n"),c=c.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var g=0;h=h.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(t,e,r,n,i){var o=WB(r);return null===o&&(o=g++),"uniform sampler".concat(n," ").concat(i,"; // BINDING=").concat(o)}))}if(h=(h=(h=h.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,(function(t,e,r){return"SAMPLER_".concat(e,"(P_").concat(r,")")}))).replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,(function(t,e,r){return"PP_SAMPLER_".concat(e,"(P_").concat(r,")")}))).replace(/\bPU_TEXTURE\((.*?)\)/g,(function(t,e){return"TEXTURE(P_".concat(e,")")})),t.separateSamplerTextures)h=h.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(t,e,r){var n=B(XB(e),2),i=n[0],o=n[1];return"texture".concat(i," T_P_").concat(r,", sampler").concat(o," S_P_").concat(r)})),h=(h=(h=h.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(t,e,r){return"T_".concat(r,", S_").concat(r)}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(t,e,r){return"sampler".concat(e,"(T_").concat(r,", S_").concat(r,")")}))).replace(/\bTEXTURE\((.*?)\)/g,(function(t,e){return"T_".concat(e)}));else{var _=[];h=(h=(h=h.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(t,e,r){return"sampler".concat(e," P_").concat(r)}))).replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(t,e,r){return r}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(t,e,r){return _.push([r,e]),r})),a&&_.forEach((function(t){var e=B(t,2),r=e[0],n=e[1];h=h.replace(new RegExp("texture\\(".concat(r),"g"),(function(){return"texture".concat(n,"(").concat(r)}))})),h=h.replace(/\bTEXTURE\((.*?)\)/g,(function(t,e){return e}))}var v="".concat(a?"":t.glslVersion,"\n").concat(a&&s?"#extension GL_EXT_draw_buffers : require\n":"","\n").concat(a&&"frag"===e?"#extension GL_OES_standard_derivatives : enable\n":"").concat(i?c:"","\n").concat(p||"").concat(u?u+"\n":"","\n").concat(h,"\n").trim();if(t.explicitBindingLocations&&"frag"===e&&(v=v.replace(/^\b(out)\b/g,(function(t,e){return"layout(location = 0) ".concat(e)}))),a){if("frag"===e&&(v=v.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,(function(t,e,r){return"varying ".concat(e," ").concat(r,";\n")}))),"vert"===e&&(v=(v=v.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(t,e,r){return"varying ".concat(e," ").concat(r,";\n")}))).replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,(function(t,e,r){return"attribute ".concat(e," ").concat(r,";\n")}))),v=v.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(t,e){return e.trim().replace(/^.*$/gm,(function(t){var e=t.trim();return e.startsWith("#")?e:t?"uniform ".concat(e):""}))})),"frag"===e)if(s){var y=[],x=(v=v.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,(function(t,e){return y.push(e),"vec4 ".concat(e,";\n")}))).lastIndexOf("}");v=v.substring(0,x)+"\n    ".concat(y.map((function(t,e){return"gl_FragData[".concat(e,"] = ").concat(t,";\n    ")})).join("\n"))+v.substring(x)}else{var b;if(v=v.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(t,e,r){return b=r,"".concat(e," ").concat(r,";\n")})),b){x=v.lastIndexOf("}");v=v.substring(0,x)+"\n  gl_FragColor = vec4(".concat(b,");\n")+v.substring(x)}}v=v.replace(/^\s*layout\((.*)\)/gm,"")}return v}var qB=function(t){function e(e){var r=e.id,n=e.device,i=t.call(this)||this;return i.id=r,i.device=n,null!==i.device.resourceCreationTracker&&i.device.resourceCreationTracker.trackResourceCreated(i),i}return R(e,t),e.prototype.destroy=function(){null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},e}(PD),YB=function(t){function e(e){var r=e.id,n=e.device,i=e.descriptor,o=t.call(this,{id:r,device:n})||this;o.type=sD.Bindings;var a=i.uniformBufferBindings,s=i.samplerBindings;return o.uniformBufferBindings=a||[],o.samplerBindings=s||[],o.bindingLayouts=o.createBindingLayouts(),o}return R(e,t),e.prototype.createBindingLayouts=function(){var t=0,e=0,r=[],n=this.uniformBufferBindings.length,i=this.samplerBindings.length;return r.push({firstUniformBuffer:t,numUniformBuffers:n,firstSampler:e,numSamplers:i}),{numUniformBuffers:t+=n,numSamplers:e+=i,bindingLayoutTables:r}},e}(qB);function KB(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}function $B(t){switch(ND(t)){case LD.BC1:case LD.BC2:case LD.BC3:case LD.BC4_UNORM:case LD.BC4_SNORM:case LD.BC5_UNORM:case LD.BC5_SNORM:return!0;default:return!1}}function QB(t){if(FD(t)&MD.Normalized)return!1;var e=ND(t);return e===LD.S8||e===LD.S16||e===LD.S32||(e===LD.U8||e===LD.U16||e===LD.U32)}function JB(t){return t&_D.INDEX?aD.ELEMENT_ARRAY_BUFFER:t&_D.VERTEX?aD.ARRAY_BUFFER:t&_D.UNIFORM?aD.UNIFORM_BUFFER:void 0}function tN(t){var e=ND(t),r=BD(t),n=FD(t),i=function(t){switch(t){case LD.U8:return aD.UNSIGNED_BYTE;case LD.U16:return aD.UNSIGNED_SHORT;case LD.U32:return aD.UNSIGNED_INT;case LD.S8:return aD.BYTE;case LD.S16:return aD.SHORT;case LD.S32:return aD.INT;case LD.F16:return aD.HALF_FLOAT;case LD.F32:return aD.FLOAT;default:throw new Error("whoops")}}(e),o=function(t){switch(t){case ID.R:return 1;case ID.RG:return 2;case ID.RGB:return 3;case ID.RGBA:return 4;default:return 1}}(r);return{size:o,type:i,normalized:!!(n&MD.Normalized)}}function eN(t){switch(t){case dD.CLAMP_TO_EDGE:return aD.CLAMP_TO_EDGE;case dD.REPEAT:return aD.REPEAT;case dD.MIRRORED_REPEAT:return aD.MIRRORED_REPEAT;default:throw new Error("whoops")}}function rN(t,e){if(e===mD.LINEAR&&t===fD.BILINEAR)return aD.LINEAR_MIPMAP_LINEAR;if(e===mD.LINEAR&&t===fD.POINT)return aD.NEAREST_MIPMAP_LINEAR;if(e===mD.NEAREST&&t===fD.BILINEAR)return aD.LINEAR_MIPMAP_NEAREST;if(e===mD.NEAREST&&t===fD.POINT)return aD.NEAREST_MIPMAP_NEAREST;if(e===mD.NO_MIP&&t===fD.BILINEAR)return aD.LINEAR;if(e===mD.NO_MIP&&t===fD.POINT)return aD.NEAREST;throw new Error("Unknown texture filter mode")}function nN(t,e){void 0===e&&(e=0);var r=t;return r.gl_buffer_pages[e/r.pageByteSize|0]}function iN(t){return t.gl_texture}function oN(t){return t.gl_sampler}function aN(t,e){t.name=e,t.__SPECTOR_Metadata={name:e}}function sN(t,e){for(var r=[];;){var n=e.exec(t);if(!n)break;r.push(n)}return r}function lN(t){return t.blendMode==pD.ADD&&t.blendSrcFactor==hD.ONE&&t.blendDstFactor===hD.ZERO}function uN(t){if(t===bD.TEXTURE_2D)return aD.TEXTURE_2D;if(t===bD.TEXTURE_2D_ARRAY)return aD.TEXTURE_2D_ARRAY;if(t===bD.TEXTURE_CUBE_MAP)return aD.TEXTURE_CUBE_MAP;if(t===bD.TEXTURE_3D)return aD.TEXTURE_3D;throw new Error("whoops")}function cN(t,e,r,n){return t%r==0&&e%n==0}var hN,pN=function(t){function e(e){var r=e.id,n=e.device,i=e.descriptor,o=t.call(this,{id:r,device:n})||this;o.type=sD.Buffer;var a=i.viewOrSize,s=i.usage,l=i.hint,u=void 0===l?vD.STATIC:l,c=n.uniformBufferMaxPageByteSize,h=n.gl,p=s&_D.UNIFORM;p||(KB(h)?h.bindVertexArray(null):n.OES_vertex_array_object.bindVertexArrayOES(null));var d,f=iD(a)?$D(a,4):$D(a.byteLength,4);if(o.gl_buffer_pages=[],p){for(var m=f;m>0;)o.gl_buffer_pages.push(o.createBufferPage(Math.min(m,c),s,u)),m-=c;d=c}else o.gl_buffer_pages.push(o.createBufferPage(f,s,u)),d=f;return o.pageByteSize=d,o.byteSize=f,o.usage=s,o.gl_target=JB(s),iD(a)||o.setSubData(0,new Uint8Array(a.buffer)),p||(KB(h)?h.bindVertexArray(o.device.currentBoundVAO):n.OES_vertex_array_object.bindVertexArrayOES(o.device.currentBoundVAO)),o}return R(e,t),e.prototype.setSubData=function(t,e,r,n){void 0===r&&(r=0),void 0===n&&(n=e.byteLength-r);for(var i=this.device.gl,o=this.pageByteSize,a=t+n,s=t,l=t%o;s<a;){var u=KB(i)?i.COPY_WRITE_BUFFER:this.gl_target,c=nN(this,s);if(c.ubo)return;i.bindBuffer(u,c),KB(i)?i.bufferSubData(u,l,e,r,Math.min(a-s,o)):i.bufferSubData(u,l,e),s+=o,l=0,r+=o,this.device.debugGroupStatisticsBufferUpload()}},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0;e<this.gl_buffer_pages.length;e++)this.gl_buffer_pages[e].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[e]);this.gl_buffer_pages=[]},e.prototype.createBufferPage=function(t,e,r){var n=this.device.gl,i=e&_D.UNIFORM;if(!KB(n)&&i)return{ubo:!0};var o=this.device.ensureResourceExists(n.createBuffer()),a=JB(e),s=function(t){switch(t){case vD.STATIC:return aD.STATIC_DRAW;case vD.DYNAMIC:return aD.DYNAMIC_DRAW}}(r);return n.bindBuffer(a,o),n.bufferData(a,t,s),o},e}(qB),dN=function(t){function e(e){var r,n,i,o,a,s=e.id,l=e.device,u=e.descriptor,c=t.call(this,{id:s,device:l})||this;c.type=sD.InputLayout;var h=u.vertexBufferDescriptors,p=u.indexBufferFormat,d=u.program;GD(p===OD.U16_R||p===OD.U32_R||null===p);var f=null!==p?function(t){switch(t){case OD.U8_R:return aD.UNSIGNED_BYTE;case OD.U16_R:return aD.UNSIGNED_SHORT;case OD.U32_R:return aD.UNSIGNED_INT;default:throw new Error("whoops")}}(p):null,m=null!==p?UD(p):null,g=c.device.gl,_=c.device.ensureResourceExists(KB(g)?g.createVertexArray():l.OES_vertex_array_object.createVertexArrayOES());KB(g)?g.bindVertexArray(_):l.OES_vertex_array_object.bindVertexArrayOES(_),g.bindBuffer(g.ARRAY_BUFFER,nN(c.device.fallbackVertexBuffer));try{for(var v=D(u.vertexBufferDescriptors),y=v.next();!y.done;y=v.next()){var x=y.value,b=x.stepMode,E=x.attributes;try{for(var T=(i=void 0,D(E)),S=T.next();!S.done;S=T.next()){var A=S.value,w=A.shaderLocation,C=A.format,R=A.divisor,L=void 0===R?1:R,I=KB(g)?w:null===(a=d.attributes[w])||void 0===a?void 0:a.location,M=tN(C);if(A.vertexFormat=M,!tD(I)){QB(C);var O=M.size,P=M.type,B=M.normalized;g.vertexAttribPointer(I,O,P,B,0,0),b===yD.INSTANCE&&(KB(g)?g.vertexAttribDivisor(I,L):l.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(I,L)),g.enableVertexAttribArray(I)}}}catch(t){i={error:t}}finally{try{S&&!S.done&&(o=T.return)&&o.call(T)}finally{if(i)throw i.error}}}}catch(t){r={error:t}}finally{try{y&&!y.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}return KB(g)?g.bindVertexArray(null):l.OES_vertex_array_object.bindVertexArrayOES(null),c.vertexBufferDescriptors=h,c.vao=_,c.indexBufferFormat=p,c.indexBufferType=f,c.indexBufferCompByteSize=m,c.program=d,c}return R(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(KB(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},e}(qB),fN=function(t){function e(e){var r=e.id,n=e.device,i=e.descriptor,o=e.fake,a=t.call(this,{id:r,device:n})||this;a.type=sD.Texture,i=I({dimension:bD.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},i);var s,l,u=a.device.gl,c=a.clampmipLevelCount(i);if(a.immutable=i.usage===ED.RENDER_TARGET,a.pixelStore=i.pixelStore,a.format=i.format,a.dimension=i.dimension,a.formatKind=zD(i.format),a.width=i.width,a.height=i.height,a.depthOrArrayLayers=i.depthOrArrayLayers,a.mipmaps=c>=1,!o){l=a.device.ensureResourceExists(u.createTexture());var h=a.device.translateTextureType(i.format),p=a.device.translateTextureInternalFormat(i.format);if(a.device.setActiveTexture(u.TEXTURE0),a.device.currentTextures[0]=null,a.preprocessImage(),i.dimension===bD.TEXTURE_2D){if(s=aD.TEXTURE_2D,u.bindTexture(s,l),a.immutable)if(KB(u))u.texStorage2D(s,c,p,i.width,i.height);else{var d=(p===aD.DEPTH_COMPONENT||a.isNPOT(),0);(a.format!==OD.D32F&&a.format!==OD.D24_S8||KB(u)||n.WEBGL_depth_texture)&&(u.texImage2D(s,d,p,i.width,i.height,0,p,h,null),a.mipmaps&&(a.mipmaps=!1,u.texParameteri(aD.TEXTURE_2D,aD.TEXTURE_MIN_FILTER,aD.LINEAR),u.texParameteri(aD.TEXTURE_2D,aD.TEXTURE_WRAP_S,aD.CLAMP_TO_EDGE),u.texParameteri(aD.TEXTURE_2D,aD.TEXTURE_WRAP_T,aD.CLAMP_TO_EDGE)))}GD(1===i.depthOrArrayLayers)}else if(i.dimension===bD.TEXTURE_2D_ARRAY)s=aD.TEXTURE_2D_ARRAY,u.bindTexture(s,l),a.immutable&&KB(u)&&u.texStorage3D(s,c,p,i.width,i.height,i.depthOrArrayLayers);else if(i.dimension===bD.TEXTURE_3D)s=aD.TEXTURE_3D,u.bindTexture(s,l),a.immutable&&KB(u)&&u.texStorage3D(s,c,p,i.width,i.height,i.depthOrArrayLayers);else{if(i.dimension!==bD.TEXTURE_CUBE_MAP)throw new Error("whoops");s=aD.TEXTURE_CUBE_MAP,u.bindTexture(s,l),a.immutable&&KB(u)&&u.texStorage2D(s,c,p,i.width,i.height),GD(6===i.depthOrArrayLayers)}}return a.gl_texture=l,a.gl_target=s,a.mipLevelCount=c,a}return R(e,t),e.prototype.setImageData=function(t,e){void 0===e&&(e=0);var r=this.device.gl;$B(this.format);var n,i=this.gl_target===aD.TEXTURE_3D||this.gl_target===aD.TEXTURE_2D_ARRAY,o=this.gl_target===aD.TEXTURE_CUBE_MAP,a=(n=t[0],Object.prototype.toString.call(n)in VB);this.device.setActiveTexture(r.TEXTURE0),this.device.currentTextures[0]=null;var s,l,u=t[0];a?(s=this.width,l=this.height):(s=u.width,l=u.height,this.width=s,this.height=l),r.bindTexture(this.gl_target,this.gl_texture);var c=this.device.translateTextureFormat(this.format),h=KB(r)?this.device.translateInternalTextureFormat(this.format):c,p=this.device.translateTextureType(this.format);this.preprocessImage();for(var d=0;d<this.depthOrArrayLayers;d++){var f=t[d],m=this.gl_target;o&&(m=aD.TEXTURE_CUBE_MAP_POSITIVE_X+d%6),this.immutable?r.texSubImage2D(m,e,0,0,s,l,c,p,f):KB(r)?i?r.texImage3D(m,e,h,s,l,this.depthOrArrayLayers,0,c,p,f):r.texImage2D(m,e,h,s,l,0,c,p,f):a?r.texImage2D(m,e,c,s,l,0,c,p,f):r.texImage2D(m,e,c,c,p,f)}this.mipmaps&&this.generateMipmap(i)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.device.gl.deleteTexture(iN(this))},e.prototype.clampmipLevelCount=function(t){if(t.dimension===bD.TEXTURE_2D_ARRAY&&t.depthOrArrayLayers>1&&ND(t.format)===LD.BC1)for(var e=t.width,r=t.height,n=0;n<t.mipLevelCount;n++){if(e<=2||r<=2)return n-1;e=Math.max(e/2|0,1),r=Math.max(r/2|0,1)}return t.mipLevelCount},e.prototype.preprocessImage=function(){var t=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&t.pixelStorei(aD.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&t.pixelStorei(aD.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&t.pixelStorei(aD.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},e.prototype.generateMipmap=function(t){void 0===t&&(t=!1);var e=this.device.gl;return!KB(e)&&this.isNPOT()||this.gl_texture&&this.gl_target&&(e.bindTexture(this.gl_target,this.gl_texture),t?(e.texParameteri(this.gl_target,aD.TEXTURE_BASE_LEVEL,0),e.texParameteri(this.gl_target,aD.TEXTURE_MAX_LEVEL,Math.log2(this.width)),e.texParameteri(this.gl_target,aD.TEXTURE_MIN_FILTER,aD.LINEAR_MIPMAP_LINEAR),e.texParameteri(this.gl_target,aD.TEXTURE_MAG_FILTER,aD.LINEAR)):e.texParameteri(aD.TEXTURE_2D,aD.TEXTURE_MIN_FILTER,aD.NEAREST_MIPMAP_LINEAR),e.generateMipmap(this.gl_target),e.bindTexture(this.gl_target,null)),this},e.prototype.isNPOT=function(){return!KB(this.device.gl)&&(!YD(this.width)||!YD(this.height))},e}(qB),mN=function(t){function e(e){var r=e.id,n=e.device,i=e.descriptor,o=t.call(this,{id:r,device:n})||this;o.type=sD.RenderTarget,o.gl_renderbuffer=null,o.texture=null;var a=o.device.gl,s=i.format,l=i.width,u=i.height,c=i.sampleCount,h=void 0===c?1:c,p=i.texture,d=!1;if(s!==OD.D32F&&s!==OD.D24_S8||!p||KB(a)||n.WEBGL_depth_texture||(p.destroy(),o.texture=null,d=!0),!d&&p)o.texture=p;else{o.gl_renderbuffer=o.device.ensureResourceExists(a.createRenderbuffer()),a.bindRenderbuffer(a.RENDERBUFFER,o.gl_renderbuffer);var f=o.device.translateTextureInternalFormat(s,!0);KB(a)&&h>1?a.renderbufferStorageMultisample(aD.RENDERBUFFER,h,f,l,u):a.renderbufferStorage(aD.RENDERBUFFER,f,l,u)}return o.format=s,o.width=l,o.height=u,o.sampleCount=h,o}return R(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),null!==this.gl_renderbuffer&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},e}(qB);!function(t){t[t.NeedsCompile=0]="NeedsCompile",t[t.Compiling=1]="Compiling",t[t.NeedsBind=2]="NeedsBind",t[t.ReadyToUse=3]="ReadyToUse"}(hN||(hN={}));var gN=function(t){function e(e,r){var n=e.id,i=e.device,o=e.descriptor,a=t.call(this,{id:n,device:i})||this;a.rawVertexGLSL=r,a.type=sD.Program,a.uniformSetters={},a.attributes=[];var s=a.device.gl;return a.descriptor=o,a.gl_program=a.device.ensureResourceExists(s.createProgram()),a.gl_shader_vert=null,a.gl_shader_frag=null,a.compileState=hN.NeedsCompile,a.tryCompileProgram(),a}return R(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},e.prototype.tryCompileProgram=function(){GD(this.compileState===hN.NeedsCompile);var t=this.descriptor,e=t.vertex,r=t.fragment,n=this.device.gl;(null==e?void 0:e.glsl)&&(null==r?void 0:r.glsl)&&(this.gl_shader_vert=this.compileShader(e.postprocess?e.postprocess(e.glsl):e.glsl,n.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(r.postprocess?r.postprocess(r.glsl):r.glsl,n.FRAGMENT_SHADER),n.attachShader(this.gl_program,this.gl_shader_vert),n.attachShader(this.gl_program,this.gl_shader_frag),n.linkProgram(this.gl_program),this.compileState=hN.Compiling,KB(n)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},e.prototype.readAttributesFromLinkedProgram=function(){for(var t,e=this.device.gl,r=e.getProgramParameter(this.gl_program,e.ACTIVE_ATTRIBUTES),n=function(t){var e={};return t.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,(function(t,r,n){var i=Number(n);return e[r]=isNaN(i)?n:i,""})),e}(this.descriptor.vertex.glsl),i=function(t,e){var r=[];return t.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,(function(t,n,i){var o=Number(n);return r.push({location:isNaN(o)?e[n]:o,name:i}),""})),r}(this.rawVertexGLSL,n),o=function(r){var n=e.getActiveAttrib(a.gl_program,r),o=n.name,s=n.type,l=n.size,u=e.getAttribLocation(a.gl_program,o),c=null===(t=i.find((function(t){return t.name===o})))||void 0===t?void 0:t.location;u>=0&&!tD(c)&&(a.attributes[c]={name:o,location:u,type:s,size:l})},a=this,s=0;s<r;s++)o(s)},e.prototype.readUniformLocationsFromLinkedProgram=function(){for(var t=this.device.gl,e=t.getProgramParameter(this.gl_program,t.ACTIVE_UNIFORMS),r=0;r<e;r++){var n=t.getActiveUniform(this.gl_program,r),i=RB(n.name).name,o=t.getUniformLocation(this.gl_program,i);if(this.uniformSetters[i]=jB(t,o,n),n&&n.size>1)for(var a=0;a<n.size;a++)o=t.getUniformLocation(this.gl_program,"".concat(i,"[").concat(a,"]")),this.uniformSetters["".concat(i,"[").concat(a,"]")]=jB(t,o,n)}},e.prototype.compileShader=function(t,e){var r=this.device.gl,n=this.device.ensureResourceExists(r.createShader(e));return r.shaderSource(n,t),r.compileShader(n),n},e.prototype.setUniformsLegacy=function(t){void 0===t&&(t={});var e=this.device.gl;if(!KB(e)){var r=!1;for(var n in t){r||(e.useProgram(this.gl_program),r=!0);var i=t[n],o=this.uniformSetters[n];if(o){var a=i;a instanceof fN&&(a=a.textureIndex),o(a)}}}return this},e}(qB),_N=function(t){function e(e){var r=e.id,n=e.device,i=e.descriptor,o=t.call(this,{id:r,device:n})||this;o.type=sD.QueryPool;var a=o.device.gl;if(KB(a)){var s=i.elemCount,l=i.type;o.gl_query=function(t,e){for(var r=new Array(t),n=0;n<t;n++)r[n]=e();return r}(s,(function(){return o.device.ensureResourceExists(a.createQuery())})),o.gl_query_type=function(t){if(t===RD.OcclusionConservative)return aD.ANY_SAMPLES_PASSED_CONSERVATIVE;throw new Error("whoops")}(l)}return o}return R(e,t),e.prototype.queryResultOcclusion=function(t){var e=this.device.gl;if(KB(e)){var r=this.gl_query[t];return e.getQueryParameter(r,e.QUERY_RESULT_AVAILABLE)?!!e.getQueryParameter(r,e.QUERY_RESULT):null}return null},e.prototype.destroy=function(){t.prototype.destroy.call(this);var e=this.device.gl;if(KB(e))for(var r=0;r<this.gl_query.length;r++)e.deleteQuery(this.gl_query[r])},e}(qB),vN=function(t){function e(e){var r=e.id,n=e.device,i=t.call(this,{id:r,device:n})||this;return i.type=sD.Readback,i.gl_pbo=null,i.gl_sync=null,i}return R(e,t),e.prototype.clientWaitAsync=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=10);var n=this.device.gl;return new Promise((function(i,o){!function a(){var s=n.clientWaitSync(t,e,0);s!=n.WAIT_FAILED?s!=n.TIMEOUT_EXPIRED?i():setTimeout(a,nD(r,0,n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL)):o()}()}))},e.prototype.getBufferSubDataAsync=function(t,e,r,n,i,o){return O(this,void 0,void 0,(function(){var a;return P(this,(function(s){switch(s.label){case 0:return KB(a=this.device.gl)?(this.gl_sync=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0),a.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return s.sent(),a.bindBuffer(t,e),a.getBufferSubData(t,r,n,i,o),a.bindBuffer(t,null),[2,n];case 2:return[2]}}))}))},e.prototype.readTexture=function(t,e,r,n,i,o,a,s){return void 0===a&&(a=0),void 0===s&&(s=o.byteLength||0),O(this,void 0,void 0,(function(){var l,u,c,h,p;return P(this,(function(d){var f;return l=this.device.gl,u=t,c=this.device.translateTextureFormat(u.format),h=this.device.translateTextureType(u.format),f=u.format,p=kD(ND(f))*BD(f),KB(l)?(this.gl_pbo=this.device.ensureResourceExists(l.createBuffer()),l.bindBuffer(l.PIXEL_PACK_BUFFER,this.gl_pbo),l.bufferData(l.PIXEL_PACK_BUFFER,s,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.bindFramebuffer(aD.READ_FRAMEBUFFER,this.device.readbackFramebuffer),l.framebufferTexture2D(aD.READ_FRAMEBUFFER,aD.COLOR_ATTACHMENT0,aD.TEXTURE_2D,u.gl_texture,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,this.gl_pbo),l.readPixels(e,r,n,i,c,h,a*p),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(l.PIXEL_PACK_BUFFER,this.gl_pbo,0,o,a,0)]):[2,this.readTextureSync(t,e,r,n,i,o,a,s)]}))}))},e.prototype.readTextureSync=function(t,e,r,n,i,o,a,s){void 0===s&&(s=o.byteLength||0);var l=this.device.gl,u=t,c=this.device.translateTextureType(u.format);return l.bindFramebuffer(aD.FRAMEBUFFER,this.device.readbackFramebuffer),l.framebufferTexture2D(aD.FRAMEBUFFER,aD.COLOR_ATTACHMENT0,aD.TEXTURE_2D,u.gl_texture,0),l.pixelStorei(l.PACK_ALIGNMENT,4),l.readPixels(e,r,n,i,l.RGBA,c,o),o},e.prototype.readBuffer=function(t,e,r,n,i){return O(this,void 0,void 0,(function(){var o;return P(this,(function(a){return KB(o=this.device.gl)?[2,this.getBufferSubDataAsync(o.ARRAY_BUFFER,nN(t,e),e,r,n,i)]:[2,Promise.reject()]}))}))},e.prototype.destroy=function(){t.prototype.destroy.call(this),KB(this.device.gl)&&(null!==this.gl_sync&&this.device.gl.deleteSync(this.gl_sync),null!==this.gl_pbo&&this.device.gl.deleteBuffer(this.gl_pbo))},e}(qB),yN=function(t){function e(e){var r,n,i=e.id,o=e.device,a=e.descriptor,s=t.call(this,{id:i,device:o})||this;return s.type=sD.RenderPipeline,s.drawMode=function(t){switch(t){case gD.TRIANGLES:return aD.TRIANGLES;case gD.POINTS:return aD.POINTS;case gD.TRIANGLE_STRIP:return aD.TRIANGLE_STRIP;case gD.LINES:return aD.LINES;case gD.LINE_STRIP:return aD.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}(null!==(r=a.topology)&&void 0!==r?r:gD.TRIANGLES),s.program=a.program,s.inputLayout=a.inputLayout,s.megaState=I(I({},rB(iB)),a.megaStateDescriptor),s.colorAttachmentFormats=a.colorAttachmentFormats.slice(),s.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,s.sampleCount=null!==(n=a.sampleCount)&&void 0!==n?n:1,s}return R(e,t),e}(qB),xN=function(t){function e(e){var r=e.id,n=e.device,i=e.descriptor,o=t.call(this,{id:r,device:n})||this;return o.type=sD.ComputePipeline,o.descriptor=i,o}return R(e,t),e}(qB),bN=function(){function t(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return t.prototype.trackResourceCreated=function(t){this.creationStacks.set(t,(new Error).stack),this.liveObjects.add(t)},t.prototype.trackResourceDestroyed=function(t){this.deletionStacks.has(t)&&console.warn("Object double freed:",t,"\n\nCreation stack: ",this.creationStacks.get(t),"\n\nDeletion stack: ",this.deletionStacks.get(t),"\n\nThis stack: ",(new Error).stack),this.deletionStacks.set(t,(new Error).stack),this.liveObjects.delete(t)},t.prototype.checkForLeaks=function(){var t,e;try{for(var r=D(this.liveObjects.values()),n=r.next();!n.done;n=r.next()){var i=n.value;console.warn("Object leaked:",i,"Creation stack:",this.creationStacks.get(i))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setResourceLeakCheck=function(t,e){e?this.liveObjects.add(t):this.liveObjects.delete(t)},t}(),EN=function(t){function e(e){var r,n,i=e.id,o=e.device,a=e.descriptor,s=t.call(this,{id:i,device:o})||this;s.type=sD.Sampler;var l=s.device.gl;if(KB(l)){var u=s.device.ensureResourceExists(l.createSampler());l.samplerParameteri(u,aD.TEXTURE_WRAP_S,eN(a.addressModeU)),l.samplerParameteri(u,aD.TEXTURE_WRAP_T,eN(a.addressModeV)),l.samplerParameteri(u,aD.TEXTURE_WRAP_R,eN(null!==(r=a.addressModeW)&&void 0!==r?r:a.addressModeU)),l.samplerParameteri(u,aD.TEXTURE_MIN_FILTER,rN(a.minFilter,a.mipmapFilter)),l.samplerParameteri(u,aD.TEXTURE_MAG_FILTER,rN(a.magFilter,mD.NO_MIP)),void 0!==a.lodMinClamp&&l.samplerParameterf(u,aD.TEXTURE_MIN_LOD,a.lodMinClamp),void 0!==a.lodMaxClamp&&l.samplerParameterf(u,aD.TEXTURE_MAX_LOD,a.lodMaxClamp),void 0!==a.compareFunction&&(l.samplerParameteri(u,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE),l.samplerParameteri(u,l.TEXTURE_COMPARE_FUNC,a.compareFunction));var c=null!==(n=a.maxAnisotropy)&&void 0!==n?n:1;c>1&&null!==s.device.EXT_texture_filter_anisotropic&&(GD(a.minFilter===fD.BILINEAR&&a.magFilter===fD.BILINEAR&&a.mipmapFilter===mD.LINEAR),l.samplerParameterf(u,s.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c)),s.gl_sampler=u}else s.descriptor=a;return s}return R(e,t),e.prototype.setTextureParameters=function(t,e,r){var n,i=this.device.gl,o=this.descriptor;this.isNPOT(e,r)?i.texParameteri(aD.TEXTURE_2D,aD.TEXTURE_MIN_FILTER,aD.LINEAR):i.texParameteri(t,aD.TEXTURE_MIN_FILTER,rN(o.minFilter,o.mipmapFilter)),i.texParameteri(aD.TEXTURE_2D,aD.TEXTURE_WRAP_S,eN(o.addressModeU)),i.texParameteri(aD.TEXTURE_2D,aD.TEXTURE_WRAP_T,eN(o.addressModeV)),i.texParameteri(t,aD.TEXTURE_MAG_FILTER,rN(o.magFilter,mD.NO_MIP));var a=null!==(n=o.maxAnisotropy)&&void 0!==n?n:1;a>1&&null!==this.device.EXT_texture_filter_anisotropic&&(GD(o.minFilter===fD.BILINEAR&&o.magFilter===fD.BILINEAR&&o.mipmapFilter===mD.LINEAR),i.texParameteri(t,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a))},e.prototype.destroy=function(){t.prototype.destroy.call(this),KB(this.device.gl)&&this.device.gl.deleteSampler(oN(this))},e.prototype.isNPOT=function(t,e){return!YD(t)||!YD(e)},e}(qB),TN=function(){function t(){}return t.prototype.dispatchWorkgroups=function(t,e,r){},t.prototype.dispatchWorkgroupsIndirect=function(t,e){},t.prototype.setPipeline=function(t){},t.prototype.setBindings=function(t){},t.prototype.pushDebugGroup=function(t){},t.prototype.popDebugGroup=function(){},t.prototype.insertDebugMarker=function(t){},t}(),SN=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=sD.RenderBundle,e.commands=[],e}return R(e,t),e.prototype.push=function(t){this.commands.push(t)},e.prototype.replay=function(){this.commands.forEach((function(t){return t()}))},e}(qB),AN=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,wN=function(){function t(t,e){void 0===e&&(e={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=rB(iB),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=wD.LOWER_LEFT,this.clipSpaceNearZ=CD.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=t,this.contextAttributes=jD(t.getContextAttributes()),KB(t)?(this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=t.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=t.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=t.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=t.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=t.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=t.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=t.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=t.getExtension("EXT_color_buffer_half_float"),t.getExtension("EXT_frag_depth"),t.getExtension("OES_element_index_uint"),t.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=t.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=t.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=t.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=t.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=t.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=t.getExtension("KHR_parallel_shader_compile"),KB(t)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new fN({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:bD.TEXTURE_2D,mipLevelCount:1,usage:ED.RENDER_TARGET,format:!1===this.contextAttributes.alpha?OD.U8_RGB_RT:OD.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=AD.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(bD.TEXTURE_2D,AD.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(bD.TEXTURE_2D,AD.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:_D.VERTEX,hint:vD.STATIC}),KB(t)&&(this.fallbackTexture2DArray=this.createFallbackTexture(bD.TEXTURE_2D_ARRAY,AD.Float),this.fallbackTexture3D=this.createFallbackTexture(bD.TEXTURE_3D,AD.Float),this.fallbackTextureCube=this.createFallbackTexture(bD.TEXTURE_CUBE_MAP,AD.Float)),this.currentMegaState.depthCompare=lD.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=TD.ALL,t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),this.checkLimits(),e.shaderDebug&&(this.shaderDebug=!0),e.trackResources&&(this.resourceCreationTracker=new bN)}return t.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},t.prototype.createFallbackTexture=function(t,e){var r=t===bD.TEXTURE_CUBE_MAP?6:1,n=e===AD.Depth?OD.D32F:OD.U8_RGBA_NORM,i=this.createTexture({dimension:t,format:n,usage:ED.SAMPLED,width:1,height:1,depthOrArrayLayers:r,mipLevelCount:1});return e===AD.Float&&i.setImageData([new Uint8Array(4*r)]),iN(i)},t.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},t.prototype.checkLimits=function(){var t=this.gl;if(this.maxVertexAttribs=t.getParameter(aD.MAX_VERTEX_ATTRIBS),KB(t)){this.uniformBufferMaxPageByteSize=Math.min(t.getParameter(aD.MAX_UNIFORM_BLOCK_SIZE),65536),this.uniformBufferWordAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var e=t.getInternalformatParameter(t.RENDERBUFFER,t.DEPTH32F_STENCIL8,t.SAMPLES);this.supportedSampleCounts=e?N([],B(e),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=65536;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort((function(t,e){return t-e}))},t.prototype.configureSwapChain=function(t,e,r){var n,i=this.scTexture;i.width=t,i.height=e,this.scPlatformFramebuffer=void 0===(n=r)?null:n},t.prototype.getDevice=function(){return this},t.prototype.getCanvas=function(){return this.gl.canvas},t.prototype.getOnscreenTexture=function(){return this.scTexture},t.prototype.beginFrame=function(){},t.prototype.endFrame=function(){},t.prototype.translateTextureInternalFormat=function(t,e){switch(void 0===e&&(e=!1),t){case OD.ALPHA:return aD.ALPHA;case OD.U8_LUMINANCE:case OD.F16_LUMINANCE:case OD.F32_LUMINANCE:return aD.LUMINANCE;case OD.F16_R:return aD.R16F;case OD.F16_RG:return aD.RG16F;case OD.F16_RGB:return aD.RGB16F;case OD.F16_RGBA:return aD.RGBA16F;case OD.F32_R:return aD.R32F;case OD.F32_RG:return aD.RG32F;case OD.F32_RGB:return aD.RGB32F;case OD.F32_RGBA:return KB(this.gl)?aD.RGBA32F:e?this.WEBGL_color_buffer_float.RGBA32F_EXT:aD.RGBA;case OD.U8_R_NORM:return aD.R8;case OD.U8_RG_NORM:return aD.RG8;case OD.U8_RGB_NORM:case OD.U8_RGB_RT:return aD.RGB8;case OD.U8_RGB_SRGB:return aD.SRGB8;case OD.U8_RGBA_NORM:case OD.U8_RGBA_RT:return KB(this.gl)?aD.RGBA8:e?aD.RGBA4:aD.RGBA;case OD.U8_RGBA:return aD.RGBA;case OD.U8_RGBA_SRGB:case OD.U8_RGBA_RT_SRGB:return aD.SRGB8_ALPHA8;case OD.U16_R:return aD.R16UI;case OD.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case OD.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case OD.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case OD.U16_RGBA_5551:return aD.RGB5_A1;case OD.U16_RGB_565:return aD.RGB565;case OD.U32_R:return aD.R32UI;case OD.S8_RGBA_NORM:return aD.RGBA8_SNORM;case OD.S8_RG_NORM:return aD.RG8_SNORM;case OD.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case OD.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case OD.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case OD.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case OD.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case OD.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case OD.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case OD.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case OD.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case OD.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case OD.D32F_S8:return KB(this.gl)?aD.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?aD.DEPTH_STENCIL:aD.DEPTH_COMPONENT16;case OD.D24_S8:return KB(this.gl)?aD.DEPTH24_STENCIL8:this.WEBGL_depth_texture?aD.DEPTH_STENCIL:aD.DEPTH_COMPONENT16;case OD.D32F:return KB(this.gl)?aD.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?aD.DEPTH_COMPONENT:aD.DEPTH_COMPONENT16;case OD.D24:return KB(this.gl)?aD.DEPTH_COMPONENT24:this.WEBGL_depth_texture?aD.DEPTH_COMPONENT:aD.DEPTH_COMPONENT16;default:throw new Error("whoops")}},t.prototype.translateTextureType=function(t){switch(ND(t)){case LD.U8:return aD.UNSIGNED_BYTE;case LD.U16:return aD.UNSIGNED_SHORT;case LD.U32:return aD.UNSIGNED_INT;case LD.S8:return aD.BYTE;case LD.F16:return aD.HALF_FLOAT;case LD.F32:return aD.FLOAT;case LD.U16_PACKED_5551:return aD.UNSIGNED_SHORT_5_5_5_1;case LD.D32F:return KB(this.gl)?aD.FLOAT:this.WEBGL_depth_texture?aD.UNSIGNED_INT:aD.UNSIGNED_BYTE;case LD.D24:return KB(this.gl)?aD.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?aD.UNSIGNED_SHORT:aD.UNSIGNED_BYTE;case LD.D24S8:return KB(this.gl)?aD.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?aD.UNSIGNED_INT_24_8_WEBGL:aD.UNSIGNED_BYTE;case LD.D32FS8:return aD.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},t.prototype.translateInternalTextureFormat=function(t){switch(t){case OD.F32_R:return aD.R32F;case OD.F32_RG:return aD.RG32F;case OD.F32_RGB:return aD.RGB32F;case OD.F32_RGBA:return aD.RGBA32F;case OD.F16_R:return aD.R16F;case OD.F16_RG:return aD.RG16F;case OD.F16_RGB:return aD.RGB16F;case OD.F16_RGBA:return aD.RGBA16F}return this.translateTextureFormat(t)},t.prototype.translateTextureFormat=function(t){if($B(t)||t===OD.F32_LUMINANCE||t===OD.U8_LUMINANCE)return this.translateTextureInternalFormat(t);var e=KB(this.gl)||!KB(this.gl)&&!!this.WEBGL_depth_texture;switch(t){case OD.D24_S8:case OD.D32F_S8:return e?aD.DEPTH_STENCIL:aD.RGBA;case OD.D24:case OD.D32F:return e?aD.DEPTH_COMPONENT:aD.RGBA}var r=QB(t);switch(BD(t)){case ID.A:return aD.ALPHA;case ID.R:return r?aD.RED_INTEGER:aD.RED;case ID.RG:return r?aD.RG_INTEGER:aD.RG;case ID.RGB:return r?aD.RGB_INTEGER:aD.RGB;case ID.RGBA:return aD.RGBA}},t.prototype.setActiveTexture=function(t){this.currentActiveTexture!==t&&(this.gl.activeTexture(t),this.currentActiveTexture=t)},t.prototype.bindVAO=function(t){this.currentBoundVAO!==t&&(KB(this.gl)?this.gl.bindVertexArray(t):this.OES_vertex_array_object.bindVertexArrayOES(t),this.currentBoundVAO=t)},t.prototype.programCompiled=function(t){GD(t.compileState!==hN.NeedsCompile),t.compileState===hN.Compiling&&(t.compileState=hN.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(t))},t.prototype.useProgram=function(t){this.currentProgram!==t&&(this.programCompiled(t),this.gl.useProgram(t.gl_program),this.currentProgram=t)},t.prototype.ensureResourceExists=function(t){if(null===t){var e=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(e))}return t},t.prototype.createBuffer=function(t){return new pN({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createTexture=function(t){return new fN({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createSampler=function(t){return new EN({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createRenderTarget=function(t){return new mN({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createRenderTargetFromTexture=function(t){var e=t,r=e.format,n=e.width,i=e.height;return GD(1===e.mipLevelCount),this.createRenderTarget({format:r,width:n,height:i,sampleCount:1,texture:t})},t.prototype.createProgram=function(t){var e,r,n,i=null===(e=t.vertex)||void 0===e?void 0:e.glsl;return(null===(r=t.vertex)||void 0===r?void 0:r.glsl)&&(t.vertex.glsl=ZB(this.queryVendorInfo(),"vert",t.vertex.glsl)),(null===(n=t.fragment)||void 0===n?void 0:n.glsl)&&(t.fragment.glsl=ZB(this.queryVendorInfo(),"frag",t.fragment.glsl)),this.createProgramSimple(t,i)},t.prototype.createProgramSimple=function(t,e){return new gN({id:this.getNextUniqueId(),device:this,descriptor:t},e)},t.prototype.createBindings=function(t){return new YB({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createInputLayout=function(t){return new dN({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createRenderPipeline=function(t){return new yN({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createComputePass=function(){return new TN},t.prototype.createComputePipeline=function(t){return new xN({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createReadback=function(){return new vN({id:this.getNextUniqueId(),device:this})},t.prototype.createQueryPool=function(t,e){return new _N({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:e}})},t.prototype.formatRenderPassDescriptor=function(t){var e,r,n,i,o,a,s=t.colorAttachment;t.depthClearValue=null!==(e=t.depthClearValue)&&void 0!==e?e:"load",t.stencilClearValue=null!==(r=t.stencilClearValue)&&void 0!==r?r:"load";for(var l=0;l<s.length;l++)t.colorAttachmentLevel||(t.colorAttachmentLevel=[]),t.colorAttachmentLevel[l]=null!==(n=t.colorAttachmentLevel[l])&&void 0!==n?n:0,t.colorResolveToLevel||(t.colorResolveToLevel=[]),t.colorResolveToLevel[l]=null!==(i=t.colorResolveToLevel[l])&&void 0!==i?i:0,t.colorClearColor||(t.colorClearColor=[]),t.colorClearColor[l]=null!==(o=t.colorClearColor[l])&&void 0!==o?o:"load",t.colorStore||(t.colorStore=[]),t.colorStore[l]=null!==(a=t.colorStore[l])&&void 0!==a&&a},t.prototype.createRenderBundle=function(){return new SN({id:this.getNextUniqueId(),device:this})},t.prototype.beginBundle=function(t){this.renderBundle=t},t.prototype.endBundle=function(){this.renderBundle=void 0},t.prototype.executeBundles=function(t){t.forEach((function(t){t.replay()}))},t.prototype.createRenderPass=function(t){null!==this.currentRenderPassDescriptor&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=t,this.formatRenderPassDescriptor(t);var e=t.colorAttachment,r=t.colorAttachmentLevel,n=t.colorClearColor,i=t.colorResolveTo,o=t.colorResolveToLevel,a=t.depthStencilAttachment,s=t.depthClearValue,l=t.stencilClearValue,u=t.depthStencilResolveTo,c=i&&1===i.length&&i[0]===this.scTexture;this.setRenderPassParametersBegin(e.length,c);for(var h=0;h<e.length;h++)this.setRenderPassParametersColor(h,e[h],r[h],i[h],o[h],c);this.setRenderPassParametersDepthStencil(a,u,c),this.validateCurrentAttachments();for(h=0;h<e.length;h++){var p=n[h];"load"!==p&&this.setRenderPassParametersClearColor(h,p.r,p.g,p.b,p.a)}return this.setRenderPassParametersClearDepthStencil(s,l),this},t.prototype.submitPass=function(t){GD(null!==this.currentRenderPassDescriptor),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},t.prototype.copySubTexture2D=function(t,e,r,n,i,o){var a=this.gl,s=t,l=n;if(GD(1===l.mipLevelCount),GD(1===s.mipLevelCount),KB(a))s===this.scTexture?a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,s,0)),a.bindFramebuffer(a.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,l,0),a.blitFramebuffer(i,o,i+l.width,o+l.height,e,r,e+l.width,r+l.height,a.COLOR_BUFFER_BIT,a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null);else if(s===this.scTexture){var u=this.createRenderTargetFromTexture(n);this.submitBlitRenderPass(u,s)}},t.prototype.queryLimits=function(){return this},t.prototype.queryTextureFormatSupported=function(t,e,r){switch(t){case OD.BC1_SRGB:case OD.BC2_SRGB:case OD.BC3_SRGB:return null!==this.WEBGL_compressed_texture_s3tc_srgb&&cN(e,r,4,4);case OD.BC1:case OD.BC2:case OD.BC3:return null!==this.WEBGL_compressed_texture_s3tc&&cN(e,r,4,4);case OD.BC4_UNORM:case OD.BC4_SNORM:case OD.BC5_UNORM:case OD.BC5_SNORM:return null!==this.EXT_texture_compression_rgtc&&cN(e,r,4,4);case OD.U16_R_NORM:case OD.U16_RG_NORM:case OD.U16_RGBA_NORM:return null!==this.EXT_texture_norm16;case OD.F32_R:case OD.F32_RG:case OD.F32_RGB:case OD.F32_RGBA:return null!==this.OES_texture_float_linear;case OD.F16_R:case OD.F16_RG:case OD.F16_RGB:case OD.F16_RGBA:return null!==this.OES_texture_half_float_linear;default:return!0}},t.prototype.queryProgramReady=function(t){var e=this.gl;if(t.compileState===hN.NeedsCompile)throw new Error("whoops");if(t.compileState===hN.Compiling){var r=void 0;return(r=null===this.KHR_parallel_shader_compile||e.getProgramParameter(t.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR))&&this.programCompiled(t),r}return t.compileState===hN.NeedsBind||t.compileState===hN.ReadyToUse},t.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},t.prototype.queryVendorInfo=function(){return this},t.prototype.queryRenderPass=function(t){return this.currentRenderPassDescriptor},t.prototype.queryRenderTarget=function(t){return t},t.prototype.setResourceName=function(t,e){if(t.name=e,t.type===sD.Buffer)for(var r=t.gl_buffer_pages,n=0;n<r.length;n++)aN(r[n],"".concat(e," Page ").concat(n));else if(t.type===sD.Texture)aN(iN(t),e);else if(t.type===sD.Sampler)aN(oN(t),e);else if(t.type===sD.RenderTarget){var i=t.gl_renderbuffer;null!==i&&aN(i,e)}else t.type===sD.InputLayout&&aN(t.vao,e)},t.prototype.setResourceLeakCheck=function(t,e){null!==this.resourceCreationTracker&&this.resourceCreationTracker.setResourceLeakCheck(t,e)},t.prototype.checkForLeaks=function(){null!==this.resourceCreationTracker&&this.resourceCreationTracker.checkForLeaks()},t.prototype.pushDebugGroup=function(t){},t.prototype.popDebugGroup=function(){},t.prototype.insertDebugMarker=function(t){},t.prototype.programPatched=function(t,e){GD(this.shaderDebug)},t.prototype.getBufferData=function(t,e,r){void 0===r&&(r=0);var n=this.gl;KB(n)&&(n.bindBuffer(n.COPY_READ_BUFFER,nN(t,4*r)),n.getBufferSubData(n.COPY_READ_BUFFER,4*r,e))},t.prototype.debugGroupStatisticsDrawCall=function(t){void 0===t&&(t=1);for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].drawCallCount+=t},t.prototype.debugGroupStatisticsBufferUpload=function(t){void 0===t&&(t=1);for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].bufferUploadCount+=t},t.prototype.debugGroupStatisticsTextureBind=function(t){void 0===t&&(t=1);for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].textureBindCount+=t},t.prototype.debugGroupStatisticsTriangles=function(t){for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].triangleCount+=t},t.prototype.reportShaderError=function(t,e){var r=this.gl,n=r.getShaderParameter(t,r.COMPILE_STATUS);if(!n){console.error(function(t,e){return void 0===e&&(e=1),t.split("\n").map((function(t,r){return"".concat(function(t,e,r){for(void 0===r&&(r="0");t.length<e;)t="".concat(r).concat(t);return t}(""+(e+r),4," "),"  ").concat(t)})).join("\n")}(e));var i=r.getExtension("WEBGL_debug_shaders");i&&console.error(i.getTranslatedShaderSource(t)),console.error(r.getShaderInfoLog(t))}return n},t.prototype.checkProgramCompilationForErrors=function(t){var e=this.gl,r=t.gl_program;if(!e.getProgramParameter(r,e.LINK_STATUS)){var n=t.descriptor;if(!this.reportShaderError(t.gl_shader_vert,n.vertex.glsl))return;if(!this.reportShaderError(t.gl_shader_frag,n.fragment.glsl))return;console.error(e.getProgramInfoLog(t.gl_program))}},t.prototype.bindFramebufferAttachment=function(t,e,r,n){var i=this.gl;if(tD(r))i.framebufferRenderbuffer(t,e,i.RENDERBUFFER,null);else if(r.type===sD.RenderTarget)null!==r.gl_renderbuffer?i.framebufferRenderbuffer(t,e,i.RENDERBUFFER,r.gl_renderbuffer):null!==r.texture&&i.framebufferTexture2D(t,e,aD.TEXTURE_2D,iN(r.texture),n);else if(r.type===sD.Texture){var o=iN(r);r.dimension===bD.TEXTURE_2D?i.framebufferTexture2D(t,e,aD.TEXTURE_2D,o,n):KB(i)&&(r.dimension,bD.TEXTURE_2D_ARRAY)}},t.prototype.bindFramebufferDepthStencilAttachment=function(t,e){var r=this.gl,n=tD(e)?MD.Depth|MD.Stencil:FD(e.format),i=!!(n&MD.Depth),o=!!(n&MD.Stencil);i&&o?KB(this.gl)||!KB(this.gl)&&!!this.WEBGL_depth_texture?this.bindFramebufferAttachment(t,r.DEPTH_STENCIL_ATTACHMENT,e,0):this.bindFramebufferAttachment(t,r.DEPTH_ATTACHMENT,e,0):i?(this.bindFramebufferAttachment(t,r.DEPTH_ATTACHMENT,e,0),this.bindFramebufferAttachment(t,r.STENCIL_ATTACHMENT,null,0)):o&&(this.bindFramebufferAttachment(t,r.STENCIL_ATTACHMENT,e,0),this.bindFramebufferAttachment(t,r.DEPTH_ATTACHMENT,null,0))},t.prototype.validateCurrentAttachments=function(){for(var t=-1,e=-1,r=-1,n=0;n<this.currentColorAttachments.length;n++){var i=this.currentColorAttachments[n];null!==i&&(-1===t?(t=i.sampleCount,e=i.width,r=i.height):(GD(t===i.sampleCount),GD(e===i.width),GD(r===i.height)))}this.currentDepthStencilAttachment&&(-1===t?t=this.currentDepthStencilAttachment.sampleCount:(GD(t===this.currentDepthStencilAttachment.sampleCount),GD(e===this.currentDepthStencilAttachment.width),GD(r===this.currentDepthStencilAttachment.height))),this.currentSampleCount=t},t.prototype.setRenderPassParametersBegin=function(t,e){void 0===e&&(e=!1);var r=this.gl;if(e)r.bindFramebuffer(aD.FRAMEBUFFER,null);else if(KB(r)?r.bindFramebuffer(aD.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||r.bindFramebuffer(aD.FRAMEBUFFER,this.renderPassDrawFramebuffer),KB(r)?r.drawBuffers([aD.COLOR_ATTACHMENT0,aD.COLOR_ATTACHMENT1,aD.COLOR_ATTACHMENT2,aD.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([aD.COLOR_ATTACHMENT0_WEBGL,aD.COLOR_ATTACHMENT1_WEBGL,aD.COLOR_ATTACHMENT2_WEBGL,aD.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=t;n<this.currentColorAttachments.length;n++){var i=KB(r)?aD.DRAW_FRAMEBUFFER:aD.FRAMEBUFFER,o=KB(r)?aD.COLOR_ATTACHMENT0:aD.COLOR_ATTACHMENT0_WEBGL;r.framebufferRenderbuffer(i,o+n,aD.RENDERBUFFER,null),r.framebufferTexture2D(i,o+n,aD.TEXTURE_2D,null,0)}this.currentColorAttachments.length=t},t.prototype.setRenderPassParametersColor=function(t,e,r,n,i,o){void 0===o&&(o=!1);var a=KB(this.gl);this.currentColorAttachments[t]===e&&this.currentColorAttachmentLevels[t]===r||(this.currentColorAttachments[t]=e,this.currentColorAttachmentLevels[t]=r,!o&&(a||!a&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(a?aD.DRAW_FRAMEBUFFER:aD.FRAMEBUFFER,(a?aD.COLOR_ATTACHMENT0:aD.COLOR_ATTACHMENT0_WEBGL)+t,e,r),this.resolveColorAttachmentsChanged=!0),this.currentColorResolveTos[t]===n&&this.currentColorResolveToLevels[t]===i||(this.currentColorResolveTos[t]=n,this.currentColorResolveToLevels[t]=i,null!==n&&(this.resolveColorAttachmentsChanged=!0))},t.prototype.setRenderPassParametersDepthStencil=function(t,e,r){void 0===r&&(r=!1);var n=this.gl;this.currentDepthStencilAttachment!==t&&(this.currentDepthStencilAttachment=t,r||this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(KB(n)?aD.DRAW_FRAMEBUFFER:aD.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==e&&(this.currentDepthStencilResolveTo=e,e&&(this.resolveDepthStencilAttachmentsChanged=!0))},t.prototype.setRenderPassParametersClearColor=function(t,e,r,n,i){var o,a=this.gl;null!==this.OES_draw_buffers_indexed?(o=this.currentMegaState.attachmentsState[t])&&o.channelWriteMask!==TD.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(t,!0,!0,!0,!0),o.channelWriteMask=TD.ALL):(o=this.currentMegaState.attachmentsState[0])&&o.channelWriteMask!==TD.ALL&&(a.colorMask(!0,!0,!0,!0),o.channelWriteMask=TD.ALL);this.setScissorRectEnabled(!1),KB(a)?a.clearBufferfv(a.COLOR,t,[e,r,n,i]):(a.clearColor(e,r,n,i),a.clear(a.COLOR_BUFFER_BIT))},t.prototype.setRenderPassParametersClearDepthStencil=function(t,e){void 0===t&&(t="load"),void 0===e&&(e="load");var r=this.gl;"load"!==t&&(GD(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(r.depthMask(!0),this.currentMegaState.depthWrite=!0),KB(r)?r.clearBufferfv(r.DEPTH,0,[t]):(r.clearDepth(t),r.clear(r.DEPTH_BUFFER_BIT))),"load"!==e&&(GD(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(r.enable(r.STENCIL_TEST),r.stencilMask(255),this.currentMegaState.stencilWrite=!0),KB(r)?r.clearBufferiv(r.STENCIL,0,[e]):(r.clearStencil(e),r.clear(r.STENCIL_BUFFER_BIT)))},t.prototype.setBindings=function(t){var e,r=this;if(this.renderBundle)this.renderBundle.push((function(){return r.setBindings(t)}));else{var n=this.gl,i=t,o=i.uniformBufferBindings,a=i.samplerBindings,s=i.bindingLayouts;GD(0<s.bindingLayoutTables.length);var l=s.bindingLayoutTables[0];GD(o.length>=l.numUniformBuffers),GD(a.length>=l.numSamplers);for(var u=0;u<o.length;u++){if(0!==(g=o[u]).size){var c=l.firstUniformBuffer+u,h=g.buffer,p=g.offset||0,d=g.size||h.byteSize;if(h!==this.currentUniformBuffers[c]||p!==this.currentUniformBufferByteOffsets[c]||d!==this.currentUniformBufferByteSizes[c]){var f=p%h.pageByteSize,m=h.gl_buffer_pages[p/h.pageByteSize|0];GD(f+d<=h.pageByteSize),KB(n)&&n.bindBufferRange(n.UNIFORM_BUFFER,c,m,f,d),this.currentUniformBuffers[c]=h,this.currentUniformBufferByteOffsets[c]=p,this.currentUniformBufferByteSizes[c]=d}}}for(u=0;u<l.numSamplers;u++){var g=a[u],_=l.firstSampler+u,v=null!==g&&null!==g.sampler?oN(g.sampler):null,y=null!==g&&null!==g.texture?iN(g.texture):null;if(this.currentSamplers[_]!==v&&(KB(n)&&n.bindSampler(_,v),this.currentSamplers[_]=v),this.currentTextures[_]!==y){if(this.setActiveTexture(n.TEXTURE0+_),null!==y){var x=jD(g).texture,b=x.gl_target,E=x.width,T=x.height;g.texture.textureIndex=_,n.bindTexture(b,y),KB(n)||null===(e=g.sampler)||void 0===e||e.setTextureParameters(b,E,T),this.debugGroupStatisticsTextureBind()}else{var S=I(I({},g),aB),A=S.dimension,w=S.formatKind;b=uN(A);n.bindTexture(b,this.getFallbackTexture(I({gl_target:b,formatKind:w},S)))}this.currentTextures[_]=y}}}},t.prototype.setViewport=function(t,e,r,n){this.gl.viewport(t,e,r,n)},t.prototype.setScissorRect=function(t,e,r,n){var i=this.gl;this.setScissorRectEnabled(!0),i.scissor(t,e,r,n)},t.prototype.applyAttachmentStateIndexed=function(t,e,r){var n=this.gl,i=this.OES_draw_buffers_indexed;e.channelWriteMask!==r.channelWriteMask&&(i.colorMaskiOES(t,!!(r.channelWriteMask&TD.RED),!!(r.channelWriteMask&TD.GREEN),!!(r.channelWriteMask&TD.BLUE),!!(r.channelWriteMask&TD.ALPHA)),e.channelWriteMask=r.channelWriteMask);var o=e.rgbBlendState.blendMode!==r.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==r.alphaBlendState.blendMode,a=e.rgbBlendState.blendSrcFactor!==r.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==r.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==r.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==r.alphaBlendState.blendDstFactor;(a||o)&&(lN(e.rgbBlendState)&&lN(e.alphaBlendState)?i.enableiOES(t,n.BLEND):lN(r.rgbBlendState)&&lN(r.alphaBlendState)&&i.disableiOES(t,n.BLEND)),o&&(i.blendEquationSeparateiOES(t,r.rgbBlendState.blendMode,r.alphaBlendState.blendMode),e.rgbBlendState.blendMode=r.rgbBlendState.blendMode,e.alphaBlendState.blendMode=r.alphaBlendState.blendMode),a&&(i.blendFuncSeparateiOES(t,r.rgbBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor,r.alphaBlendState.blendSrcFactor,r.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=r.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=r.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=r.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=r.alphaBlendState.blendDstFactor)},t.prototype.applyAttachmentState=function(t,e){var r=this.gl;t.channelWriteMask!==e.channelWriteMask&&(r.colorMask(!!(e.channelWriteMask&TD.RED),!!(e.channelWriteMask&TD.GREEN),!!(e.channelWriteMask&TD.BLUE),!!(e.channelWriteMask&TD.ALPHA)),t.channelWriteMask=e.channelWriteMask);var n=t.rgbBlendState.blendMode!==e.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==e.alphaBlendState.blendMode,i=t.rgbBlendState.blendSrcFactor!==e.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==e.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==e.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==e.alphaBlendState.blendDstFactor;(i||n)&&(lN(t.rgbBlendState)&&lN(t.alphaBlendState)?r.enable(r.BLEND):lN(e.rgbBlendState)&&lN(e.alphaBlendState)&&r.disable(r.BLEND)),n&&(r.blendEquationSeparate(e.rgbBlendState.blendMode,e.alphaBlendState.blendMode),t.rgbBlendState.blendMode=e.rgbBlendState.blendMode,t.alphaBlendState.blendMode=e.alphaBlendState.blendMode),i&&(r.blendFuncSeparate(e.rgbBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor,e.alphaBlendState.blendSrcFactor,e.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=e.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=e.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=e.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=e.alphaBlendState.blendDstFactor)},t.prototype.setMegaState=function(t){var e=this.gl,r=this.currentMegaState;if(null!==this.OES_draw_buffers_indexed)for(var n=0;n<t.attachmentsState.length;n++)this.applyAttachmentStateIndexed(n,r.attachmentsState[0],t.attachmentsState[0]);else GD(1===t.attachmentsState.length),this.applyAttachmentState(r.attachmentsState[0],t.attachmentsState[0]);VD(r.blendConstant,t.blendConstant)||(e.blendColor(t.blendConstant.r,t.blendConstant.g,t.blendConstant.b,t.blendConstant.a),HD(r.blendConstant,t.blendConstant)),r.depthCompare!==t.depthCompare&&(e.depthFunc(t.depthCompare),r.depthCompare=t.depthCompare),!!r.depthWrite!=!!t.depthWrite&&(e.depthMask(t.depthWrite),r.depthWrite=t.depthWrite),!!r.stencilWrite!=!!t.stencilWrite&&(e.stencilMask(t.stencilWrite?255:0),r.stencilWrite=t.stencilWrite);var i=!1;if(!mB(r.stencilFront,t.stencilFront)){i=!0;var o=t.stencilFront,a=o.passOp,s=o.failOp,l=o.depthFailOp,u=o.compare;r.stencilFront.passOp===a&&r.stencilFront.failOp===s&&r.stencilFront.depthFailOp===l||(e.stencilOpSeparate(e.FRONT,s,l,a),r.stencilFront.passOp=a,r.stencilFront.failOp=s,r.stencilFront.depthFailOp=l),r.stencilFront.compare!==u&&(this.setStencilReference(0),r.stencilFront.compare=u)}if(!mB(r.stencilBack,t.stencilBack)){i=!0;var c=t.stencilBack;a=c.passOp,s=c.failOp,l=c.depthFailOp,u=c.compare;r.stencilBack.passOp===a&&r.stencilBack.failOp===s&&r.stencilBack.depthFailOp===l||(e.stencilOpSeparate(e.BACK,s,l,a),r.stencilBack.passOp=a,r.stencilBack.failOp=s,r.stencilBack.depthFailOp=l),r.stencilBack.compare!==u&&(this.setStencilReference(0),r.stencilBack.compare=u)}r.stencilFront.mask===t.stencilFront.mask&&r.stencilBack.mask===t.stencilBack.mask||(i=!0,r.stencilFront.mask=t.stencilFront.mask,r.stencilBack.mask=t.stencilBack.mask),i&&this.applyStencil(),r.cullMode!==t.cullMode&&(r.cullMode===cD.NONE?e.enable(e.CULL_FACE):t.cullMode===cD.NONE&&e.disable(e.CULL_FACE),t.cullMode===cD.BACK?e.cullFace(e.BACK):t.cullMode===cD.FRONT?e.cullFace(e.FRONT):t.cullMode===cD.FRONT_AND_BACK&&e.cullFace(e.FRONT_AND_BACK),r.cullMode=t.cullMode),r.frontFace!==t.frontFace&&(e.frontFace(t.frontFace),r.frontFace=t.frontFace),r.polygonOffset!==t.polygonOffset&&(t.polygonOffset?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),r.polygonOffset=t.polygonOffset),r.polygonOffsetFactor===t.polygonOffsetFactor&&r.polygonOffsetUnits===t.polygonOffsetUnits||(e.polygonOffset(t.polygonOffsetFactor,t.polygonOffsetUnits),r.polygonOffsetFactor=t.polygonOffsetFactor,r.polygonOffsetUnits=t.polygonOffsetUnits)},t.prototype.validatePipelineFormats=function(t){for(var e=0;e<this.currentColorAttachments.length;e++)this.currentColorAttachments[e];this.currentDepthStencilAttachment&&GD(this.currentDepthStencilAttachment.format===t.depthStencilAttachmentFormat),-1!==this.currentSampleCount&&GD(this.currentSampleCount===t.sampleCount)},t.prototype.setPipeline=function(t){var e=this;if(this.renderBundle)this.renderBundle.push((function(){return e.setPipeline(t)}));else{this.currentPipeline=t,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var r=this.currentPipeline.program;if(this.useProgram(r),r.compileState===hN.NeedsBind){var n=this.gl,i=r.gl_program,o=r.descriptor,a=sN(o.vertex.glsl,AN);if(KB(n))for(var s=0;s<a.length;s++){var l=B(a[s],2)[1],u=n.getUniformBlockIndex(i,l);-1!==u&&4294967295!==u&&n.uniformBlockBinding(i,u,s)}var c=sN(o.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm);for(s=0;s<c.length;s++){var h=B(c[s],3),p=h[1],d=h[2],f=n.getUniformLocation(i,p);n.uniform1i(f,parseInt(d))}r.compileState=hN.ReadyToUse}}},t.prototype.setVertexInput=function(t,e,r){var n,i,o,a=this;if(this.renderBundle)this.renderBundle.push((function(){return a.setVertexInput(t,e,r)}));else if(null!==t){GD(this.currentPipeline.inputLayout===t);var s=t;this.bindVAO(s.vao);for(var l=this.gl,u=0;u<s.vertexBufferDescriptors.length;u++){var c=s.vertexBufferDescriptors[u],h=c.arrayStride,p=c.attributes;try{for(var d=(n=void 0,D(p)),f=d.next();!f.done;f=d.next()){var m=f.value,g=m.shaderLocation,_=m.offset,v=KB(l)?g:null===(o=s.program.attributes[g])||void 0===o?void 0:o.location;if(!tD(v)){var y=e[u];if(null===y)continue;var x=m.vertexFormat;l.bindBuffer(l.ARRAY_BUFFER,nN(y.buffer));var b=(y.offset||0)+_;l.vertexAttribPointer(v,x.size,x.type,x.normalized,h,b)}}}catch(t){n={error:t}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}if(GD(null!==r==(null!==s.indexBufferFormat)),null!==r){var E=r.buffer;GD(E.usage===_D.INDEX),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,nN(E)),this.currentIndexBufferByteOffset=r.offset||0}else this.currentIndexBufferByteOffset=null}else GD(null===this.currentPipeline.inputLayout),GD(null===r),this.bindVAO(null),this.currentIndexBufferByteOffset=0},t.prototype.setStencilReference=function(t){this.currentStencilRef!==t&&(this.currentStencilRef=t,this.applyStencil())},t.prototype.draw=function(t,e,r,n){var i,o=this;if(this.renderBundle)this.renderBundle.push((function(){return o.draw(t,e,r,n)}));else{var a=this.gl,s=this.currentPipeline;if(e){var l=[s.drawMode,r||0,t,e];KB(a)?a.drawArraysInstanced.apply(a,N([],B(l),!1)):(i=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(i,N([],B(l),!1))}else a.drawArrays(s.drawMode,r,t);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(e,1))}},t.prototype.drawIndexed=function(t,e,r,n,i){var o,a=this;if(this.renderBundle)this.renderBundle.push((function(){return a.drawIndexed(t,e,r,n,i)}));else{var s=this.gl,l=this.currentPipeline,u=jD(l.inputLayout),c=jD(this.currentIndexBufferByteOffset)+r*u.indexBufferCompByteSize;if(e){var h=[l.drawMode,t,u.indexBufferType,c,e];KB(s)?s.drawElementsInstanced.apply(s,N([],B(h),!1)):(o=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(o,N([],B(h),!1))}else s.drawElements(l.drawMode,t,u.indexBufferType,c);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(e,1))}},t.prototype.drawIndirect=function(t,e){},t.prototype.drawIndexedIndirect=function(t,e){},t.prototype.beginOcclusionQuery=function(t){var e=this.gl;if(KB(e)){var r=this.currentRenderPassDescriptor.occlusionQueryPool;e.beginQuery(r.gl_query_type,r.gl_query[t])}},t.prototype.endOcclusionQuery=function(){var t=this.gl;if(KB(t)){var e=this.currentRenderPassDescriptor.occlusionQueryPool;t.endQuery(e.gl_query_type)}},t.prototype.pipelineQueryReady=function(t){var e=t;return this.queryProgramReady(e.program)},t.prototype.pipelineForceReady=function(t){},t.prototype.endPass=function(){for(var t=this.gl,e=KB(t),r=1===this.currentColorResolveTos.length&&this.currentColorResolveTos[0]===this.scTexture,n=!1,i=0;i<this.currentColorAttachments.length;i++){var o=this.currentColorAttachments[i];if(null!==o){var a=this.currentColorResolveTos[i],s=!1;null!==a&&(GD(o.width===a.width&&o.height===a.height),this.setScissorRectEnabled(!1),r||(e&&t.bindFramebuffer(t.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&e&&this.bindFramebufferAttachment(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[i])),s=!0,r||(a===this.scTexture?t.bindFramebuffer(e?aD.DRAW_FRAMEBUFFER:aD.FRAMEBUFFER,this.scPlatformFramebuffer):(t.bindFramebuffer(e?aD.DRAW_FRAMEBUFFER:aD.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&t.framebufferTexture2D(e?aD.DRAW_FRAMEBUFFER:aD.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a.gl_texture,this.currentColorResolveToLevels[i]))),r||(e?(t.blitFramebuffer(0,0,o.width,o.height,0,0,a.width,a.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(o,a)),n=!0),this.currentRenderPassDescriptor.colorStore[i]||r||s||(t.bindFramebuffer(e?aD.READ_FRAMEBUFFER:aD.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(e?aD.READ_FRAMEBUFFER:aD.FRAMEBUFFER,t.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[i])),r||t.bindFramebuffer(e?aD.READ_FRAMEBUFFER:aD.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var l=this.currentDepthStencilAttachment;if(l){var u=this.currentDepthStencilResolveTo;s=!1;u&&(GD(l.width===u.width&&l.height===u.height),this.setScissorRectEnabled(!1),r||(t.bindFramebuffer(e?aD.READ_FRAMEBUFFER:aD.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),t.bindFramebuffer(e?aD.DRAW_FRAMEBUFFER:aD.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(e?aD.READ_FRAMEBUFFER:aD.FRAMEBUFFER,l),this.bindFramebufferDepthStencilAttachment(e?aD.DRAW_FRAMEBUFFER:aD.FRAMEBUFFER,u))),s=!0,r||(e&&t.blitFramebuffer(0,0,l.width,l.height,0,0,u.width,u.height,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(e?aD.DRAW_FRAMEBUFFER:aD.FRAMEBUFFER,null)),n=!0),r||this.currentRenderPassDescriptor.depthStencilStore||(s||(t.bindFramebuffer(e?aD.READ_FRAMEBUFFER:aD.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(e?aD.READ_FRAMEBUFFER:aD.FRAMEBUFFER,l),s=!0),e&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[t.DEPTH_STENCIL_ATTACHMENT])),!r&&s&&t.bindFramebuffer(e?aD.READ_FRAMEBUFFER:aD.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}r||n||t.bindFramebuffer(e?aD.DRAW_FRAMEBUFFER:aD.FRAMEBUFFER,null)},t.prototype.setScissorRectEnabled=function(t){if(this.currentScissorEnabled!==t){var e=this.gl;t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.currentScissorEnabled=t}},t.prototype.applyStencil=function(){tD(this.currentStencilRef)||(this.gl.stencilFuncSeparate(aD.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(aD.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},t.prototype.getFallbackTexture=function(t){var e=t.gl_target,r=t.formatKind;if(e===aD.TEXTURE_2D)return r===AD.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(e===aD.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(e===aD.TEXTURE_3D)return this.fallbackTexture3D;if(e===aD.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},t.prototype.submitBlitRenderPass=function(t,e){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:"layout(location = 0) in vec2 a_Position;\nout vec2 v_TexCoord;\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}"},fragment:{glsl:"uniform sampler2D u_Texture;\nin vec2 v_TexCoord;\nout vec4 outputColor;\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);\n}"}}),this.blitVertexBuffer=this.createBuffer({usage:_D.VERTEX|_D.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:8,stepMode:yD.VERTEX,attributes:[{format:OD.F32_RG,offset:0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:gD.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[OD.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:rB(iB)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:t.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:t}));var r=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var n=this.createRenderPass({colorAttachment:[t],colorResolveTo:[e],colorClearColor:[qD]}),i=this.getCanvas(),o=i.width,a=i.height;n.setPipeline(this.blitRenderPipeline),n.setBindings(this.blitBindings),n.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),n.setViewport(0,0,o,a),this.gl.disable(this.gl.BLEND),n.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=r,this.inBlitRenderPass=!1},t}(),CN=function(){function t(t){this.pluginOptions=t}return t.prototype.createSwapChain=function(t){return O(this,void 0,void 0,(function(){var e,r,n,i,o,a,s,l,u,c,h,p,d;return P(this,(function(f){return e=this.pluginOptions,r=e.targets,n=e.xrCompatible,i=e.antialias,o=void 0!==i&&i,a=e.preserveDrawingBuffer,s=void 0!==a&&a,l=e.premultipliedAlpha,u=void 0===l||l,c=e.shaderDebug,h=e.trackResources,p={antialias:o,preserveDrawingBuffer:s,stencil:!0,premultipliedAlpha:u,xrCompatible:n},this.handleContextEvents(t),r.includes("webgl2")&&(d=t.getContext("webgl2",p)||t.getContext("experimental-webgl2",p)),!d&&r.includes("webgl1")&&(d=t.getContext("webgl",p)||t.getContext("experimental-webgl",p)),[2,new wN(d,{shaderDebug:c,trackResources:h})]}))}))},t.prototype.handleContextEvents=function(t){var e=this.pluginOptions,r=e.onContextLost,n=e.onContextRestored,i=e.onContextCreationError;i&&t.addEventListener("webglcontextcreationerror",i,!1),r&&t.addEventListener("webglcontextlost",r,!1),n&&t.addEventListener("webglcontextrestored",n,!1)},t}();let RN;const LN="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&LN.decode();let IN=null;function MN(){return null!==IN&&0!==IN.byteLength||(IN=new Uint8Array(RN.memory.buffer)),IN}function ON(t,e){return t>>>=0,LN.decode(MN().subarray(t,t+e))}const PN=new Array(128).fill(void 0);PN.push(void 0,null,!0,!1);let DN=PN.length;function BN(t){return PN[t]}function NN(t){const e=BN(t);return function(t){t<132||(PN[t]=DN,DN=t)}(t),e}let FN=0;const kN="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},UN="function"==typeof kN.encodeInto?function(t,e){return kN.encodeInto(t,e)}:function(t,e){const r=kN.encode(t);return e.set(r),{read:t.length,written:r.length}};function zN(t,e,r){if(void 0===r){const r=kN.encode(t),n=e(r.length,1)>>>0;return MN().subarray(n,n+r.length).set(r),FN=r.length,n}let n=t.length,i=e(n,1)>>>0;const o=MN();let a=0;for(;a<n;a++){const e=t.charCodeAt(a);if(e>127)break;o[i+a]=e}if(a!==n){0!==a&&(t=t.slice(a)),i=r(i,n,n=a+3*t.length,1)>>>0;const e=MN().subarray(i+a,i+n);a+=UN(t,e).written}return FN=a,i}let GN=null;function jN(){return null!==GN&&0!==GN.byteLength||(GN=new Int32Array(RN.memory.buffer)),GN}function VN(t,e,r){let n,i;try{const s=RN.__wbindgen_add_to_stack_pointer(-16),l=zN(t,RN.__wbindgen_malloc,RN.__wbindgen_realloc),u=FN,c=zN(e,RN.__wbindgen_malloc,RN.__wbindgen_realloc),h=FN;RN.glsl_compile(s,l,u,c,h,r);var o=jN()[s/4+0],a=jN()[s/4+1];return n=o,i=a,ON(o,a)}finally{RN.__wbindgen_add_to_stack_pointer(16),RN.__wbindgen_free(n,i,1)}}class HN{static __wrap(t){t>>>=0;const e=Object.create(HN.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();RN.__wbg_wgslcomposer_free(t)}constructor(){const t=RN.wgslcomposer_new();return HN.__wrap(t)}load_composable(t){const e=zN(t,RN.__wbindgen_malloc,RN.__wbindgen_realloc),r=FN;RN.wgslcomposer_load_composable(this.__wbg_ptr,e,r)}wgsl_compile(t){let e,r;try{const o=RN.__wbindgen_add_to_stack_pointer(-16),a=zN(t,RN.__wbindgen_malloc,RN.__wbindgen_realloc),s=FN;RN.wgslcomposer_wgsl_compile(o,this.__wbg_ptr,a,s);var n=jN()[o/4+0],i=jN()[o/4+1];return e=n,r=i,ON(n,i)}finally{RN.__wbindgen_add_to_stack_pointer(16),RN.__wbindgen_free(e,r,1)}}}function WN(){const t={wbg:{}};return t.wbg.__wbindgen_string_new=function(t,e){return function(t){DN===PN.length&&PN.push(PN.length+1);const e=DN;return DN=PN[e],PN[e]=t,e}(ON(t,e))},t.wbg.__wbindgen_object_drop_ref=function(t){NN(t)},t.wbg.__wbg_log_1d3ae0273d8f4f8a=function(t){console.log(BN(t))},t.wbg.__wbg_log_576ca876af0d4a77=function(t,e){console.log(BN(t),BN(e))},t.wbg.__wbindgen_throw=function(t,e){throw new Error(ON(t,e))},t}async function XN(t){if(void 0!==RN)return RN;const e=WN();("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:r,module:n}=await async function(t,e){if("function"==typeof Response&&t instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,e)}catch(e){if("application/wasm"==t.headers.get("Content-Type"))throw e;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e)}const r=await t.arrayBuffer();return await WebAssembly.instantiate(r,e)}{const r=await WebAssembly.instantiate(t,e);return r instanceof WebAssembly.Instance?{instance:r,module:t}:r}}(await t,e);return function(t,e){return RN=t.exports,XN.__wbindgen_wasm_module=e,GN=null,IN=null,RN}(r,n)}var ZN,qN;function YN(t){if(t===OD.U8_R_NORM)return"r8unorm";if(t===OD.S8_R_NORM)return"r8snorm";if(t===OD.U8_RG_NORM)return"rg8unorm";if(t===OD.S8_RG_NORM)return"rg8snorm";if(t===OD.U32_R)return"r32uint";if(t===OD.S32_R)return"r32sint";if(t===OD.F32_R)return"r32float";if(t===OD.U16_RG)return"rg16uint";if(t===OD.S16_RG)return"rg16sint";if(t===OD.F16_RG)return"rg16float";if(t===OD.U8_RGBA_RT)return"bgra8unorm";if(t===OD.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(t===OD.U8_RGBA_NORM)return"rgba8unorm";if(t===OD.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(t===OD.S8_RGBA_NORM)return"rgba8snorm";if(t===OD.U32_RG)return"rg32uint";if(t===OD.S32_RG)return"rg32sint";if(t===OD.F32_RG)return"rg32float";if(t===OD.U16_RGBA)return"rgba16uint";if(t===OD.S16_RGBA)return"rgba16sint";if(t===OD.F16_RGBA)return"rgba16float";if(t===OD.F32_RGBA)return"rgba32float";if(t===OD.U32_RGBA)return"rgba32uint";if(t===OD.S32_RGBA)return"rgba32sint";if(t===OD.D24)return"depth24plus";if(t===OD.D24_S8)return"depth24plus-stencil8";if(t===OD.D32F)return"depth32float";if(t===OD.D32F_S8)return"depth32float-stencil8";if(t===OD.BC1)return"bc1-rgba-unorm";if(t===OD.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(t===OD.BC2)return"bc2-rgba-unorm";if(t===OD.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(t===OD.BC3)return"bc3-rgba-unorm";if(t===OD.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(t===OD.BC4_SNORM)return"bc4-r-snorm";if(t===OD.BC4_UNORM)return"bc4-r-unorm";if(t===OD.BC5_SNORM)return"bc5-rg-snorm";if(t===OD.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function KN(t){if(t===bD.TEXTURE_2D)return"2d";if(t===bD.TEXTURE_CUBE_MAP)return"cube";if(t===bD.TEXTURE_2D_ARRAY)return"2d-array";if(t===bD.TEXTURE_3D)return"3d";throw new Error("whoops")}function $N(t){if(t===dD.CLAMP_TO_EDGE)return"clamp-to-edge";if(t===dD.REPEAT)return"repeat";if(t===dD.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function QN(t){if(t===fD.BILINEAR)return"linear";if(t===fD.POINT)return"nearest";throw new Error("whoops")}function JN(t){if(t===mD.LINEAR)return"linear";if(t===mD.NEAREST)return"nearest";if(t===mD.NO_MIP)return"nearest";throw new Error("whoops")}function tF(t){return t.gpuBuffer}function eF(t){if(t===RD.OcclusionConservative)return"occlusion";throw new Error("whoops")}function rF(t){switch(t){case gD.TRIANGLES:return"triangle-list";case gD.POINTS:return"point-list";case gD.TRIANGLE_STRIP:return"triangle-strip";case gD.LINES:return"line-list";case gD.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function nF(t){if(t===cD.NONE)return"none";if(t===cD.FRONT)return"front";if(t===cD.BACK)return"back";throw new Error("whoops")}function iF(t){if(t===uD.CCW)return"ccw";if(t===uD.CW)return"cw";throw new Error("whoops")}function oF(t){if(t===hD.ZERO)return"zero";if(t===hD.ONE)return"one";if(t===hD.SRC)return"src";if(t===hD.ONE_MINUS_SRC)return"one-minus-src";if(t===hD.DST)return"dst";if(t===hD.ONE_MINUS_DST)return"one-minus-dst";if(t===hD.SRC_ALPHA)return"src-alpha";if(t===hD.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(t===hD.DST_ALPHA)return"dst-alpha";if(t===hD.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(t===hD.CONST)return"constant";if(t===hD.ONE_MINUS_CONSTANT)return"one-minus-constant";if(t===hD.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function aF(t){if(t===pD.ADD)return"add";if(t===pD.SUBSTRACT)return"subtract";if(t===pD.REVERSE_SUBSTRACT)return"reverse-subtract";if(t===pD.MIN)return"min";if(t===pD.MAX)return"max";throw new Error("whoops")}function sF(t){return{operation:aF(t.blendMode),srcFactor:oF(t.blendSrcFactor),dstFactor:oF(t.blendDstFactor)}}function lF(t){return t.blendMode===pD.ADD&&t.blendSrcFactor===hD.ONE&&t.blendDstFactor===hD.ZERO}function uF(t){return lF(t.rgbBlendState)&&lF(t.alphaBlendState)?void 0:{color:sF(t.rgbBlendState),alpha:sF(t.alphaBlendState)}}function cF(t,e){return e.attachmentsState.map((function(e,r){return function(t,e){return{format:YN(e),blend:uF(t),writeMask:t.channelWriteMask}}(e,t[r])}))}function hF(t){if(t===lD.NEVER)return"never";if(t===lD.LESS)return"less";if(t===lD.EQUAL)return"equal";if(t===lD.LEQUAL)return"less-equal";if(t===lD.GREATER)return"greater";if(t===lD.NOTEQUAL)return"not-equal";if(t===lD.GEQUAL)return"greater-equal";if(t===lD.ALWAYS)return"always";throw new Error("whoops")}function pF(t){if(t===SD.KEEP)return"keep";if(t===SD.REPLACE)return"replace";if(t===SD.ZERO)return"zero";if(t===SD.DECREMENT_CLAMP)return"decrement-clamp";if(t===SD.DECREMENT_WRAP)return"decrement-wrap";if(t===SD.INCREMENT_CLAMP)return"increment-clamp";if(t===SD.INCREMENT_WRAP)return"increment-wrap";if(t===SD.INVERT)return"invert";throw new Error("whoops")}function dF(t){if(t===yD.VERTEX)return"vertex";if(t===yD.INSTANCE)return"instance";throw new Error("whoops")}function fF(t){if(t===OD.U8_R)return"uint8x2";if(t===OD.U8_RG)return"uint8x2";if(t===OD.U8_RGB)return"uint8x4";if(t===OD.U8_RGBA)return"uint8x4";if(t===OD.U8_RG_NORM)return"unorm8x2";if(t===OD.U8_RGBA_NORM)return"unorm8x4";if(t===OD.S8_RGB_NORM)return"snorm8x4";if(t===OD.S8_RGBA_NORM)return"snorm8x4";if(t===OD.U16_RG_NORM)return"unorm16x2";if(t===OD.U16_RGBA_NORM)return"unorm16x4";if(t===OD.S16_RG_NORM)return"snorm16x2";if(t===OD.S16_RGBA_NORM)return"snorm16x4";if(t===OD.S16_RG)return"uint16x2";if(t===OD.F16_RG)return"float16x2";if(t===OD.F16_RGBA)return"float16x4";if(t===OD.F32_R)return"float32";if(t===OD.F32_RG)return"float32x2";if(t===OD.F32_RGB)return"float32x3";if(t===OD.F32_RGBA)return"float32x4";throw"whoops"}function mF(t,e,r,n){switch(void 0===r&&(r=!1),t){case OD.S8_R:case OD.S8_R_NORM:case OD.S8_RG_NORM:case OD.S8_RGB_NORM:case OD.S8_RGBA_NORM:var i=(ArrayBuffer,new Int8Array(e));return n&&i.set(new Int8Array(n)),i;case OD.U8_R:case OD.U8_R_NORM:case OD.U8_RG:case OD.U8_RG_NORM:case OD.U8_RGB:case OD.U8_RGB_NORM:case OD.U8_RGB_SRGB:case OD.U8_RGBA:case OD.U8_RGBA_NORM:case OD.U8_RGBA_SRGB:var o=(ArrayBuffer,new Uint8Array(e));return n&&o.set(new Uint8Array(n)),o;case OD.S16_R:case OD.S16_RG:case OD.S16_RG_NORM:case OD.S16_RGB_NORM:case OD.S16_RGBA:case OD.S16_RGBA_NORM:var a=e instanceof ArrayBuffer?new Int16Array(e):new Int16Array(r?e/2:e);return n&&a.set(new Int16Array(n)),a;case OD.U16_R:case OD.U16_RGB:case OD.U16_RGBA_5551:case OD.U16_RGBA_NORM:case OD.U16_RG_NORM:case OD.U16_R_NORM:var s=e instanceof ArrayBuffer?new Uint16Array(e):new Uint16Array(r?e/2:e);return n&&s.set(new Uint16Array(n)),s;case OD.S32_R:var l=e instanceof ArrayBuffer?new Int32Array(e):new Int32Array(r?e/4:e);return n&&l.set(new Int32Array(n)),l;case OD.U32_R:case OD.U32_RG:var u=e instanceof ArrayBuffer?new Uint32Array(e):new Uint32Array(r?e/4:e);return n&&u.set(new Uint32Array(n)),u;case OD.F32_R:case OD.F32_RG:case OD.F32_RGB:case OD.F32_RGBA:var c=e instanceof ArrayBuffer?new Float32Array(e):new Float32Array(r?e/4:e);return n&&c.set(new Float32Array(n)),c}var h=(ArrayBuffer,new Uint8Array(e));return n&&h.set(new Uint8Array(n)),h}function gF(t){switch(t){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth16unorm":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":case"depth32float":default:return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8}}}!function(t){t[t.COPY_SRC=1]="COPY_SRC",t[t.COPY_DST=2]="COPY_DST",t[t.TEXTURE_BINDING=4]="TEXTURE_BINDING",t[t.STORAGE_BINDING=8]="STORAGE_BINDING",t[t.STORAGE=8]="STORAGE",t[t.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(ZN||(ZN={})),function(t){t[t.READ=1]="READ",t[t.WRITE=2]="WRITE"}(qN||(qN={}));var _F=function(t){function e(e){var r=e.id,n=e.device,i=t.call(this)||this;return i.id=r,i.device=n,i}return R(e,t),e.prototype.destroy=function(){},e}(PD),vF=function(t){function e(e){var r,n,i=e.id,o=e.device,a=e.descriptor,s=t.call(this,{id:i,device:o})||this;s.type=sD.Bindings;var l=a.pipeline;GD(!!l);var u=a.uniformBufferBindings,c=a.storageBufferBindings,h=a.samplerBindings,p=a.storageTextureBindings;s.numUniformBuffers=(null==u?void 0:u.length)||0;var d=[[],[],[],[]],f=0;if(u&&u.length)for(var m=0;m<u.length;m++){var g=a.uniformBufferBindings[m],_=g.binding,v=g.size,y=g.offset,x={buffer:tF(g.buffer),offset:null!=y?y:0,size:v};d[0].push({binding:null!=_?_:f++,resource:x})}if(h&&h.length){f=0;for(m=0;m<h.length;m++){var b=I(I({},h[m]),aB),E=null!==(_=a.samplerBindings[m]).texture?_.texture:s.device.getFallbackTexture(b);b.dimension=E.dimension,b.formatKind=zD(E.format);var T=E.gpuTextureView;if(d[1].push({binding:null!==(r=_.textureBinding)&&void 0!==r?r:f++,resource:T}),-1!==_.samplerBinding){var S=null!==_.sampler?_.sampler:s.device.getFallbackSampler(b),A=S.gpuSampler;d[1].push({binding:null!==(n=_.samplerBinding)&&void 0!==n?n:f++,resource:A})}}}if(c&&c.length){f=0;for(m=0;m<c.length;m++){var w=a.storageBufferBindings[m];_=w.binding,v=w.size,y=w.offset,x={buffer:tF(w.buffer),offset:null!=y?y:0,size:v};d[2].push({binding:null!=_?_:f++,resource:x})}}if(p&&p.length){f=0;for(m=0;m<p.length;m++){var C=a.storageTextureBindings[m];_=C.binding,T=(E=C.texture).gpuTextureView;d[3].push({binding:null!=_?_:f++,resource:T})}}var R=d.findLastIndex((function(t){return!!t.length}));return s.gpuBindGroup=d.map((function(t,e){return e<=R&&s.device.device.createBindGroup({layout:l.getBindGroupLayout(e),entries:t})})),s}return R(e,t),e}(_F),yF=function(t){function e(e){var r=e.id,n=e.device,i=e.descriptor,o=t.call(this,{id:r,device:n})||this;o.type=sD.Buffer;var a=i.usage,s=i.viewOrSize,l=!!(a&_D.MAP_READ);o.usage=function(t){var e=0;return t&_D.INDEX&&(e|=GPUBufferUsage.INDEX),t&_D.VERTEX&&(e|=GPUBufferUsage.VERTEX),t&_D.UNIFORM&&(e|=GPUBufferUsage.UNIFORM),t&_D.STORAGE&&(e|=GPUBufferUsage.STORAGE),t&_D.COPY_SRC&&(e|=GPUBufferUsage.COPY_SRC),t&_D.INDIRECT&&(e|=GPUBufferUsage.INDIRECT),e|GPUBufferUsage.COPY_DST}(a),l&&(o.usage=_D.MAP_READ|_D.COPY_DST);var u=!iD(s);(o.view=iD(s)?null:s,o.size=iD(s)?$D(s,4):$D(s.byteLength,4),iD(s))?o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!!l&&u}):(o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!0}),new(s&&s.constructor||Float32Array)(o.gpuBuffer.getMappedRange()).set(s),o.gpuBuffer.unmap());return o}return R(e,t),e.prototype.setSubData=function(t,e,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i=this.gpuBuffer;n=n||e.byteLength,n=Math.min(n,this.size-t);var o=e.byteOffset+r,a=o+n,s=n+3&-4;if(s!==n){var l=new Uint8Array(e.buffer.slice(o,a));(e=new Uint8Array(s)).set(l),r=0,o=0,a=s,n=s}for(var u=15728640,c=0;a-(o+c)>u;)this.device.device.queue.writeBuffer(i,t+c,e.buffer,o+c,u),c+=u;this.device.device.queue.writeBuffer(i,t+c,e.buffer,o+c,n-c)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.gpuBuffer.destroy()},e}(_F),xF=function(){function t(){this.gpuComputePassEncoder=null}return t.prototype.dispatchWorkgroups=function(t,e,r){this.gpuComputePassEncoder.dispatchWorkgroups(t,e,r)},t.prototype.dispatchWorkgroupsIndirect=function(t,e){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(t.gpuBuffer,e)},t.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},t.prototype.beginComputePass=function(t){GD(null===this.gpuComputePassEncoder),this.frameCommandEncoder=t,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},t.prototype.setPipeline=function(t){var e=jD(t.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(e)},t.prototype.setBindings=function(t){var e=this,r=t;r.gpuBindGroup.forEach((function(t,n){t&&e.gpuComputePassEncoder.setBindGroup(n,r.gpuBindGroup[n])}))},t.prototype.pushDebugGroup=function(t){this.gpuComputePassEncoder.pushDebugGroup(t)},t.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},t.prototype.insertDebugMarker=function(t){this.gpuComputePassEncoder.insertDebugMarker(t)},t}(),bF=function(t){function e(e){var r=e.id,n=e.device,i=e.descriptor,o=t.call(this,{id:r,device:n})||this;o.type=sD.ComputePipeline,o.gpuComputePipeline=null,o.descriptor=i;var a=i.program.computeStage;if(null===a)return o;var s={layout:"auto",compute:I({},a)};return o.gpuComputePipeline=o.device.device.createComputePipeline(s),void 0!==o.name&&(o.gpuComputePipeline.label=o.name),o}return R(e,t),e.prototype.getBindGroupLayout=function(t){return this.gpuComputePipeline.getBindGroupLayout(t)},e}(_F),EF=function(t){function e(e){var r,n,i,o,a=e.id,s=e.device,l=e.descriptor,u=t.call(this,{id:a,device:s})||this;u.type=sD.InputLayout;var c=[];try{for(var h=D(l.vertexBufferDescriptors),p=h.next();!p.done;p=h.next()){var d=p.value,f=d.arrayStride,m=d.stepMode,g=d.attributes;c.push({arrayStride:f,stepMode:dF(m),attributes:[]});try{for(var _=(i=void 0,D(g)),v=_.next();!v.done;v=_.next()){var y=v.value,x=y.shaderLocation,b=y.format,E=y.offset;c[c.length-1].attributes.push({shaderLocation:x,format:fF(b),offset:E})}}catch(t){i={error:t}}finally{try{v&&!v.done&&(o=_.return)&&o.call(_)}finally{if(i)throw i.error}}}}catch(t){r={error:t}}finally{try{p&&!p.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}return u.indexFormat=function(t){if(null!==t){if(t===OD.U16_R)return"uint16";if(t===OD.U32_R)return"uint32";throw new Error("whoops")}}(l.indexBufferFormat),u.buffers=c,u}return R(e,t),e}(_F),TF=function(t){function e(e){var r=e.id,n=e.device,i=e.descriptor,o=t.call(this,{id:r,device:n})||this;return o.type=sD.Program,o.vertexStage=null,o.fragmentStage=null,o.computeStage=null,o.descriptor=i,i.vertex&&(o.vertexStage=o.createShaderStage(i.vertex,"vertex")),i.fragment&&(o.fragmentStage=o.createShaderStage(i.fragment,"fragment")),i.compute&&(o.computeStage=o.createShaderStage(i.compute,"compute")),o}return R(e,t),e.prototype.setUniformsLegacy=function(t){},e.prototype.createShaderStage=function(t,e){var r,n,i=t.glsl,o=t.wgsl,a=t.entryPoint,s=t.postprocess,l=o;if(!l)try{l=this.device.glsl_compile(i,e,!1)}catch(t){throw console.error(t,i),new Error("whoops")}var u=function(t){if(!l.includes(t))return"continue";l=(l=l.replace("var T_".concat(t,": texture_2d<f32>;"),"var T_".concat(t,": texture_depth_2d;"))).replace(new RegExp("textureSample\\(T_".concat(t,"(.*)\\);$"),"gm"),(function(e,r){return"vec4<f32>(textureSample(T_".concat(t).concat(r,"), 0.0, 0.0, 0.0);")}))};try{for(var c=D(["u_TextureFramebufferDepth"]),h=c.next();!h.done;h=c.next()){u(h.value)}}catch(t){r={error:t}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}return s&&(l=s(l)),{module:this.device.device.createShaderModule({code:l}),entryPoint:a||"main"}},e}(_F),SF=function(t){function e(e){var r=e.id,n=e.device,i=e.descriptor,o=t.call(this,{id:r,device:n})||this;o.type=sD.QueryPool;var a=i.elemCount,s=i.type;return o.querySet=o.device.device.createQuerySet({type:eF(s),count:a}),o.resolveBuffer=o.device.device.createBuffer({size:8*a,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),o.cpuBuffer=o.device.device.createBuffer({size:8*a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o.results=null,o}return R(e,t),e.prototype.queryResultOcclusion=function(t){return null===this.results?null:this.results[t]!==BigInt(0)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},e}(_F),AF=function(t){function e(e){var r=e.id,n=e.device,i=t.call(this,{id:r,device:n})||this;return i.type=sD.Readback,i}return R(e,t),e.prototype.readTexture=function(t,e,r,n,i,o,a,s){return void 0===a&&(a=0),O(this,void 0,void 0,(function(){var s,l,u,c,h,p,d;return P(this,(function(f){return l=gF((s=t).gpuTextureformat),u=Math.ceil(n/l.width)*l.length,c=256*Math.ceil(u/256),h=c*i,p=this.device.createBuffer({usage:_D.STORAGE|_D.MAP_READ|_D.COPY_DST,hint:vD.STATIC,viewOrSize:h}),(d=this.device.device.createCommandEncoder()).copyTextureToBuffer({texture:s.gpuTexture,mipLevel:0,origin:{x:e,y:r,z:Math.max(0,0)}},{buffer:p.gpuBuffer,offset:0,bytesPerRow:c},{width:n,height:i,depthOrArrayLayers:1}),this.device.device.queue.submit([d.finish()]),[2,this.readBuffer(p,0,o.byteLength===h?o:null,a,h,s.format,!0,!1,u,c,i)]}))}))},e.prototype.readTextureSync=function(t,e,r,n,i,o,a,s){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},e.prototype.readBuffer=function(t,e,r,n,i,o,a,s,l,u,c){var h=this;void 0===e&&(e=0),void 0===r&&(r=null),void 0===i&&(i=0),void 0===o&&(o=OD.U8_RGB),void 0===a&&(a=!1),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=0);var p=t,d=i||p.size,f=r||p.view,m=f&&f.constructor&&f.constructor.BYTES_PER_ELEMENT||UD(o),g=p;if(!(p.usage&_D.MAP_READ&&p.usage&_D.COPY_DST)){var _=this.device.device.createCommandEncoder();g=this.device.createBuffer({usage:_D.STORAGE|_D.MAP_READ|_D.COPY_DST,hint:vD.STATIC,viewOrSize:d}),_.copyBufferToBuffer(p.gpuBuffer,e,g.gpuBuffer,0,d),this.device.device.queue.submit([_.finish()])}return new Promise((function(t,r){g.gpuBuffer.mapAsync(qN.READ,e,d).then((function(){var r=g.gpuBuffer.getMappedRange(e,d),n=f;if(a)n=null===n?mF(o,d,!0,r):mF(o,n.buffer,void 0,r);else if(null===n)switch(m){case 1:(n=new Uint8Array(d)).set(new Uint8Array(r));break;case 2:n=h.getHalfFloatAsFloatRGBAArrayBuffer(d/2,r);break;case 4:(n=new Float32Array(d/4)).set(new Float32Array(r))}else switch(m){case 1:(n=new Uint8Array(n.buffer)).set(new Uint8Array(r));break;case 2:n=h.getHalfFloatAsFloatRGBAArrayBuffer(d/2,r,f);break;case 4:var i=f&&f.constructor||Float32Array;(n=new i(n.buffer)).set(new i(r))}if(l!==u){1!==m||a||(l*=2,u*=2);for(var s=new Uint8Array(n.buffer),p=l,_=0,v=1;v<c;++v){_=v*u;for(var y=0;y<l;++y)s[p++]=s[_++]}n=0===m||a?new Uint8Array(s.buffer,0,p):new Float32Array(s.buffer,0,p/4)}g.gpuBuffer.unmap(),t(n)}),(function(t){return r(t)}))}))},e.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(t,e,r){r||(r=new Float32Array(t));for(var n,i,o,a,s=new Uint16Array(e);t--;)r[t]=(n=s[t],i=void 0,o=void 0,a=void 0,i=(32768&n)>>15,a=1023&n,0===(o=(31744&n)>>10)?(i?-1:1)*Math.pow(2,-14)*(a/Math.pow(2,10)):31==o?a?NaN:1/0*(i?-1:1):(i?-1:1)*Math.pow(2,o-15)*(1+a/Math.pow(2,10)));return r},e}(_F),wF=function(){function t(t){this.device=t,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return t.prototype.getEncoder=function(){var t;return(null===(t=this.renderBundle)||void 0===t?void 0:t.renderBundleEncoder)||this.gpuRenderPassEncoder},t.prototype.getTextureView=function(t,e){return GD(e<t.mipLevelCount),1===t.mipLevelCount?t.gpuTextureView:t.gpuTexture.createView({baseMipLevel:e,mipLevelCount:1})},t.prototype.setRenderPassDescriptor=function(t){var e,r,n,i,o,a;this.descriptor=t,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var s=t.colorAttachment.length;this.gfxColorAttachment.length=s,this.gfxColorResolveTo.length=s;for(var l=0;l<t.colorAttachment.length;l++){var u=t.colorAttachment[l],c=t.colorResolveTo[l];if(null===u&&null!==c&&(u=c,c=null),this.gfxColorAttachment[l]=u,this.gfxColorResolveTo[l]=c,this.gfxColorAttachmentLevel[l]=(null===(e=t.colorAttachmentLevel)||void 0===e?void 0:e[l])||0,this.gfxColorResolveToLevel[l]=(null===(r=t.colorResolveToLevel)||void 0===r?void 0:r[l])||0,null===u){this.gpuColorAttachments.length=l,this.gfxColorAttachment.length=l,this.gfxColorResolveTo.length=l;break}void 0===this.gpuColorAttachments[l]&&(this.gpuColorAttachments[l]={}),(p=this.gpuColorAttachments[l]).view=this.getTextureView(u,(null===(n=this.gfxColorAttachmentLevel)||void 0===n?void 0:n[l])||0);var h=null!==(o=null===(i=t.colorClearColor)||void 0===i?void 0:i[l])&&void 0!==o?o:"load";"load"===h?p.loadOp="load":(p.loadOp="clear",p.clearValue=h),p.storeOp=(null===(a=t.colorStore)||void 0===a?void 0:a[l])?"store":"discard",p.resolveTarget=void 0,null!==c&&(u.sampleCount>1?p.resolveTarget=this.getTextureView(c,this.gfxColorResolveToLevel[l]):p.storeOp="store")}if(this.gfxDepthStencilAttachment=t.depthStencilAttachment,this.gfxDepthStencilResolveTo=t.depthStencilResolveTo,t.depthStencilAttachment){var p,d=t.depthStencilAttachment;(p=this.gpuDepthStencilAttachment).view=d.gpuTextureView,!!(FD(d.format)&MD.Depth)?("load"===t.depthClearValue?p.depthLoadOp="load":(p.depthLoadOp="clear",p.depthClearValue=t.depthClearValue),t.depthStencilStore||null!==this.gfxDepthStencilResolveTo?p.depthStoreOp="store":p.depthStoreOp="discard"):(p.depthLoadOp=void 0,p.depthStoreOp=void 0),!!(FD(d.format)&MD.Stencil)?("load"===t.stencilClearValue?p.stencilLoadOp="load":(p.stencilLoadOp="clear",p.stencilClearValue=t.stencilClearValue),t.depthStencilStore||null!==this.gfxDepthStencilResolveTo?p.stencilStoreOp="store":p.stencilStoreOp="discard"):(p.stencilLoadOp=void 0,p.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=tD(t.occlusionQueryPool)?void 0:t.occlusionQueryPool.querySet},t.prototype.beginRenderPass=function(t,e){GD(null===this.gpuRenderPassEncoder),this.setRenderPassDescriptor(e),this.frameCommandEncoder=t,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},t.prototype.flipY=function(t,e){return this.device.swapChainHeight-t-e},t.prototype.setViewport=function(t,e,r,n,i,o){void 0===i&&(i=0),void 0===o&&(o=1),this.gpuRenderPassEncoder.setViewport(t,this.flipY(e,n),r,n,i,o)},t.prototype.setScissorRect=function(t,e,r,n){this.gpuRenderPassEncoder.setScissorRect(t,this.flipY(e,n),r,n)},t.prototype.setPipeline=function(t){var e=jD(t.gpuRenderPipeline);this.getEncoder().setPipeline(e)},t.prototype.setVertexInput=function(t,e,r){if(null!==t){var n=this.getEncoder(),i=t;null!==r&&n.setIndexBuffer(tF(r.buffer),jD(i.indexFormat),r.offset);for(var o=0;o<e.length;o++){var a=e[o];null!==a&&n.setVertexBuffer(o,tF(a.buffer),a.offset)}}},t.prototype.setBindings=function(t){var e=t,r=this.getEncoder();e.gpuBindGroup.forEach((function(t,n){t&&r.setBindGroup(n,e.gpuBindGroup[n])}))},t.prototype.setStencilReference=function(t){this.gpuRenderPassEncoder.setStencilReference(t)},t.prototype.draw=function(t,e,r,n){this.getEncoder().draw(t,e,r,n)},t.prototype.drawIndexed=function(t,e,r,n,i){this.getEncoder().drawIndexed(t,e,r,n,i)},t.prototype.drawIndirect=function(t,e){this.getEncoder().drawIndirect(tF(t),e)},t.prototype.drawIndexedIndirect=function(t,e){this.getEncoder().drawIndexedIndirect(tF(t),e)},t.prototype.beginOcclusionQuery=function(t){this.gpuRenderPassEncoder.beginOcclusionQuery(t)},t.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},t.prototype.pushDebugGroup=function(t){this.gpuRenderPassEncoder.pushDebugGroup(t)},t.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},t.prototype.insertDebugMarker=function(t){this.gpuRenderPassEncoder.insertDebugMarker(t)},t.prototype.beginBundle=function(t){this.renderBundle=t},t.prototype.endBundle=function(){this.renderBundle.finish()},t.prototype.executeBundles=function(t){this.gpuRenderPassEncoder.executeBundles(t.map((function(t){return t.renderBundle})))},t.prototype.finish=function(){var t;null===(t=this.gpuRenderPassEncoder)||void 0===t||t.end(),this.gpuRenderPassEncoder=null;for(var e=0;e<this.gfxColorAttachment.length;e++){var r=this.gfxColorAttachment[e],n=this.gfxColorResolveTo[e];null!==r&&null!==n&&1===r.sampleCount&&this.copyAttachment(n,this.gfxColorAttachmentLevel[e],r,this.gfxColorResolveToLevel[e])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},t.prototype.copyAttachment=function(t,e,r,n){GD(1===r.sampleCount);var i={texture:r.gpuTexture,mipLevel:n},o={texture:t.gpuTexture,mipLevel:e};GD(r.width>>>n==t.width>>>e),GD(r.height>>>n==t.height>>>e),GD(!!(r.usage&ZN.COPY_SRC)),GD(!!(t.usage&ZN.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(i,o,[t.width,t.height,1])},t}(),CF=function(t){function e(e){var r=e.id,n=e.device,i=e.descriptor,o=t.call(this,{id:r,device:n})||this;return o.type=sD.RenderPipeline,o.isCreatingAsync=!1,o.gpuRenderPipeline=null,o.descriptor=i,o.device.createRenderPipelineInternal(o,!1),o}return R(e,t),e.prototype.getBindGroupLayout=function(t){return this.gpuRenderPipeline.getBindGroupLayout(t)},e}(_F),RF=function(t){function e(e){var r,n,i=e.id,o=e.device,a=e.descriptor,s=t.call(this,{id:i,device:o})||this;s.type=sD.Sampler;var l=a.lodMinClamp,u=a.mipmapFilter===mD.NO_MIP?a.lodMinClamp:a.lodMaxClamp,c=null!==(r=a.maxAnisotropy)&&void 0!==r?r:1;return c>1&&GD(a.minFilter===fD.BILINEAR&&a.magFilter===fD.BILINEAR&&a.mipmapFilter===mD.LINEAR),s.gpuSampler=s.device.device.createSampler({addressModeU:$N(a.addressModeU),addressModeV:$N(a.addressModeV),addressModeW:$N(null!==(n=a.addressModeW)&&void 0!==n?n:a.addressModeU),lodMinClamp:l,lodMaxClamp:u,minFilter:QN(a.minFilter),magFilter:QN(a.magFilter),mipmapFilter:JN(a.mipmapFilter),compare:void 0!==a.compareFunction?hF(a.compareFunction):void 0,maxAnisotropy:c}),s}return R(e,t),e}(_F),LF=function(t){function e(e){var r=e.id,n=e.device,i=e.descriptor,o=e.skipCreate,a=e.sampleCount,s=t.call(this,{id:r,device:n})||this;s.type=sD.Texture,s.flipY=!1;var l=i.format,u=i.dimension,c=i.width,h=i.height,p=i.depthOrArrayLayers,d=i.mipLevelCount,f=i.usage,m=i.pixelStore;return s.flipY=!!(null==m?void 0:m.unpackFlipY),s.device.createTextureShared({format:l,dimension:null!=u?u:bD.TEXTURE_2D,width:c,height:h,depthOrArrayLayers:null!=p?p:1,mipLevelCount:null!=d?d:1,usage:f,sampleCount:null!=a?a:1},s,o),s}return R(e,t),e.prototype.textureFromImageBitmapOrCanvas=function(t,e,r){for(var n=e[0].width,i=e[0].height,o={size:{width:n,height:i,depthOrArrayLayers:r},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},a=t.createTexture(o),s=0;s<e.length;s++)t.queue.copyExternalImageToTexture({source:e[s],flipY:this.flipY},{texture:a,origin:[0,0,s]},[n,i]);return[a,n,i]},e.prototype.isImageBitmapOrCanvases=function(t){var e=t[0];return e instanceof ImageBitmap||e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas},e.prototype.isVideo=function(t){return t[0]instanceof HTMLVideoElement},e.prototype.setImageData=function(t,e){var r,n,i,o,a=this,s=this.device.device;if(this.isImageBitmapOrCanvases(t))n=(r=B(this.textureFromImageBitmapOrCanvas(s,t,this.depthOrArrayLayers),3))[0],i=r[1],o=r[2];else if(this.isVideo(t))n=s.importExternalTexture({source:t[0]});else{var l=gF(this.gpuTextureformat),u=Math.ceil(this.width/l.width)*l.length;t.forEach((function(t){s.queue.writeTexture({texture:a.gpuTexture},t,{bytesPerRow:u},{width:a.width,height:a.height})}))}this.width=i,this.height=o,n&&(this.gpuTexture=n),this.gpuTextureView=this.gpuTexture.createView({dimension:KN(this.dimension)})},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.gpuTexture.destroy()},e}(_F),IF=function(t){function e(e){var r=e.id,n=e.device,i=t.call(this,{id:r,device:n})||this;return i.type=sD.RenderBundle,i.renderBundleEncoder=i.device.device.createRenderBundleEncoder({colorFormats:[i.device.swapChainFormat]}),i}return R(e,t),e.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},e}(_F),MF=function(){function t(t,e,r,n,i,o){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=ZN.RENDER_ATTACHMENT|ZN.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=wD.UPPER_LEFT,this.clipSpaceNearZ=CD.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=e,this.canvas=r,this.canvasContext=n,this.glsl_compile=i,this.WGSLComposer=o,this.fallbackTexture2D=this.createFallbackTexture(bD.TEXTURE_2D,AD.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(bD.TEXTURE_2D,AD.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(bD.TEXTURE_2D_ARRAY,AD.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(bD.TEXTURE_3D,AD.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(bD.TEXTURE_CUBE_MAP,AD.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:dD.REPEAT,addressModeV:dD.REPEAT,minFilter:fD.POINT,magFilter:fD.POINT,mipmapFilter:mD.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:dD.REPEAT,addressModeV:dD.REPEAT,minFilter:fD.POINT,magFilter:fD.POINT,mipmapFilter:mD.NEAREST,compareFunction:lD.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(t){console.error(t.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return t.prototype.destroy=function(){},t.prototype.configureSwapChain=function(t,e){this.swapChainWidth===t&&this.swapChainHeight===e||(this.swapChainWidth=t,this.swapChainHeight=e)},t.prototype.getOnscreenTexture=function(){var t=this.canvasContext.getCurrentTexture(),e=t.createView(),r=new LF({id:0,device:this,descriptor:{format:OD.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:bD.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return r.depthOrArrayLayers=1,r.sampleCount=1,r.gpuTexture=t,r.gpuTextureView=e,r.name="Onscreen",this.setResourceName(r,"Onscreen Texture"),r},t.prototype.getDevice=function(){return this},t.prototype.getCanvas=function(){return this.canvas},t.prototype.beginFrame=function(){GD(0===this.frameCommandEncoderPool.length)},t.prototype.endFrame=function(){GD(this.frameCommandEncoderPool.every((function(t){return null!==t}))),this.device.queue.submit(this.frameCommandEncoderPool.map((function(t){return t.finish()}))),this.frameCommandEncoderPool=[]},t.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},t.prototype.createBuffer=function(t){return new yF({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createTexture=function(t){return new LF({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createSampler=function(t){return new RF({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createRenderTarget=function(t){var e=new LF({id:this.getNextUniqueId(),device:this,descriptor:I(I({},t),{dimension:bD.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:ED.RENDER_TARGET}),sampleCount:t.sampleCount});return e.depthOrArrayLayers=1,e.type=sD.RenderTarget,e},t.prototype.createRenderTargetFromTexture=function(t){var e=t,r=e.format,n=e.width,i=e.height,o=e.depthOrArrayLayers,a=e.sampleCount,s=e.mipLevelCount,l=e.gpuTexture,u=e.gpuTextureView,c=e.usage;GD(!!(c&ZN.RENDER_ATTACHMENT));var h=new LF({id:this.getNextUniqueId(),device:this,descriptor:{format:r,width:n,height:i,depthOrArrayLayers:o,dimension:bD.TEXTURE_2D,mipLevelCount:s,usage:c},skipCreate:!0});return h.depthOrArrayLayers=o,h.sampleCount=a,h.gpuTexture=l,h.gpuTextureView=u,h},t.prototype.createProgram=function(t){var e,r;return(null===(e=t.vertex)||void 0===e?void 0:e.glsl)&&(t.vertex.glsl=ZB(this.queryVendorInfo(),"vert",t.vertex.glsl)),(null===(r=t.fragment)||void 0===r?void 0:r.glsl)&&(t.fragment.glsl=ZB(this.queryVendorInfo(),"frag",t.fragment.glsl)),new TF({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createProgramSimple=function(t){return new TF({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createTextureShared=function(t,e,r){var n={width:t.width,height:t.height,depthOrArrayLayers:t.depthOrArrayLayers},i=t.mipLevelCount,o=YN(t.format),a=function(t){if(t===bD.TEXTURE_2D)return"2d";if(t===bD.TEXTURE_CUBE_MAP)return"2d";if(t===bD.TEXTURE_2D_ARRAY)return"2d";if(t===bD.TEXTURE_3D)return"3d";throw new Error("whoops")}(t.dimension),s=function(t){var e=0;return t&ED.SAMPLED&&(e|=ZN.TEXTURE_BINDING|ZN.COPY_DST|ZN.COPY_SRC),t&ED.STORAGE&&(e|=ZN.TEXTURE_BINDING|ZN.STORAGE_BINDING|ZN.COPY_SRC|ZN.COPY_DST),t&ED.RENDER_TARGET&&(e|=ZN.RENDER_ATTACHMENT|ZN.TEXTURE_BINDING|ZN.COPY_SRC|ZN.COPY_DST),e}(t.usage);if(e.gpuTextureformat=o,e.dimension=t.dimension,e.format=t.format,e.width=t.width,e.height=t.height,e.depthOrArrayLayers=t.depthOrArrayLayers,e.mipLevelCount=i,e.usage=s,e.sampleCount=t.sampleCount,!r){var l=this.device.createTexture({size:n,mipLevelCount:i,format:o,dimension:a,sampleCount:t.sampleCount,usage:s}),u=l.createView();e.gpuTexture=l,e.gpuTextureView=u}},t.prototype.getFallbackSampler=function(t){return t.formatKind===AD.Depth&&t.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},t.prototype.getFallbackTexture=function(t){var e=t.dimension,r=t.formatKind;if(e===bD.TEXTURE_2D)return r===AD.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(e===bD.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(e===bD.TEXTURE_3D)return this.fallbackTexture3D;if(e===bD.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},t.prototype.createFallbackTexture=function(t,e){var r=t===bD.TEXTURE_CUBE_MAP?6:1,n=e===AD.Float?OD.U8_RGBA_NORM:OD.D24;return this.createTexture({dimension:t,format:n,usage:ED.SAMPLED,width:1,height:1,depthOrArrayLayers:r,mipLevelCount:1})},t.prototype.createBindings=function(t){return new vF({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createInputLayout=function(t){return new EF({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createComputePipeline=function(t){return new bF({id:this.getNextUniqueId(),device:this,descriptor:t})},t.prototype.createRenderPipeline=function(t){return new CF({id:this.getNextUniqueId(),device:this,descriptor:I({},t)})},t.prototype.createQueryPool=function(t,e){return new SF({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:e}})},t.prototype.createRenderPipelineInternal=function(t,e){var r;if(null===t.gpuRenderPipeline){var n=t.descriptor,i=n.program,o=i.vertexStage,a=i.fragmentStage;if(null!==o&&null!==a){var s=n.megaStateDescriptor||{},l=s.stencilBack,u=s.stencilFront,c=M(s,["stencilBack","stencilFront"]),h=rB(iB);n.megaStateDescriptor=I(I(I({},h),{stencilBack:I(I({},h.stencilBack),l),stencilFront:I(I({},h.stencilFront),u)}),c);var p=n.megaStateDescriptor.attachmentsState[0];n.colorAttachmentFormats.forEach((function(t,e){n.megaStateDescriptor.attachmentsState[e]||(n.megaStateDescriptor.attachmentsState[e]=tB(void 0,p))}));var d,f,m=(d=null!==(r=n.topology)&&void 0!==r?r:gD.TRIANGLES,f=n.megaStateDescriptor,{topology:rF(d),cullMode:nF(f.cullMode),frontFace:iF(f.frontFace)}),g=cF(n.colorAttachmentFormats,n.megaStateDescriptor),_=function(t,e){if(!tD(t))return{format:YN(t),depthWriteEnabled:!!e.depthWrite,depthCompare:hF(e.depthCompare),depthBias:e.polygonOffset?e.polygonOffsetUnits:0,depthBiasSlopeScale:e.polygonOffset?e.polygonOffsetFactor:0,stencilFront:{compare:hF(e.stencilFront.compare),passOp:pF(e.stencilFront.passOp),failOp:pF(e.stencilFront.failOp),depthFailOp:pF(e.stencilFront.depthFailOp)},stencilBack:{compare:hF(e.stencilBack.compare),passOp:pF(e.stencilBack.passOp),failOp:pF(e.stencilBack.failOp),depthFailOp:pF(e.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}(n.depthStencilAttachmentFormat,n.megaStateDescriptor),v=void 0;null!==n.inputLayout&&(v=n.inputLayout.buffers);var y=n.sampleCount,x={layout:"auto",vertex:I(I({},o),{buffers:v}),primitive:m,depthStencil:_,multisample:{count:y},fragment:I(I({},a),{targets:g})};t.gpuRenderPipeline=this.device.createRenderPipeline(x)}}},t.prototype.createReadback=function(){return new AF({id:this.getNextUniqueId(),device:this})},t.prototype.createRenderBundle=function(){return new IF({id:this.getNextUniqueId(),device:this})},t.prototype.createRenderPass=function(t){var e=this.renderPassPool.pop();void 0===e&&(e=new wF(this));var r=this.frameCommandEncoderPool.pop();return void 0===r&&(r=this.device.createCommandEncoder()),e.beginRenderPass(r,t),e},t.prototype.createComputePass=function(){var t=this.computePassPool.pop();void 0===t&&(t=new xF);var e=this.frameCommandEncoderPool.pop();return void 0===e&&(e=this.device.createCommandEncoder()),t.beginComputePass(e),t},t.prototype.submitPass=function(t){var e=t;e instanceof wF?(this.frameCommandEncoderPool.push(e.frameCommandEncoder),e.finish(),this.renderPassPool.push(e)):e instanceof xF&&(this.frameCommandEncoderPool.push(e.frameCommandEncoder),e.finish(),this.computePassPool.push(e))},t.prototype.copySubTexture2D=function(t,e,r,n,i,o,a){var s=this.device.createCommandEncoder(),l=t,u=n,c={texture:u.gpuTexture,origin:[i,o,0],mipLevel:0,aspect:"all"},h={texture:l.gpuTexture,origin:[e,r,0],mipLevel:0,aspect:"all"};GD(!!(u.usage&ZN.COPY_SRC)),GD(!!(l.usage&ZN.COPY_DST)),s.copyTextureToTexture(c,h,[u.width,u.height,a||1]),this.device.queue.submit([s.finish()])},t.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},t.prototype.queryTextureFormatSupported=function(t,e,r){if(function(t){switch(ND(t)){case LD.BC1:case LD.BC2:case LD.BC3:case LD.BC4_SNORM:case LD.BC4_UNORM:case LD.BC5_SNORM:case LD.BC5_UNORM:return!0;default:return!1}}(t)){if(!this.featureTextureCompressionBC)return!1;var n=function(t){switch(ND(t)){case LD.BC1:case LD.BC2:case LD.BC3:case LD.BC4_SNORM:case LD.BC4_UNORM:case LD.BC5_SNORM:case LD.BC5_UNORM:return 4;default:return 1}}(t);return e%n==0&&r%n==0&&this.featureTextureCompressionBC}switch(t){case OD.U16_RGBA_NORM:case OD.F32_RGBA:return!1}return!0},t.prototype.queryPlatformAvailable=function(){return!0},t.prototype.queryVendorInfo=function(){return this},t.prototype.queryRenderPass=function(t){return t.descriptor},t.prototype.queryRenderTarget=function(t){return t},t.prototype.setResourceName=function(t,e){if(t.name=e,t.type===sD.Buffer)(r=t).gpuBuffer.label=e;else if(t.type===sD.Texture){(r=t).gpuTexture.label=e,r.gpuTextureView.label=e}else if(t.type===sD.RenderTarget){(r=t).gpuTexture.label=e,r.gpuTextureView.label=e}else if(t.type===sD.Sampler){(r=t).gpuSampler.label=e}else if(t.type===sD.RenderPipeline){var r;null!==(r=t).gpuRenderPipeline&&(r.gpuRenderPipeline.label=e)}},t.prototype.setResourceLeakCheck=function(t,e){},t.prototype.checkForLeaks=function(){},t.prototype.programPatched=function(t){},t.prototype.pipelineQueryReady=function(t){return null!==t.gpuRenderPipeline},t.prototype.pipelineForceReady=function(t){var e=t;this.createRenderPipelineInternal(e,!1)},t}(),OF=function(){function t(t){this.pluginOptions=t}return t.prototype.createSwapChain=function(t){return O(this,void 0,void 0,(function(){var e,r,n,i,o,a,s;return P(this,(function(l){switch(l.label){case 0:if(void 0===globalThis.navigator.gpu)return[2,null];e=null,l.label=1;case 1:return l.trys.push([1,3,,4]),r=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:r})];case 2:return e=l.sent(),[3,4];case 3:return n=l.sent(),console.log(n),[3,4];case 4:return null===e?[2,null]:(i=["depth32float-stencil8","texture-compression-bc","float32-filterable"].filter((function(t){return e.features.has(t)})),[4,e.requestDevice({requiredFeatures:i})]);case 5:if((o=l.sent())&&(a=this.pluginOptions.onContextLost,o.lost.then((function(){a&&a()}))),null===o)return[2,null];if(!(s=t.getContext("webgpu")))return[2,null];l.label=6;case 6:return l.trys.push([6,8,,9]),[4,XN(this.pluginOptions.shaderCompilerPath)];case 7:case 8:return l.sent(),[3,9];case 9:return[2,new MF(e,o,t,s,VN,HN&&new HN)]}}))}))},t}(),PF=class{constructor(t,e){const{buffer:r,offset:n,stride:i,normalized:o,size:a,divisor:s,shaderLocation:l}=e;this.buffer=r,this.attribute={shaderLocation:l,buffer:r.get(),offset:n||0,stride:i||0,normalized:o||!1,divisor:s||0},a&&(this.attribute.size=a)}get(){return this.buffer}updateBuffer(t){this.buffer.subData(t)}destroy(){this.buffer.destroy()}},DF={[x_.FLOAT]:Float32Array,[x_.UNSIGNED_BYTE]:Uint8Array,[x_.SHORT]:Int16Array,[x_.UNSIGNED_SHORT]:Uint16Array,[x_.INT]:Int32Array,[x_.UNSIGNED_INT]:Uint32Array},BF={[x_.POINTS]:gD.POINTS,[x_.LINES]:gD.LINES,[x_.LINE_LOOP]:gD.LINES,[x_.LINE_STRIP]:gD.LINE_STRIP,[x_.TRIANGLES]:gD.TRIANGLES,[x_.TRIANGLE_FAN]:gD.TRIANGLES,[x_.TRIANGLE_STRIP]:gD.TRIANGLE_STRIP},NF={1:OD.F32_R,2:OD.F32_RG,3:OD.F32_RGB,4:OD.F32_RGBA},FF={[x_.STATIC_DRAW]:vD.STATIC,[x_.DYNAMIC_DRAW]:vD.DYNAMIC,[x_.STREAM_DRAW]:vD.DYNAMIC},kF={[x_.REPEAT]:dD.REPEAT,[x_.CLAMP_TO_EDGE]:dD.CLAMP_TO_EDGE,[x_.MIRRORED_REPEAT]:dD.MIRRORED_REPEAT},UF={[x_.NEVER]:lD.NEVER,[x_.ALWAYS]:lD.ALWAYS,[x_.LESS]:lD.LESS,[x_.LEQUAL]:lD.LEQUAL,[x_.GREATER]:lD.GREATER,[x_.GEQUAL]:lD.GEQUAL,[x_.EQUAL]:lD.EQUAL,[x_.NOTEQUAL]:lD.NOTEQUAL},zF={[x_.FRONT]:cD.FRONT,[x_.BACK]:cD.BACK},GF={[x_.FUNC_ADD]:pD.ADD,[x_.MIN_EXT]:pD.MIN,[x_.MAX_EXT]:pD.MAX,[x_.FUNC_SUBTRACT]:pD.SUBSTRACT,[x_.FUNC_REVERSE_SUBTRACT]:pD.REVERSE_SUBSTRACT},jF={[x_.ZERO]:hD.ZERO,[x_.ONE]:hD.ONE,[x_.SRC_COLOR]:hD.SRC,[x_.ONE_MINUS_SRC_COLOR]:hD.ONE_MINUS_SRC,[x_.SRC_ALPHA]:hD.SRC_ALPHA,[x_.ONE_MINUS_SRC_ALPHA]:hD.ONE_MINUS_SRC_ALPHA,[x_.DST_COLOR]:hD.DST,[x_.ONE_MINUS_DST_COLOR]:hD.ONE_MINUS_DST,[x_.DST_ALPHA]:hD.DST_ALPHA,[x_.ONE_MINUS_DST_ALPHA]:hD.ONE_MINUS_DST_ALPHA,[x_.CONSTANT_COLOR]:hD.CONST,[x_.ONE_MINUS_CONSTANT_COLOR]:hD.ONE_MINUS_CONSTANT,[x_.CONSTANT_ALPHA]:hD.CONST,[x_.ONE_MINUS_CONSTANT_ALPHA]:hD.ONE_MINUS_CONSTANT,[x_.SRC_ALPHA_SATURATE]:hD.SRC_ALPHA_SATURATE},VF={[x_.REPLACE]:SD.REPLACE,[x_.KEEP]:SD.KEEP,[x_.ZERO]:SD.ZERO,[x_.INVERT]:SD.INVERT,[x_.INCR]:SD.INCREMENT_CLAMP,[x_.DECR]:SD.DECREMENT_CLAMP,[x_.INCR_WRAP]:SD.INCREMENT_WRAP,[x_.DECR_WRAP]:SD.DECREMENT_WRAP},HF={[x_.ALWAYS]:lD.ALWAYS,[x_.EQUAL]:lD.EQUAL,[x_.GEQUAL]:lD.GEQUAL,[x_.GREATER]:lD.GREATER,[x_.LEQUAL]:lD.LEQUAL,[x_.LESS]:lD.LESS,[x_.NEVER]:lD.NEVER,[x_.NOTEQUAL]:lD.NOTEQUAL},WF={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function XF(t){return Object.prototype.toString.call(t)in WF}var ZF=class{constructor(t,e){this.isDestroyed=!1;const{data:r,usage:n,type:i,isUBO:o,label:a}=e;let s;s=XF(r)?r:new DF[this.type||x_.FLOAT](r),this.type=i,this.size=s.byteLength,this.buffer=t.createBuffer({viewOrSize:s,usage:o?_D.UNIFORM:_D.VERTEX,hint:FF[n||x_.STATIC_DRAW]}),a&&t.setResourceName(this.buffer,a)}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:t,offset:e}){let r;r=XF(t)?t:new DF[this.type||x_.FLOAT](t),this.buffer.setSubData(e,new Uint8Array(r.buffer))}};function qF(t,e=0){return t+=e,t+=t<<10,(t+=t>>>6)>>>0}function YF(t){return t+=t<<3,t^=t>>>11,(t+=t<<15)>>>0}function KF(){return 0}var $F=class{constructor(){this.keys=[],this.values=[]}},QF=class{constructor(t,e){this.keyEqualFunc=t,this.keyHashFunc=e,this.buckets=new Map}findBucketIndex(t,e){for(let r=0;r<t.keys.length;r++)if(this.keyEqualFunc(e,t.keys[r]))return r;return-1}findBucket(t){const e=this.keyHashFunc(t);return this.buckets.get(e)}get(t){const e=this.findBucket(t);if(void 0===e)return null;const r=this.findBucketIndex(e,t);return r<0?null:e.values[r]}add(t,e){const r=this.keyHashFunc(t);void 0===this.buckets.get(r)&&this.buckets.set(r,new $F);const n=this.buckets.get(r);n.keys.push(t),n.values.push(e)}delete(t){const e=this.findBucket(t);if(void 0===e)return;const r=this.findBucketIndex(e,t);-1!==r&&(e.keys.splice(r,1),e.values.splice(r,1))}clear(){this.buckets.clear()}size(){let t=0;for(const e of this.buckets.values())t+=e.values.length;return t}*values(){for(const t of this.buckets.values())for(let e=t.values.length-1;e>=0;e--)yield t.values[e]}};function JF(t,e){return t=qF(t,e.blendMode),t=qF(t,e.blendSrcFactor),t=qF(t,e.blendDstFactor)}function tk(t,e){return t=JF(t,e.rgbBlendState),t=qF(t=JF(t,e.alphaBlendState),e.channelWriteMask)}function ek(t,e){var r,n,i,o,a,s,l,u;for(let r=0;r<e.attachmentsState.length;r++)t=tk(t,e.attachmentsState[r]);return t=function(t,e){return qF(t,e.r<<24|e.g<<16|e.b<<8|e.a)}(t,e.blendConstant||ZD),t=qF(t,e.depthCompare),t=qF(t,e.depthWrite?1:0),t=qF(t,null==(r=e.stencilFront)?void 0:r.compare),t=qF(t,null==(n=e.stencilFront)?void 0:n.passOp),t=qF(t,null==(i=e.stencilFront)?void 0:i.failOp),t=qF(t,null==(o=e.stencilFront)?void 0:o.depthFailOp),t=qF(t,null==(a=e.stencilBack)?void 0:a.compare),t=qF(t,null==(s=e.stencilBack)?void 0:s.passOp),t=qF(t,null==(l=e.stencilBack)?void 0:l.failOp),t=qF(t,null==(u=e.stencilBack)?void 0:u.depthFailOp),t=qF(t,e.stencilWrite?1:0),t=qF(t,e.cullMode),t=qF(t,e.frontFace?1:0),t=qF(t,e.polygonOffset?1:0)}function rk(t){let e=0;e=qF(e,t.program.id),null!==t.inputLayout&&(e=qF(e,t.inputLayout.id)),e=ek(e,t.megaStateDescriptor);for(let r=0;r<t.colorAttachmentFormats.length;r++)e=qF(e,t.colorAttachmentFormats[r]||0);return e=qF(e,t.depthStencilAttachmentFormat||0),YF(e)}function nk(t){let e=0;if(t.samplerBindings)for(let r=0;r<t.samplerBindings.length;r++){const n=t.samplerBindings[r];null!==n&&null!==n.texture&&(e=qF(e,n.texture.id))}if(t.uniformBufferBindings)for(let r=0;r<t.uniformBufferBindings.length;r++){const n=t.uniformBufferBindings[r];null!==n&&null!==n.buffer&&(e=qF(e,n.buffer.id),e=qF(e,n.binding),e=qF(e,n.offset),e=qF(e,n.size))}if(t.storageBufferBindings)for(let r=0;r<t.storageBufferBindings.length;r++){const n=t.storageBufferBindings[r];null!==n&&null!==n.buffer&&(e=qF(e,n.buffer.id),e=qF(e,n.binding),e=qF(e,n.offset),e=qF(e,n.size))}if(t.storageTextureBindings)for(let r=0;r<t.storageTextureBindings.length;r++){const n=t.storageTextureBindings[r];null!==n&&null!==n.texture&&(e=qF(e,n.texture.id),e=qF(e,n.binding))}return YF(e)}function ik(t,e){var r,n,i,o;return(null==(r=t.vertex)?void 0:r.glsl)===(null==(n=e.vertex)?void 0:n.glsl)&&(null==(i=t.fragment)?void 0:i.glsl)===(null==(o=e.fragment)?void 0:o.glsl)}var ok=class{constructor(t){this.device=t,this.bindingsCache=new QF(pB,nk),this.renderPipelinesCache=new QF(vB,rk),this.inputLayoutsCache=new QF(bB,KF),this.programCache=new QF(ik,KF)}createBindings(t){var e;let r=this.bindingsCache.get(t);if(null===r){const i={samplerBindings:(n=t).samplerBindings&&lB(n.samplerBindings,EB),uniformBufferBindings:n.uniformBufferBindings&&lB(n.uniformBufferBindings,TB),storageBufferBindings:n.storageBufferBindings&&lB(n.storageBufferBindings,TB),storageTextureBindings:n.storageTextureBindings&&lB(n.storageTextureBindings,SB),pipeline:n.pipeline};i.uniformBufferBindings=null==(e=i.uniformBufferBindings)?void 0:e.filter((({size:t})=>t&&t>0)),r=this.device.createBindings(i),this.bindingsCache.add(i,r)}var n;return r}createRenderPipeline(t){let e=this.renderPipelinesCache.get(t);if(null===e){const a=(n=(r=t).inputLayout,i=r.program,o=r.topology,{inputLayout:n,megaStateDescriptor:r.megaStateDescriptor&&rB(r.megaStateDescriptor),program:i,topology:o,colorAttachmentFormats:r.colorAttachmentFormats.slice(),depthStencilAttachmentFormat:r.depthStencilAttachmentFormat,sampleCount:r.sampleCount});a.colorAttachmentFormats=a.colorAttachmentFormats.filter((t=>t)),e=this.device.createRenderPipeline(a),this.renderPipelinesCache.add(a,e)}var r,n,i,o;return e}createInputLayout(t){t.vertexBufferDescriptors=t.vertexBufferDescriptors.filter((t=>!!t));let e=this.inputLayoutsCache.get(t);if(null===e){const n={vertexBufferDescriptors:lB((r=t).vertexBufferDescriptors,wB),indexBufferFormat:r.indexBufferFormat,program:r.program};e=this.device.createInputLayout(n),this.inputLayoutsCache.add(n,e)}var r;return e}createProgram(t){let e=this.programCache.get(t);if(null===e){const r=function(t){var e,r;return{vertex:{glsl:null==(e=t.vertex)?void 0:e.glsl},fragment:{glsl:null==(r=t.fragment)?void 0:r.glsl}}}(t);e=this.device.createProgram(t),this.programCache.add(r,e)}return e}destroy(){for(const t of this.bindingsCache.values())t.destroy();for(const t of this.renderPipelinesCache.values())t.destroy();for(const t of this.inputLayoutsCache.values())t.destroy();for(const t of this.programCache.values())t.destroy();this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}},ak=class{constructor(t,e){const{data:r,type:n,count:i=0}=e;let o;o=XF(r)?r:new DF[this.type||x_.UNSIGNED_INT](r),this.type=n,this.count=i,this.indexBuffer=t.createBuffer({viewOrSize:o,usage:_D.INDEX})}get(){return this.indexBuffer}subData({data:t}){let e;e=XF(t)?t:new DF[this.type||x_.UNSIGNED_INT](t),this.indexBuffer.setSubData(0,new Uint8Array(e.buffer))}destroy(){this.indexBuffer.destroy()}};function sk(t){return!(!t||!t.texture)}var lk=class{constructor(t,e){this.device=t,this.options=e,this.isDestroy=!1;const{wrapS:r=x_.CLAMP_TO_EDGE,wrapT:n=x_.CLAMP_TO_EDGE,aniso:i,mag:o=x_.NEAREST,min:a=x_.NEAREST}=e;this.createTexture(e),this.sampler=t.createSampler({addressModeU:kF[r],addressModeV:kF[n],minFilter:a===x_.NEAREST?fD.POINT:fD.BILINEAR,magFilter:o===x_.NEAREST?fD.POINT:fD.BILINEAR,mipmapFilter:mD.NO_MIP,maxAnisotropy:i})}createTexture(t){const{type:e=x_.UNSIGNED_BYTE,width:r,height:n,flipY:i=!1,format:o=x_.RGBA,alignment:a=1,usage:s=xy.SAMPLED,unorm:l=!1,label:u}=t;let{data:c}=t;this.width=r,this.height=n;let h=OD.U8_RGBA_RT;if(e===x_.UNSIGNED_BYTE&&o===x_.RGBA)h=l?OD.U8_RGBA_NORM:OD.U8_RGBA_RT;else if(e===x_.UNSIGNED_BYTE&&o===x_.LUMINANCE)h=OD.U8_LUMINANCE;else if(e===x_.FLOAT&&o===x_.LUMINANCE)h=OD.F32_LUMINANCE;else if(e===x_.FLOAT&&o===x_.RGB)"WebGPU"===this.device.queryVendorInfo().platformString?(c&&(c=function(t,e){const r=t.length,n=r+Math.ceil(r/3),i=new Float32Array(n);for(let r=0;r<n;r+=4)i[r]=t[r/4*3],i[r+1]=t[r/4*3+1],i[r+2]=t[r/4*3+2],i[r+3]=e;return i}(c,0)),h=OD.F32_RGBA):h=OD.F32_RGB;else if(e===x_.FLOAT&&o===x_.RGBA)h=OD.F32_RGBA;else{if(e!==x_.FLOAT||o!==x_.RED)throw new Error(`create texture error, type: ${e}, format: ${o}`);h=OD.F32_R}this.texture=this.device.createTexture({format:h,width:r,height:n,usage:s===xy.SAMPLED?ED.SAMPLED:ED.RENDER_TARGET,pixelStore:{unpackFlipY:i,packAlignment:a},mipLevelCount:1}),u&&this.device.setResourceName(this.texture,u),c&&this.texture.setImageData([c])}get(){return this.texture}update(t){const{data:e}=t;this.texture.setImageData([e])}bind(){}resize({width:t,height:e}){this.width===t&&this.height===e||this.destroy(),this.options.width=t,this.options.height=e,this.createTexture(this.options),this.isDestroy=!1}getSize(){return[this.width,this.height]}destroy(){var t;this.isDestroy||this.texture.destroyed||null==(t=this.texture)||t.destroy(),this.isDestroy=!0}},uk=class{constructor(t,e){this.device=t,this.options=e,this.createColorRenderTarget(),this.createDepthRenderTarget()}createColorRenderTarget(t=!1){const{width:e,height:r,color:n}=this.options;n&&(sk(n)?(t&&n.resize({width:e,height:r}),this.colorTexture=n.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=n.width,this.height=n.height):e&&r&&(this.colorTexture=this.device.createTexture({format:OD.U8_RGBA_RT,usage:ED.RENDER_TARGET,width:e,height:r}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=e,this.height=r))}createDepthRenderTarget(t=!1){const{width:e,height:r,depth:n}=this.options;n&&(sk(n)?(t&&n.resize({width:e,height:r}),this.depthTexture=n.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=n.width,this.height=n.height):e&&r&&(this.depthTexture=this.device.createTexture({format:OD.D24_S8,usage:ED.RENDER_TARGET,width:e,height:r}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=e,this.height=r))}get(){return this.colorRenderTarget}destroy(){var t,e;null==(t=this.colorRenderTarget)||t.destroy(),null==(e=this.depthRenderTarget)||e.destroy()}resize({width:t,height:e}){this.width===t&&this.height===e||(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=t,this.options.height=e,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}},ck=Object.defineProperty,hk=Object.defineProperties,pk=Object.getOwnPropertyDescriptors,dk=Object.getOwnPropertySymbols,fk=Object.prototype.hasOwnProperty,mk=Object.prototype.propertyIsEnumerable,gk=(t,e,r)=>e in t?ck(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_k=(t,e)=>{for(var r in e||(e={}))fk.call(e,r)&&gk(t,r,e[r]);if(dk)for(var r of dk(e))mk.call(e,r)&&gk(t,r,e[r]);return t},{isPlainObject:vk,isTypedArray:yk,isNil:xk}=ld,bk=class{constructor(t,e,r){this.device=t,this.options=e,this.service=r,this.destroyed=!1,this.uniforms={},this.vertexBuffers=[];const{vs:n,fs:i,attributes:o,uniforms:a,count:s,elements:l,diagnosticDerivativeUniformityEnabled:u}=e;this.options=e;const c=u?"":this.service.viewportOrigin===wD.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=r.renderCache.createProgram({vertex:{glsl:n},fragment:{glsl:i,postprocess:t=>c+t}}),a&&(this.uniforms=this.extractUniforms(a));const h=[];let p=0;Object.keys(o).forEach((t=>{const e=o[t],r=e.get();this.vertexBuffers.push(r.get());const{offset:n=0,stride:i=0,size:a=1,divisor:s=0,shaderLocation:l=0}=e.attribute;h.push({arrayStride:i||4*a,stepMode:yD.VERTEX,attributes:[{format:NF[a],shaderLocation:l,offset:n,divisor:s}]}),p=r.size/a})),s||(this.options.count=p),l&&(this.indexBuffer=l.get());const d=r.renderCache.createInputLayout({vertexBufferDescriptors:h,indexBufferFormat:l?OD.U32_R:null,program:this.program});this.inputLayout=d,this.pipeline=this.createPipeline(e)}createPipeline(t,e){var r;const{primitive:n=x_.TRIANGLES,depth:i,cull:o,blend:a,stencil:s}=t,l=this.initDepthDrawParams({depth:i}),u=!(!l||!l.enable),c=this.initCullDrawParams({cull:o}),h=!(!c||!c.enable),p=this.getBlendDrawParams({blend:a}),d=!(!p||!p.enable),f=this.getStencilDrawParams({stencil:s}),m=!(!f||!f.enable),g=this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:BF[n],colorAttachmentFormats:[OD.U8_RGBA_RT],depthStencilAttachmentFormat:OD.D24_S8,megaStateDescriptor:{attachmentsState:[e?{channelWriteMask:TD.ALL,rgbBlendState:{blendMode:pD.ADD,blendSrcFactor:hD.ONE,blendDstFactor:hD.ZERO},alphaBlendState:{blendMode:pD.ADD,blendSrcFactor:hD.ONE,blendDstFactor:hD.ZERO}}:{channelWriteMask:m&&f.opFront.zpass===SD.REPLACE?TD.NONE:TD.ALL,rgbBlendState:{blendMode:d&&p.equation.rgb||pD.ADD,blendSrcFactor:d&&p.func.srcRGB||hD.SRC_ALPHA,blendDstFactor:d&&p.func.dstRGB||hD.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:d&&p.equation.alpha||pD.ADD,blendSrcFactor:d&&p.func.srcAlpha||hD.ONE,blendDstFactor:d&&p.func.dstAlpha||hD.ONE}}],blendConstant:d?ZD:void 0,depthWrite:u,depthCompare:u&&l.func||lD.LESS,cullMode:h&&c.face||cD.NONE,stencilWrite:m,stencilFront:{compare:m?f.func.cmp:lD.ALWAYS,passOp:f.opFront.zpass,failOp:f.opFront.fail,depthFailOp:f.opFront.zfail,mask:f.opFront.mask},stencilBack:{compare:m?f.func.cmp:lD.ALWAYS,passOp:f.opBack.zpass,failOp:f.opBack.fail,depthFailOp:f.opBack.zfail,mask:f.opBack.mask}}});return m&&!xk(null==(r=null==s?void 0:s.func)?void 0:r.ref)&&(g.stencilFuncReference=s.func.ref),g}updateAttributesAndElements(){}updateAttributes(){}addUniforms(t){this.uniforms=_k(_k({},this.uniforms),this.extractUniforms(t))}draw(t,e){const r=_k(_k({},this.options),t),{count:n=0,instances:i,elements:o,uniforms:a={},uniformBuffers:s,textures:l}=r;this.uniforms=_k(_k({},this.uniforms),this.extractUniforms(a));const{renderPass:u,currentFramebuffer:c,width:h,height:p}=this.service;this.pipeline=this.createPipeline(r,e);const d=this.service.device,f=d.swapChainHeight;if(d.swapChainHeight=(null==c?void 0:c.height)||p,u.setViewport(0,0,(null==c?void 0:c.width)||h,(null==c?void 0:c.height)||p),d.swapChainHeight=f,u.setPipeline(this.pipeline),xk(this.pipeline.stencilFuncReference)||u.setStencilReference(this.pipeline.stencilFuncReference),u.setVertexInput(this.inputLayout,this.vertexBuffers.map((t=>({buffer:t}))),o?{buffer:this.indexBuffer,offset:0}:null),s&&(this.bindings=d.createBindings({pipeline:this.pipeline,uniformBufferBindings:s.map(((t,e)=>{const r=t;return{binding:e,buffer:r.get(),size:r.size}})),samplerBindings:null==l?void 0:l.map((t=>({texture:t.texture,sampler:t.sampler})))})),this.bindings&&(u.setBindings(this.bindings),Object.keys(this.uniforms).forEach((t=>{const e=this.uniforms[t];e instanceof lk?this.uniforms[t]=e.get():e instanceof uk&&(this.uniforms[t]=e.get().texture)})),this.program.setUniformsLegacy(this.uniforms)),o){const t=o.count;0===t?u.draw(n,i):u.drawIndexed(t,i)}else u.draw(n,i)}destroy(){var t,e,r;null==(t=this.vertexBuffers)||t.forEach((t=>t.destroy())),null==(e=this.indexBuffer)||e.destroy(),null==(r=this.bindings)||r.destroy(),this.pipeline.destroy(),this.destroyed=!0}initDepthDrawParams({depth:t}){if(t)return{enable:void 0===t.enable||!!t.enable,mask:void 0===t.mask||!!t.mask,func:UF[t.func||x_.LESS],range:t.range||[0,1]}}getBlendDrawParams({blend:t}){const{enable:e,func:r,equation:n,color:i=[0,0,0,0]}=t||{};return{enable:!!e,func:{srcRGB:jF[r&&r.srcRGB||x_.SRC_ALPHA],srcAlpha:jF[r&&r.srcAlpha||x_.SRC_ALPHA],dstRGB:jF[r&&r.dstRGB||x_.ONE_MINUS_SRC_ALPHA],dstAlpha:jF[r&&r.dstAlpha||x_.ONE_MINUS_SRC_ALPHA]},equation:{rgb:GF[n&&n.rgb||x_.FUNC_ADD],alpha:GF[n&&n.alpha||x_.FUNC_ADD]},color:i}}getStencilDrawParams({stencil:t}){const{enable:e,mask:r=4294967295,func:n={cmp:x_.ALWAYS,ref:0,mask:4294967295},opFront:i={fail:x_.KEEP,zfail:x_.KEEP,zpass:x_.KEEP},opBack:o={fail:x_.KEEP,zfail:x_.KEEP,zpass:x_.KEEP}}=t||{};return{enable:!!e,mask:r,func:(a=_k({},n),s={cmp:HF[n.cmp]},hk(a,pk(s))),opFront:{fail:VF[i.fail],zfail:VF[i.zfail],zpass:VF[i.zpass],mask:n.mask},opBack:{fail:VF[o.fail],zfail:VF[o.zfail],zpass:VF[o.zpass],mask:n.mask}};var a,s}initCullDrawParams({cull:t}){if(t){const{enable:e,face:r=x_.BACK}=t;return{enable:!!e,face:zF[r]}}}extractUniforms(t){const e={};return Object.keys(t).forEach((r=>{this.extractUniformsRecursively(r,t[r],e,"")})),e}extractUniformsRecursively(t,e,r,n){null===e||"number"==typeof e||"boolean"==typeof e||Array.isArray(e)&&"number"==typeof e[0]||yk(e)||""===e||"resize"in e?r[`${n&&n+"."}${t}`]=e:(vk(e)&&Object.keys(e).forEach((i=>{this.extractUniformsRecursively(i,e[i],r,`${n&&n+"."}${t}`)})),Array.isArray(e)&&e.forEach(((e,i)=>{Object.keys(e).forEach((o=>{this.extractUniformsRecursively(o,e[o],r,`${n&&n+"."}${t}[${i}]`)}))})))}};function Ek(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}var Tk=(t,e,r)=>new Promise(((n,i)=>{var o=t=>{try{s(r.next(t))}catch(t){i(t)}},a=t=>{try{s(r.throw(t))}catch(t){i(t)}},s=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,a);s((r=r.apply(t,e)).next())})),{isUndefined:Sk}=ld,Ak=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>this.device.queryVendorInfo().platformString,this.createModel=t=>new bk(this.device,t,this),this.createAttribute=t=>new PF(this.device,t),this.createBuffer=t=>new ZF(this.device,t),this.createElements=t=>new ak(this.device,t),this.createTexture2D=t=>new lk(this.device,t),this.createFramebuffer=t=>new uk(this.device,t),this.useFramebuffer=(t,e)=>{this.currentFramebuffer=t,this.beginFrame(),e(),this.endFrame(),this.currentFramebuffer=null},this.useFramebufferAsync=(t,e)=>Tk(this,null,(function*(){this.currentFramebuffer=t,this.preRenderPass=this.renderPass,this.beginFrame(),yield e(),this.endFrame(),this.currentFramebuffer=null,this.renderPass=this.preRenderPass})),this.clear=t=>{const{color:e,depth:r,stencil:n,framebuffer:i=null}=t;if(i)i.clearOptions={color:e,depth:r,stencil:n};else{const t=this.queryVerdorInfo();if("WebGL1"===t){const t=this.getGLContext();Sk(n)?Sk(r)||(t.clearDepth(r),t.clear(t.DEPTH_BUFFER_BIT)):(t.clearStencil(n),t.clear(t.STENCIL_BUFFER_BIT))}else if("WebGL2"===t){const t=this.getGLContext();Sk(n)?Sk(r)||t.clearBufferfv(t.DEPTH,0,[r]):t.clearBufferiv(t.STENCIL,0,[n])}}},this.viewport=({width:t,height:e})=>{this.swapChain.configureSwapChain(t,e),this.createMainColorDepthRT(t,e),this.width=t,this.height=e},this.readPixels=t=>{const{framebuffer:e,x:r,y:n,width:i,height:o}=t,a=this.device.createReadback(),s=e.colorTexture,l=a.readTextureSync(s,r,this.viewportOrigin===wD.LOWER_LEFT?n:this.height-n,i,o,new Uint8Array(i*o*4));if(this.viewportOrigin!==wD.LOWER_LEFT)for(let t=0;t<l.length;t+=4){const e=l[t];l[t]=l[t+2],l[t+2]=e}return a.destroy(),l},this.readPixelsAsync=t=>Tk(this,null,(function*(){const{framebuffer:e,x:r,y:n,width:i,height:o}=t,a=this.device.createReadback(),s=e.colorTexture,l=yield a.readTexture(s,r,this.viewportOrigin===wD.LOWER_LEFT?n:this.height-n,i,o,new Uint8Array(i*o*4));if(this.viewportOrigin!==wD.LOWER_LEFT)for(let t=0;t<l.length;t+=4){const e=l[t];l[t]=l[t+2],l[t+2]=e}return a.destroy(),l})),this.getViewportSize=()=>({width:this.width,height:this.height}),this.getContainer=()=>{var t;return null==(t=this.canvas)?void 0:t.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.device.gl,this.destroy=()=>{var t;this.canvas=null,null==(t=this.uniformBuffers)||t.forEach((t=>{t.destroy()})),this.device.destroy(),this.renderCache.destroy()}}init(t,e){return Tk(this,null,(function*(){const{enableWebGPU:r,shaderCompilerPath:n,antialias:i}=e;this.canvas=t;const o=r?new OF({shaderCompilerPath:n}):new CN({targets:["webgl2","webgl1"],antialias:i,onContextLost(t){console.warn("context lost",t)},onContextCreationError(t){console.warn("context creation error",t)},onContextRestored(t){console.warn("context restored",t)}}),a=yield o.createSwapChain(t);a.configureSwapChain(t.width,t.height),this.device=a.getDevice(),this.swapChain=a,this.renderCache=new ok(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin;const s=this.device.gl;this.extensionObject={OES_texture_float:!Ek(s)&&this.device.OES_texture_float},this.createMainColorDepthRT(t.width,t.height)}))}createMainColorDepthRT(t,e){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:OD.U8_RGBA_RT,width:t,height:e,usage:ED.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:OD.D24_S8,width:t,height:e,usage:ED.RENDER_TARGET}))}beginFrame(){this.device.beginFrame();const{currentFramebuffer:t,swapChain:e,mainColorRT:r,mainDepthRT:n}=this,i=t?t.colorRenderTarget:r,o=t?null:e.getOnscreenTexture(),a=t?t.depthRenderTarget:n,{color:s=[0,0,0,0],depth:l=1,stencil:u=0}=(null==t?void 0:t.clearOptions)||{},c=i?XD(255*s[0],255*s[1],255*s[2],s[3]):ZD,h=a?l:void 0,p=a?u:void 0,d=this.device.createRenderPass({colorAttachment:[i],colorResolveTo:[o],colorClearColor:[c],colorStore:[!0],depthStencilAttachment:a,depthClearValue:h,stencilClearValue:p});this.renderPass=d}endFrame(){this.device.submitPass(this.renderPass),this.device.endFrame()}getPointSizeRange(){const t=this.device.gl;return t.getParameter(t.ALIASED_POINT_SIZE_RANGE)}testExtension(t){return!!this.getGLContext().getExtension(t)}setState(){}setBaseState(){}setCustomLayerDefaults(){}setDirty(t){this.isDirty=t}getDirty(){return this.isDirty}},wk={exports:{}};!function(t,e){t.exports=function(){var t=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},e=function(t,e){for(var r=Object.keys(e),n=0;n<r.length;++n)t[r[n]]=e[r[n]];return t},r="\n";function n(t){return"undefined"!=typeof atob?atob(t):"base64:"+t}function i(t){var e=new Error("(regl) "+t);throw console.error(e),e}function o(t,e){t||i(e)}function a(t){return t?": "+t:""}function s(t,e,r){t in e||i("unknown parameter ("+t+")"+a(r)+". possible values: "+Object.keys(e).join())}function l(e,r){t(e)||i("invalid parameter type"+a(r)+". must be a typed array")}function u(t,e){switch(e){case"number":return"number"==typeof t;case"object":return"object"==typeof t;case"string":return"string"==typeof t;case"boolean":return"boolean"==typeof t;case"function":return"function"==typeof t;case"undefined":return void 0===t;case"symbol":return"symbol"==typeof t}}function c(t,e,r){u(t,e)||i("invalid parameter type"+a(r)+". expected "+e+", got "+typeof t)}function h(t,e){t>=0&&(0|t)===t||i("invalid parameter type, ("+t+")"+a(e)+". must be a nonnegative integer")}function p(t,e,r){e.indexOf(t)<0&&i("invalid value"+a(r)+". must be one of: "+e)}var d=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function f(t){Object.keys(t).forEach((function(t){d.indexOf(t)<0&&i('invalid regl constructor argument "'+t+'". must be one of '+d)}))}function m(t,e){for(t+="";t.length<e;)t=" "+t;return t}function g(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function _(t,e){this.number=t,this.line=e,this.errors=[]}function v(t,e,r){this.file=t,this.line=e,this.message=r}function y(){var t=new Error,e=(t.stack||t).toString(),r=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(r)return r[1];var n=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return n?n[1]:"unknown"}function x(){var t=new Error,e=(t.stack||t).toString(),r=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(r)return r[1];var n=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return n?n[1]:"unknown"}function b(t,e){var r=t.split("\n"),i=1,o=0,a={unknown:new g,0:new g};a.unknown.name=a[0].name=e||y(),a.unknown.lines.push(new _(0,""));for(var s=0;s<r.length;++s){var l=r[s],u=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(l);if(u)switch(u[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(u[2]);c&&(i=0|c[1],c[2]&&((o=0|c[2])in a||(a[o]=new g)));break;case"define":var h=/SHADER_NAME(_B64)?\s+(.*)$/.exec(u[2]);h&&(a[o].name=h[1]?n(h[2]):h[2])}a[o].lines.push(new _(i++,l))}return Object.keys(a).forEach((function(t){var e=a[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),a}function E(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var r=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);r?e.push(new v(0|r[1],0|r[2],r[3].trim())):t.length>0&&e.push(new v("unknown",0,t))}})),e}function T(t,e){e.forEach((function(e){var r=t[e.file];if(r){var n=r.index[e.line];if(n)return n.errors.push(e),void(r.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))}function S(t,e,n,i,a){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var s=t.getShaderInfoLog(e),l=i===t.FRAGMENT_SHADER?"fragment":"vertex";M(n,"string",l+" shader source must be a string",a);var u=b(n,a),c=E(s);T(u,c),Object.keys(u).forEach((function(t){var e=u[t];if(e.hasErrors){var n=[""],i=[""];o("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){o(m(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(t.line+r,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(n){var i=n.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),e=Math.max(t.line.indexOf(s,e),0)}else e=0;o(m("| ",6)),o(m("^^^",e+3)+r,"font-weight:bold"),o(m("| ",6)),o(i+r,"font-weight:bold")})),o(m("| ",6)+r)}else o(m(t.number,4)+"|  "),o(t.line+r,"color:red")})),"undefined"==typeof document||window.chrome?console.log(n.join("")):(i[0]=n.join("%c"),console.log.apply(console,i))}function o(t,e){n.push(t),i.push(e||"")}})),o.raise("Error compiling "+l+" shader, "+u[0].name)}}function A(t,e,n,i,a){if(!t.getProgramParameter(e,t.LINK_STATUS)){var s=t.getProgramInfoLog(e),l=b(n,a),u='Error linking program with vertex shader, "'+b(i,a)[0].name+'", and fragment shader "'+l[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+r+"%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+r+s),o.raise(u)}}function w(t){t._commandRef=y()}function C(t,e,r,n){function i(t){return t?n.id(t):0}function o(t,e){Object.keys(e).forEach((function(e){t[n.id(e)]=!0}))}w(t),t._fragId=i(t.static.frag),t._vertId=i(t.static.vert);var a=t._uniformSet={};o(a,e.static),o(a,e.dynamic);var s=t._attributeSet={};o(s,r.static),o(s,r.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic}function R(t,e){var r=x();i(t+" in command "+(e||y())+("unknown"===r?"":" called from "+r))}function L(t,e,r){t||R(e,r||y())}function I(t,e,r,n){t in e||R("unknown parameter ("+t+")"+a(r)+". possible values: "+Object.keys(e).join(),n||y())}function M(t,e,r,n){u(t,e)||R("invalid parameter type"+a(r)+". expected "+e+", got "+typeof t,n||y())}function O(t){t()}function P(t,e,r){t.texture?p(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):p(t.renderbuffer._renderbuffer.format,r,"unsupported renderbuffer format for attachment")}var D=33071,B=9728,N=9984,F=9985,k=9986,U=9987,z=5121,G=5122,j=5123,V=5124,H=5125,W=5126,X=32819,Z=32820,q=33635,Y=34042,K=36193,$={};function Q(t,e){return t===Z||t===X||t===q?2:t===Y?4:$[t]*e}function J(t){return!(t&t-1||!t)}function tt(t,e,r){var n,i=e.width,a=e.height,s=e.channels;o(i>0&&i<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),t.wrapS===D&&t.wrapT===D||o(J(i)&&J(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==i&&1!==a&&o(t.minFilter!==N&&t.minFilter!==k&&t.minFilter!==F&&t.minFilter!==U,"min filter requires mipmap"):(o(J(i)&&J(a),"texture must be a square power of 2 to support mipmapping"),o(e.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),e.type===W&&(r.extensions.indexOf("oes_texture_float_linear")<0&&o(t.minFilter===B&&t.magFilter===B,"filter not supported, must enable oes_texture_float_linear"),o(!t.genMipmaps,"mipmap generation not supported with float textures"));var l=e.images;for(n=0;n<16;++n)if(l[n]){var u=i>>n,c=a>>n;o(e.mipmask&1<<n,"missing mipmap data");var h=l[n];if(o(h.width===u&&h.height===c,"invalid shape for mip images"),o(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed);else if(h.data){var p=Math.ceil(Q(h.type,s)*u/h.unpackAlignment)*h.unpackAlignment;o(h.data.byteLength===p*c,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else t.genMipmaps||o(!(e.mipmask&1<<n),"extra mipmap data");e.compressed&&o(!t.genMipmaps,"mipmap generation for compressed images not supported")}function et(t,e,r,n){var i=t.width,a=t.height,s=t.channels;o(i>0&&i<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),o(i===a,"cube map must be square"),o(e.wrapS===D&&e.wrapT===D,"wrap mode not supported by cube map");for(var l=0;l<r.length;++l){var u=r[l];o(u.width===i&&u.height===a,"inconsistent cube map face shape"),e.genMipmaps&&(o(!u.compressed,"can not generate mipmap for compressed textures"),o(1===u.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=u.images,h=0;h<16;++h){var p=c[h];if(p){var d=i>>h,f=a>>h;o(u.mipmask&1<<h,"missing mipmap data"),o(p.width===d&&p.height===f,"invalid shape for mip images"),o(p.format===t.format&&p.internalformat===t.internalformat&&p.type===t.type,"incompatible type for mip image"),p.compressed||(p.data?o(p.data.byteLength===d*f*Math.max(Q(p.type,s),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):p.element||p.copy)}}}}$[5120]=$[z]=1,$[G]=$[j]=$[K]=$[q]=$[X]=$[Z]=2,$[V]=$[H]=$[W]=$[Y]=4;var rt=e(o,{optional:O,raise:i,commandRaise:R,command:L,parameter:s,commandParameter:I,constructor:f,type:c,commandType:M,isTypedArray:l,nni:h,oneOf:p,shaderError:S,linkError:A,callSite:x,saveCommandRef:w,saveDrawInfo:C,framebufferFormat:P,guessCommand:y,texture2D:tt,textureCube:et}),nt=0,it=0;function ot(t,e){this.id=nt++,this.type=t,this.data=e}function at(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function st(t){if(0===t.length)return[];var e=t.charAt(0),r=t.charAt(t.length-1);if(t.length>1&&e===r&&('"'===e||"'"===e))return['"'+at(t.substr(1,t.length-2))+'"'];var n=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(n)return st(t.substr(0,n.index)).concat(st(n[1])).concat(st(t.substr(n.index+n[0].length)));var i=t.split(".");if(1===i.length)return['"'+at(t)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(st(i[a]));return o}function lt(t){return"["+st(t).join("][")+"]"}function ut(t,e){return new ot(t,lt(e+""))}function ct(t){return"function"==typeof t&&!t._reglType||t instanceof ot}function ht(t,e){return"function"==typeof t?new ot(it,t):t}var pt={DynamicVariable:ot,define:ut,isDynamic:ct,unbox:ht,accessor:lt},dt={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},ft="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function mt(){var t={"":0},e=[""];return{id:function(r){var n=t[r];return n||(n=t[r]=e.length,e.push(r),n)},str:function(t){return e[t]}}}function gt(t,r,n){var i,o=document.createElement("canvas");function a(){var r=window.innerWidth,i=window.innerHeight;if(t!==document.body){var a=t.getBoundingClientRect();r=a.right-a.left,i=a.bottom-a.top}o.width=n*r,o.height=n*i,e(o.style,{width:r+"px",height:i+"px"})}function s(){i?i.disconnect():window.removeEventListener("resize",a),t.removeChild(o)}return e(o.style,{border:0,margin:0,padding:0,top:0,left:0}),t.appendChild(o),t===document.body&&(o.style.position="absolute",e(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(t):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:s}}function _t(t,e){function r(r){try{return t.getContext(r,e)}catch(t){return null}}return r("webgl")||r("experimental-webgl")||r("webgl-experimental")}function vt(t){return"string"==typeof t.nodeName&&"function"==typeof t.appendChild&&"function"==typeof t.getBoundingClientRect}function yt(t){return"function"==typeof t.drawArrays||"function"==typeof t.drawElements}function xt(t){return"string"==typeof t?t.split():(rt(Array.isArray(t),"invalid extension array"),t)}function bt(t){return"string"==typeof t?(rt("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function Et(t){var e,r,n,i,o=t||{},a={},s=[],l=[],u="undefined"==typeof window?1:window.devicePixelRatio,c=!1,h=function(t){t&&rt.raise(t)},p=function(){};if("string"==typeof o?(rt("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),e=document.querySelector(o),rt(e,"invalid query string for element")):"object"==typeof o?vt(o)?e=o:yt(o)?n=(i=o).canvas:(rt.constructor(o),"gl"in o?i=o.gl:"canvas"in o?n=bt(o.canvas):"container"in o&&(r=bt(o.container)),"attributes"in o&&(a=o.attributes,rt.type(a,"object","invalid context attributes")),"extensions"in o&&(s=xt(o.extensions)),"optionalExtensions"in o&&(l=xt(o.optionalExtensions)),"onDone"in o&&(rt.type(o.onDone,"function","invalid or missing onDone callback"),h=o.onDone),"profile"in o&&(c=!!o.profile),"pixelRatio"in o&&(u=+o.pixelRatio,rt(u>0,"invalid pixel ratio"))):rt.raise("invalid arguments to regl"),e&&("canvas"===e.nodeName.toLowerCase()?n=e:r=e),!i){if(!n){rt("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var d=gt(r||document.body,h,u);if(!d)return null;n=d.canvas,p=d.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),i=_t(n,a)}return i?{gl:i,canvas:n,container:r,extensions:s,optionalExtensions:l,pixelRatio:u,profile:c,onDone:h,onDestroy:p}:(p(),h("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Tt(t,e){var r={};function n(e){rt.type(e,"string","extension name must be string");var n,i=e.toLowerCase();try{n=r[i]=t.getExtension(i)}catch(t){}return!!n}for(var i=0;i<e.extensions.length;++i){var o=e.extensions[i];if(!n(o))return e.onDestroy(),e.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(n),{extensions:r,restore:function(){Object.keys(r).forEach((function(t){if(r[t]&&!n(t))throw new Error("(regl): error restoring extension "+t)}))}}}function St(t,e){for(var r=Array(t),n=0;n<t;++n)r[n]=e(n);return r}var At=5120,wt=5121,Ct=5122,Rt=5123,Lt=5124,It=5125,Mt=5126;function Ot(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}function Pt(t){var e,r;return e=(t>65535)<<4,e|=r=((t>>>=e)>255)<<3,e|=r=((t>>>=r)>15)<<2,(e|=r=((t>>>=r)>3)<<1)|(t>>>=r)>>1}function Dt(){var t=St(8,(function(){return[]}));function e(e){var r=Ot(e),n=t[Pt(r)>>2];return n.length>0?n.pop():new ArrayBuffer(r)}function r(e){t[Pt(e.byteLength)>>2].push(e)}function n(t,r){var n=null;switch(t){case At:n=new Int8Array(e(r),0,r);break;case wt:n=new Uint8Array(e(r),0,r);break;case Ct:n=new Int16Array(e(2*r),0,r);break;case Rt:n=new Uint16Array(e(2*r),0,r);break;case Lt:n=new Int32Array(e(4*r),0,r);break;case It:n=new Uint32Array(e(4*r),0,r);break;case Mt:n=new Float32Array(e(4*r),0,r);break;default:return null}return n.length!==r?n.subarray(0,r):n}function i(t){r(t.buffer)}return{alloc:e,free:r,allocType:n,freeType:i}}var Bt=Dt();Bt.zero=Dt();var Nt=3408,Ft=3410,kt=3411,Ut=3412,zt=3413,Gt=3414,jt=3415,Vt=33901,Ht=33902,Wt=3379,Xt=3386,Zt=34921,qt=36347,Yt=36348,Kt=35661,$t=35660,Qt=34930,Jt=36349,te=34076,ee=34024,re=7936,ne=7937,ie=7938,oe=35724,ae=34047,se=36063,le=34852,ue=3553,ce=34067,he=34069,pe=33984,de=6408,fe=5126,me=5121,ge=36160,_e=36053,ve=36064,ye=16384,xe=function(t,e){var r=1;e.ext_texture_filter_anisotropic&&(r=t.getParameter(ae));var n=1,i=1;e.webgl_draw_buffers&&(n=t.getParameter(le),i=t.getParameter(se));var o=!!e.oes_texture_float;if(o){var a=t.createTexture();t.bindTexture(ue,a),t.texImage2D(ue,0,de,1,1,0,de,fe,null);var s=t.createFramebuffer();if(t.bindFramebuffer(ge,s),t.framebufferTexture2D(ge,ve,ue,a,0),t.bindTexture(ue,null),t.checkFramebufferStatus(ge)!==_e)o=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(ye);var l=Bt.allocType(fe,4);t.readPixels(0,0,1,1,de,fe,l),t.getError()?o=!1:(t.deleteFramebuffer(s),t.deleteTexture(a),o=1===l[0]),Bt.freeType(l)}}var u=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=t.createTexture(),h=Bt.allocType(me,36);t.activeTexture(pe),t.bindTexture(ce,c),t.texImage2D(he,0,de,3,3,0,de,me,h),Bt.freeType(h),t.bindTexture(ce,null),t.deleteTexture(c),u=!t.getError()}return{colorBits:[t.getParameter(Ft),t.getParameter(kt),t.getParameter(Ut),t.getParameter(zt)],depthBits:t.getParameter(Gt),stencilBits:t.getParameter(jt),subpixelBits:t.getParameter(Nt),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:i,pointSizeDims:t.getParameter(Vt),lineWidthDims:t.getParameter(Ht),maxViewportDims:t.getParameter(Xt),maxCombinedTextureUnits:t.getParameter(Kt),maxCubeMapSize:t.getParameter(te),maxRenderbufferSize:t.getParameter(ee),maxTextureUnits:t.getParameter(Qt),maxTextureSize:t.getParameter(Wt),maxAttributes:t.getParameter(Zt),maxVertexUniforms:t.getParameter(qt),maxVertexTextureUnits:t.getParameter($t),maxVaryingVectors:t.getParameter(Yt),maxFragmentUniforms:t.getParameter(Jt),glsl:t.getParameter(oe),renderer:t.getParameter(ne),vendor:t.getParameter(re),version:t.getParameter(ie),readFloat:o,npotTextureCube:u}};function be(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}var Ee=function(t){return Object.keys(t).map((function(e){return t[e]}))},Te={shape:Le,flatten:Re};function Se(t,e,r){for(var n=0;n<e;++n)r[n]=t[n]}function Ae(t,e,r,n){for(var i=0,o=0;o<e;++o)for(var a=t[o],s=0;s<r;++s)n[i++]=a[s]}function we(t,e,r,n,i,o){for(var a=o,s=0;s<e;++s)for(var l=t[s],u=0;u<r;++u)for(var c=l[u],h=0;h<n;++h)i[a++]=c[h]}function Ce(t,e,r,n,i){for(var o=1,a=r+1;a<e.length;++a)o*=e[a];var s=e[r];if(e.length-r==4){var l=e[r+1],u=e[r+2],c=e[r+3];for(a=0;a<s;++a)we(t[a],l,u,c,n,i),i+=o}else for(a=0;a<s;++a)Ce(t[a],e,r+1,n,i),i+=o}function Re(t,e,r,n){var i=1;if(e.length)for(var o=0;o<e.length;++o)i*=e[o];else i=0;var a=n||Bt.allocType(r,i);switch(e.length){case 0:break;case 1:Se(t,e[0],a);break;case 2:Ae(t,e[0],e[1],a);break;case 3:we(t,e[0],e[1],e[2],a,0);break;default:Ce(t,e,0,a,0)}return a}function Le(t){for(var e=[],r=t;r.length;r=r[0])e.push(r.length);return e}var Ie={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Me={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Oe={dynamic:35048,stream:35040,static:35044},Pe=Te.flatten,De=Te.shape,Be=35044,Ne=35040,Fe=5121,ke=5126,Ue=[];function ze(t){return 0|Ie[Object.prototype.toString.call(t)]}function Ge(t,e){for(var r=0;r<e.length;++r)t[r]=e[r]}function je(t,e,r,n,i,o,a){for(var s=0,l=0;l<r;++l)for(var u=0;u<n;++u)t[s++]=e[i*l+o*u+a]}function Ve(e,r,n,i){var o=0,a={};function s(t){this.id=o++,this.buffer=e.createBuffer(),this.type=t,this.usage=Be,this.byteLength=0,this.dimension=1,this.dtype=Fe,this.persistentData=null,n.profile&&(this.stats={size:0})}s.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){d(this)};var l=[];function u(t,e){var r=l.pop();return r||(r=new s(t)),r.bind(),p(r,e,Ne,0,1,!1),r}function c(t){l.push(t)}function h(t,r,n){t.byteLength=r.byteLength,e.bufferData(t.type,r,n)}function p(e,r,n,i,o,a){var s,l;if(e.usage=n,Array.isArray(r)){if(e.dtype=i||ke,r.length>0)if(Array.isArray(r[0])){s=De(r);for(var u=1,c=1;c<s.length;++c)u*=s[c];e.dimension=u,h(e,l=Pe(r,s,e.dtype),n),a?e.persistentData=l:Bt.freeType(l)}else if("number"==typeof r[0]){e.dimension=o;var p=Bt.allocType(e.dtype,r.length);Ge(p,r),h(e,p,n),a?e.persistentData=p:Bt.freeType(p)}else t(r[0])?(e.dimension=r[0].length,e.dtype=i||ze(r[0])||ke,h(e,l=Pe(r,[r.length,r[0].length],e.dtype),n),a?e.persistentData=l:Bt.freeType(l)):rt.raise("invalid buffer data")}else if(t(r))e.dtype=i||ze(r),e.dimension=o,h(e,r,n),a&&(e.persistentData=new Uint8Array(new Uint8Array(r.buffer)));else if(be(r)){s=r.shape;var d=r.stride,f=r.offset,m=0,g=0,_=0,v=0;1===s.length?(m=s[0],g=1,_=d[0],v=0):2===s.length?(m=s[0],g=s[1],_=d[0],v=d[1]):rt.raise("invalid shape"),e.dtype=i||ze(r.data)||ke,e.dimension=g;var y=Bt.allocType(e.dtype,m*g);je(y,r.data,m,g,_,v,f),h(e,y,n),a?e.persistentData=y:Bt.freeType(y)}else r instanceof ArrayBuffer?(e.dtype=Fe,e.dimension=o,h(e,r,n),a&&(e.persistentData=new Uint8Array(new Uint8Array(r)))):rt.raise("invalid buffer data")}function d(t){r.bufferCount--,i(t);var n=t.buffer;rt(n,"buffer must not be deleted already"),e.deleteBuffer(n),t.buffer=null,delete a[t.id]}function f(i,o,l,u){r.bufferCount++;var c=new s(o);function h(r){var i=Be,o=null,a=0,s=0,l=1;return Array.isArray(r)||t(r)||be(r)||r instanceof ArrayBuffer?o=r:"number"==typeof r?a=0|r:r&&(rt.type(r,"object","buffer arguments must be an object, a number or an array"),"data"in r&&(rt(null===o||Array.isArray(o)||t(o)||be(o),"invalid data for buffer"),o=r.data),"usage"in r&&(rt.parameter(r.usage,Oe,"invalid buffer usage"),i=Oe[r.usage]),"type"in r&&(rt.parameter(r.type,Me,"invalid buffer type"),s=Me[r.type]),"dimension"in r&&(rt.type(r.dimension,"number","invalid dimension"),l=0|r.dimension),"length"in r&&(rt.nni(a,"buffer length must be a nonnegative integer"),a=0|r.length)),c.bind(),o?p(c,o,i,s,l,u):(a&&e.bufferData(c.type,a,i),c.dtype=s||Fe,c.usage=i,c.dimension=l,c.byteLength=a),n.profile&&(c.stats.size=c.byteLength*Ue[c.dtype]),h}function f(t,r){rt(r+t.byteLength<=c.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+r+" to a buffer of size "+c.byteLength),e.bufferSubData(c.type,r,t)}function m(e,r){var n,i=0|(r||0);if(c.bind(),t(e)||e instanceof ArrayBuffer)f(e,i);else if(Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var o=Bt.allocType(c.dtype,e.length);Ge(o,e),f(o,i),Bt.freeType(o)}else if(Array.isArray(e[0])||t(e[0])){n=De(e);var a=Pe(e,n,c.dtype);f(a,i),Bt.freeType(a)}else rt.raise("invalid buffer data")}else if(be(e)){n=e.shape;var s=e.stride,l=0,u=0,p=0,d=0;1===n.length?(l=n[0],u=1,p=s[0],d=0):2===n.length?(l=n[0],u=n[1],p=s[0],d=s[1]):rt.raise("invalid shape");var m=Array.isArray(e.data)?c.dtype:ze(e.data),g=Bt.allocType(m,l*u);je(g,e.data,l,u,p,d,e.offset),f(g,i),Bt.freeType(g)}else rt.raise("invalid data for buffer subdata");return h}return a[c.id]=c,l||h(i),h._reglType="buffer",h._buffer=c,h.subdata=m,n.profile&&(h.stats=c.stats),h.destroy=function(){d(c)},h}function m(){Ee(a).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))}return n.profile&&(r.getTotalBufferSize=function(){var t=0;return Object.keys(a).forEach((function(e){t+=a[e].stats.size})),t}),{create:f,createStream:u,destroyStream:c,clear:function(){Ee(a).forEach(d),l.forEach(d)},getBuffer:function(t){return t&&t._buffer instanceof s?t._buffer:null},restore:m,_initBuffer:p}}Ue[5120]=1,Ue[5122]=2,Ue[5124]=4,Ue[5121]=1,Ue[5123]=2,Ue[5125]=4,Ue[5126]=4;var He=4,We={points:0,point:0,lines:1,line:1,triangles:4,triangle:He,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Xe=0,Ze=1,qe=4,Ye=5120,Ke=5121,$e=5122,Qe=5123,Je=5124,tr=5125,er=34963,rr=35040,nr=35044;function ir(e,r,n,i){var o={},a=0,s={uint8:Ke,uint16:Qe};function l(t){this.id=a++,o[this.id]=this,this.buffer=t,this.primType=qe,this.vertCount=0,this.type=0}r.oes_element_index_uint&&(s.uint32=tr),l.prototype.bind=function(){this.buffer.bind()};var u=[];function c(t){var e=u.pop();return e||(e=new l(n.create(null,er,!0,!1)._buffer)),p(e,t,rr,-1,-1,0,0),e}function h(t){u.push(t)}function p(i,o,a,s,l,u,c){var h;if(i.buffer.bind(),o){var p=c;c||t(o)&&(!be(o)||t(o.data))||(p=r.oes_element_index_uint?tr:Qe),n._initBuffer(i.buffer,o,a,p,3)}else e.bufferData(er,u,a),i.buffer.dtype=h||Ke,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=u;if(h=c,!c){switch(i.buffer.dtype){case Ke:case Ye:h=Ke;break;case Qe:case $e:h=Qe;break;case tr:case Je:h=tr;break;default:rt.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,rt(h!==tr||!!r.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var d=l;d<0&&(d=i.buffer.byteLength,h===Qe?d>>=1:h===tr&&(d>>=2)),i.vertCount=d;var f=s;if(s<0){f=qe;var m=i.buffer.dimension;1===m&&(f=Xe),2===m&&(f=Ze),3===m&&(f=qe)}i.primType=f}function d(t){i.elementsCount--,rt(null!==t.buffer,"must not double destroy elements"),delete o[t.id],t.buffer.destroy(),t.buffer=null}function f(e,r){var o=n.create(null,er,!0),a=new l(o._buffer);function u(e){if(e)if("number"==typeof e)o(e),a.primType=qe,a.vertCount=0|e,a.type=Ke;else{var r=null,n=nr,i=-1,l=-1,c=0,h=0;Array.isArray(e)||t(e)||be(e)?r=e:(rt.type(e,"object","invalid arguments for elements"),"data"in e&&(r=e.data,rt(Array.isArray(r)||t(r)||be(r),"invalid data for element buffer")),"usage"in e&&(rt.parameter(e.usage,Oe,"invalid element buffer usage"),n=Oe[e.usage]),"primitive"in e&&(rt.parameter(e.primitive,We,"invalid element buffer primitive"),i=We[e.primitive]),"count"in e&&(rt("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),l=0|e.count),"type"in e&&(rt.parameter(e.type,s,"invalid buffer type"),h=s[e.type]),"length"in e?c=0|e.length:(c=l,h===Qe||h===$e?c*=2:h!==tr&&h!==Je||(c*=4))),p(a,r,n,i,l,c,h)}else o(),a.primType=qe,a.vertCount=0,a.type=Ke;return u}return i.elementsCount++,u(e),u._reglType="elements",u._elements=a,u.subdata=function(t,e){return o.subdata(t,e),u},u.destroy=function(){d(a)},u}return{create:f,createStream:c,destroyStream:h,getElements:function(t){return"function"==typeof t&&t._elements instanceof l?t._elements:null},clear:function(){Ee(o).forEach(d)}}}var or=new Float32Array(1),ar=new Uint32Array(or.buffer),sr=5123;function lr(t){for(var e=Bt.allocType(sr,t.length),r=0;r<t.length;++r)if(isNaN(t[r]))e[r]=65535;else if(t[r]===1/0)e[r]=31744;else if(t[r]===-1/0)e[r]=64512;else{or[0]=t[r];var n=ar[0],i=n>>>31<<15,o=(n<<1>>>24)-127,a=n>>13&1023;if(o<-24)e[r]=i;else if(o<-14){var s=-14-o;e[r]=i+(a+1024>>s)}else e[r]=o>15?i+31744:i+(o+15<<10)+a}return e}function ur(e){return Array.isArray(e)||t(e)}var cr=function(t){return!(t&t-1||!t)},hr=34467,pr=3553,dr=34067,fr=34069,mr=6408,gr=6406,_r=6407,vr=6409,yr=6410,xr=32854,br=32855,Er=36194,Tr=32819,Sr=32820,Ar=33635,wr=34042,Cr=6402,Rr=34041,Lr=35904,Ir=35906,Mr=36193,Or=33776,Pr=33777,Dr=33778,Br=33779,Nr=35986,Fr=35987,kr=34798,Ur=35840,zr=35841,Gr=35842,jr=35843,Vr=36196,Hr=5121,Wr=5123,Xr=5125,Zr=5126,qr=10242,Yr=10243,Kr=10497,$r=33071,Qr=33648,Jr=10240,tn=10241,en=9728,rn=9729,nn=9984,on=9985,an=9986,sn=9987,ln=33170,un=4352,cn=4353,hn=4354,pn=34046,dn=3317,fn=37440,mn=37441,gn=37443,_n=37444,vn=33984,yn=[nn,an,on,sn],xn=[0,vr,yr,_r,mr],bn={};function En(t){return"[object "+t+"]"}bn[vr]=bn[gr]=bn[Cr]=1,bn[Rr]=bn[yr]=2,bn[_r]=bn[Lr]=3,bn[mr]=bn[Ir]=4;var Tn=En("HTMLCanvasElement"),Sn=En("OffscreenCanvas"),An=En("CanvasRenderingContext2D"),wn=En("ImageBitmap"),Cn=En("HTMLImageElement"),Rn=En("HTMLVideoElement"),Ln=Object.keys(Ie).concat([Tn,Sn,An,wn,Cn,Rn]),In=[];In[Hr]=1,In[Zr]=4,In[Mr]=2,In[Wr]=2,In[Xr]=4;var Mn=[];function On(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function Pn(t){return!!Array.isArray(t)&&!(0===t.length||!ur(t[0]))}function Dn(t){return Object.prototype.toString.call(t)}function Bn(t){return Dn(t)===Tn}function Nn(t){return Dn(t)===Sn}function Fn(t){return Dn(t)===An}function kn(t){return Dn(t)===wn}function Un(t){return Dn(t)===Cn}function zn(t){return Dn(t)===Rn}function Gn(t){if(!t)return!1;var e=Dn(t);return Ln.indexOf(e)>=0||On(t)||Pn(t)||be(t)}function jn(t){return 0|Ie[Object.prototype.toString.call(t)]}function Vn(t,e){var r=e.length;switch(t.type){case Hr:case Wr:case Xr:case Zr:var n=Bt.allocType(t.type,r);n.set(e),t.data=n;break;case Mr:t.data=lr(e);break;default:rt.raise("unsupported texture type, must specify a typed array")}}function Hn(t,e){return Bt.allocType(t.type===Mr?Zr:t.type,e)}function Wn(t,e){t.type===Mr?(t.data=lr(e),Bt.freeType(e)):t.data=e}function Xn(t,e,r,n,i,o){for(var a=t.width,s=t.height,l=t.channels,u=Hn(t,a*s*l),c=0,h=0;h<s;++h)for(var p=0;p<a;++p)for(var d=0;d<l;++d)u[c++]=e[r*p+n*h+i*d+o];Wn(t,u)}function Zn(t,e,r,n,i,o){var a;if(a=void 0!==Mn[t]?Mn[t]:bn[t]*In[e],o&&(a*=6),i){for(var s=0,l=r;l>=1;)s+=a*l*l,l/=2;return s}return a*r*n}function qn(r,n,i,o,a,s,l){var u={"don't care":un,"dont care":un,nice:hn,fast:cn},c={repeat:Kr,clamp:$r,mirror:Qr},h={nearest:en,linear:rn},p=e({mipmap:sn,"nearest mipmap nearest":nn,"linear mipmap nearest":on,"nearest mipmap linear":an,"linear mipmap linear":sn},h),d={none:0,browser:_n},f={uint8:Hr,rgba4:Tr,rgb565:Ar,"rgb5 a1":Sr},m={alpha:gr,luminance:vr,"luminance alpha":yr,rgb:_r,rgba:mr,rgba4:xr,"rgb5 a1":br,rgb565:Er},g={};n.ext_srgb&&(m.srgb=Lr,m.srgba=Ir),n.oes_texture_float&&(f.float32=f.float=Zr),n.oes_texture_half_float&&(f.float16=f["half float"]=Mr),n.webgl_depth_texture&&(e(m,{depth:Cr,"depth stencil":Rr}),e(f,{uint16:Wr,uint32:Xr,"depth stencil":wr})),n.webgl_compressed_texture_s3tc&&e(g,{"rgb s3tc dxt1":Or,"rgba s3tc dxt1":Pr,"rgba s3tc dxt3":Dr,"rgba s3tc dxt5":Br}),n.webgl_compressed_texture_atc&&e(g,{"rgb atc":Nr,"rgba atc explicit alpha":Fr,"rgba atc interpolated alpha":kr}),n.webgl_compressed_texture_pvrtc&&e(g,{"rgb pvrtc 4bppv1":Ur,"rgb pvrtc 2bppv1":zr,"rgba pvrtc 4bppv1":Gr,"rgba pvrtc 2bppv1":jr}),n.webgl_compressed_texture_etc1&&(g["rgb etc1"]=Vr);var _=Array.prototype.slice.call(r.getParameter(hr));Object.keys(g).forEach((function(t){var e=g[t];_.indexOf(e)>=0&&(m[t]=e)}));var v=Object.keys(m);i.textureFormats=v;var y=[];Object.keys(m).forEach((function(t){var e=m[t];y[e]=t}));var x=[];Object.keys(f).forEach((function(t){var e=f[t];x[e]=t}));var b=[];Object.keys(h).forEach((function(t){var e=h[t];b[e]=t}));var E=[];Object.keys(p).forEach((function(t){var e=p[t];E[e]=t}));var T=[];Object.keys(c).forEach((function(t){var e=c[t];T[e]=t}));var S=v.reduce((function(t,e){var r=m[e];return r===vr||r===gr||r===vr||r===yr||r===Cr||r===Rr||n.ext_srgb&&(r===Lr||r===Ir)?t[r]=r:r===br||e.indexOf("rgba")>=0?t[r]=mr:t[r]=_r,t}),{});function A(){this.internalformat=mr,this.format=mr,this.type=Hr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=_n,this.width=0,this.height=0,this.channels=0}function w(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function C(t,e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(rt.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(rt.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(rt.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(rt.parameter(e.colorSpace,d,"invalid colorSpace"),t.colorSpace=d[e.colorSpace]),"type"in e){var r=e.type;rt(n.oes_texture_float||!("float"===r||"float32"===r),"you must enable the OES_texture_float extension in order to use floating point textures."),rt(n.oes_texture_half_float||!("half float"===r||"float16"===r),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),rt(n.webgl_depth_texture||!("uint16"===r||"uint32"===r||"depth stencil"===r),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),rt.parameter(r,f,"invalid texture type"),t.type=f[r]}var o=t.width,a=t.height,s=t.channels,l=!1;"shape"in e?(rt(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),o=e.shape[0],a=e.shape[1],3===e.shape.length&&(s=e.shape[2],rt(s>0&&s<=4,"invalid number of channels"),l=!0),rt(o>=0&&o<=i.maxTextureSize,"invalid width"),rt(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in e&&(o=a=e.radius,rt(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in e&&(o=e.width,rt(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in e&&(a=e.height,rt(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in e&&(s=e.channels,rt(s>0&&s<=4,"invalid number of channels"),l=!0)),t.width=0|o,t.height=0|a,t.channels=0|s;var u=!1;if("format"in e){var c=e.format;rt(n.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),rt.parameter(c,m,"invalid texture format");var h=t.internalformat=m[c];t.format=S[h],c in f&&("type"in e||(t.type=f[c])),c in g&&(t.compressed=!0),u=!0}!l&&u?t.channels=bn[t.format]:l&&!u?t.channels!==xn[t.format]&&(t.format=t.internalformat=xn[t.channels]):u&&l&&rt(t.channels===bn[t.format],"number of channels inconsistent with specified format")}}function R(t){r.pixelStorei(fn,t.flipY),r.pixelStorei(mn,t.premultiplyAlpha),r.pixelStorei(gn,t.colorSpace),r.pixelStorei(dn,t.unpackAlignment)}function L(){A.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function I(e,r){var n=null;if(Gn(r)?n=r:r&&(rt.type(r,"object","invalid pixel data type"),C(e,r),"x"in r&&(e.xOffset=0|r.x),"y"in r&&(e.yOffset=0|r.y),Gn(r.data)&&(n=r.data)),rt(!e.compressed||n instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),r.copy){rt(!n,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;e.width=e.width||o-e.xOffset,e.height=e.height||s-e.yOffset,e.needsCopy=!0,rt(e.xOffset>=0&&e.xOffset<o&&e.yOffset>=0&&e.yOffset<s&&e.width>0&&e.width<=o&&e.height>0&&e.height<=s,"copy texture read out of bounds")}else if(n){if(t(n))e.channels=e.channels||4,e.data=n,"type"in r||e.type!==Hr||(e.type=jn(n));else if(On(n))e.channels=e.channels||4,Vn(e,n),e.alignment=1,e.needsFree=!0;else if(be(n)){var l=n.data;Array.isArray(l)||e.type!==Hr||(e.type=jn(l));var u,c,h,p,d,f,m=n.shape,g=n.stride;3===m.length?(h=m[2],f=g[2]):(rt(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,f=1),u=m[0],c=m[1],p=g[0],d=g[1],e.alignment=1,e.width=u,e.height=c,e.channels=h,e.format=e.internalformat=xn[h],e.needsFree=!0,Xn(e,l,p,d,f,n.offset)}else if(Bn(n)||Nn(n)||Fn(n))Bn(n)||Nn(n)?e.element=n:e.element=n.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(kn(n))e.element=n,e.width=n.width,e.height=n.height,e.channels=4;else if(Un(n))e.element=n,e.width=n.naturalWidth,e.height=n.naturalHeight,e.channels=4;else if(zn(n))e.element=n,e.width=n.videoWidth,e.height=n.videoHeight,e.channels=4;else if(Pn(n)){var _=e.width||n[0].length,v=e.height||n.length,y=e.channels;y=ur(n[0][0])?y||n[0][0].length:y||1;for(var x=Te.shape(n),b=1,E=0;E<x.length;++E)b*=x[E];var T=Hn(e,b);Te.flatten(n,x,"",T),Wn(e,T),e.alignment=1,e.width=_,e.height=v,e.channels=y,e.format=e.internalformat=xn[y],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;e.type===Zr?rt(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===Mr&&rt(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function M(t,e,n){var i=t.element,a=t.data,s=t.internalformat,l=t.format,u=t.type,c=t.width,h=t.height;R(t),i?r.texImage2D(e,n,l,l,u,i):t.compressed?r.compressedTexImage2D(e,n,s,c,h,0,a):t.needsCopy?(o(),r.copyTexImage2D(e,n,l,t.xOffset,t.yOffset,c,h,0)):r.texImage2D(e,n,l,c,h,0,l,u,a||null)}function O(t,e,n,i,a){var s=t.element,l=t.data,u=t.internalformat,c=t.format,h=t.type,p=t.width,d=t.height;R(t),s?r.texSubImage2D(e,a,n,i,c,h,s):t.compressed?r.compressedTexSubImage2D(e,a,n,i,u,p,d,l):t.needsCopy?(o(),r.copyTexSubImage2D(e,a,n,i,t.xOffset,t.yOffset,p,d)):r.texSubImage2D(e,a,n,i,p,d,c,h,l)}var P=[];function D(){return P.pop()||new L}function B(t){t.needsFree&&Bt.freeType(t.data),L.call(t),P.push(t)}function N(){A.call(this),this.genMipmaps=!1,this.mipmapHint=un,this.mipmask=0,this.images=Array(16)}function F(t,e,r){var n=t.images[0]=D();t.mipmask=1,n.width=t.width=e,n.height=t.height=r,n.channels=t.channels=4}function k(t,e){var r=null;if(Gn(e))w(r=t.images[0]=D(),t),I(r,e),t.mipmask=1;else if(C(t,e),Array.isArray(e.mipmap))for(var n=e.mipmap,i=0;i<n.length;++i)w(r=t.images[i]=D(),t),r.width>>=i,r.height>>=i,I(r,n[i]),t.mipmask|=1<<i;else w(r=t.images[0]=D(),t),I(r,e),t.mipmask=1;w(t,t.images[0]),!t.compressed||t.internalformat!==Or&&t.internalformat!==Pr&&t.internalformat!==Dr&&t.internalformat!==Br||rt(t.width%4==0&&t.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function U(t,e){for(var r=t.images,n=0;n<r.length;++n){if(!r[n])return;M(r[n],e,n)}}var z=[];function G(){var t=z.pop()||new N;A.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function j(t){for(var e=t.images,r=0;r<e.length;++r)e[r]&&B(e[r]),e[r]=null;z.push(t)}function V(){this.minFilter=en,this.magFilter=en,this.wrapS=$r,this.wrapT=$r,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=un}function H(t,e){if("min"in e){var r=e.min;rt.parameter(r,p),t.minFilter=p[r],yn.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var n=e.mag;rt.parameter(n,h),t.magFilter=h[n]}var o=t.wrapS,a=t.wrapT;if("wrap"in e){var s=e.wrap;"string"==typeof s?(rt.parameter(s,c),o=a=c[s]):Array.isArray(s)&&(rt.parameter(s[0],c),rt.parameter(s[1],c),o=c[s[0]],a=c[s[1]])}else{if("wrapS"in e){var l=e.wrapS;rt.parameter(l,c),o=c[l]}if("wrapT"in e){var d=e.wrapT;rt.parameter(d,c),a=c[d]}}if(t.wrapS=o,t.wrapT=a,"anisotropic"in e){var f=e.anisotropic;rt("number"==typeof f&&f>=1&&f<=i.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var m=!1;switch(typeof e.mipmap){case"string":rt.parameter(e.mipmap,u,"invalid mipmap hint"),t.mipmapHint=u[e.mipmap],t.genMipmaps=!0,m=!0;break;case"boolean":m=t.genMipmaps=e.mipmap;break;case"object":rt(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,m=!0;break;default:rt.raise("invalid mipmap type")}m&&!("min"in e)&&(t.minFilter=nn)}}function W(t,e){r.texParameteri(e,tn,t.minFilter),r.texParameteri(e,Jr,t.magFilter),r.texParameteri(e,qr,t.wrapS),r.texParameteri(e,Yr,t.wrapT),n.ext_texture_filter_anisotropic&&r.texParameteri(e,pn,t.anisotropic),t.genMipmaps&&(r.hint(ln,t.mipmapHint),r.generateMipmap(e))}var X=0,Z={},q=i.maxTextureUnits,Y=Array(q).map((function(){return null}));function K(t){A.call(this),this.mipmask=0,this.internalformat=mr,this.id=X++,this.refCount=1,this.target=t,this.texture=r.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new V,l.profile&&(this.stats={size:0})}function $(t){r.activeTexture(vn),r.bindTexture(t.target,t.texture)}function Q(){var t=Y[0];t?r.bindTexture(t.target,t.texture):r.bindTexture(pr,null)}function J(t){var e=t.texture;rt(e,"must not double destroy texture");var n=t.unit,i=t.target;n>=0&&(r.activeTexture(vn+n),r.bindTexture(i,null),Y[n]=null),r.deleteTexture(e),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete Z[t.id],s.textureCount--}function tt(t,e){var n=new K(pr);function o(t,e){var r=n.texInfo;V.call(r);var a=G();return"number"==typeof t?F(a,0|t,"number"==typeof e?0|e:0|t):t?(rt.type(t,"object","invalid arguments to regl.texture"),H(r,t),k(a,t)):F(a,1,1),r.genMipmaps&&(a.mipmask=(a.width<<1)-1),n.mipmask=a.mipmask,w(n,a),rt.texture2D(r,a,i),n.internalformat=a.internalformat,o.width=a.width,o.height=a.height,$(n),U(a,pr),W(r,pr),Q(),j(a),l.profile&&(n.stats.size=Zn(n.internalformat,n.type,a.width,a.height,r.genMipmaps,!1)),o.format=y[n.internalformat],o.type=x[n.type],o.mag=b[r.magFilter],o.min=E[r.minFilter],o.wrapS=T[r.wrapS],o.wrapT=T[r.wrapT],o}function a(t,e,r,i){rt(!!t,"must specify image data");var a=0|e,s=0|r,l=0|i,u=D();return w(u,n),u.width=0,u.height=0,I(u,t),u.width=u.width||(n.width>>l)-a,u.height=u.height||(n.height>>l)-s,rt(n.type===u.type&&n.format===u.format&&n.internalformat===u.internalformat,"incompatible format for texture.subimage"),rt(a>=0&&s>=0&&a+u.width<=n.width&&s+u.height<=n.height,"texture.subimage write out of bounds"),rt(n.mipmask&1<<l,"missing mipmap data"),rt(u.data||u.element||u.needsCopy,"missing image data"),$(n),O(u,pr,a,s,l),Q(),B(u),o}function u(t,e){var i=0|t,a=0|e||i;if(i===n.width&&a===n.height)return o;o.width=n.width=i,o.height=n.height=a,$(n);for(var s=0;n.mipmask>>s;++s){var u=i>>s,c=a>>s;if(!u||!c)break;r.texImage2D(pr,s,n.format,u,c,0,n.format,n.type,null)}return Q(),l.profile&&(n.stats.size=Zn(n.internalformat,n.type,i,a,!1,!1)),o}return Z[n.id]=n,s.textureCount++,o(t,e),o.subimage=a,o.resize=u,o._reglType="texture2d",o._texture=n,l.profile&&(o.stats=n.stats),o.destroy=function(){n.decRef()},o}function et(t,e,n,o,a,u){var c=new K(dr);Z[c.id]=c,s.cubeCount++;var h=new Array(6);function p(t,e,r,n,o,a){var s,u=c.texInfo;for(V.call(u),s=0;s<6;++s)h[s]=G();if("number"!=typeof t&&t)if("object"==typeof t)if(e)k(h[0],t),k(h[1],e),k(h[2],r),k(h[3],n),k(h[4],o),k(h[5],a);else if(H(u,t),C(c,t),"faces"in t){var d=t.faces;for(rt(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),s=0;s<6;++s)rt("object"==typeof d[s]&&!!d[s],"invalid input for cube map face"),w(h[s],c),k(h[s],d[s])}else for(s=0;s<6;++s)k(h[s],t);else rt.raise("invalid arguments to cube map");else{var f=0|t||1;for(s=0;s<6;++s)F(h[s],f,f)}for(w(c,h[0]),i.npotTextureCube||rt(cr(c.width)&&cr(c.height),"your browser does not support non power or two texture dimensions"),u.genMipmaps?c.mipmask=(h[0].width<<1)-1:c.mipmask=h[0].mipmask,rt.textureCube(c,u,h,i),c.internalformat=h[0].internalformat,p.width=h[0].width,p.height=h[0].height,$(c),s=0;s<6;++s)U(h[s],fr+s);for(W(u,dr),Q(),l.profile&&(c.stats.size=Zn(c.internalformat,c.type,p.width,p.height,u.genMipmaps,!0)),p.format=y[c.internalformat],p.type=x[c.type],p.mag=b[u.magFilter],p.min=E[u.minFilter],p.wrapS=T[u.wrapS],p.wrapT=T[u.wrapT],s=0;s<6;++s)j(h[s]);return p}function d(t,e,r,n,i){rt(!!e,"must specify image data"),rt("number"==typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var o=0|r,a=0|n,s=0|i,l=D();return w(l,c),l.width=0,l.height=0,I(l,e),l.width=l.width||(c.width>>s)-o,l.height=l.height||(c.height>>s)-a,rt(c.type===l.type&&c.format===l.format&&c.internalformat===l.internalformat,"incompatible format for texture.subimage"),rt(o>=0&&a>=0&&o+l.width<=c.width&&a+l.height<=c.height,"texture.subimage write out of bounds"),rt(c.mipmask&1<<s,"missing mipmap data"),rt(l.data||l.element||l.needsCopy,"missing image data"),$(c),O(l,fr+t,o,a,s),Q(),B(l),p}function f(t){var e=0|t;if(e!==c.width){p.width=c.width=e,p.height=c.height=e,$(c);for(var n=0;n<6;++n)for(var i=0;c.mipmask>>i;++i)r.texImage2D(fr+n,i,c.format,e>>i,e>>i,0,c.format,c.type,null);return Q(),l.profile&&(c.stats.size=Zn(c.internalformat,c.type,p.width,p.height,!1,!0)),p}}return p(t,e,n,o,a,u),p.subimage=d,p.resize=f,p._reglType="textureCube",p._texture=c,l.profile&&(p.stats=c.stats),p.destroy=function(){c.decRef()},p}function nt(){for(var t=0;t<q;++t)r.activeTexture(vn+t),r.bindTexture(pr,null),Y[t]=null;Ee(Z).forEach(J),s.cubeCount=0,s.textureCount=0}function it(){for(var t=0;t<q;++t){var e=Y[t];e&&(e.bindCount=0,e.unit=-1,Y[t]=null)}Ee(Z).forEach((function(t){t.texture=r.createTexture(),r.bindTexture(t.target,t.texture);for(var e=0;e<32;++e)if(t.mipmask&1<<e)if(t.target===pr)r.texImage2D(pr,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);else for(var n=0;n<6;++n)r.texImage2D(fr+n,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);W(t.texInfo,t.target)}))}return e(K.prototype,{bind:function(){var t=this;t.bindCount+=1;var e=t.unit;if(e<0){for(var n=0;n<q;++n){var i=Y[n];if(i){if(i.bindCount>0)continue;i.unit=-1}Y[n]=t,e=n;break}e>=q&&rt.raise("insufficient number of texture units"),l.profile&&s.maxTextureUnits<e+1&&(s.maxTextureUnits=e+1),t.unit=e,r.activeTexture(vn+e),r.bindTexture(t.target,t.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&J(this)}}),l.profile&&(s.getTotalTextureSize=function(){var t=0;return Object.keys(Z).forEach((function(e){t+=Z[e].stats.size})),t}),{create2D:tt,createCube:et,clear:nt,getTexture:function(t){return null},restore:it}}Mn[xr]=2,Mn[br]=2,Mn[Er]=2,Mn[Rr]=4,Mn[Or]=.5,Mn[Pr]=.5,Mn[Dr]=1,Mn[Br]=1,Mn[Nr]=.5,Mn[Fr]=1,Mn[kr]=1,Mn[Ur]=.5,Mn[zr]=.25,Mn[Gr]=.5,Mn[jr]=.25,Mn[Vr]=.5;var Yn=36161,Kn=32854,$n=32855,Qn=36194,Jn=33189,ti=36168,ei=34041,ri=35907,ni=34836,ii=34842,oi=34843,ai=[];function si(t,e,r){return ai[t]*e*r}ai[Kn]=2,ai[$n]=2,ai[Qn]=2,ai[Jn]=2,ai[ti]=1,ai[ei]=4,ai[ri]=4,ai[ni]=16,ai[ii]=8,ai[oi]=6;var li=function(t,e,r,n,i){var o={rgba4:Kn,rgb565:Qn,"rgb5 a1":$n,depth:Jn,stencil:ti,"depth stencil":ei};e.ext_srgb&&(o.srgba=ri),e.ext_color_buffer_half_float&&(o.rgba16f=ii,o.rgb16f=oi),e.webgl_color_buffer_float&&(o.rgba32f=ni);var a=[];Object.keys(o).forEach((function(t){var e=o[t];a[e]=t}));var s=0,l={};function u(t){this.id=s++,this.refCount=1,this.renderbuffer=t,this.format=Kn,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(e){var r=e.renderbuffer;rt(r,"must not double destroy renderbuffer"),t.bindRenderbuffer(Yn,null),t.deleteRenderbuffer(r),e.renderbuffer=null,e.refCount=0,delete l[e.id],n.renderbufferCount--}function h(e,s){var c=new u(t.createRenderbuffer());function h(e,n){var s=0,l=0,u=Kn;if("object"==typeof e&&e){var p=e;if("shape"in p){var d=p.shape;rt(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),s=0|d[0],l=0|d[1]}else"radius"in p&&(s=l=0|p.radius),"width"in p&&(s=0|p.width),"height"in p&&(l=0|p.height);"format"in p&&(rt.parameter(p.format,o,"invalid renderbuffer format"),u=o[p.format])}else"number"==typeof e?(s=0|e,l="number"==typeof n?0|n:s):e?rt.raise("invalid arguments to renderbuffer constructor"):s=l=1;if(rt(s>0&&l>0&&s<=r.maxRenderbufferSize&&l<=r.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||l!==c.height||u!==c.format)return h.width=c.width=s,h.height=c.height=l,c.format=u,t.bindRenderbuffer(Yn,c.renderbuffer),t.renderbufferStorage(Yn,u,s,l),rt(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=si(c.format,c.width,c.height)),h.format=a[c.format],h}function p(e,n){var o=0|e,a=0|n||o;return o===c.width&&a===c.height||(rt(o>0&&a>0&&o<=r.maxRenderbufferSize&&a<=r.maxRenderbufferSize,"invalid renderbuffer size"),h.width=c.width=o,h.height=c.height=a,t.bindRenderbuffer(Yn,c.renderbuffer),t.renderbufferStorage(Yn,c.format,o,a),rt(0===t.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=si(c.format,c.width,c.height))),h}return l[c.id]=c,n.renderbufferCount++,h(e,s),h.resize=p,h._reglType="renderbuffer",h._renderbuffer=c,i.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h}function p(){Ee(l).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(Yn,e.renderbuffer),t.renderbufferStorage(Yn,e.format,e.width,e.height)})),t.bindRenderbuffer(Yn,null)}return u.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(n.getTotalRenderbufferSize=function(){var t=0;return Object.keys(l).forEach((function(e){t+=l[e].stats.size})),t}),{create:h,clear:function(){Ee(l).forEach(c)},restore:p}},ui=36160,ci=36161,hi=3553,pi=34069,di=36064,fi=36096,mi=36128,gi=33306,_i=36053,vi=36054,yi=36055,xi=36057,bi=36061,Ei=36193,Ti=5121,Si=5126,Ai=6407,wi=6408,Ci=6402,Ri=[Ai,wi],Li=[];Li[wi]=4,Li[Ai]=3;var Ii=[];Ii[Ti]=1,Ii[Si]=4,Ii[Ei]=2;var Mi=33189,Oi=36168,Pi=34041,Di=[32854,32855,36194,35907,34842,34843,34836],Bi={};function Ni(t,r,n,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},l=["rgba"],u=["rgba4","rgb565","rgb5 a1"];r.ext_srgb&&u.push("srgba"),r.ext_color_buffer_half_float&&u.push("rgba16f","rgb16f"),r.webgl_color_buffer_float&&u.push("rgba32f");var c=["uint8"];function h(t,e,r){this.target=t,this.texture=e,this.renderbuffer=r;var n=0,i=0;e?(n=e.width,i=e.height):r&&(n=r.width,i=r.height),this.width=n,this.height=i}function p(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function d(t,e,r){if(t)if(t.texture){var n=t.texture._texture,i=Math.max(1,n.width),o=Math.max(1,n.height);rt(i===e&&o===r,"inconsistent width/height for supplied texture"),n.refCount+=1}else{var a=t.renderbuffer._renderbuffer;rt(a.width===e&&a.height===r,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function f(e,r){r&&(r.texture?t.framebufferTexture2D(ui,e,r.target,r.texture._texture.texture,0):t.framebufferRenderbuffer(ui,e,ci,r.renderbuffer._renderbuffer.renderbuffer))}function m(t){var e=hi,r=null,n=null,i=t;"object"==typeof t&&(i=t.data,"target"in t&&(e=0|t.target)),rt.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(r=i,rt(e===hi)):"textureCube"===o?(r=i,rt(e>=pi&&e<pi+6,"invalid cube map target")):"renderbuffer"===o?(n=i,e=ci):rt.raise("invalid regl object for attachment"),new h(e,r,n)}function g(t,e,r,n,a){if(r){var s=i.create2D({width:t,height:e,format:n,type:a});return s._texture.refCount=0,new h(hi,s,null)}var l=o.create({width:t,height:e,format:n});return l._renderbuffer.refCount=0,new h(ci,null,l)}function _(t){return t&&(t.texture||t.renderbuffer)}function v(t,e,r){t&&(t.texture?t.texture.resize(e,r):t.renderbuffer&&t.renderbuffer.resize(e,r),t.width=e,t.height=r)}r.oes_texture_half_float&&c.push("half float","float16"),r.oes_texture_float&&c.push("float","float32");var y=0,x={};function b(){this.id=y++,x[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function E(t){t.colorAttachments.forEach(p),p(t.depthAttachment),p(t.stencilAttachment),p(t.depthStencilAttachment)}function T(e){var r=e.framebuffer;rt(r,"must not double destroy framebuffer"),t.deleteFramebuffer(r),e.framebuffer=null,a.framebufferCount--,delete x[e.id]}function S(e){var r;t.bindFramebuffer(ui,e.framebuffer);var i=e.colorAttachments;for(r=0;r<i.length;++r)f(di+r,i[r]);for(r=i.length;r<n.maxColorAttachments;++r)t.framebufferTexture2D(ui,di+r,hi,null,0);t.framebufferTexture2D(ui,gi,hi,null,0),t.framebufferTexture2D(ui,fi,hi,null,0),t.framebufferTexture2D(ui,mi,hi,null,0),f(fi,e.depthAttachment),f(mi,e.stencilAttachment),f(gi,e.depthStencilAttachment);var o=t.checkFramebufferStatus(ui);t.isContextLost()||o===_i||rt.raise("framebuffer configuration not supported, status = "+Bi[o]),t.bindFramebuffer(ui,s.next?s.next.framebuffer:null),s.cur=s.next,t.getError()}function A(t,i){var o=new b;function h(t,e){var i;rt(s.next!==o,"can not update framebuffer which is currently in use");var a=0,p=0,f=!0,v=!0,y=null,x=!0,b="rgba",T="uint8",A=1,w=null,C=null,R=null,L=!1;if("number"==typeof t)a=0|t,p=0|e||a;else if(t){rt.type(t,"object","invalid arguments for framebuffer");var I=t;if("shape"in I){var M=I.shape;rt(Array.isArray(M)&&M.length>=2,"invalid shape for framebuffer"),a=M[0],p=M[1]}else"radius"in I&&(a=p=I.radius),"width"in I&&(a=I.width),"height"in I&&(p=I.height);("color"in I||"colors"in I)&&(y=I.color||I.colors,Array.isArray(y)&&rt(1===y.length||r.webgl_draw_buffers,"multiple render targets not supported")),y||("colorCount"in I&&(A=0|I.colorCount,rt(A>0,"invalid color buffer count")),"colorTexture"in I&&(x=!!I.colorTexture,b="rgba4"),"colorType"in I&&(T=I.colorType,x?(rt(r.oes_texture_float||!("float"===T||"float32"===T),"you must enable OES_texture_float in order to use floating point framebuffer objects"),rt(r.oes_texture_half_float||!("half float"===T||"float16"===T),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===T||"float16"===T?(rt(r.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),b="rgba16f"):"float"!==T&&"float32"!==T||(rt(r.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),b="rgba32f"),rt.oneOf(T,c,"invalid color type")),"colorFormat"in I&&(b=I.colorFormat,l.indexOf(b)>=0?x=!0:u.indexOf(b)>=0?x=!1:x?rt.oneOf(I.colorFormat,l,"invalid color format for texture"):rt.oneOf(I.colorFormat,u,"invalid color format for renderbuffer"))),("depthTexture"in I||"depthStencilTexture"in I)&&(L=!(!I.depthTexture&&!I.depthStencilTexture),rt(!L||r.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in I&&("boolean"==typeof I.depth?f=I.depth:(w=I.depth,v=!1)),"stencil"in I&&("boolean"==typeof I.stencil?v=I.stencil:(C=I.stencil,f=!1)),"depthStencil"in I&&("boolean"==typeof I.depthStencil?f=v=I.depthStencil:(R=I.depthStencil,f=!1,v=!1))}else a=p=1;var O=null,P=null,D=null,B=null;if(Array.isArray(y))O=y.map(m);else if(y)O=[m(y)];else for(O=new Array(A),i=0;i<A;++i)O[i]=g(a,p,x,b,T);rt(r.webgl_draw_buffers||O.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),rt(O.length<=n.maxColorAttachments,"too many color attachments, not supported"),a=a||O[0].width,p=p||O[0].height,w?P=m(w):f&&!v&&(P=g(a,p,L,"depth","uint32")),C?D=m(C):v&&!f&&(D=g(a,p,!1,"stencil","uint8")),R?B=m(R):!w&&!C&&v&&f&&(B=g(a,p,L,"depth stencil","depth stencil")),rt(!!w+!!C+!!R<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var N=null;for(i=0;i<O.length;++i)if(d(O[i],a,p),rt(!O[i]||O[i].texture&&Ri.indexOf(O[i].texture._texture.format)>=0||O[i].renderbuffer&&Di.indexOf(O[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),O[i]&&O[i].texture){var F=Li[O[i].texture._texture.format]*Ii[O[i].texture._texture.type];null===N?N=F:rt(N===F,"all color attachments much have the same number of bits per pixel.")}return d(P,a,p),rt(!P||P.texture&&P.texture._texture.format===Ci||P.renderbuffer&&P.renderbuffer._renderbuffer.format===Mi,"invalid depth attachment for framebuffer object"),d(D,a,p),rt(!D||D.renderbuffer&&D.renderbuffer._renderbuffer.format===Oi,"invalid stencil attachment for framebuffer object"),d(B,a,p),rt(!B||B.texture&&B.texture._texture.format===Pi||B.renderbuffer&&B.renderbuffer._renderbuffer.format===Pi,"invalid depth-stencil attachment for framebuffer object"),E(o),o.width=a,o.height=p,o.colorAttachments=O,o.depthAttachment=P,o.stencilAttachment=D,o.depthStencilAttachment=B,h.color=O.map(_),h.depth=_(P),h.stencil=_(D),h.depthStencil=_(B),h.width=o.width,h.height=o.height,S(o),h}function p(t,e){rt(s.next!==o,"can not resize a framebuffer which is currently in use");var r=Math.max(0|t,1),n=Math.max(0|e||r,1);if(r===o.width&&n===o.height)return h;for(var i=o.colorAttachments,a=0;a<i.length;++a)v(i[a],r,n);return v(o.depthAttachment,r,n),v(o.stencilAttachment,r,n),v(o.depthStencilAttachment,r,n),o.width=h.width=r,o.height=h.height=n,S(o),h}return a.framebufferCount++,h(t,i),e(h,{resize:p,_reglType:"framebuffer",_framebuffer:o,destroy:function(){T(o),E(o)},use:function(t){s.setFBO({framebuffer:h},t)}})}function w(t){var o=Array(6);function a(t){var n;rt(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var u,h={color:null},p=0,d=null,f="rgba",m="uint8",g=1;if("number"==typeof t)p=0|t;else if(t){rt.type(t,"object","invalid arguments for framebuffer");var _=t;if("shape"in _){var v=_.shape;rt(Array.isArray(v)&&v.length>=2,"invalid shape for framebuffer"),rt(v[0]===v[1],"cube framebuffer must be square"),p=v[0]}else"radius"in _&&(p=0|_.radius),"width"in _?(p=0|_.width,"height"in _&&rt(_.height===p,"must be square")):"height"in _&&(p=0|_.height);("color"in _||"colors"in _)&&(d=_.color||_.colors,Array.isArray(d)&&rt(1===d.length||r.webgl_draw_buffers,"multiple render targets not supported")),d||("colorCount"in _&&(g=0|_.colorCount,rt(g>0,"invalid color buffer count")),"colorType"in _&&(rt.oneOf(_.colorType,c,"invalid color type"),m=_.colorType),"colorFormat"in _&&(f=_.colorFormat,rt.oneOf(_.colorFormat,l,"invalid color format for texture"))),"depth"in _&&(h.depth=_.depth),"stencil"in _&&(h.stencil=_.stencil),"depthStencil"in _&&(h.depthStencil=_.depthStencil)}else p=1;if(d)if(Array.isArray(d))for(u=[],n=0;n<d.length;++n)u[n]=d[n];else u=[d];else{u=Array(g);var y={radius:p,format:f,type:m};for(n=0;n<g;++n)u[n]=i.createCube(y)}for(h.color=Array(u.length),n=0;n<u.length;++n){var x=u[n];rt("function"==typeof x&&"textureCube"===x._reglType,"invalid cube map"),p=p||x.width,rt(x.width===p&&x.height===p,"invalid cube map shape"),h.color[n]={target:pi,data:u[n]}}for(n=0;n<6;++n){for(var b=0;b<u.length;++b)h.color[b].target=pi+n;n>0&&(h.depth=o[0].depth,h.stencil=o[0].stencil,h.depthStencil=o[0].depthStencil),o[n]?o[n](h):o[n]=A(h)}return e(a,{width:p,height:p,color:u})}function u(t){var e,r=0|t;if(rt(r>0&&r<=n.maxCubeMapSize,"invalid radius for cube fbo"),r===a.width)return a;var i=a.color;for(e=0;e<i.length;++e)i[e].resize(r);for(e=0;e<6;++e)o[e].resize(r);return a.width=a.height=r,a}return a(t),e(a,{faces:o,resize:u,_reglType:"framebufferCube",destroy:function(){o.forEach((function(t){t.destroy()}))}})}function C(){s.cur=null,s.next=null,s.dirty=!0,Ee(x).forEach((function(e){e.framebuffer=t.createFramebuffer(),S(e)}))}return e(s,{getFramebuffer:function(t){if("function"==typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof b)return e}return null},create:A,createCube:w,clear:function(){Ee(x).forEach(T)},restore:C})}Bi[_i]="complete",Bi[vi]="incomplete attachment",Bi[xi]="incomplete dimensions",Bi[yi]="incomplete, missing attachment",Bi[bi]="unsupported";var Fi=5126,ki=34962;function Ui(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Fi,this.offset=0,this.stride=0,this.divisor=0}function zi(e,r,n,i,o){for(var a=n.maxAttributes,s=new Array(a),l=0;l<a;++l)s[l]=new Ui;var u=0,c={},h={Record:Ui,scope:{},state:s,currentVAO:null,targetVAO:null,restore:d()?x:function(){},createVAO:b,getVAO:m,destroyBuffer:p,setVAO:d()?g:_,clear:d()?v:function(){}};function p(t){for(var r=0;r<s.length;++r){var n=s[r];n.buffer===t&&(e.disableVertexAttribArray(r),n.buffer=null)}}function d(){return r.oes_vertex_array_object}function f(){return r.angle_instanced_arrays}function m(t){return"function"==typeof t&&t._vao?t._vao:null}function g(t){if(t!==h.currentVAO){var e=d();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),h.currentVAO=t}}function _(t){if(t!==h.currentVAO){if(t)t.bindAttrs();else for(var r=f(),n=0;n<s.length;++n){var i=s[n];i.buffer?(e.enableVertexAttribArray(n),e.vertexAttribPointer(n,i.size,i.type,i.normalized,i.stride,i.offfset),r&&r.vertexAttribDivisorANGLE(n,i.divisor)):(e.disableVertexAttribArray(n),e.vertexAttrib4f(n,i.x,i.y,i.z,i.w))}h.currentVAO=t}}function v(){Ee(c).forEach((function(t){t.destroy()}))}function y(){this.id=++u,this.attributes=[];var t=d();this.vao=t?t.createVertexArrayOES():null,c[this.id]=this,this.buffers=[]}function x(){d()&&Ee(c).forEach((function(t){t.refresh()}))}function b(e){var n=new y;function s(e){rt(Array.isArray(e),"arguments to vertex array constructor must be an array"),rt(e.length<a,"too many attributes"),rt(e.length>0,"must specify at least one attribute");for(var i=0;i<n.buffers.length;++i)n.buffers[i].destroy();n.buffers.length=0;var l=n.attributes;l.length=e.length;for(var u=0;u<e.length;++u){var c=e[u],h=l[u]=new Ui;if(Array.isArray(c)||t(c)||be(c)){var p=o.create(c,ki,!1,!0);h.buffer=o.getBuffer(p),h.size=0|h.buffer.dimension,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1,n.buffers.push(p)}else o.getBuffer(c)?(h.buffer=o.getBuffer(c),h.size=0|h.buffer.dimension,h.normalized=!1,h.type=h.buffer.dtype,h.offset=0,h.stride=0,h.divisor=0,h.state=1):o.getBuffer(c.buffer)?(h.buffer=o.getBuffer(c.buffer),h.size=0|(+c.size||h.buffer.dimension),h.normalized=!!c.normalized||!1,"type"in c?(rt.parameter(c.type,Me,"invalid buffer type"),h.type=Me[c.type]):h.type=h.buffer.dtype,h.offset=0|(c.offset||0),h.stride=0|(c.stride||0),h.divisor=0|(c.divisor||0),h.state=1,rt(h.size>=1&&h.size<=4,"size must be between 1 and 4"),rt(h.offset>=0,"invalid offset"),rt(h.stride>=0&&h.stride<=255,"stride must be between 0 and 255"),rt(h.divisor>=0,"divisor must be positive"),rt(!h.divisor||!!r.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in c?(rt(u>0,"first attribute must not be a constant"),h.x=+c.x||0,h.y=+c.y||0,h.z=+c.z||0,h.w=+c.w||0,h.state=2):rt(!1,"invalid attribute spec for location "+u)}return n.refresh(),s}return i.vaoCount+=1,s.destroy=function(){n.destroy()},s._vao=n,s._reglType="vao",s(e)}return y.prototype.bindAttrs=function(){for(var t=f(),r=this.attributes,n=0;n<r.length;++n){var i=r[n];i.buffer?(e.enableVertexAttribArray(n),e.bindBuffer(ki,i.buffer.buffer),e.vertexAttribPointer(n,i.size,i.type,i.normalized,i.stride,i.offset),t&&t.vertexAttribDivisorANGLE(n,i.divisor)):(e.disableVertexAttribArray(n),e.vertexAttrib4f(n,i.x,i.y,i.z,i.w))}for(var o=r.length;o<a;++o)e.disableVertexAttribArray(o)},y.prototype.refresh=function(){var t=d();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),h.currentVAO=this)},y.prototype.destroy=function(){if(this.vao){var t=d();this===h.currentVAO&&(h.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}c[this.id]&&(delete c[this.id],i.vaoCount-=1)},h}var Gi=35632,ji=35633,Vi=35718,Hi=35721;function Wi(t,e,r,n){var i={},o={};function a(t,e,r,n){this.name=t,this.id=e,this.location=r,this.info=n}function s(t,e){for(var r=0;r<t.length;++r)if(t[r].id===e.id)return void(t[r].location=e.location);t.push(e)}function l(r,n,a){var s=r===Gi?i:o,l=s[n];if(!l){var u=e.str(n);l=t.createShader(r),t.shaderSource(l,u),t.compileShader(l),rt.shaderError(t,l,u,r,a),s[n]=l}return l}var u={},c=[],h=0;function p(t,e){this.id=h++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],n.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(r,i,o){var u,c,h=l(Gi,r.fragId),p=l(ji,r.vertId),d=r.program=t.createProgram();if(t.attachShader(d,h),t.attachShader(d,p),o)for(u=0;u<o.length;++u){var f=o[u];t.bindAttribLocation(d,f[0],f[1])}t.linkProgram(d),rt.linkError(t,d,e.str(r.fragId),e.str(r.vertId),i);var m=t.getProgramParameter(d,Vi);n.profile&&(r.stats.uniformsCount=m);var g=r.uniforms;for(u=0;u<m;++u)if(c=t.getActiveUniform(d,u))if(c.size>1)for(var _=0;_<c.size;++_){var v=c.name.replace("[0]","["+_+"]");s(g,new a(v,e.id(v),t.getUniformLocation(d,v),c))}else s(g,new a(c.name,e.id(c.name),t.getUniformLocation(d,c.name),c));var y=t.getProgramParameter(d,Hi);n.profile&&(r.stats.attributesCount=y);var x=r.attributes;for(u=0;u<y;++u)(c=t.getActiveAttrib(d,u))&&s(x,new a(c.name,e.id(c.name),t.getAttribLocation(d,c.name),c))}function f(){i={},o={};for(var t=0;t<c.length;++t)d(c[t],null,c[t].attributes.map((function(t){return[t.location,t.name]})))}return n.profile&&(r.getMaxUniformsCount=function(){var t=0;return c.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},r.getMaxAttributesCount=function(){var t=0;return c.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);Ee(i).forEach(e),i={},Ee(o).forEach(e),o={},c.forEach((function(e){t.deleteProgram(e.program)})),c.length=0,u={},r.shaderCount=0},program:function(t,e,n,i){rt.command(t>=0,"missing vertex shader",n),rt.command(e>=0,"missing fragment shader",n);var o=u[e];o||(o=u[e]={});var a=o[t];if(a&&!i)return a;var s=new p(e,t);return r.shaderCount++,d(s,n,i),a||(o[t]=s),c.push(s),s},restore:f,shader:l,frag:-1,vert:-1}}var Xi=6408,Zi=5121,qi=3333,Yi=5126;function Ki(e,r,n,i,o,a,s){function l(l){var u;null===r.next?(rt(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),u=Zi):(rt(null!==r.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),u=r.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(rt(u===Zi||u===Yi,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),u===Yi&&rt(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):rt(u===Zi,"Reading from a framebuffer is only allowed for the type 'uint8'"));var c=0,h=0,p=i.framebufferWidth,d=i.framebufferHeight,f=null;t(l)?f=l:l&&(rt.type(l,"object","invalid arguments to regl.read()"),c=0|l.x,h=0|l.y,rt(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),rt(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),p=0|(l.width||i.framebufferWidth-c),d=0|(l.height||i.framebufferHeight-h),f=l.data||null),f&&(u===Zi?rt(f instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):u===Yi&&rt(f instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),rt(p>0&&p+c<=i.framebufferWidth,"invalid width for read pixels"),rt(d>0&&d+h<=i.framebufferHeight,"invalid height for read pixels"),n();var m=p*d*4;return f||(u===Zi?f=new Uint8Array(m):u===Yi&&(f=f||new Float32Array(m))),rt.isTypedArray(f,"data buffer for regl.read() must be a typedarray"),rt(f.byteLength>=m,"data buffer for regl.read() too small"),e.pixelStorei(qi,4),e.readPixels(c,h,p,d,Xi,u,f),f}function u(t){var e;return r.setFBO({framebuffer:t.framebuffer},(function(){e=l(t)})),e}function c(t){return t&&"framebuffer"in t?u(t):l(t)}return c}function $i(t){return Array.prototype.slice.call(t)}function Qi(t){return $i(t).join("")}function Ji(){var t=0,r=[],n=[];function i(e){for(var i=0;i<n.length;++i)if(n[i]===e)return r[i];var o="g"+t++;return r.push(o),n.push(e),o}function o(){var r=[];function n(){r.push.apply(r,$i(arguments))}var i=[];function o(){var e="v"+t++;return i.push(e),arguments.length>0&&(r.push(e,"="),r.push.apply(r,$i(arguments)),r.push(";")),e}return e(n,{def:o,toString:function(){return Qi([i.length>0?"var "+i.join(",")+";":"",Qi(r)])}})}function a(){var t=o(),r=o(),n=t.toString,i=r.toString;function a(e,n){r(e,n,"=",t.def(e,n),";")}return e((function(){t.apply(t,$i(arguments))}),{def:t.def,entry:t,exit:r,save:a,set:function(e,r,n){a(e,r),t(e,r,"=",n,";")},toString:function(){return n()+i()}})}function s(){var t=Qi(arguments),r=a(),n=a(),i=r.toString,o=n.toString;return e(r,{then:function(){return r.apply(r,$i(arguments)),this},else:function(){return n.apply(n,$i(arguments)),this},toString:function(){var e=o();return e&&(e="else{"+e+"}"),Qi(["if(",t,"){",i(),"}",e])}})}var l=o(),u={};function c(t,r){var n=[];function i(){var t="a"+n.length;return n.push(t),t}r=r||0;for(var o=0;o<r;++o)i();var s=a(),l=s.toString;return u[t]=e(s,{arg:i,toString:function(){return Qi(["function(",n.join(),"){",l(),"}"])}})}function h(){var t=['"use strict";',l,"return {"];Object.keys(u).forEach((function(e){t.push('"',e,'":',u[e].toString(),",")})),t.push("}");var e=Qi(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,r.concat(e)).apply(null,n)}return{global:l,link:i,block:o,proc:c,scope:a,cond:s,compile:h}}var to="xyzw".split(""),eo=5121,ro=1,no=2,io=0,oo=1,ao=2,so=3,lo=4,uo="dither",co="blend.enable",ho="blend.color",po="blend.equation",fo="blend.func",mo="depth.enable",go="depth.func",_o="depth.range",vo="depth.mask",yo="colorMask",xo="cull.enable",bo="cull.face",Eo="frontFace",To="lineWidth",So="polygonOffset.enable",Ao="polygonOffset.offset",wo="sample.alpha",Co="sample.enable",Ro="sample.coverage",Lo="stencil.enable",Io="stencil.mask",Mo="stencil.func",Oo="stencil.opFront",Po="stencil.opBack",Do="scissor.enable",Bo="scissor.box",No="viewport",Fo="profile",ko="framebuffer",Uo="vert",zo="frag",Go="elements",jo="primitive",Vo="count",Ho="offset",Wo="instances",Xo="vao",Zo="Width",qo="Height",Yo=ko+Zo,Ko=ko+qo,$o=No+Zo,Qo=No+qo,Jo="drawingBuffer",ta=Jo+Zo,ea=Jo+qo,ra=[fo,po,Mo,Oo,Po,Ro,No,Bo,Ao],na=34962,ia=34963,oa=3553,aa=34067,sa=2884,la=3042,ua=3024,ca=2960,ha=2929,pa=3089,da=32823,fa=32926,ma=32928,ga=5126,_a=35664,va=35665,ya=35666,xa=5124,ba=35667,Ea=35668,Ta=35669,Sa=35670,Aa=35671,wa=35672,Ca=35673,Ra=35674,La=35675,Ia=35676,Ma=35678,Oa=35680,Pa=4,Da=1028,Ba=1029,Na=2304,Fa=2305,ka=32775,Ua=32776,za=519,Ga=7680,ja=0,Va=1,Ha=32774,Wa=513,Xa=36160,Za=36064,qa={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ya=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ka={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},$a={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Qa={frag:35632,vert:35633},Ja={cw:Na,ccw:Fa};function ts(e){return Array.isArray(e)||t(e)||be(e)}function es(t){return t.sort((function(t,e){return t===No?-1:e===No?1:t<e?-1:1}))}function rs(t,e,r,n){this.thisDep=t,this.contextDep=e,this.propDep=r,this.append=n}function ns(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function is(t){return new rs(!1,!1,!1,t)}function os(t,e){var r=t.type;if(r===io){var n=t.data.length;return new rs(!0,n>=1,n>=2,e)}if(r===lo){var i=t.data;return new rs(i.thisDep,i.contextDep,i.propDep,e)}return new rs(r===so,r===ao,r===oo,e)}var as=new rs(!1,!1,!1,(function(){}));function ss(t,e,r,n,i,o,a,s,l,u,c,h,p,d,f){var m=u.Record,g={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(g.min=ka,g.max=Ua);var _=r.angle_instanced_arrays,v=r.webgl_draw_buffers,y={dirty:!0,profile:f.profile},x={},b=[],E={},T={};function S(t){return t.replace(".","_")}function A(t,e,r){var n=S(t);b.push(t),x[n]=y[n]=!!r,E[n]=e}function w(t,e,r){var n=S(t);b.push(t),Array.isArray(r)?(y[n]=r.slice(),x[n]=r.slice()):y[n]=x[n]=r,T[n]=e}A(uo,ua),A(co,la),w(ho,"blendColor",[0,0,0,0]),w(po,"blendEquationSeparate",[Ha,Ha]),w(fo,"blendFuncSeparate",[Va,ja,Va,ja]),A(mo,ha,!0),w(go,"depthFunc",Wa),w(_o,"depthRange",[0,1]),w(vo,"depthMask",!0),w(yo,yo,[!0,!0,!0,!0]),A(xo,sa),w(bo,"cullFace",Ba),w(Eo,Eo,Fa),w(To,To,1),A(So,da),w(Ao,"polygonOffset",[0,0]),A(wo,fa),A(Co,ma),w(Ro,"sampleCoverage",[1,!1]),A(Lo,ca),w(Io,"stencilMask",-1),w(Mo,"stencilFunc",[za,0,-1]),w(Oo,"stencilOpSeparate",[Da,Ga,Ga,Ga]),w(Po,"stencilOpSeparate",[Ba,Ga,Ga,Ga]),A(Do,pa),w(Bo,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),w(No,No,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var C={gl:t,context:p,strings:e,next:x,current:y,draw:h,elements:o,buffer:i,shader:c,attributes:u.state,vao:u,uniforms:l,framebuffer:s,extensions:r,timer:d,isBufferArgs:ts},R={primTypes:We,compareFuncs:Ka,blendFuncs:qa,blendEquations:g,stencilOps:$a,glTypes:Me,orientationType:Ja};rt.optional((function(){C.isArrayLike=ur})),v&&(R.backBuffer=[Ba],R.drawBuffer=St(n.maxDrawbuffers,(function(t){return 0===t?[0]:St(t,(function(t){return Za+t}))})));var L=0;function I(){var t=Ji(),r=t.link,n=t.global;t.id=L++,t.batchId="0";var i=r(C),o=t.shared={props:"a0"};Object.keys(C).forEach((function(t){o[t]=n.def(i,".",t)})),rt.optional((function(){t.CHECK=r(rt),t.commandStr=rt.guessCommand(),t.command=r(t.commandStr),t.assert=function(t,e,n){t("if(!(",e,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},R.invalidBlendCombinations=Ya}));var a=t.next={},s=t.current={};Object.keys(T).forEach((function(t){Array.isArray(y[t])&&(a[t]=n.def(o.next,".",t),s[t]=n.def(o.current,".",t))}));var l=t.constants={};Object.keys(R).forEach((function(t){l[t]=n.def(JSON.stringify(R[t]))})),t.invoke=function(e,n){switch(n.type){case io:var i=["this",o.context,o.props,t.batchId];return e.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case oo:return e.def(o.props,n.data);case ao:return e.def(o.context,n.data);case so:return e.def("this",n.data);case lo:return n.data.append(t,e),n.data.ref}},t.attribCache={};var c={};return t.scopeAttrib=function(t){var n=e.id(t);if(n in c)return c[n];var i=u.scope[n];return i||(i=u.scope[n]=new m),c[n]=r(i)},t}function M(t){var e,r=t.static,n=t.dynamic;if(Fo in r){var i=!!r[Fo];(e=is((function(t,e){return i}))).enable=i}else if(Fo in n){var o=n[Fo];e=os(o,(function(t,e){return t.invoke(e,o)}))}return e}function O(t,e){var r=t.static,n=t.dynamic;if(ko in r){var i=r[ko];return i?(i=s.getFramebuffer(i),rt.command(i,"invalid framebuffer object"),is((function(t,e){var r=t.link(i),n=t.shared;e.set(n.framebuffer,".next",r);var o=n.context;return e.set(o,"."+Yo,r+".width"),e.set(o,"."+Ko,r+".height"),r}))):is((function(t,e){var r=t.shared;e.set(r.framebuffer,".next","null");var n=r.context;return e.set(n,"."+Yo,n+"."+ta),e.set(n,"."+Ko,n+"."+ea),"null"}))}if(ko in n){var o=n[ko];return os(o,(function(t,e){var r=t.invoke(e,o),n=t.shared,i=n.framebuffer,a=e.def(i,".getFramebuffer(",r,")");rt.optional((function(){t.assert(e,"!"+r+"||"+a,"invalid framebuffer object")})),e.set(i,".next",a);var s=n.context;return e.set(s,"."+Yo,a+"?"+a+".width:"+s+"."+ta),e.set(s,"."+Ko,a+"?"+a+".height:"+s+"."+ea),a}))}return null}function P(t,e,r){var n=t.static,i=t.dynamic;function o(t){if(t in n){var o=n[t];rt.commandType(o,"object","invalid "+t,r.commandStr);var a,s,l=!0,u=0|o.x,c=0|o.y;return"width"in o?(a=0|o.width,rt.command(a>=0,"invalid "+t,r.commandStr)):l=!1,"height"in o?(s=0|o.height,rt.command(s>=0,"invalid "+t,r.commandStr)):l=!1,new rs(!l&&e&&e.thisDep,!l&&e&&e.contextDep,!l&&e&&e.propDep,(function(t,e){var r=t.shared.context,n=a;"width"in o||(n=e.def(r,".",Yo,"-",u));var i=s;return"height"in o||(i=e.def(r,".",Ko,"-",c)),[u,c,n,i]}))}if(t in i){var h=i[t],p=os(h,(function(e,r){var n=e.invoke(r,h);rt.optional((function(){e.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+t)}));var i=e.shared.context,o=r.def(n,".x|0"),a=r.def(n,".y|0"),s=r.def('"width" in ',n,"?",n,".width|0:","(",i,".",Yo,"-",o,")"),l=r.def('"height" in ',n,"?",n,".height|0:","(",i,".",Ko,"-",a,")");return rt.optional((function(){e.assert(r,s+">=0&&"+l+">=0","invalid "+t)})),[o,a,s,l]}));return e&&(p.thisDep=p.thisDep||e.thisDep,p.contextDep=p.contextDep||e.contextDep,p.propDep=p.propDep||e.propDep),p}return e?new rs(e.thisDep,e.contextDep,e.propDep,(function(t,e){var r=t.shared.context;return[0,0,e.def(r,".",Yo),e.def(r,".",Ko)]})):null}var a=o(No);if(a){var s=a;a=new rs(a.thisDep,a.contextDep,a.propDep,(function(t,e){var r=s.append(t,e),n=t.shared.context;return e.set(n,"."+$o,r[2]),e.set(n,"."+Qo,r[3]),r}))}return{viewport:a,scissor_box:o(Bo)}}function D(t,e){var r=t.static;if("string"==typeof r[zo]&&"string"==typeof r[Uo]){if(Object.keys(e.dynamic).length>0)return null;var n=e.static,i=Object.keys(n);if(i.length>0&&"number"==typeof n[i[0]]){for(var o=[],a=0;a<i.length;++a)rt("number"==typeof n[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|n[i[a]],i[a]]);return o}}return null}function B(t,r,n){var i=t.static,o=t.dynamic;function a(t){if(t in i){var r=e.id(i[t]);rt.optional((function(){c.shader(Qa[t],r,rt.guessCommand())}));var n=is((function(){return r}));return n.id=r,n}if(t in o){var a=o[t];return os(a,(function(e,r){var n=e.invoke(r,a),i=r.def(e.shared.strings,".id(",n,")");return rt.optional((function(){r(e.shared.shader,".shader(",Qa[t],",",i,",",e.command,");")})),i}))}return null}var s,l=a(zo),u=a(Uo),h=null;return ns(l)&&ns(u)?(h=c.program(u.id,l.id,null,n),s=is((function(t,e){return t.link(h)}))):s=new rs(l&&l.thisDep||u&&u.thisDep,l&&l.contextDep||u&&u.contextDep,l&&l.propDep||u&&u.propDep,(function(t,e){var r,n=t.shared.shader;r=l?l.append(t,e):e.def(n,".",zo);var i=n+".program("+(u?u.append(t,e):e.def(n,".",Uo))+","+r;return rt.optional((function(){i+=","+t.command})),e.def(i+")")})),{frag:l,vert:u,progVar:s,program:h}}function N(t,e){var r=t.static,n=t.dynamic;function i(){if(Go in r){var t=r[Go];ts(t)?t=o.getElements(o.create(t,!0)):t&&(t=o.getElements(t),rt.command(t,"invalid elements",e.commandStr));var i=is((function(e,r){if(t){var n=e.link(t);return e.ELEMENTS=n,n}return e.ELEMENTS=null,null}));return i.value=t,i}if(Go in n){var a=n[Go];return os(a,(function(t,e){var r=t.shared,n=r.isBufferArgs,i=r.elements,o=t.invoke(e,a),s=e.def("null"),l=e.def(n,"(",o,")"),u=t.cond(l).then(s,"=",i,".createStream(",o,");").else(s,"=",i,".getElements(",o,");");return rt.optional((function(){t.assert(u.else,"!"+o+"||"+s,"invalid elements")})),e.entry(u),e.exit(t.cond(l).then(i,".destroyStream(",s,");")),t.ELEMENTS=s,s}))}return null}var a=i();function s(){if(jo in r){var t=r[jo];return rt.commandParameter(t,We,"invalid primitve",e.commandStr),is((function(e,r){return We[t]}))}if(jo in n){var i=n[jo];return os(i,(function(t,e){var r=t.constants.primTypes,n=t.invoke(e,i);return rt.optional((function(){t.assert(e,n+" in "+r,"invalid primitive, must be one of "+Object.keys(We))})),e.def(r,"[",n,"]")}))}return a?ns(a)?a.value?is((function(t,e){return e.def(t.ELEMENTS,".primType")})):is((function(){return Pa})):new rs(a.thisDep,a.contextDep,a.propDep,(function(t,e){var r=t.ELEMENTS;return e.def(r,"?",r,".primType:",Pa)})):null}function l(t,i){if(t in r){var o=0|r[t];return rt.command(!i||o>=0,"invalid "+t,e.commandStr),is((function(t,e){return i&&(t.OFFSET=o),o}))}if(t in n){var s=n[t];return os(s,(function(e,r){var n=e.invoke(r,s);return i&&(e.OFFSET=n,rt.optional((function(){e.assert(r,n+">=0","invalid "+t)}))),n}))}return i&&a?is((function(t,e){return t.OFFSET="0",0})):null}var u=l(Ho,!0);function c(){if(Vo in r){var t=0|r[Vo];return rt.command("number"==typeof t&&t>=0,"invalid vertex count",e.commandStr),is((function(){return t}))}if(Vo in n){var i=n[Vo];return os(i,(function(t,e){var r=t.invoke(e,i);return rt.optional((function(){t.assert(e,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")})),r}))}if(a){if(ns(a)){if(a)return u?new rs(u.thisDep,u.contextDep,u.propDep,(function(t,e){var r=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return rt.optional((function(){t.assert(e,r+">=0","invalid vertex offset/element buffer too small")})),r})):is((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var o=is((function(){return-1}));return rt.optional((function(){o.MISSING=!0})),o}var s=new rs(a.thisDep||u.thisDep,a.contextDep||u.contextDep,a.propDep||u.propDep,(function(t,e){var r=t.ELEMENTS;return t.OFFSET?e.def(r,"?",r,".vertCount-",t.OFFSET,":-1"):e.def(r,"?",r,".vertCount:-1")}));return rt.optional((function(){s.DYNAMIC=!0})),s}return null}return{elements:a,primitive:s(),count:c(),instances:l(Wo,!1),offset:u}}function F(t,e){var r=t.static,i=t.dynamic,o={};return b.forEach((function(t){var a=S(t);function s(e,n){if(t in r){var s=e(r[t]);o[a]=is((function(){return s}))}else if(t in i){var l=i[t];o[a]=os(l,(function(t,e){return n(t,e,t.invoke(e,l))}))}}switch(t){case xo:case co:case uo:case Lo:case mo:case Do:case So:case wo:case Co:case vo:return s((function(r){return rt.commandType(r,"boolean",t,e.commandStr),r}),(function(e,r,n){return rt.optional((function(){e.assert(r,"typeof "+n+'==="boolean"',"invalid flag "+t,e.commandStr)})),n}));case go:return s((function(r){return rt.commandParameter(r,Ka,"invalid "+t,e.commandStr),Ka[r]}),(function(e,r,n){var i=e.constants.compareFuncs;return rt.optional((function(){e.assert(r,n+" in "+i,"invalid "+t+", must be one of "+Object.keys(Ka))})),r.def(i,"[",n,"]")}));case _o:return s((function(t){return rt.command(ur(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,r){return rt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+r+")&&"+r+".length===2&&typeof "+r+'[0]==="number"&&typeof '+r+'[1]==="number"&&'+r+"[0]<="+r+"[1]","depth range must be a 2d array")})),[e.def("+",r,"[0]"),e.def("+",r,"[1]")]}));case fo:return s((function(t){rt.commandType(t,"object","blend.func",e.commandStr);var r="srcRGB"in t?t.srcRGB:t.src,n="srcAlpha"in t?t.srcAlpha:t.src,i="dstRGB"in t?t.dstRGB:t.dst,o="dstAlpha"in t?t.dstAlpha:t.dst;return rt.commandParameter(r,qa,a+".srcRGB",e.commandStr),rt.commandParameter(n,qa,a+".srcAlpha",e.commandStr),rt.commandParameter(i,qa,a+".dstRGB",e.commandStr),rt.commandParameter(o,qa,a+".dstAlpha",e.commandStr),rt.command(-1===Ya.indexOf(r+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+r+", "+i+")",e.commandStr),[qa[r],qa[i],qa[n],qa[o]]}),(function(e,r,n){var i=e.constants.blendFuncs;function o(o,a){var s=r.def('"',o,a,'" in ',n,"?",n,".",o,a,":",n,".",o);return rt.optional((function(){e.assert(r,s+" in "+i,"invalid "+t+"."+o+a+", must be one of "+Object.keys(qa))})),s}rt.optional((function(){e.assert(r,n+"&&typeof "+n+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");rt.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(r,t+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var l=r.def(i,"[",a,"]"),u=r.def(i,"[",o("src","Alpha"),"]");return[l,r.def(i,"[",s,"]"),u,r.def(i,"[",o("dst","Alpha"),"]")]}));case po:return s((function(r){return"string"==typeof r?(rt.commandParameter(r,g,"invalid "+t,e.commandStr),[g[r],g[r]]):"object"==typeof r?(rt.commandParameter(r.rgb,g,t+".rgb",e.commandStr),rt.commandParameter(r.alpha,g,t+".alpha",e.commandStr),[g[r.rgb],g[r.alpha]]):void rt.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,r,n){var i=e.constants.blendEquations,o=r.def(),a=r.def(),s=e.cond("typeof ",n,'==="string"');return rt.optional((function(){function r(t,r,n){e.assert(t,n+" in "+i,"invalid "+r+", must be one of "+Object.keys(g))}r(s.then,t,n),e.assert(s.else,n+"&&typeof "+n+'==="object"',"invalid "+t),r(s.else,t+".rgb",n+".rgb"),r(s.else,t+".alpha",n+".alpha")})),s.then(o,"=",a,"=",i,"[",n,"];"),s.else(o,"=",i,"[",n,".rgb];",a,"=",i,"[",n,".alpha];"),r(s),[o,a]}));case ho:return s((function(t){return rt.command(ur(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),St(4,(function(e){return+t[e]}))}),(function(t,e,r){return rt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+r+")&&"+r+".length===4","blend.color must be a 4d array")})),St(4,(function(t){return e.def("+",r,"[",t,"]")}))}));case Io:return s((function(t){return rt.commandType(t,"number",a,e.commandStr),0|t}),(function(t,e,r){return rt.optional((function(){t.assert(e,"typeof "+r+'==="number"',"invalid stencil.mask")})),e.def(r,"|0")}));case Mo:return s((function(r){rt.commandType(r,"object",a,e.commandStr);var n=r.cmp||"keep",i=r.ref||0,o="mask"in r?r.mask:-1;return rt.commandParameter(n,Ka,t+".cmp",e.commandStr),rt.commandType(i,"number",t+".ref",e.commandStr),rt.commandType(o,"number",t+".mask",e.commandStr),[Ka[n],i,o]}),(function(t,e,r){var n=t.constants.compareFuncs;return rt.optional((function(){function i(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(r+"&&typeof ",r,'==="object"'),i('!("cmp" in ',r,")||(",r,".cmp in ",n,")")})),[e.def('"cmp" in ',r,"?",n,"[",r,".cmp]",":",Ga),e.def(r,".ref|0"),e.def('"mask" in ',r,"?",r,".mask|0:-1")]}));case Oo:case Po:return s((function(r){rt.commandType(r,"object",a,e.commandStr);var n=r.fail||"keep",i=r.zfail||"keep",o=r.zpass||"keep";return rt.commandParameter(n,$a,t+".fail",e.commandStr),rt.commandParameter(i,$a,t+".zfail",e.commandStr),rt.commandParameter(o,$a,t+".zpass",e.commandStr),[t===Po?Ba:Da,$a[n],$a[i],$a[o]]}),(function(e,r,n){var i=e.constants.stencilOps;function o(o){return rt.optional((function(){e.assert(r,'!("'+o+'" in '+n+")||("+n+"."+o+" in "+i+")","invalid "+t+"."+o+", must be one of "+Object.keys($a))})),r.def('"',o,'" in ',n,"?",i,"[",n,".",o,"]:",Ga)}return rt.optional((function(){e.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+t)})),[t===Po?Ba:Da,o("fail"),o("zfail"),o("zpass")]}));case Ao:return s((function(t){rt.commandType(t,"object",a,e.commandStr);var r=0|t.factor,n=0|t.units;return rt.commandType(r,"number",a+".factor",e.commandStr),rt.commandType(n,"number",a+".units",e.commandStr),[r,n]}),(function(e,r,n){return rt.optional((function(){e.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+t)})),[r.def(n,".factor|0"),r.def(n,".units|0")]}));case bo:return s((function(t){var r=0;return"front"===t?r=Da:"back"===t&&(r=Ba),rt.command(!!r,a,e.commandStr),r}),(function(t,e,r){return rt.optional((function(){t.assert(e,r+'==="front"||'+r+'==="back"',"invalid cull.face")})),e.def(r,'==="front"?',Da,":",Ba)}));case To:return s((function(t){return rt.command("number"==typeof t&&t>=n.lineWidthDims[0]&&t<=n.lineWidthDims[1],"invalid line width, must be a positive number between "+n.lineWidthDims[0]+" and "+n.lineWidthDims[1],e.commandStr),t}),(function(t,e,r){return rt.optional((function(){t.assert(e,"typeof "+r+'==="number"&&'+r+">="+n.lineWidthDims[0]+"&&"+r+"<="+n.lineWidthDims[1],"invalid line width")})),r}));case Eo:return s((function(t){return rt.commandParameter(t,Ja,a,e.commandStr),Ja[t]}),(function(t,e,r){return rt.optional((function(){t.assert(e,r+'==="cw"||'+r+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(r+'==="cw"?'+Na+":"+Fa)}));case yo:return s((function(t){return rt.command(ur(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,r){return rt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+r+")&&"+r+".length===4","invalid color.mask")})),St(4,(function(t){return"!!"+r+"["+t+"]"}))}));case Ro:return s((function(t){rt.command("object"==typeof t&&t,a,e.commandStr);var r="value"in t?t.value:1,n=!!t.invert;return rt.command("number"==typeof r&&r>=0&&r<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[r,n]}),(function(t,e,r){return rt.optional((function(){t.assert(e,r+"&&typeof "+r+'==="object"',"invalid sample.coverage")})),[e.def('"value" in ',r,"?+",r,".value:1"),e.def("!!",r,".invert")]}))}})),o}function k(t,e){var r=t.static,n=t.dynamic,i={};return Object.keys(r).forEach((function(t){var n,o=r[t];if("number"==typeof o||"boolean"==typeof o)n=is((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?n=is((function(t){return t.link(o)})):"framebuffer"===a||"framebufferCube"===a?(rt.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),n=is((function(t){return t.link(o.color[0])}))):rt.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else ur(o)?n=is((function(e){return e.global.def("[",St(o.length,(function(r){return rt.command("number"==typeof o[r]||"boolean"==typeof o[r],"invalid uniform "+t,e.commandStr),o[r]})),"]")})):rt.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);n.value=o,i[t]=n})),Object.keys(n).forEach((function(t){var e=n[t];i[t]=os(e,(function(t,r){return t.invoke(r,e)}))})),i}function U(t,r){var n=t.static,o=t.dynamic,a={};return Object.keys(n).forEach((function(t){var o=n[t],s=e.id(t),l=new m;if(ts(o))l.state=ro,l.buffer=i.getBuffer(i.create(o,na,!1,!0)),l.type=0;else{var u=i.getBuffer(o);if(u)l.state=ro,l.buffer=u,l.type=0;else if(rt.command("object"==typeof o&&o,"invalid data for attribute "+t,r.commandStr),"constant"in o){var c=o.constant;l.buffer="null",l.state=no,"number"==typeof c?l.x=c:(rt.command(ur(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+t,r.commandStr),to.forEach((function(t,e){e<c.length&&(l[t]=c[e])})))}else{u=ts(o.buffer)?i.getBuffer(i.create(o.buffer,na,!1,!0)):i.getBuffer(o.buffer),rt.command(!!u,'missing buffer for attribute "'+t+'"',r.commandStr);var h=0|o.offset;rt.command(h>=0,'invalid offset for attribute "'+t+'"',r.commandStr);var p=0|o.stride;rt.command(p>=0&&p<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',r.commandStr);var d=0|o.size;rt.command(!("size"in o)||d>0&&d<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',r.commandStr);var f=!!o.normalized,g=0;"type"in o&&(rt.commandParameter(o.type,Me,"invalid type for attribute "+t,r.commandStr),g=Me[o.type]);var v=0|o.divisor;"divisor"in o&&(rt.command(0===v||_,'cannot specify divisor for attribute "'+t+'", instancing not supported',r.commandStr),rt.command(v>=0,'invalid divisor for attribute "'+t+'"',r.commandStr)),rt.optional((function(){var e=r.commandStr,n=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(o).forEach((function(r){rt.command(n.indexOf(r)>=0,'unknown parameter "'+r+'" for attribute pointer "'+t+'" (valid parameters are '+n+")",e)}))})),l.buffer=u,l.state=ro,l.size=d,l.normalized=f,l.type=g||u.dtype,l.offset=h,l.stride=p,l.divisor=v}}a[t]=is((function(t,e){var r=t.attribCache;if(s in r)return r[s];var n={isStream:!1};return Object.keys(l).forEach((function(t){n[t]=l[t]})),l.buffer&&(n.buffer=t.link(l.buffer),n.type=n.type||n.buffer+".dtype"),r[s]=n,n}))})),Object.keys(o).forEach((function(t){var e=o[t];function r(r,n){var i=r.invoke(n,e),o=r.shared,a=r.constants,s=o.isBufferArgs,l=o.buffer;rt.optional((function(){r.assert(n,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+l+".getBuffer("+i+")||"+l+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var u={isStream:n.def(!1)},c=new m;c.state=ro,Object.keys(c).forEach((function(t){u[t]=n.def(""+c[t])}));var h=u.buffer,p=u.type;function d(t){n(u[t],"=",i,".",t,"|0;")}return n("if(",s,"(",i,")){",u.isStream,"=true;",h,"=",l,".createStream(",na,",",i,");",p,"=",h,".dtype;","}else{",h,"=",l,".getBuffer(",i,");","if(",h,"){",p,"=",h,".dtype;",'}else if("constant" in ',i,"){",u.state,"=",no,";","if(typeof "+i+'.constant === "number"){',u[to[0]],"=",i,".constant;",to.slice(1).map((function(t){return u[t]})).join("="),"=0;","}else{",to.map((function(t,e){return u[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",l,".createStream(",na,",",i,".buffer);","}else{",h,"=",l,".getBuffer(",i,".buffer);","}",p,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",h,".dtype;",u.normalized,"=!!",i,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),n("}}"),n.exit("if(",u.isStream,"){",l,".destroyStream(",h,");","}"),u}a[t]=os(e,r)})),a}function z(t,e){var r=t.static,n=t.dynamic;if(Xo in r){var i=r[Xo];return null!==i&&null===u.getVAO(i)&&(i=u.createVAO(i)),is((function(t){return t.link(u.getVAO(i))}))}if(Xo in n){var o=n[Xo];return os(o,(function(t,e){var r=t.invoke(e,o);return e.def(t.shared.vao+".getVAO("+r+")")}))}return null}function G(t){var e=t.static,r=t.dynamic,n={};return Object.keys(e).forEach((function(t){var r=e[t];n[t]=is((function(t,e){return"number"==typeof r||"boolean"==typeof r?""+r:t.link(r)}))})),Object.keys(r).forEach((function(t){var e=r[t];n[t]=os(e,(function(t,r){return t.invoke(r,e)}))})),n}function j(t,e,n,i,o){var a=t.static,s=t.dynamic;rt.optional((function(){var t=[ko,Uo,zo,Go,jo,Ho,Vo,Wo,Fo,Xo].concat(b);function e(e){Object.keys(e).forEach((function(e){rt.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',o.commandStr)}))}e(a),e(s)}));var l=D(t,e),c=O(t),h=P(t,c,o),p=N(t,o),d=F(t,o),f=B(t,o,l);function m(t){var e=h[t];e&&(d[t]=e)}m(No),m(S(Bo));var g=Object.keys(d).length>0,_={framebuffer:c,draw:p,shader:f,state:d,dirty:g,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(_.profile=M(t),_.uniforms=k(n,o),_.drawVAO=_.scopeVAO=z(t),!_.drawVAO&&f.program&&!l&&r.angle_instanced_arrays){var v=!0,y=f.program.attributes.map((function(t){var r=e.static[t];return v=v&&!!r,r}));if(v&&y.length>0){var x=u.getVAO(u.createVAO(y));_.drawVAO=new rs(null,null,null,(function(t,e){return t.link(x)})),_.useVAO=!0}}return l?_.useVAO=!0:_.attributes=U(e,o),_.context=G(i),_}function V(t,e,r){var n=t.shared.context,i=t.scope();Object.keys(r).forEach((function(o){e.save(n,"."+o);var a=r[o];i(n,".",o,"=",a.append(t,e),";")})),e(i)}function H(t,e,r,n){var i,o=t.shared,a=o.gl,s=o.framebuffer;v&&(i=e.def(o.extensions,".webgl_draw_buffers"));var l,u=t.constants,c=u.drawBuffer,h=u.backBuffer;l=r?r.append(t,e):e.def(s,".next"),n||e("if(",l,"!==",s,".cur){"),e("if(",l,"){",a,".bindFramebuffer(",Xa,",",l,".framebuffer);"),v&&e(i,".drawBuffersWEBGL(",c,"[",l,".colorAttachments.length]);"),e("}else{",a,".bindFramebuffer(",Xa,",null);"),v&&e(i,".drawBuffersWEBGL(",h,");"),e("}",s,".cur=",l,";"),n||e("}")}function W(t,e,r){var n=t.shared,i=n.gl,o=t.current,a=t.next,s=n.current,l=n.next,u=t.cond(s,".dirty");b.forEach((function(e){var n,c,h=S(e);if(!(h in r.state))if(h in a){n=a[h],c=o[h];var p=St(y[h].length,(function(t){return u.def(n,"[",t,"]")}));u(t.cond(p.map((function(t,e){return t+"!=="+c+"["+e+"]"})).join("||")).then(i,".",T[h],"(",p,");",p.map((function(t,e){return c+"["+e+"]="+t})).join(";"),";"))}else{n=u.def(l,".",h);var d=t.cond(n,"!==",s,".",h);u(d),h in E?d(t.cond(n).then(i,".enable(",E[h],");").else(i,".disable(",E[h],");"),s,".",h,"=",n,";"):d(i,".",T[h],"(",n,");",s,".",h,"=",n,";")}})),0===Object.keys(r.state).length&&u(s,".dirty=false;"),e(u)}function X(t,e,r,n){var i=t.shared,o=t.current,a=i.current,s=i.gl;es(Object.keys(r)).forEach((function(i){var l=r[i];if(!n||n(l)){var u=l.append(t,e);if(E[i]){var c=E[i];ns(l)?e(s,u?".enable(":".disable(",c,");"):e(t.cond(u).then(s,".enable(",c,");").else(s,".disable(",c,");")),e(a,".",i,"=",u,";")}else if(ur(u)){var h=o[i];e(s,".",T[i],"(",u,");",u.map((function(t,e){return h+"["+e+"]="+t})).join(";"),";")}else e(s,".",T[i],"(",u,");",a,".",i,"=",u,";")}}))}function Z(t,e){_&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function q(t,e,r,n,i){var o,a,s,l=t.shared,u=t.stats,c=l.current,h=l.timer,p=r.profile;function f(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function m(t){t(o=e.def(),"=",f(),";"),"string"==typeof i?t(u,".count+=",i,";"):t(u,".count++;"),d&&(n?t(a=e.def(),"=",h,".getNumPendingQueries();"):t(h,".beginQuery(",u,");"))}function g(t){t(u,".cpuTime+=",f(),"-",o,";"),d&&(n?t(h,".pushScopeStats(",a,",",h,".getNumPendingQueries(),",u,");"):t(h,".endQuery();"))}function _(t){var r=e.def(c,".profile");e(c,".profile=",t,";"),e.exit(c,".profile=",r,";")}if(p){if(ns(p))return void(p.enable?(m(e),g(e.exit),_("true")):_("false"));_(s=p.append(t,e))}else s=e.def(c,".profile");var v=t.block();m(v),e("if(",s,"){",v,"}");var y=t.block();g(y),e.exit("if(",s,"){",y,"}")}function Y(t,e,r,n,i){var o=t.shared;function a(t){switch(t){case _a:case ba:case Aa:return 2;case va:case Ea:case wa:return 3;case ya:case Ta:case Ca:return 4;default:return 1}}function s(r,n,i){var a=o.gl,s=e.def(r,".location"),l=e.def(o.attributes,"[",s,"]"),u=i.state,c=i.buffer,h=[i.x,i.y,i.z,i.w],p=["buffer","normalized","offset","stride"];function d(){e("if(!",l,".buffer){",a,".enableVertexAttribArray(",s,");}");var r,o=i.type;if(r=i.size?e.def(i.size,"||",n):n,e("if(",l,".type!==",o,"||",l,".size!==",r,"||",p.map((function(t){return l+"."+t+"!=="+i[t]})).join("||"),"){",a,".bindBuffer(",na,",",c,".buffer);",a,".vertexAttribPointer(",[s,r,o,i.normalized,i.stride,i.offset],");",l,".type=",o,";",l,".size=",r,";",p.map((function(t){return l+"."+t+"="+i[t]+";"})).join(""),"}"),_){var u=i.divisor;e("if(",l,".divisor!==",u,"){",t.instancing,".vertexAttribDivisorANGLE(",[s,u],");",l,".divisor=",u,";}")}}function f(){e("if(",l,".buffer){",a,".disableVertexAttribArray(",s,");",l,".buffer=null;","}if(",to.map((function(t,e){return l+"."+t+"!=="+h[e]})).join("||"),"){",a,".vertexAttrib4f(",s,",",h,");",to.map((function(t,e){return l+"."+t+"="+h[e]+";"})).join(""),"}")}u===ro?d():u===no?f():(e("if(",u,"===",ro,"){"),d(),e("}else{"),f(),e("}"))}n.forEach((function(n){var o,l=n.name,u=r.attributes[l];if(u){if(!i(u))return;o=u.append(t,e)}else{if(!i(as))return;var c=t.scopeAttrib(l);rt.optional((function(){t.assert(e,c+".state","missing attribute "+l)})),o={},Object.keys(new m).forEach((function(t){o[t]=e.def(c,".",t)}))}s(t.link(n),a(n.info.type),o)}))}function K(t,r,n,i,o){for(var a,s=t.shared,l=s.gl,u=0;u<i.length;++u){var c,h=i[u],p=h.name,d=h.info.type,f=n.uniforms[p],m=t.link(h)+".location";if(f){if(!o(f))continue;if(ns(f)){var g=f.value;if(rt.command(null!=g,'missing uniform "'+p+'"',t.commandStr),d===Ma||d===Oa){rt.command("function"==typeof g&&(d===Ma&&("texture2d"===g._reglType||"framebuffer"===g._reglType)||d===Oa&&("textureCube"===g._reglType||"framebufferCube"===g._reglType)),"invalid texture for uniform "+p,t.commandStr);var _=t.link(g._texture||g.color[0]._texture);r(l,".uniform1i(",m,",",_+".bind());"),r.exit(_,".unbind();")}else if(d===Ra||d===La||d===Ia){rt.optional((function(){rt.command(ur(g),"invalid matrix for uniform "+p,t.commandStr),rt.command(d===Ra&&4===g.length||d===La&&9===g.length||d===Ia&&16===g.length,"invalid length for matrix uniform "+p,t.commandStr)}));var v=t.global.def("new Float32Array(["+Array.prototype.slice.call(g)+"])"),y=2;d===La?y=3:d===Ia&&(y=4),r(l,".uniformMatrix",y,"fv(",m,",false,",v,");")}else{switch(d){case ga:rt.commandType(g,"number","uniform "+p,t.commandStr),a="1f";break;case _a:rt.command(ur(g)&&2===g.length,"uniform "+p,t.commandStr),a="2f";break;case va:rt.command(ur(g)&&3===g.length,"uniform "+p,t.commandStr),a="3f";break;case ya:rt.command(ur(g)&&4===g.length,"uniform "+p,t.commandStr),a="4f";break;case Sa:rt.commandType(g,"boolean","uniform "+p,t.commandStr),a="1i";break;case xa:rt.commandType(g,"number","uniform "+p,t.commandStr),a="1i";break;case Aa:case ba:rt.command(ur(g)&&2===g.length,"uniform "+p,t.commandStr),a="2i";break;case wa:case Ea:rt.command(ur(g)&&3===g.length,"uniform "+p,t.commandStr),a="3i";break;case Ca:case Ta:rt.command(ur(g)&&4===g.length,"uniform "+p,t.commandStr),a="4i"}r(l,".uniform",a,"(",m,",",ur(g)?Array.prototype.slice.call(g):g,");")}continue}c=f.append(t,r)}else{if(!o(as))continue;c=r.def(s.uniforms,"[",e.id(p),"]")}d===Ma?r("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}"):d===Oa&&r("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}"),rt.optional((function(){function e(e,n){t.assert(r,e,'bad data or missing for uniform "'+p+'".  '+n)}function n(t){e("typeof "+c+'==="'+t+'"',"invalid type, expected "+t)}function i(r,n){e(s.isArrayLike+"("+c+")&&"+c+".length==="+r,"invalid vector, should have length "+r,t.commandStr)}function o(r){e("typeof "+c+'==="function"&&'+c+'._reglType==="texture'+(r===oa?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(d){case xa:n("number");break;case ba:i(2);break;case Ea:i(3);break;case Ta:i(4);break;case ga:n("number");break;case _a:i(2);break;case va:i(3);break;case ya:i(4);break;case Sa:n("boolean");break;case Aa:i(2);break;case wa:i(3);break;case Ca:case Ra:i(4);break;case La:i(9);break;case Ia:i(16);break;case Ma:o(oa);break;case Oa:o(aa)}}));var x=1;switch(d){case Ma:case Oa:var b=r.def(c,"._texture");r(l,".uniform1i(",m,",",b,".bind());"),r.exit(b,".unbind();");continue;case xa:case Sa:a="1i";break;case ba:case Aa:a="2i",x=2;break;case Ea:case wa:a="3i",x=3;break;case Ta:case Ca:a="4i",x=4;break;case ga:a="1f";break;case _a:a="2f",x=2;break;case va:a="3f",x=3;break;case ya:a="4f",x=4;break;case Ra:a="Matrix2fv";break;case La:a="Matrix3fv";break;case Ia:a="Matrix4fv"}if(r(l,".uniform",a,"(",m,","),"M"===a.charAt(0)){var E=Math.pow(d-Ra+2,2),T=t.global.def("new Float32Array(",E,")");r("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",St(E,(function(t){return T+"["+t+"]="+c+"["+t+"]"})),",",T,")")}else r(x>1?St(x,(function(t){return c+"["+t+"]"})):c);r(");")}}function $(t,e,r,n){var i=t.shared,o=i.gl,a=i.draw,s=n.draw;function l(){var i,l=s.elements,u=e;return l?((l.contextDep&&n.contextDynamic||l.propDep)&&(u=r),i=l.append(t,u)):i=u.def(a,".",Go),i&&u("if("+i+")"+o+".bindBuffer("+ia+","+i+".buffer.buffer);"),i}function u(){var i,o=s.count,l=e;return o?((o.contextDep&&n.contextDynamic||o.propDep)&&(l=r),i=o.append(t,l),rt.optional((function(){o.MISSING&&t.assert(e,"false","missing vertex count"),o.DYNAMIC&&t.assert(l,i+">=0","missing vertex count")}))):(i=l.def(a,".",Vo),rt.optional((function(){t.assert(l,i+">=0","missing vertex count")}))),i}var c=l();function h(i){var o=s[i];return o?o.contextDep&&n.contextDynamic||o.propDep?o.append(t,r):o.append(t,e):e.def(a,".",i)}var p,d,f=h(jo),m=h(Ho),g=u();if("number"==typeof g){if(0===g)return}else r("if(",g,"){"),r.exit("}");_&&(p=h(Wo),d=t.instancing);var v=c+".type",y=s.elements&&ns(s.elements);function x(){function t(){r(d,".drawElementsInstancedANGLE(",[f,g,v,m+"<<(("+v+"-"+eo+")>>1)",p],");")}function e(){r(d,".drawArraysInstancedANGLE(",[f,m,g,p],");")}c?y?t():(r("if(",c,"){"),t(),r("}else{"),e(),r("}")):e()}function b(){function t(){r(o+".drawElements("+[f,g,v,m+"<<(("+v+"-"+eo+")>>1)"]+");")}function e(){r(o+".drawArrays("+[f,m,g]+");")}c?y?t():(r("if(",c,"){"),t(),r("}else{"),e(),r("}")):e()}_&&("number"!=typeof p||p>=0)?"string"==typeof p?(r("if(",p,">0){"),x(),r("}else if(",p,"<0){"),b(),r("}")):x():b()}function Q(t,e,r,n,i){var o=I(),a=o.proc("body",i);return rt.optional((function(){o.commandStr=e.commandStr,o.command=o.link(e.commandStr)})),_&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),t(o,a,r,n),o.compile().body}function J(t,e,r,n){Z(t,e),r.useVAO?r.drawVAO?e(t.shared.vao,".setVAO(",r.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),Y(t,e,r,n.attributes,(function(){return!0}))),K(t,e,r,n.uniforms,(function(){return!0})),$(t,e,e,r)}function tt(t,e){var r=t.proc("draw",1);Z(t,r),V(t,r,e.context),H(t,r,e.framebuffer),W(t,r,e),X(t,r,e.state),q(t,r,e,!1,!0);var n=e.shader.progVar.append(t,r);if(r(t.shared.gl,".useProgram(",n,".program);"),e.shader.program)J(t,r,e,e.shader.program);else{r(t.shared.vao,".setVAO(null);");var i=t.global.def("{}"),o=r.def(n,".id"),a=r.def(i,"[",o,"]");r(t.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",t.link((function(r){return Q(J,t,e,r,1)})),"(",n,");",a,".call(this,a0);"))}Object.keys(e.state).length>0&&r(t.shared.current,".dirty=true;")}function et(t,e,r,n){function i(){return!0}t.batchId="a1",Z(t,e),Y(t,e,r,n.attributes,i),K(t,e,r,n.uniforms,i),$(t,e,e,r)}function nt(t,e,r,n){Z(t,e);var i=r.contextDep,o=e.def(),a="a0",s="a1",l=e.def();t.shared.props=l,t.batchId=o;var u=t.scope(),c=t.scope();function h(t){return t.contextDep&&i||t.propDep}function p(t){return!h(t)}if(e(u.entry,"for(",o,"=0;",o,"<",s,";++",o,"){",l,"=",a,"[",o,"];",c,"}",u.exit),r.needsContext&&V(t,c,r.context),r.needsFramebuffer&&H(t,c,r.framebuffer),X(t,c,r.state,h),r.profile&&h(r.profile)&&q(t,c,r,!1,!0),n)r.useVAO?r.drawVAO?h(r.drawVAO)?c(t.shared.vao,".setVAO(",r.drawVAO.append(t,c),");"):u(t.shared.vao,".setVAO(",r.drawVAO.append(t,u),");"):u(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(u(t.shared.vao,".setVAO(null);"),Y(t,u,r,n.attributes,p),Y(t,c,r,n.attributes,h)),K(t,u,r,n.uniforms,p),K(t,c,r,n.uniforms,h),$(t,u,c,r);else{var d=t.global.def("{}"),f=r.shader.progVar.append(t,c),m=c.def(f,".id"),g=c.def(d,"[",m,"]");c(t.shared.gl,".useProgram(",f,".program);","if(!",g,"){",g,"=",d,"[",m,"]=",t.link((function(e){return Q(et,t,r,e,2)})),"(",f,");}",g,".call(this,a0[",o,"],",o,");")}}function it(t,e){var r=t.proc("batch",2);t.batchId="0",Z(t,r);var n=!1,i=!0;Object.keys(e.context).forEach((function(t){n=n||e.context[t].propDep})),n||(V(t,r,e.context),i=!1);var o=e.framebuffer,a=!1;function s(t){return t.contextDep&&n||t.propDep}o?(o.propDep?n=a=!0:o.contextDep&&n&&(a=!0),a||H(t,r,o)):H(t,r,null),e.state.viewport&&e.state.viewport.propDep&&(n=!0),W(t,r,e),X(t,r,e.state,(function(t){return!s(t)})),e.profile&&s(e.profile)||q(t,r,e,!1,"a1"),e.contextDep=n,e.needsContext=i,e.needsFramebuffer=a;var l=e.shader.progVar;if(l.contextDep&&n||l.propDep)nt(t,r,e,null);else{var u=l.append(t,r);if(r(t.shared.gl,".useProgram(",u,".program);"),e.shader.program)nt(t,r,e,e.shader.program);else{r(t.shared.vao,".setVAO(null);");var c=t.global.def("{}"),h=r.def(u,".id"),p=r.def(c,"[",h,"]");r(t.cond(p).then(p,".call(this,a0,a1);").else(p,"=",c,"[",h,"]=",t.link((function(r){return Q(nt,t,e,r,2)})),"(",u,");",p,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&r(t.shared.current,".dirty=true;")}function ot(t,r){var n=t.proc("scope",3);t.batchId="a2";var i=t.shared,o=i.current;function a(e){var o=r.shader[e];o&&n.set(i.shader,"."+e,o.append(t,n))}V(t,n,r.context),r.framebuffer&&r.framebuffer.append(t,n),es(Object.keys(r.state)).forEach((function(e){var o=r.state[e].append(t,n);ur(o)?o.forEach((function(r,i){n.set(t.next[e],"["+i+"]",r)})):n.set(i.next,"."+e,o)})),q(t,n,r,!0,!0),[Go,Ho,Vo,Wo,jo].forEach((function(e){var o=r.draw[e];o&&n.set(i.draw,"."+e,""+o.append(t,n))})),Object.keys(r.uniforms).forEach((function(o){n.set(i.uniforms,"["+e.id(o)+"]",r.uniforms[o].append(t,n))})),Object.keys(r.attributes).forEach((function(e){var i=r.attributes[e].append(t,n),o=t.scopeAttrib(e);Object.keys(new m).forEach((function(t){n.set(o,"."+t,i[t])}))})),r.scopeVAO&&n.set(i.vao,".targetVAO",r.scopeVAO.append(t,n)),a(Uo),a(zo),Object.keys(r.state).length>0&&(n(o,".dirty=true;"),n.exit(o,".dirty=true;")),n("a1(",t.shared.context,",a0,",t.batchId,");")}function at(t){if("object"==typeof t&&!ur(t)){for(var e=Object.keys(t),r=0;r<e.length;++r)if(pt.isDynamic(t[e[r]]))return!0;return!1}}function st(t,e,r){var n=e.static[r];if(n&&at(n)){var i=t.global,o=Object.keys(n),a=!1,s=!1,l=!1,u=t.global.def("{}");o.forEach((function(e){var r=n[e];if(pt.isDynamic(r)){"function"==typeof r&&(r=n[e]=pt.unbox(r));var o=os(r,null);a=a||o.thisDep,l=l||o.propDep,s=s||o.contextDep}else{switch(i(u,".",e,"="),typeof r){case"number":i(r);break;case"string":i('"',r,'"');break;case"object":Array.isArray(r)&&i("[",r.join(),"]");break;default:i(t.link(r))}i(";")}})),e.dynamic[r]=new pt.DynamicVariable(lo,{thisDep:a,contextDep:s,propDep:l,ref:u,append:c}),delete e.static[r]}function c(t,e){o.forEach((function(r){var i=n[r];if(pt.isDynamic(i)){var o=t.invoke(e,i);e(u,".",r,"=",o,";")}}))}}function lt(t,e,r,n,i){var o=I();o.stats=o.link(i),Object.keys(e.static).forEach((function(t){st(o,e,t)})),ra.forEach((function(e){st(o,t,e)}));var a=j(t,e,r,n,o);return tt(o,a),ot(o,a),it(o,a),o.compile()}return{next:x,current:y,procs:function(){var t=I(),e=t.proc("poll"),i=t.proc("refresh"),o=t.block();e(o),i(o);var a,s=t.shared,l=s.gl,u=s.next,c=s.current;o(c,".dirty=false;"),H(t,e),H(t,i,null,!0),_&&(a=t.link(_)),r.oes_vertex_array_object&&i(t.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<n.maxAttributes;++h){var p=i.def(s.attributes,"[",h,"]"),d=t.cond(p,".buffer");d.then(l,".enableVertexAttribArray(",h,");",l,".bindBuffer(",na,",",p,".buffer.buffer);",l,".vertexAttribPointer(",h,",",p,".size,",p,".type,",p,".normalized,",p,".stride,",p,".offset);").else(l,".disableVertexAttribArray(",h,");",l,".vertexAttrib4f(",h,",",p,".x,",p,".y,",p,".z,",p,".w);",p,".buffer=null;"),i(d),_&&i(a,".vertexAttribDivisorANGLE(",h,",",p,".divisor);")}return i(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(E).forEach((function(r){var n=E[r],a=o.def(u,".",r),s=t.block();s("if(",a,"){",l,".enable(",n,")}else{",l,".disable(",n,")}",c,".",r,"=",a,";"),i(s),e("if(",a,"!==",c,".",r,"){",s,"}")})),Object.keys(T).forEach((function(r){var n,a,s=T[r],h=y[r],p=t.block();if(p(l,".",s,"("),ur(h)){var d=h.length;n=t.global.def(u,".",r),a=t.global.def(c,".",r),p(St(d,(function(t){return n+"["+t+"]"})),");",St(d,(function(t){return a+"["+t+"]="+n+"["+t+"];"})).join("")),e("if(",St(d,(function(t){return n+"["+t+"]!=="+a+"["+t+"]"})).join("||"),"){",p,"}")}else n=o.def(u,".",r),a=o.def(c,".",r),p(n,");",c,".",r,"=",n,";"),e("if(",n,"!==",a,"){",p,"}");i(p)})),t.compile()}(),compile:lt}}function ls(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var us=34918,cs=34919,hs=35007,ps=function(t,e){if(!e.ext_disjoint_timer_query)return null;var r=[];function n(){return r.pop()||e.ext_disjoint_timer_query.createQueryEXT()}function i(t){r.push(t)}var o=[];function a(t){var r=n();e.ext_disjoint_timer_query.beginQueryEXT(hs,r),o.push(r),d(o.length-1,o.length,t)}function s(){e.ext_disjoint_timer_query.endQueryEXT(hs)}function l(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var u=[];function c(){return u.pop()||new l}function h(t){u.push(t)}var p=[];function d(t,e,r){var n=c();n.startQueryIndex=t,n.endQueryIndex=e,n.sum=0,n.stats=r,p.push(n)}var f=[],m=[];function g(){var t,r,n=o.length;if(0!==n){m.length=Math.max(m.length,n+1),f.length=Math.max(f.length,n+1),f[0]=0,m[0]=0;var a=0;for(t=0,r=0;r<o.length;++r){var s=o[r];e.ext_disjoint_timer_query.getQueryObjectEXT(s,cs)?(a+=e.ext_disjoint_timer_query.getQueryObjectEXT(s,us),i(s)):o[t++]=s,f[r+1]=a,m[r+1]=t}for(o.length=t,t=0,r=0;r<p.length;++r){var l=p[r],u=l.startQueryIndex,c=l.endQueryIndex;l.sum+=f[c]-f[u];var d=m[u],g=m[c];g===d?(l.stats.gpuTime+=l.sum/1e6,h(l)):(l.startQueryIndex=d,l.endQueryIndex=g,p[t++]=l)}p.length=t}}return{beginQuery:a,endQuery:s,pushScopeStats:d,update:g,getNumPendingQueries:function(){return o.length},clear:function(){r.push.apply(r,o);for(var t=0;t<r.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(r[t]);o.length=0,r.length=0},restore:function(){o.length=0,r.length=0}}},ds=16384,fs=256,ms=1024,gs=34962,_s="webglcontextlost",vs="webglcontextrestored",ys=1,xs=2,bs=3;function Es(t,e){for(var r=0;r<t.length;++r)if(t[r]===e)return r;return-1}function Ts(t){var r=Et(t);if(!r)return null;var n=r.gl,i=n.getContextAttributes(),o=n.isContextLost(),a=Tt(n,r);if(!a)return null;var s=mt(),l=ls(),u=a.extensions,c=ps(n,u),h=ft(),p=n.drawingBufferWidth,d=n.drawingBufferHeight,f={tick:0,time:0,viewportWidth:p,viewportHeight:d,framebufferWidth:p,framebufferHeight:d,drawingBufferWidth:p,drawingBufferHeight:d,pixelRatio:r.pixelRatio},m={},g={elements:null,primitive:4,count:-1,offset:0,instances:-1},_=xe(n,u),v=Ve(n,l,r,x),y=zi(n,u,_,l,v);function x(t){return y.destroyBuffer(t)}var b=ir(n,u,v,l),E=Wi(n,s,l,r),T=qn(n,u,_,(function(){w.procs.poll()}),f,l,r),S=li(n,u,_,l,r),A=Ni(n,u,_,T,S,l),w=ss(n,s,u,_,v,b,T,A,m,y,E,g,f,c,r),C=Ki(n,A,w.procs.poll,f,i,u,_),R=w.next,L=n.canvas,I=[],M=[],O=[],P=[r.onDestroy],D=null;function B(){if(0===I.length)return c&&c.update(),void(D=null);D=dt.next(B),Z();for(var t=I.length-1;t>=0;--t){var e=I[t];e&&e(f,null,0)}n.flush(),c&&c.update()}function N(){!D&&I.length>0&&(D=dt.next(B))}function F(){D&&(dt.cancel(B),D=null)}function k(t){t.preventDefault(),o=!0,F(),M.forEach((function(t){t()}))}function U(t){n.getError(),o=!1,a.restore(),E.restore(),v.restore(),T.restore(),S.restore(),A.restore(),y.restore(),c&&c.restore(),w.procs.refresh(),N(),O.forEach((function(t){t()}))}function z(){I.length=0,F(),L&&(L.removeEventListener(_s,k),L.removeEventListener(vs,U)),E.clear(),A.clear(),S.clear(),T.clear(),b.clear(),v.clear(),y.clear(),c&&c.clear(),P.forEach((function(t){t()}))}function G(t){function r(t){var r=e({},t);function n(t){if(t in r){var e=r[t];delete r[t],Object.keys(e).forEach((function(n){r[t+"."+n]=e[n]}))}}return delete r.uniforms,delete r.attributes,delete r.context,delete r.vao,"stencil"in r&&r.stencil.op&&(r.stencil.opBack=r.stencil.opFront=r.stencil.op,delete r.stencil.op),n("blend"),n("depth"),n("cull"),n("stencil"),n("polygonOffset"),n("scissor"),n("sample"),"vao"in t&&(r.vao=t.vao),r}function n(t){var e={},r={};return Object.keys(t).forEach((function(n){var i=t[n];pt.isDynamic(i)?r[n]=pt.unbox(i,n):e[n]=i})),{dynamic:r,static:e}}rt(!!t,"invalid args to regl({...})"),rt.type(t,"object","invalid args to regl({...})");var i=n(t.context||{}),a=n(t.uniforms||{}),s=n(t.attributes||{}),l=n(r(t)),u={gpuTime:0,cpuTime:0,count:0},c=w.compile(l,s,a,i,u),h=c.draw,p=c.batch,d=c.scope,f=[];function m(t){for(;f.length<t;)f.push(null);return f}function g(t,e){var r;if(o&&rt.raise("context lost"),"function"==typeof t)return d.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(r=0;r<t;++r)d.call(this,null,e,r);else{if(!Array.isArray(t))return d.call(this,t,e,0);for(r=0;r<t.length;++r)d.call(this,t[r],e,r)}else if("number"==typeof t){if(t>0)return p.call(this,m(0|t),0|t)}else{if(!Array.isArray(t))return h.call(this,t);if(t.length)return p.call(this,t,t.length)}}return e(g,{stats:u})}L&&(L.addEventListener(_s,k,!1),L.addEventListener(vs,U,!1));var j=A.setFBO=G({framebuffer:pt.define.call(null,ys,"framebuffer")});function V(t,e){var r=0;w.procs.poll();var i=e.color;i&&(n.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),r|=ds),"depth"in e&&(n.clearDepth(+e.depth),r|=fs),"stencil"in e&&(n.clearStencil(0|e.stencil),r|=ms),rt(!!r,"called regl.clear with no buffer specified"),n.clear(r)}function H(t){if(rt("object"==typeof t&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var r=0;r<6;++r)j(e({framebuffer:t.framebuffer.faces[r]},t),V);else j(t,V);else V(null,t)}function W(t){function e(){var e=Es(I,t);function r(){var t=Es(I,r);I[t]=I[I.length-1],I.length-=1,I.length<=0&&F()}rt(e>=0,"cannot cancel a frame twice"),I[e]=r}return rt.type(t,"function","regl.frame() callback must be a function"),I.push(t),N(),{cancel:e}}function X(){var t=R.viewport,e=R.scissor_box;t[0]=t[1]=e[0]=e[1]=0,f.viewportWidth=f.framebufferWidth=f.drawingBufferWidth=t[2]=e[2]=n.drawingBufferWidth,f.viewportHeight=f.framebufferHeight=f.drawingBufferHeight=t[3]=e[3]=n.drawingBufferHeight}function Z(){f.tick+=1,f.time=Y(),X(),w.procs.poll()}function q(){X(),w.procs.refresh(),c&&c.update()}function Y(){return(ft()-h)/1e3}function K(t,e){var r;switch(rt.type(e,"function","listener callback must be a function"),t){case"frame":return W(e);case"lost":r=M;break;case"restore":r=O;break;case"destroy":r=P;break;default:rt.raise("invalid event, must be one of frame,lost,restore,destroy")}return r.push(e),{cancel:function(){for(var t=0;t<r.length;++t)if(r[t]===e)return r[t]=r[r.length-1],void r.pop()}}}q();var $=e(G,{clear:H,prop:pt.define.bind(null,ys),context:pt.define.bind(null,xs),this:pt.define.bind(null,bs),draw:G({}),buffer:function(t){return v.create(t,gs,!1,!1)},elements:function(t){return b.create(t,!1)},texture:T.create2D,cube:T.createCube,renderbuffer:S.create,framebuffer:A.create,framebufferCube:A.createCube,vao:y.createVAO,attributes:i,frame:W,on:K,limits:_,hasExtension:function(t){return _.extensions.indexOf(t.toLowerCase())>=0},read:C,destroy:z,_gl:n,_refresh:q,poll:function(){Z(),c&&c.update()},now:Y,stats:l});return r.onDone(null,$),$}return Ts}()}(wk);var Ck,Rk,Lk,Ik,Mk=wk.exports,Ok=class{constructor(t,e){const{buffer:r,offset:n,stride:i,normalized:o,size:a,divisor:s}=e;this.buffer=r,this.attribute={buffer:r.get(),offset:n||0,stride:i||0,normalized:o||!1,divisor:s||0},a&&(this.attribute.size=a)}get(){return this.attribute}updateBuffer(t){this.buffer.subData(t)}destroy(){this.buffer.destroy()}},Pk={[x_.POINTS]:"points",[x_.LINES]:"lines",[x_.LINE_LOOP]:"line loop",[x_.LINE_STRIP]:"line strip",[x_.TRIANGLES]:"triangles",[x_.TRIANGLE_FAN]:"triangle fan",[x_.TRIANGLE_STRIP]:"triangle strip"},Dk={[x_.STATIC_DRAW]:"static",[x_.DYNAMIC_DRAW]:"dynamic",[x_.STREAM_DRAW]:"stream"},Bk={[x_.BYTE]:"int8",[x_.INT]:"int32",[x_.UNSIGNED_BYTE]:"uint8",[x_.UNSIGNED_SHORT]:"uint16",[x_.UNSIGNED_INT]:"uint32",[x_.FLOAT]:"float"},Nk={[x_.ALPHA]:"alpha",[x_.LUMINANCE]:"luminance",[x_.LUMINANCE_ALPHA]:"luminance alpha",[x_.RGB]:"rgb",[x_.RGBA]:"rgba",[x_.RGBA4]:"rgba4",[x_.RGB5_A1]:"rgb5 a1",[x_.RGB565]:"rgb565",[x_.DEPTH_COMPONENT]:"depth",[x_.DEPTH_STENCIL]:"depth stencil"},Fk={[x_.DONT_CARE]:"dont care",[x_.NICEST]:"nice",[x_.FASTEST]:"fast"},kk={[x_.NEAREST]:"nearest",[x_.LINEAR]:"linear",[x_.LINEAR_MIPMAP_LINEAR]:"mipmap",[x_.NEAREST_MIPMAP_LINEAR]:"nearest mipmap linear",[x_.LINEAR_MIPMAP_NEAREST]:"linear mipmap nearest",[x_.NEAREST_MIPMAP_NEAREST]:"nearest mipmap nearest"},Uk={[x_.REPEAT]:"repeat",[x_.CLAMP_TO_EDGE]:"clamp",[x_.MIRRORED_REPEAT]:"mirror"},zk={[x_.NONE]:"none",[x_.BROWSER_DEFAULT_WEBGL]:"browser"},Gk={[x_.NEVER]:"never",[x_.ALWAYS]:"always",[x_.LESS]:"less",[x_.LEQUAL]:"lequal",[x_.GREATER]:"greater",[x_.GEQUAL]:"gequal",[x_.EQUAL]:"equal",[x_.NOTEQUAL]:"notequal"},jk={[x_.FUNC_ADD]:"add",[x_.MIN_EXT]:"min",[x_.MAX_EXT]:"max",[x_.FUNC_SUBTRACT]:"subtract",[x_.FUNC_REVERSE_SUBTRACT]:"reverse subtract"},Vk={[x_.ZERO]:"zero",[x_.ONE]:"one",[x_.SRC_COLOR]:"src color",[x_.ONE_MINUS_SRC_COLOR]:"one minus src color",[x_.SRC_ALPHA]:"src alpha",[x_.ONE_MINUS_SRC_ALPHA]:"one minus src alpha",[x_.DST_COLOR]:"dst color",[x_.ONE_MINUS_DST_COLOR]:"one minus dst color",[x_.DST_ALPHA]:"dst alpha",[x_.ONE_MINUS_DST_ALPHA]:"one minus dst alpha",[x_.CONSTANT_COLOR]:"constant color",[x_.ONE_MINUS_CONSTANT_COLOR]:"one minus constant color",[x_.CONSTANT_ALPHA]:"constant alpha",[x_.ONE_MINUS_CONSTANT_ALPHA]:"one minus constant alpha",[x_.SRC_ALPHA_SATURATE]:"src alpha saturate"},Hk={[x_.NEVER]:"never",[x_.ALWAYS]:"always",[x_.LESS]:"less",[x_.LEQUAL]:"lequal",[x_.GREATER]:"greater",[x_.GEQUAL]:"gequal",[x_.EQUAL]:"equal",[x_.NOTEQUAL]:"notequal"},Wk={[x_.ZERO]:"zero",[x_.KEEP]:"keep",[x_.REPLACE]:"replace",[x_.INVERT]:"invert",[x_.INCR]:"increment",[x_.DECR]:"decrement",[x_.INCR_WRAP]:"increment wrap",[x_.DECR_WRAP]:"decrement wrap"},Xk={[x_.FRONT]:"front",[x_.BACK]:"back"},Zk=class{constructor(t,e){this.isDestroyed=!1;const{data:r,usage:n,type:i}=e;this.buffer=t.buffer({data:r,usage:Dk[n||x_.STATIC_DRAW],type:Bk[i||x_.UNSIGNED_BYTE]})}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:t,offset:e}){this.buffer.subdata(t,e)}},qk=class{constructor(t,e){const{data:r,usage:n,type:i,count:o}=e;this.elements=t.elements({data:r,usage:Dk[n||x_.STATIC_DRAW],type:Bk[i||x_.UNSIGNED_BYTE],count:o})}get(){return this.elements}subData({data:t}){this.elements.subdata(t)}destroy(){}},Yk=class{constructor(t,e){const{width:r,height:n,color:i,colors:o}=e,a={width:r,height:n};Array.isArray(o)&&(a.colors=o.map((t=>t.get()))),i&&"boolean"!=typeof i&&(a.color=i.get()),this.framebuffer=t.framebuffer(a)}get(){return this.framebuffer}destroy(){this.framebuffer.destroy()}resize({width:t,height:e}){this.framebuffer.resize(t,e)}},Kk=Object.defineProperty,$k=Object.defineProperties,Qk=Object.getOwnPropertyDescriptors,Jk=Object.getOwnPropertySymbols,tU=Object.prototype.hasOwnProperty,eU=Object.prototype.propertyIsEnumerable,rU=(t,e,r)=>e in t?Kk(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nU=(t,e)=>{for(var r in e||(e={}))tU.call(e,r)&&rU(t,r,e[r]);if(Jk)for(var r of Jk(e))eU.call(e,r)&&rU(t,r,e[r]);return t},{isPlainObject:iU,isTypedArray:oU}=ld,aU=class{constructor(t,e){this.destroyed=!1,this.uniforms={},this.reGl=t;const{vs:r,fs:n,attributes:i,uniforms:o,primitive:a,count:s,elements:l,depth:u,cull:c,instances:h}=e,p={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:wD.LOWER_LEFT,clipSpaceNearZ:CD.NEGATIVE_ONE,supportMRT:!1},d={};this.options=e,o&&(this.uniforms=this.extractUniforms(o),Object.keys(o).forEach((e=>{d[e]=t.prop(e)})));const f={};Object.keys(i).forEach((t=>{f[t]=i[t].get()}));const m=R_(ZB(p,"frag",n,null,!1)),g=R_(ZB(p,"vert",r,null,!1)),_={attributes:f,frag:m,uniforms:d,vert:g,colorMask:t.prop("colorMask"),lineWidth:1,blend:{enable:t.prop("blend.enable"),func:t.prop("blend.func"),equation:t.prop("blend.equation"),color:t.prop("blend.color")},stencil:{enable:t.prop("stencil.enable"),mask:t.prop("stencil.mask"),func:t.prop("stencil.func"),opFront:t.prop("stencil.opFront"),opBack:t.prop("stencil.opBack")},primitive:Pk[void 0===a?x_.TRIANGLES:a]};h&&(_.instances=h),s?_.count=s:l&&(_.elements=l.get()),this.initDepthDrawParams({depth:u},_),this.initCullDrawParams({cull:c},_),this.drawCommand=t(_),this.drawParams=_}updateAttributesAndElements(t,e){const r={};Object.keys(t).forEach((e=>{r[e]=t[e].get()})),this.drawParams.attributes=r,this.drawParams.elements=e.get(),this.drawCommand=this.reGl(this.drawParams)}updateAttributes(t){const e={};Object.keys(t).forEach((r=>{e[r]=t[r].get()})),this.drawParams.attributes=e,this.drawCommand=this.reGl(this.drawParams)}addUniforms(t){this.uniforms=nU(nU({},this.uniforms),this.extractUniforms(t))}draw(t,e){if(this.drawParams.attributes&&0===Object.keys(this.drawParams.attributes).length)return;const r=nU(nU({},this.uniforms),this.extractUniforms(t.uniforms||{})),n={};Object.keys(r).forEach((t=>{const e=typeof r[t];"boolean"===e||"number"===e||Array.isArray(r[t])||r[t].BYTES_PER_ELEMENT?n[t]=r[t]:n[t]=r[t].get()})),n.blend=e?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(t),n.stencil=this.getStencilDrawParams(t),n.colorMask=this.getColorMaskDrawParams(t,e),this.drawCommand(n)}destroy(){var t,e;null==(e=null==(t=this.drawParams)?void 0:t.elements)||e.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((t=>{null==t||t.destroy()})),this.destroyed=!0}initDepthDrawParams({depth:t},e){t&&(e.depth={enable:void 0===t.enable||!!t.enable,mask:void 0===t.mask||!!t.mask,func:Gk[t.func||x_.LESS],range:t.range||[0,1]})}getBlendDrawParams({blend:t}){const{enable:e,func:r,equation:n,color:i=[0,0,0,0]}=t||{};return{enable:!!e,func:{srcRGB:Vk[r&&r.srcRGB||x_.SRC_ALPHA],srcAlpha:Vk[r&&r.srcAlpha||x_.SRC_ALPHA],dstRGB:Vk[r&&r.dstRGB||x_.ONE_MINUS_SRC_ALPHA],dstAlpha:Vk[r&&r.dstAlpha||x_.ONE_MINUS_SRC_ALPHA]},equation:{rgb:jk[n&&n.rgb||x_.FUNC_ADD],alpha:jk[n&&n.alpha||x_.FUNC_ADD]},color:i}}getStencilDrawParams({stencil:t}){const{enable:e,mask:r=-1,func:n={cmp:x_.ALWAYS,ref:0,mask:-1},opFront:i={fail:x_.KEEP,zfail:x_.KEEP,zpass:x_.KEEP},opBack:o={fail:x_.KEEP,zfail:x_.KEEP,zpass:x_.KEEP}}=t||{};return{enable:!!e,mask:r,func:(a=nU({},n),s={cmp:Hk[n.cmp]},$k(a,Qk(s))),opFront:{fail:Wk[i.fail],zfail:Wk[i.zfail],zpass:Wk[i.zpass]},opBack:{fail:Wk[o.fail],zfail:Wk[o.zfail],zpass:Wk[o.zpass]}};var a,s}getColorMaskDrawParams({stencil:t},e){return(null==t?void 0:t.enable)&&t.opFront&&!e?[!1,!1,!1,!1]:[!0,!0,!0,!0]}initCullDrawParams({cull:t},e){if(t){const{enable:r,face:n=x_.BACK}=t;e.cull={enable:!!r,face:Xk[n]}}}extractUniforms(t){const e={};return Object.keys(t).forEach((r=>{this.extractUniformsRecursively(r,t[r],e,"")})),e}extractUniformsRecursively(t,e,r,n){null===e||"number"==typeof e||"boolean"==typeof e||Array.isArray(e)&&"number"==typeof e[0]||oU(e)||""===e||"resize"in e?r[`${n&&n+"."}${t}`]=e:(iU(e)&&Object.keys(e).forEach((i=>{this.extractUniformsRecursively(i,e[i],r,`${n&&n+"."}${t}`)})),Array.isArray(e)&&e.forEach(((e,i)=>{Object.keys(e).forEach((o=>{this.extractUniformsRecursively(o,e[o],r,`${n&&n+"."}${t}[${i}]`)}))})))}},sU=class{constructor(t,e){this.isDestroy=!1;const{data:r,type:n=x_.UNSIGNED_BYTE,width:i,height:o,flipY:a=!1,format:s=x_.RGBA,mipmap:l=!1,wrapS:u=x_.CLAMP_TO_EDGE,wrapT:c=x_.CLAMP_TO_EDGE,aniso:h=0,alignment:p=1,premultiplyAlpha:d=!1,mag:f=x_.NEAREST,min:m=x_.NEAREST,colorSpace:g=x_.BROWSER_DEFAULT_WEBGL,x:_=0,y:v=0,copy:y=!1}=e;this.width=i,this.height=o;const x={width:i,height:o,type:Bk[n],format:Nk[s],wrapS:Uk[u],wrapT:Uk[c],mag:kk[f],min:kk[m],alignment:p,flipY:a,colorSpace:zk[g],premultiplyAlpha:d,aniso:h,x:_,y:v,copy:y};r&&(x.data=r),"number"==typeof l?x.mipmap=Fk[l]:"boolean"==typeof l&&(x.mipmap=l),this.texture=t.texture(x)}get(){return this.texture}update(t={}){this.texture(t)}bind(){this.texture._texture.bind()}resize({width:t,height:e}){this.texture.resize(t,e),this.width=t,this.height=e}getSize(){return[this.width,this.height]}destroy(){var t;this.isDestroy||null==(t=this.texture)||t.destroy(),this.isDestroy=!0}},lU=(t,e,r)=>new Promise(((n,i)=>{var o=t=>{try{s(r.next(t))}catch(t){i(t)}},a=t=>{try{s(r.throw(t))}catch(t){i(t)}},s=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,a);s((r=r.apply(t,e)).next())})),uU=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>"WebGL1",this.createModel=t=>new aU(this.gl,t),this.createAttribute=t=>new Ok(this.gl,t),this.createBuffer=t=>new Zk(this.gl,t),this.createElements=t=>new qk(this.gl,t),this.createTexture2D=t=>new sU(this.gl,t),this.createFramebuffer=t=>new Yk(this.gl,t),this.useFramebuffer=(t,e)=>{this.gl({framebuffer:t?t.get():null})(e)},this.useFramebufferAsync=(t,e)=>lU(this,null,(function*(){this.gl({framebuffer:t?t.get():null})(e)})),this.clear=t=>{var e;const{color:r,depth:n,stencil:i,framebuffer:o=null}=t,a={color:r,depth:n,stencil:i};a.framebuffer=null===o?o:o.get(),null==(e=this.gl)||e.clear(a)},this.viewport=({x:t,y:e,width:r,height:n})=>{this.gl._gl.viewport(t,e,r,n),this.width=r,this.height=n,this.gl._refresh()},this.readPixels=t=>{const{framebuffer:e,x:r,y:n,width:i,height:o}=t,a={x:r,y:n,width:i,height:o};return e&&(a.framebuffer=e.get()),this.gl.read(a)},this.readPixelsAsync=t=>lU(this,null,(function*(){return this.readPixels(t)})),this.getViewportSize=()=>({width:this.gl._gl.drawingBufferWidth,height:this.gl._gl.drawingBufferHeight}),this.getContainer=()=>{var t;return null==(t=this.canvas)?void 0:t.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.gl._gl,this.destroy=()=>{var t,e,r;this.canvas=null,null==(r=null==(e=null==(t=this.gl)?void 0:t._gl)?void 0:e.getExtension("WEBGL_lose_context"))||r.loseContext(),this.gl.destroy(),this.gl=null}}init(t,e,r){return lU(this,null,(function*(){this.canvas=t,this.gl=r||(yield new Promise(((t,r)=>{Mk({canvas:this.canvas,attributes:{alpha:!0,antialias:e.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,stencil:e.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:(e,n)=>{!e&&n||r(e),t(n)}})}))),this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")}}))}getPointSizeRange(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}testExtension(t){return!!this.getGLContext().getExtension(t)}setState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}setBaseState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}setCustomLayerDefaults(){const t=this.getGLContext();t.disable(t.CULL_FACE)}setDirty(t){this.isDirty=t}getDirty(){return this.isDirty}beginFrame(){}endFrame(){}},cU=["selectstart","selecting","selectend"],hU=class extends Vd.exports.EventEmitter{constructor(t,e={}){super(),this.isEnable=!1,this.onDragStart=t=>{this.box.style.display="block",this.startEvent=this.endEvent=t,this.syncBoxBound(),this.emit("selectstart",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragging=t=>{this.endEvent=t,this.syncBoxBound(),this.emit("selecting",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragEnd=t=>{this.endEvent=t,this.box.style.display="none",this.emit("selectend",this.getLngLatBox(),this.startEvent,this.endEvent)},this.scene=t,this.options=e}get container(){return this.scene.getMapService().getMarkerContainer()}enable(){if(this.isEnable)return;const{className:t}=this.options;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){const e=pd("div",void 0,this.container);e.classList.add("l7-select-box"),t&&e.classList.add(t),e.style.display="none",this.box=e}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}disable(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}syncBoxBound(){const{x:t,y:e}=this.startEvent,{x:r,y:n}=this.endEvent,i=Math.min(t,r),o=Math.min(e,n),a=Math.abs(t-r),s=Math.abs(e-n);this.box.style.top=`${o}px`,this.box.style.left=`${i}px`,this.box.style.width=`${a}px`,this.box.style.height=`${s}px`}getLngLatBox(){const{lngLat:{lng:t,lat:e}}=this.startEvent,{lngLat:{lng:r,lat:n}}=this.endEvent;return Td(function(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}([Rt([[t,e],[r,n]])]))}},pU=Object.defineProperty,dU=Object.defineProperties,fU=Object.getOwnPropertyDescriptors,mU=Object.getOwnPropertySymbols,gU=Object.prototype.hasOwnProperty,_U=Object.prototype.propertyIsEnumerable,vU=(t,e,r)=>e in t?pU(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yU=(t,e,r)=>new Promise(((n,i)=>{var o=t=>{try{s(r.next(t))}catch(t){i(t)}},a=t=>{try{s(r.throw(t))}catch(t){i(t)}},s=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,a);s((r=r.apply(t,e)).next())})),xU=class{constructor(t){const{id:e,map:r,renderer:n="device"}=t,i=function(){const t=new rb,e=new dy,r=new Jv,n=new py(r),i=new xv,o=new Tv,a=new ry,s=new ny,l=new ey,u={id:""+Eb++,globalConfigService:bb,shaderModuleService:t,debugService:e,cameraService:r,coordinateSystemService:n,fontService:i,iconService:o,markerService:a,popupService:s,controlService:l,customRenderService:{}},c=new Sy(u);u.layerService=c;const h=new Xx(u);u.sceneService=h;const p=new vy(u);u.interactionService=p;const d=new by(u);u.pickingService=d;const f={clear:new ib,pixelPicking:new ab,render:new lb};u.normalPassFactory=t=>f[t];const m={copy:new gb,bloom:new cb,blurH:new pb,blurV:new fb,noise:new yb,sepia:new xb,colorHalftone:new mb,hexagonalPixelate:new _b,ink:new vb};return u.postProcessingPass=m,u.postProcessingPassFactory=t=>m[t],u}();this.container=i,r.setContainer(i,e),i.rendererService="regl"===n?new uU:new Ak,this.sceneService=i.sceneService,this.mapService=i.mapService,this.iconService=i.iconService,this.fontService=i.fontService,this.controlService=i.controlService,this.layerService=i.layerService,this.debugService=i.debugService,this.debugService.setEnable(t.debug),this.markerService=i.markerService,this.interactionService=i.interactionService,this.popupService=i.popupService,this.boxSelect=new hU(this,{}),this.initComponent(e),this.sceneService.init(t),this.initControl()}get map(){return this.mapService.map}get loaded(){return this.sceneService.loaded}getServiceContainer(){return this.container}getSize(){return this.mapService.getSize()}getMinZoom(){return this.mapService.getMinZoom()}getMaxZoom(){return this.mapService.getMaxZoom()}getType(){return this.mapService.getType()}getMapContainer(){return this.mapService.getMapContainer()}getMapCanvasContainer(){return this.mapService.getMapCanvasContainer()}getMapService(){return this.mapService}getDebugService(){return this.debugService}exportPng(t){return yU(this,null,(function*(){return this.sceneService.exportPng(t)}))}exportMap(t){return yU(this,null,(function*(){return this.sceneService.exportPng(t)}))}registerRenderService(t){if(this.sceneService.loaded){new t(this).init()}else this.on("loaded",(()=>{new t(this).init()}))}setBgColor(t){this.mapService.setBgColor(t)}addLayer(t){this.loaded?this.preAddLayer(t):this.once("loaded",(()=>{this.preAddLayer(t)}))}preAddLayer(t){const e=Tb(this.container);if(t.setContainer(e),this.sceneService.addLayer(t),t.inited){this.initTileLayer(t);const e=this.initMask(t);this.addMask(e,t.id)}else t.on("inited",(()=>{this.initTileLayer(t);const e=this.initMask(t);this.addMask(e,t.id)}))}initMask(t){const{mask:e,maskfence:r,maskColor:n="#000",maskOpacity:i=0}=t.getLayerConfig();if(!e||!r)return;return(new aM).source(r).shape("fill").style({color:n,opacity:i})}addMask(t,e){if(!t)return;const r=this.getLayer(e);if(r){const e=Tb(this.container);t.setContainer(e),r.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}getPickedLayer(){return this.layerService.pickedLayerId}getLayers(){return this.layerService.getLayers()}getLayer(t){return this.layerService.getLayer(t)}getLayerByName(t){return this.layerService.getLayerByName(t)}removeLayer(t,e){return yU(this,null,(function*(){yield this.layerService.remove(t,e)}))}removeAllLayer(){return yU(this,null,(function*(){yield this.layerService.removeAllLayers()}))}render(){this.sceneService.render()}setEnableRender(t){this.layerService.setEnableRender(t)}addIconFont(t,e){this.fontService.addIconFont(t,e)}addIconFonts(t){t.forEach((([t,e])=>{this.fontService.addIconFont(t,e)}))}addFontFace(t,e){this.fontService.once("fontloaded",(t=>{this.emit("fontloaded",t)})),this.fontService.addFontFace(t,e)}addImage(t,e){return yU(this,null,(function*(){yield this.iconService.addImage(t,e)}))}hasImage(t){return this.iconService.hasImage(t)}removeImage(t){this.iconService.removeImage(t)}addIconFontGlyphs(t,e){this.fontService.addIconGlyphs(e)}addControl(t){this.controlService.addControl(t,this.container)}removeControl(t){this.controlService.removeControl(t)}getControlByName(t){return this.controlService.getControlByName(t)}addMarker(t){this.markerService.addMarker(t)}addMarkerLayer(t){this.markerService.addMarkerLayer(t)}removeMarkerLayer(t){this.markerService.removeMarkerLayer(t)}removeAllMarkers(){this.markerService.removeAllMarkers()}removeAllMakers(){console.warn("removeAllMakers 已废弃，请使用 removeAllMarkers"),this.markerService.removeAllMarkers()}addPopup(t){this.popupService.addPopup(t)}removePopup(t){this.popupService.removePopup(t)}on(t,e){var r;cU.includes(t)?null==(r=this.boxSelect)||r.on(t,e):Sb.includes(t)?this.sceneService.on(t,e):this.mapService.on(t,e)}once(t,e){var r;cU.includes(t)?null==(r=this.boxSelect)||r.once(t,e):Sb.includes(t)?this.sceneService.once(t,e):this.mapService.once(t,e)}emit(t,e){-1===Sb.indexOf(t)?this.mapService.on(t,e):this.sceneService.emit(t,e)}off(t,e){var r;cU.includes(t)?null==(r=this.boxSelect)||r.off(t,e):Sb.includes(t)?this.sceneService.off(t,e):this.mapService.off(t,e)}getZoom(){return this.mapService.getZoom()}getCenter(t){return this.mapService.getCenter(t)}setCenter(t,e){return this.mapService.setCenter(t,e)}getPitch(){return this.mapService.getPitch()}setPitch(t){return this.mapService.setPitch(t)}getRotation(){return this.mapService.getRotation()}getBounds(){return this.mapService.getBounds()}setRotation(t){this.mapService.setRotation(t)}zoomIn(){this.mapService.zoomIn()}zoomOut(){this.mapService.zoomOut()}panTo(t){this.mapService.panTo(t)}panBy(t,e){this.mapService.panBy(t,e)}getContainer(){return this.mapService.getContainer()}setZoom(t){this.mapService.setZoom(t)}fitBounds(t,e){const{fitBoundsOptions:r,animate:n}=this.sceneService.getSceneConfig();var i;this.mapService.fitBounds(t,e||(i=((t,e)=>{for(var r in e||(e={}))gU.call(e,r)&&vU(t,r,e[r]);if(mU)for(var r of mU(e))_U.call(e,r)&&vU(t,r,e[r]);return t})({},r),dU(i,fU({animate:n}))))}setZoomAndCenter(t,e){this.mapService.setZoomAndCenter(t,e)}setMapStyle(t){this.mapService.setMapStyle(t)}setMapStatus(t){this.mapService.setMapStatus(t)}pixelToLngLat(t){return this.mapService.pixelToLngLat(t)}lngLatToPixel(t){return this.mapService.lngLatToPixel(t)}containerToLngLat(t){return this.mapService.containerToLngLat(t)}lngLatToContainer(t){return this.mapService.lngLatToContainer(t)}destroy(){this.sceneService.destroy()}registerPostProcessingPass(t){this.container.postProcessingPass.name=new t}enableShaderPick(){this.layerService.enableShaderPick()}diasbleShaderPick(){this.layerService.disableShaderPick()}enableBoxSelect(t=!0){this.boxSelect.enable(),t&&this.boxSelect.once("selectend",(()=>{this.disableBoxSelect()}))}disableBoxSelect(){this.boxSelect.disable()}static addProtocol(t,e){Dt.REGISTERED_PROTOCOLS[t]=e}static removeProtocol(t){delete Dt.REGISTERED_PROTOCOLS[t]}getProtocol(t){return Dt.REGISTERED_PROTOCOLS[t]}startAnimate(){this.layerService.startAnimate()}stopAnimate(){this.layerService.stopAnimate()}getPointSizeRange(){return this.sceneService.getPointSizeRange()}initComponent(t){this.controlService.init({container:ud(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}initControl(){const{logoVisible:t,logoPosition:e}=this.sceneService.getSceneConfig();t&&this.addControl(new zT({position:e}))}initTileLayer(t){t.getSource().isTile&&(t.tileLayer=new _M(t))}},bU=function(){function t(){this._events={}}return t.prototype.on=function(t,e,r){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!r}),this},t.prototype.once=function(t,e){return this.on(t,e,!0)},t.prototype.emit=function(t){for(var e=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var i=this._events[t]||[],o=this._events["*"]||[],a=function(n){for(var i=n.length,o=0;o<i;o++)if(n[o]){var a=n[o],s=a.callback;a.once&&(n.splice(o,1),0===n.length&&delete e._events[t],i--,o--),s.apply(e,r)}};a(i),a(o)},t.prototype.off=function(t,e){if(t)if(e){for(var r=this._events[t]||[],n=r.length,i=0;i<n;i++)r[i].callback===e&&(r.splice(i,1),n--,i--);0===r.length&&delete this._events[t]}else delete this._events[t];else this._events={};return this},t.prototype.getEvents=function(){return this._events},t}();function EU(t){Ck||(Ck=document.createElement("table"),Rk=document.createElement("tr"),Lk=/^\s*<(\w+|!)[^>]*>/,Ik={tr:document.createElement("tbody"),tbody:Ck,thead:Ck,tfoot:Ck,td:Rk,th:Rk,"*":document.createElement("div")});var e=Lk.test(t)&&RegExp.$1;e&&e in Ik||(e="*");var r=Ik[e];t="string"==typeof t?t.replace(/(^\s*)|(\s*$)/g,""):t,r.innerHTML=""+t;var n=r.childNodes[0];return n&&r.contains(n)&&r.removeChild(n),n}function TU(t,e){if(t)for(var r in e)e.hasOwnProperty(r)&&(t.style[r]=e[r]);return t}var SU={fontFamily:'\n  "-apple-system", BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",\n  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",\n  SimSun, "sans-serif"'};const AU="l7plot-tooltip",wU="l7plot-tooltip__title",CU="l7plot-tooltip__list",RU="l7plot-tooltip__list-item",LU="l7plot-tooltip__name",IU="l7plot-tooltip__value",MU=`<div class="${AU}">\n  <div class="${wU}"></div>\n  <ul class="${CU}"></ul>\n</div>`,OU=`<li class="${RU}" data-index={index}>\n  <span class="${LU}">{name}</span>\n  <span class="${IU}">{value}</span>\n</li>`;var PU={[AU]:{visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:SU.fontFamily,lineHeight:"20px",padding:"10px 10px 6px 10px"},[wU]:{marginBottom:"4px"},[CU]:{margin:"0px",listStyleType:"none",padding:"0px"},[RU]:{listStyleType:"none",marginBottom:"4px",whiteSpace:"nowrap",display:"flex",justifyContent:"space-between"},[LU]:{},[IU]:{marginLeft:"30px"}};function DU(t){const e=t.childNodes;for(let r=e.length-1;r>=0;r--)t.removeChild(e[r])}class BU{constructor(t){this.destroyed=!1,this.options=b({},this.getDefaultOptions(),t),this.container=this.initContainer(),this.initDom(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible(),this.render()}getDefaultOptions(){return{name:"",containerTpl:"<div></div>",visible:!0,capture:!0,domStyles:{}}}getContainer(){return this.container}getParentContainer(){const t=this.options.parent;let e;if(!t)return e;if(d(t)){const r=document.getElementById(t);if(!r)throw new Error(`No parent id ${t}`);e=r}else e=t;return e}initContainer(){const t=this.createDom(this.options.containerTpl),e=this.getParentContainer();return e&&e.appendChild(t),t}initVisible(){this.options.visible?this.show():this.hide()}initCapture(){this.setCapture(this.options.capture)}update(t){this.options=b({},this.options,t),this.updateInner(t),this.afterUpdate(t)}updateInner(t){t.domStyles&&this.applyStyles()}afterUpdate(t){t.capture&&this.setCapture(t.capture)}setCapture(t){const e=t?"auto":"none";this.container.style.pointerEvents=e}applyStyles(){const t=this.options.domStyles;if(!t)return;const e=this.container;this.applyChildrenStyles(e,t);const r=this.options.className;if(r&&(n=r,e.className.match(new RegExp(`(\\s|^)${n}(\\s|$)`)))){TU(e,t[r])}var n}applyChildrenStyles(t,e){c(e,((e,r)=>{c(t.getElementsByClassName(r),(t=>{TU(t,e)}))}))}applyStyle(t,e){const r=this.options.domStyles;r&&TU(e,r[t])}createDom(t="<div></div>"){return EU(t)}removeDom(){const t=this.container;t&&t.parentNode&&t.parentNode.removeChild(t)}destroy(){this.removeEvent(),this.removeDom(),this.destroyed=!0}}class NU extends BU{getDefaultOptions(){return b({},super.getDefaultOptions(),{id:"l7plot-tooltip",name:"l7plot-tooltip",title:"",showTitle:!0,items:[],containerTpl:MU,itemTpl:OU,domStyles:PU,className:AU})}initContainer(){const{customContent:t}=this.options;if(t){const e=this.getHtmlContentNode(t),r=this.getParentContainer();return r&&r.appendChild(e),e}return super.initContainer()}initDom(){this.cacheDoms()}initEvent(){}removeEvent(){}cacheDoms(){const t=this.container,e=t.getElementsByClassName(wU)[0],r=t.getElementsByClassName(CU)[0];this.titleDom=e,this.listDom=r}render(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())}show(){const t=this.container;t&&!this.destroyed&&TU(t,{visibility:"visible"})}hide(){const t=this.container;t&&!this.destroyed&&TU(t,{visibility:"hidden"})}updateInner(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),super.updateInner(t)}renderCustomContent(t){const e=this.container.parentNode,r=this.getHtmlContentNode(t),n=this.container;e&&e.replaceChild(r,n),this.container=r,this.applyStyles()}getHtmlContentNode(t){let e;const r=t(this.options.title||"",this.options.items);return e=d(r)?this.createDom(r):r,e}resetTitle(){const t=this.options.title;this.options.showTitle&&t?(this.showTitle(),this.setTitle(t)):this.hideTitle()}showTitle(){const t=this.titleDom;t&&TU(t,{display:"block"})}hideTitle(){const t=this.titleDom;t&&TU(t,{display:"none"})}setTitle(t){const e=this.titleDom;e&&(e.innerHTML=t)}renderItems(){this.clearItemDoms();const t=this.options.items,e=this.options.itemTpl||OU,r=this.listDom;r&&(t.forEach((t=>{const n=Object.assign({},t),i=g(e,n),o=this.createDom(i);r.appendChild(o)})),this.applyChildrenStyles(r,this.options.domStyles))}clearItemDoms(){this.listDom&&DU(this.listDom)}clear(){this.setTitle(""),this.clearItemDoms()}}const FU="l7plot-legend l7plot-legend__category",kU="l7plot-legend__title",UU="l7plot-legend__category-list",zU="l7plot-legend__list-item",GU="l7plot-legend__category-marker",jU="l7plot-legend__category-value",VU=`<div class="${FU}">\n  <div class="${kU}"></div>\n  <ul class="${UU}"></ul>\n</div>`,HU=`<li class="${zU}" data-index={index}>\n  <span class="${GU}" style="background:{color}"></span>\n  <span class="${jU}">{value}</span>\n</li>`;var WU={[FU]:{visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:SU.fontFamily,padding:"10px 10px 6px 10px",lineHeight:1,fontSize:"12px"},[kU]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[UU]:{margin:"0px",listStyleType:"none",padding:"0px"},[zU]:{listStyleType:"none",display:"flex",alignItems:"center",marginBottom:"2px"},[GU]:{width:"10px",height:"10px"},[jU]:{paddingLeft:"8px"}};class XU extends BU{getDefaultOptions(){return b({},super.getDefaultOptions(),{id:"l7plot-category-legend",name:"l7plot-category-legend",title:"",items:[],containerTpl:VU,itemTpl:HU,domStyles:WU,className:FU})}initContainer(){const{customContent:t}=this.options;if(t){const e=this.getHtmlContentNode(t),r=this.getParentContainer();return r&&r.appendChild(e),e}return super.initContainer()}initDom(){this.cacheDoms()}initEvent(){}removeEvent(){}cacheDoms(){const t=this.container,e=t.getElementsByClassName(kU)[0],r=t.getElementsByClassName(UU)[0];this.titleDom=e,this.listDom=r}render(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())}show(){const t=this.container;t&&!this.destroyed&&TU(t,{visibility:"visible"})}hide(){const t=this.container;t&&!this.destroyed&&TU(t,{visibility:"hidden"})}updateInner(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),super.updateInner(t)}renderCustomContent(t){const e=this.container.parentNode,r=this.getHtmlContentNode(t),n=this.container;e&&e.replaceChild(r,n),this.container=r,this.applyStyles()}getHtmlContentNode(t){let e;const r=t(this.options.title||"",this.options.items);return e=d(r)?this.createDom(r):r,e}resetTitle(){const t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()}showTitle(){const t=this.titleDom;t&&TU(t,{display:"block"})}hideTitle(){const t=this.titleDom;t&&TU(t,{display:"none"})}setTitle(t){const e=this.titleDom;e&&(e.innerHTML=t)}renderItems(){this.clearItemDoms();const t=this.options.items.length>30?this.options.items.slice(0,30):this.options.items,e=this.options.itemTpl||HU,r=this.listDom;r&&(t.forEach((t=>{const n=""===t.value?"—":Array.isArray(t.value)?t.value.join(" - "):t.value,i=Object.assign(Object.assign({},t),{value:n}),o=g(e,i),a=this.createDom(o);r.appendChild(a)})),this.applyChildrenStyles(r,this.options.domStyles))}clearItemDoms(){this.listDom&&DU(this.listDom)}clear(){this.setTitle(""),this.clearItemDoms()}}const ZU="l7plot-legend l7plot-legend__continue",qU="l7plot-legend__title",YU="l7plot-legend__ribbon-container",KU="l7plot-legend__ribbon",$U="l7plot-legend__gradient-bar",QU="l7plot-legend__value-range",JU=`<div class="${ZU}">\n  <div class="${qU}"></div>\n  <div class="${YU}"></div>\n</div>`,tz=`<div class="${KU}">\n  <span class="${QU}">{min}</span>\n  <div class="${$U}" style="background-image: {backgroundImage}"></div>\n  <span class="${QU}">{max}</span>\n</div>`;var ez={[ZU]:{visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:SU.fontFamily,padding:"10px",lineHeight:1,fontSize:"12px"},[qU]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[KU]:{display:"flex",alignItems:"center"},[$U]:{width:"140px",height:"14px",margin:"0px 5px"},[QU]:{padding:"0px"}};class rz extends BU{getDefaultOptions(){return b({},super.getDefaultOptions(),{id:"l7plot-continue-legend",name:"l7plot-continue-legend",title:"",containerTpl:JU,ribbonTpl:tz,domStyles:ez,className:ZU})}initContainer(){const{customContent:t}=this.options;if(t){const e=this.getHtmlContentNode(t),r=this.getParentContainer();return r&&r.appendChild(e),e}return super.initContainer()}initDom(){this.cacheDoms()}initEvent(){}removeEvent(){}cacheDoms(){const t=this.container,e=t.getElementsByClassName(qU)[0],r=t.getElementsByClassName(YU)[0];this.titleDom=e,this.ribbonContainerDom=r}render(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderRibbon())}show(){const t=this.container;t&&!this.destroyed&&TU(t,{visibility:"visible"})}hide(){const t=this.container;t&&!this.destroyed&&TU(t,{visibility:"hidden"})}updateInner(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.colors&&this.renderRibbon()),super.updateInner(t)}renderCustomContent(t){const e=this.container.parentNode,r=this.getHtmlContentNode(t),n=this.container;e&&e.replaceChild(r,n),this.container=r,this.applyStyles()}getHtmlContentNode(t){let e;const r=t(this.options.title||"",this.options.min,this.options.max,this.options.colors);return e=d(r)?this.createDom(r):r,e}resetTitle(){const t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()}showTitle(){const t=this.titleDom;t&&TU(t,{display:"block"})}hideTitle(){const t=this.titleDom;t&&TU(t,{display:"none"})}setTitle(t){const e=this.titleDom;e&&(e.innerHTML=t)}renderRibbon(){this.clearRibbonContainerDoms();const{min:t,max:e,colors:r,ribbonTpl:n=tz}=this.options,i=this.ribbonContainerDom;if(i){const o=g(n,{min:t,max:e,backgroundImage:`linear-gradient(to right, ${r.join(", ")})`}),a=this.createDom(o);i.appendChild(a),this.applyChildrenStyles(i,this.options.domStyles)}}clearRibbonContainerDoms(){this.ribbonContainerDom&&DU(this.ribbonContainerDom)}clear(){this.setTitle(""),this.clearRibbonContainerDoms()}}class nz extends PT{constructor(t){super(t),this.legendComponents=[],this.options=t,this.legendComponents=this.initLegendComponents(t.items)}initLegendComponents(t){const e=[];for(let r=0;r<t.length;r++){const n=t[r];if("category"===n.type){const t=new XU({title:n.options.title,items:n.options.items,className:n.options.className,customContent:n.options.customContent,domStyles:n.options.domStyles});e.push(t)}else if("continue"===n.type){const t=new rz({title:n.options.title,min:n.options.min,max:n.options.max,colors:n.options.colors,className:n.options.className,customContent:n.options.customContent,domStyles:n.options.domStyles});e.push(t)}}return e}getDefaultOptions(){return{position:"bottomleft"}}onAdd(){const t=window.document.createElement("div");return t.className="l7plot-legend-container",this.legendComponents.forEach((e=>{const r=e.getContainer();t.appendChild(r)})),t}onRemove(){this.legendComponents.forEach((t=>{t.destroy()}))}}var iz="object"==typeof global&&global&&global.Object===Object&&global,oz="object"==typeof self&&self&&self.Object===Object&&self,az=iz||oz||Function("return this")(),sz=az.Symbol,lz=Object.prototype,uz=lz.hasOwnProperty,cz=lz.toString,hz=sz?sz.toStringTag:void 0;var pz=Object.prototype.toString;var dz="[object Null]",fz="[object Undefined]",mz=sz?sz.toStringTag:void 0;function gz(t){return null==t?void 0===t?fz:dz:mz&&mz in Object(t)?function(t){var e=uz.call(t,hz),r=t[hz];try{t[hz]=void 0;var n=!0}catch(t){}var i=cz.call(t);return n&&(e?t[hz]=r:delete t[hz]),i}(t):function(t){return pz.call(t)}(t)}var _z="[object Symbol]";function vz(t){return"symbol"==typeof t||function(t){return null!=t&&"object"==typeof t}(t)&&gz(t)==_z}var yz=Array.isArray,xz=1/0,bz=sz?sz.prototype:void 0,Ez=bz?bz.toString:void 0;function Tz(t){if("string"==typeof t)return t;if(yz(t))return function(t,e){for(var r=-1,n=null==t?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}(t,Tz)+"";if(vz(t))return Ez?Ez.call(t):"";var e=t+"";return"0"==e&&1/t==-xz?"-0":e}var Sz=/\s/;var Az=/^\s+/;function wz(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Sz.test(t.charAt(e)););return e}(t)+1).replace(Az,""):t}function Cz(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var Rz=NaN,Lz=/^[-+]0x[0-9a-f]+$/i,Iz=/^0b[01]+$/i,Mz=/^0o[0-7]+$/i,Oz=parseInt;function Pz(t){if("number"==typeof t)return t;if(vz(t))return Rz;if(Cz(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Cz(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=wz(t);var r=Iz.test(t);return r||Mz.test(t)?Oz(t.slice(2),r?2:8):Lz.test(t)?Rz:+t}var Dz=1/0,Bz=17976931348623157e292;function Nz(t){var e=function(t){return t?(t=Pz(t))===Dz||t===-Dz?(t<0?-1:1)*Bz:t==t?t:0:0===t?t:0}(t),r=e%1;return e==e?r?e-r:e:0}var Fz="[object AsyncFunction]",kz="[object Function]",Uz="[object GeneratorFunction]",zz="[object Proxy]";var Gz=az["__core-js_shared__"],jz=function(){var t=/[^.]+$/.exec(Gz&&Gz.keys&&Gz.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var Vz=Function.prototype.toString;var Hz=/^\[object .+?Constructor\]$/,Wz=Function.prototype,Xz=Object.prototype,Zz=Wz.toString,qz=Xz.hasOwnProperty,Yz=RegExp("^"+Zz.call(qz).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Kz(t){if(!Cz(t)||(e=t,jz&&jz in e))return!1;var e,r=function(t){if(!Cz(t))return!1;var e=gz(t);return e==kz||e==Uz||e==Fz||e==zz}(t)?Yz:Hz;return r.test(function(t){if(null!=t){try{return Vz.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function $z(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return Kz(r)?r:void 0}var Qz=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Jz=/^\w*$/;var tG=$z(Object,"create");var eG=Object.prototype.hasOwnProperty;var rG=Object.prototype.hasOwnProperty;function nG(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function iG(t,e){for(var r,n,i=t.length;i--;)if((r=t[i][0])===(n=e)||r!=r&&n!=n)return i;return-1}nG.prototype.clear=function(){this.__data__=tG?tG(null):{},this.size=0},nG.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},nG.prototype.get=function(t){var e=this.__data__;if(tG){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return eG.call(e,t)?e[t]:void 0},nG.prototype.has=function(t){var e=this.__data__;return tG?void 0!==e[t]:rG.call(e,t)},nG.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=tG&&void 0===e?"__lodash_hash_undefined__":e,this};var oG=Array.prototype.splice;function aG(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}aG.prototype.clear=function(){this.__data__=[],this.size=0},aG.prototype.delete=function(t){var e=this.__data__,r=iG(e,t);return!(r<0)&&(r==e.length-1?e.pop():oG.call(e,r,1),--this.size,!0)},aG.prototype.get=function(t){var e=this.__data__,r=iG(e,t);return r<0?void 0:e[r][1]},aG.prototype.has=function(t){return iG(this.__data__,t)>-1},aG.prototype.set=function(t,e){var r=this.__data__,n=iG(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var sG=$z(az,"Map");function lG(t,e){var r,n,i=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof e?"string":"hash"]:i.map}function uG(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}uG.prototype.clear=function(){this.size=0,this.__data__={hash:new nG,map:new(sG||aG),string:new nG}},uG.prototype.delete=function(t){var e=lG(this,t).delete(t);return this.size-=e?1:0,e},uG.prototype.get=function(t){return lG(this,t).get(t)},uG.prototype.has=function(t){return lG(this,t).has(t)},uG.prototype.set=function(t,e){var r=lG(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var cG="Expected a function";function hG(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(cG);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=t.apply(this,n);return r.cache=o.set(i,a)||o,a};return r.cache=new(hG.Cache||uG),r}hG.Cache=uG;var pG,dG,fG,mG=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gG=/\\(\\)?/g,_G=(pG=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(mG,(function(t,r,n,i){e.push(n?i.replace(gG,"$1"):r||t)})),e},dG=hG(pG,(function(t){return 500===fG.size&&fG.clear(),t})),fG=dG.cache,dG),vG=_G;function yG(t){return null==t?"":Tz(t)}function xG(t,e){return yz(t)?t:function(t,e){if(yz(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!vz(t))||Jz.test(t)||!Qz.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:vG(yG(t))}var bG=1/0;function EG(t){if("string"==typeof t||vz(t))return t;var e=t+"";return"0"==e&&1/t==-bG?"-0":e}function TG(t,e,r){var n=null==t?void 0:function(t,e){for(var r=0,n=(e=xG(e,t)).length;null!=t&&r<n;)t=t[EG(e[r++])];return r&&r==n?t:void 0}(t,e);return void 0===n?r:n}var SG=az.isFinite,AG=Math.min;var wG=function(t){var e=Math[t];return function(t,r){if(t=Pz(t),(r=null==r?0:AG(Nz(r),292))&&SG(t)){var n=(yG(t)+"e").split("e");return+((n=(yG(e(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round"),CG=wG;const RG=(new Object).toString,LG=(t,e)=>RG.call(t)==="[object "+e+"]",IG=t=>LG(t,"Array"),MG=t=>{if(!(t=>"object"==typeof t&&null!==t)(t)||!LG(t,"Object"))return!1;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},OG=(t,e,r,n)=>{r=r||0,n=n||5;for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){const o=e[i];o?MG(o)?(MG(t[i])||(t[i]={}),r<n?OG(t[i],o,r+1,n):t[i]=e[i]):IG(o)?(t[i]=[],t[i]=t[i].concat(o)):t[i]=o:t[i]=o}},PG=(t,...e)=>{for(let r=0;r<e.length;r+=1)OG(t,e[r]);return t},DG=["mousemove","click"];class BG extends bU{constructor(t,e,r){super(),this.currentVisible=!1,this.interactionTriggerHander=t=>{const{feature:e,featureId:r}=t,{title:n,customTitle:i,items:o,customItems:a}=this.options,s="Feature"===e.type&&e.geometry&&e.properties?e.properties:e;let l=[];if(a){const t=a(e);if(!Array.isArray(t))throw new Error("customItems return array");l=t}else o&&o.forEach((t=>{if(d(t)){const e=t.split(".").pop()||t,r=TG(s,t);void 0!==r&&l.push({name:e,value:r})}else{const{field:e,alias:n,customValue:i}=t,o=n||e.split(".").pop()||e,a=TG(s,e);void 0!==a&&l.push({name:o,value:i?i(a,s,r):a})}}));const u={title:i?i(s):n,items:l};this.updateTooltip(t,u)},this.interactionUntriggerHander=()=>{this.hideTooltip()},this.scene=t,this.interactionLayers=e,this.options=PG({},this.getDefaultOptions(),r);const{offsets:n,title:i,showTitle:o,customContent:a,domStyles:s,anchor:l,className:u}=this.options;this.marker=new OT({offsets:n,anchor:l,draggable:!1}),this.tooltipComponent=new NU({title:i,showTitle:o,items:[],customContent:a,domStyles:s,className:u}),this.setComponent(),this.initInteractionEvent()}getDefaultOptions(){return{showTitle:!0,showComponent:!0,items:[],offsets:[15,0],trigger:"mousemove",anchor:te["TOP-LEFT"]}}update(t){this.marker.remove(),this.currentVisible=!1,this.options=PG({},this.options,t);const{offsets:e,showTitle:r,customContent:n,domStyles:i,anchor:o,className:a}=this.options;this.marker=new OT({offsets:e,anchor:o,draggable:!1}),this.tooltipComponent.update({showTitle:r,customContent:n,domStyles:i,className:a}),this.setComponent()}initInteractionEvent(){const t=this.options.trigger||"mousemove";if(!DG.includes(t))throw new Error("trigger is mousemove or click");this.interactionLayers.forEach((({layer:e})=>{e.on(t,this.interactionTriggerHander),e.on(`un${t}`,this.interactionUntriggerHander)}))}unBindInteractionEvent(){const t=this.options.trigger||"mousemove";this.interactionLayers.forEach((({layer:e})=>{e.off(t,this.interactionTriggerHander),e.off(`un${t}`,this.interactionUntriggerHander)}))}updateTooltip(t,e){const{lngLat:r,x:n,y:i}=t;if(this.options.showComponent&&(this.updateComponent(e),this.setPostion(r)),this.currentVisible){const t={type:"tooltip:change",data:e,lngLat:r,x:n,y:i};this.emit("tooltip:change",t)}else{this.showTooltip();const t={type:"tooltip:show",data:e,lngLat:r,x:n,y:i};this.emit("tooltip:show",t)}}showTooltip(){this.currentVisible||(this.options.showComponent&&this.scene.addMarker(this.marker),this.currentVisible=!0)}hideTooltip(){if(!this.currentVisible)return;this.options.showComponent&&this.marker.remove(),this.currentVisible=!1;this.emit("tooltip:hide",{type:"tooltip:hide"})}updateComponent(t){E(this.lastComponentOptions,t)||(this.tooltipComponent.update(t),this.lastComponentOptions=t)}setComponent(){const t=this.tooltipComponent.getContainer(),e=window.document.createElement("div");e.style.cursor="auto",e.style.userSelect="text",e.className="l7plot-tooltip-container",["mousemove","mousedown","mouseup","click","dblclick"].forEach((t=>{e.addEventListener(t,(t=>t.stopPropagation()))})),e.appendChild(t),this.marker.setElement(e)}setPostion(t){this.marker.setLnglat(t)}destroy(){this.unBindInteractionEvent(),this.off(),this.marker.remove(),this.tooltipComponent.destroy()}}class NG extends bU{constructor(t=[],e={}){super(),this.name=e.name?e.name:w("layerGroup"),this.layers=t}addTo(t){this.scene=t;let e=0;const r=this.layers.length;this.layers.forEach((n=>{n.once("inited",(t=>{e++,this.emit("inited",t),e===r&&this.emit("inited-all")})),n.addTo(t)}))}hasLayer(t){return this.layers.some((e=>e===t))}addLayer(t){this.layers.push(t),this.scene&&(t.once("inited",(t=>this.emit("inited",t))),t.addTo(this.scene))}removeLayer(t){const e=this.layers.findIndex((e=>e===t));return-1!==e&&(this.layers.splice(e,1),this.scene&&t.remove(this.scene),!0)}getLayers(){return this.layers}getInteractionLayers(){return this.layers.filter((({interaction:t})=>t))}getLayer(t){return this.layers.find((({layer:e})=>e.id===t))}getLayerByName(t){return this.layers.find((e=>e.name===t))}removeAllLayer(){this.layers.forEach((t=>{this.scene&&t.remove(this.scene)})),this.layers=[]}isEmpty(){return 0===this.layers.length}}const FG=[{original:"loaded",adaptation:"scene-loaded"},{original:"resize",adaptation:"resize"},{original:"destroy",adaptation:"destroy"},{original:"resize",adaptation:"resize"}],kG=["mapmove","movestart","moveend","zoomchange","zoomstart","zoomend","click","dblclick","contextmenu","mousemove","mousewheel","mouseover","mouseout","mouseup","mousedown","dragstart","dragging","dragend"],UG=["inited","add","remove","dataUpdate","click","unclick","dblclick","undblclick","contextmenu","uncontextmenu","mouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","uncontextmenu","unpick","legend","legend:color","legend:size"],zG={map:{type:t.BaseMapType.Amap},logo:!0};class GG extends bU{constructor(t){super(),this.inited=!1,this.sceneLoaded=!1,this.layersLoaded=!1,this.loaded=!1,this.layerGroup=new NG,this.options=PG({},this.getDefaultOptions(),t),this.lastOptions=this.options}getDefaultOptions(){return GG.DefaultOptions}createContainer(t){const{width:e,height:r}=this.options,n="string"==typeof t?document.getElementById(t):t;return n.style.position||(n.style.position="relative"),e&&(n.style.width||(n.style.width=`${e}px`)),r&&(n.style.height||(n.style.height=`${r}px`)),n}createTheme(){return u(this.options.theme)?PG({},at("default"),rt(this.options.theme)):at(this.options.theme)}createMap(){const e=this.options.map?this.options.map:zG.map,{type:r}=e,n=M(e,["type"]),i=Object.assign({style:this.theme.mapStyle},n);return r===t.BaseMapType.Amap?new $P(i):r===t.BaseMapType.AmapV1?new QP(i):r===t.BaseMapType.AmapV2?new JP(i):r===t.BaseMapType.Mapbox?new KP(i):new VP(i)}createScene(){const{logo:t,antialias:e,preserveDrawingBuffer:r}=this.options,n=_(t)?{logoVisible:t}:{logoVisible:null==t?void 0:t.visible,logoPosition:null==t?void 0:t.position},i=Object.assign({antialias:e,preserveDrawingBuffer:r},n),o=this.createMap();return new xU(Object.assign({id:this.container,map:o},i))}registerResources(){e.size&&e.forEach(((t,e)=>{!this.scene.hasImage(e)&&this.scene.addImage(e,t)})),r.size&&r.forEach(((t,e)=>{this.scene.addFontFace(e,t)})),n.size&&n.forEach(((t,e)=>{this.scene.addIconFont(e,t)}))}update(t){this.updateOption(t),t.map&&!E(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.render(),this.emit("update")}updateOption(t){this.lastOptions=this.options,this.options=PG({},this.options,t)}updateMap(t){var e;if(!this.scene)return;const{style:r,center:n,zoom:i,rotation:o,pitch:a}=t;v(a)||this.scene.setPitch(a),v(o)||this.scene.setRotation(o),r&&r!==(null===(e=this.lastOptions.map)||void 0===e?void 0:e.style)&&this.scene.setMapStyle(r),i&&n&&this.scene.setZoomAndCenter(i,n)}changeSize(t,e){this.options.width===t&&this.options.height===e||(this.container.style.width=`${t}px`,this.container.style.height=`${e}px`,this.options=Object.assign(this.options,{width:t,height:e}))}on(t,e,r){return this.proxyEventHander("on",t,e,r),this}once(t,e){return this.proxyEventHander("once",t,e),this}off(t,e){return this.proxyEventHander("off",t,e),this}proxyEventHander(t,e,r,n){const i=FG.find((t=>t.adaptation===e));if(i)this.scene[t](i.original,r);else if(-1!==kG.indexOf(e))this.scene[t](e,r);else if(e.includes("Layer:")){const[n,i]=e.split(":");if(!(this[n]&&this[n][t])||-1===UG.indexOf(i))throw new Error(`No event name "${e}"`);this[n][t](i,r)}else super[t](e,r,n)}getScene(){return this.scene}getMap(){var e,r,n,i;return(null===(e=this.options.map)||void 0===e?void 0:e.type)===t.BaseMapType.Amap||(null===(r=this.options.map)||void 0===r?void 0:r.type)===t.BaseMapType.AmapV2||(null===(n=this.options.map)||void 0===n?void 0:n.type)===t.BaseMapType.Mapbox||(null===(i=this.options.map)||void 0===i||i.type,t.BaseMapType.Map),this.scene.map}addLayer(t){this.layerGroup.addLayer(t)}getLayes(){return console.warn("Replace to use getLayers()"),this.getLayers()}getLayers(){return this.layerGroup.getLayers()}getLayerByName(t){return this.layerGroup.getLayerByName(t)}removeLayer(t){return this.layerGroup.removeLayer(t)}removeAllLayer(){this.layerGroup.removeAllLayer()}zoomIn(){this.scene.zoomIn()}zoomOut(){this.scene.zoomOut()}setPitch(t){this.scene.setPitch(t)}fitBounds(t){this.scene.fitBounds(t)}setMapStatus(t){this.scene.setMapStatus(t)}setBgColor(t){this.scene.setBgColor(t)}initComponents(){this.initControls(),this.initTooltip()}updateComponents(){this.updateControls(),this.initTooltip()}initControls(){const{zoom:t,scale:e,layerMenu:r,legend:n}=this.options;e&&this.addScaleControl(e),t&&this.addZoomControl(t),r&&this.addLayerMenuControl(r),n&&(this.addLegendControl(n),this.emit("add-legend"))}updateControls(){const{zoom:t,scale:e,layerMenu:r,legend:n}=this.options;E(this.lastOptions.zoom,t)||(t?this.updateZoomControl(t):this.removeZoomControl()),E(this.lastOptions.scale,e)||(e?this.updateScaleControl(e):this.removeScaleControl()),E(this.lastOptions.layerMenu,r)||(r?this.updateLayerMenuControl(r):this.removeLayerMenuControl()),E(this.lastOptions.legend,n)||(n?this.updateLegendControl(n):this.removeLegendControl())}addZoomControl(t){this.zoomControl||(this.zoomControl=new vM(t),this.scene.addControl(this.zoomControl))}updateZoomControl(t){this.zoomControl?(this.removeZoomControl(),this.addZoomControl(t)):this.addZoomControl(t)}removeZoomControl(){this.zoomControl&&(this.zoomControl.remove(),this.zoomControl=void 0)}addScaleControl(t){this.scaleControl||(this.scaleControl=new GT(t),this.scene.addControl(this.scaleControl))}updateScaleControl(t){this.scaleControl?(this.removeScaleControl(),this.addScaleControl(t)):this.addScaleControl(t)}removeScaleControl(){this.scaleControl&&(this.scaleControl.remove(),this.scaleControl=void 0)}addLayerMenuControl(t){this.layerGroup.getLayers().forEach((({name:t,layer:e})=>{}))}updateLayerMenuControl(t){this.removeLayerMenuControl(),this.addLayerMenuControl(t)}removeLayerMenuControl(){}getLegendOptions(){return{}}addLegendControl(t){if(this.legendControl)return;const e=this.theme.components.legend,r=PG({},this.getLegendOptions(),t),{type:n,position:i}=r,o=M(r,["type","position"]),a=[];if("category"===n){const t=PG({},{domStyles:e.category.domStyles},o);a.push({type:n,options:t})}else if("continue"===n){const t=PG({},{domStyles:e.continue.domStyles},o);a.push({type:n,options:t})}a.length&&(this.legendControl=new nz({position:i,items:a}),this.scene.addControl(this.legendControl))}updateLegendControl(t){this.legendControl?(this.removeLegendControl(),this.addLegendControl(t)):this.addLegendControl(t)}removeLegendControl(){this.legendControl&&(this.legendControl.remove(),this.legendControl=void 0)}initTooltip(){this.tooltip&&this.tooltip.destroy();const{tooltip:t}=this.options;if(t){const e=PG({},{domStyles:this.theme.components.tooltip.domStyles},t),r=this.layerGroup.getInteractionLayers();this.tooltip=new BG(this.scene,r,e),this.tooltip.on("*",(t=>this.emit(t.type,t)))}}exportPng(t){return this.scene.exportPng(t)}destroy(){var t;super.off("*"),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),null===(t=this.tooltip)||void 0===t||t.destroy(),this.scene.destroy()}}GG.DefaultOptions=zG;class jG{static aggregation(t,e){const{type:r="grid",radius:n,method:i,field:o}=e,a={type:r,size:n,method:i,field:o};t.transforms?(t.transforms=t.transforms.filter((t=>t.type!==a.type)),t.transforms.push(a)):t.transforms=[a]}}const VG=["name","zIndex","visible","minZoom","maxZoom","pickingBuffer","autoFit","blend"];class HG extends bU{constructor(t){super(),this.options=PG({},this.getDefaultOptions(),t),this.lastOptions=this.options}getDefaultOptions(){return{}}pickLayerConfig(t){return S(t,VG)}addTo(t){t.addLayer(this.layer)}remove(t){t.removeLayer(this.layer)}update(t){this.updateOption(t),this.updateConfig(t)}updateOption(t){this.lastOptions=this.options,this.options=PG({},this.options,t)}updateConfig(t){v(t.zIndex)||E(this.lastOptions.zIndex,this.options.zIndex)||this.setIndex(t.zIndex),v(t.blend)||E(this.lastOptions.blend,this.options.blend)||this.setBlend(t.blend),v(t.minZoom)||E(this.lastOptions.minZoom,this.options.minZoom)||this.setMinZoom(t.minZoom),v(t.maxZoom)||E(this.lastOptions.maxZoom,this.options.maxZoom)||this.setMinZoom(t.maxZoom),v(t.visible)||E(this.lastOptions.visible,this.options.visible)||(t.visible?this.show():this.hide())}render(){this.layer.renderLayers()}setSource(t){if(t instanceof MT)this.layer.setSource(t);else{const{data:e,aggregation:r}=t,n=M(t,["data","aggregation"]);r&&jG.aggregation(n,r);this.layer.getSource()?this.layer.setData(e,n):this.layer.source(e,n)}}changeData(t){this.setSource(t)}setIndex(t){this.layer.setIndex(t)}setBlend(t){this.layer.setBlend(t)}setMinZoom(t){this.layer.setMinZoom(t)}setMaxZoom(t){this.layer.setMaxZoom(t)}show(){this.layer.inited&&this.layer.show()}hide(){this.layer.inited&&this.layer.hide()}toggleVisible(){this.isVisible()?this.hide():this.show()}isVisible(){return this.layer.inited?this.layer.isVisible():this.options.visible}fitBounds(t){this.layer.fitBounds(t)}on(t,e){return-1!==UG.indexOf(t)?this.layer.on(t,e):super.on(t,e),this}once(t,e){return-1!==UG.indexOf(t)?this.layer.once(t,e):super.once(t,e),this}off(t,e){return-1!==UG.indexOf(t)?this.layer.off(t,e):super.off(t,e),this}}function WG(t,e){return(...r)=>{const n={};return t.forEach(((t,e)=>{n[t]=r[e]})),delete n[void 0],e(n)}}HG.LayerType=t.LayerType,HG.LayerConfigkeys=VG;class XG{static shape(t,e){if(d(e))t.shape(e);else if(s(e)){const r=[];t.shape(r.join("*"),WG(r,e))}else if(u(e)){const r=e.field?e.field:"";if(s(e.value)){const n=l(r)?r:r.split("*");t.shape(r,WG(n,e.value))}else t.shape(r,e.value);d(r)&&e.scale&&XG.scale(t,r,e.scale)}}static size(t,e){if(a(e,"Number"))t.size(e);else if(l(e))t.size(e);else if(s(e)){const r=[];t.size(r.join("*"),WG(r,e))}else if(u(e)){const r=e.field?e.field:"";if(s(e.value)){const n=l(r)?r:r.split("*");t.size(r,WG(n,e.value))}else t.size(r,e.value);d(r)&&e.scale&&XG.scale(t,r,e.scale)}}static color(t,e){if(d(e))t.color(e);else if(s(e)){const r=[];t.color(r.join("*"),WG(r,e))}else if(u(e)){const r=e.field?e.field:"";if(s(e.value)){const n=l(r)?r:r.split("*");t.color(r,WG(n,e.value))}else t.color(r,e.value);d(r)&&e.scale&&XG.scale(t,r,e.scale)}}static style(t,e){e&&t.style(e)}static state(t,e){const{active:r,select:n}=e;r&&t.active(r),n&&t.select(n)}static rotate(t,e){d(e)||s(e)}static texture(t,e){d(e)&&t.texture(e)}static animate(t,e){(_(e)||u(e))&&t.animate(e)}static scale(t,e,r){t.scale(e,r)}static filter(t,e){const r=e.field?e.field:"",n=l(r)?r:r.split("*");t.filter(n.join("*"),WG(n,e.value))}}const ZG={style:{fontSize:12}};class qG extends HG{constructor(t){super(t),this.type=HG.LayerType.TextLayer,this.interaction=!1;const{name:e,source:r}=this.options,n=this.pickLayerConfig(this.options);this.name=e||w(this.type),this.layer=new FI(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(r)}getDefaultOptions(){return ZG}mappingLayer(t,e){!function(t,e){const{field:r,content:n,style:i={},state:o}=e,{fontSize:a,fill:s}=i,l={field:r||n||"",value:"text"};XG.shape(t,l),a&&XG.size(t,a),s&&XG.color(t,s),i&&XG.style(t,i),o&&XG.state(t,o)}(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}}qG.DefaultOptions=ZG,qG.LayerOptionsKeys=HG.LayerConfigkeys.concat([]);class YG extends GG{constructor(t,e){if("string"==typeof t||t instanceof Element){if(void 0===e)throw new Error("options is undefined");super(e),this.container=this.createContainer(t),this.theme=this.createTheme(),this.scene=this.createScene(),this.registerResources(),this.initSource()}else super(t)}initSource(){this.source=this.createSource(),this.render(),this.inited=!0}initLayersEvent(){}getDefaultOptions(){return YG.DefaultOptions}createSource(){const t=this.options.source,{data:e,aggregation:r}=t,n=M(t,["data","aggregation"]);r&&jG.aggregation(n,r);return new MT(e,n)}createLabelLayer(t,e,r){const{visible:n,minZoom:i,maxZoom:o,zIndex:a=0}=r||{};return new qG(Object.assign({name:"labelLayer",visible:n,minZoom:i,maxZoom:o,zIndex:a+.1,source:t},e))}updateLabelLayer(t,e,r,n){e?n?n.update(Object.assign({},e)):(n=this.createLabelLayer(t,e,r),this.layerGroup.addLayer(n)):!1===e&&n&&this.layerGroup.removeLayer(n)}render(){const t=this.createLayers(this.source);this.inited?(this.layerGroup.removeAllLayer(),t.addTo(this.scene),this.layerGroup=t):(this.layerGroup=t,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",(()=>{this.onSceneLoaded()}))),this.initLayersEvent()}onSceneLoaded(){this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",(()=>{this.onLayersLoaded()})),this.layerGroup.addTo(this.scene)}onLayersLoaded(){this.layersLoaded=!0,this.initComponents(),this.loaded=!0,this.emit("loaded")}attachToScene(t,e){this.scene=t,this.theme=e||at("default"),this.registerResources(),this.initSource()}unattachFromScene(){var t;this.removeAllLayer(),null===(t=this.tooltip)||void 0===t||t.destroy()}addToScene(t){this.attachToScene(t)}removeFromScene(){var t;this.removeAllLayer(),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),null===(t=this.tooltip)||void 0===t||t.destroy()}update(t){if(this.updateOption(t),t.map&&!E(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.scene.setEnableRender(!1),t.source&&!E(this.lastOptions.source,this.options.source)){const e=t.source,{data:r}=e,n=M(e,["data"]);this.changeData(r,n)}this.scene.setEnableRender(!0),this.render(),this.updateComponents(),this.emit("update")}changeData(t,e){this.options.source=PG({},this.options.source,Object.assign({data:t},e));const r=this.options.source,{aggregation:n}=r,i=M(r,["aggregation"]);n&&jG.aggregation(i,n),this.source.setData(this.options.source.data,i);const o=this.options.legend;o&&setTimeout((()=>{this.updateLegendControl(o)}),500),this.emit("change-data")}}YG.DefaultOptions={autoFit:!1},YG.PlotType=t.PlotType;const KG=PG({},YG.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}});const $G=t=>{if((t=>!Array.isArray(t[0].value))(t))return t;return t.map((t=>Object.assign(Object.assign({},t),{value:[CG(t.value[0],4),CG(t.value[1],4)]})))},QG={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"circle",size:12,color:"#5FD3A6"};class JG extends HG{constructor(t){super(t),this.type=HG.LayerType.DotLayer,this.interaction=!0;const{name:e,source:r}=this.options,n=this.pickLayerConfig(this.options);this.name=e||w(this.type),this.layer=new FI(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(r)}getDefaultOptions(){return QG}mappingLayer(t,e){!function(t,e){const{shape:r,color:n,size:i,style:o,state:a,animate:s}=e;r&&XG.shape(t,r),i&&XG.size(t,i),n&&XG.color(t,n),o&&XG.style(t,o),a&&XG.state(t,a),s&&XG.animate(t,s)}(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}getColorLegendItems(){const t=this.layer.getLegendItems("color");if(Array.isArray(t)&&0!==t.length){return $G(t)}return[]}}JG.DefaultOptions=QG,JG.LayerOptionsKeys=HG.LayerConfigkeys.concat(["shape","color","size","style","state","animate"]);class tj extends YG{constructor(){super(...arguments),this.type=YG.PlotType.Dot}getDefaultOptions(){return tj.DefaultOptions}createLayers(t){this.dotLayer=new JG(Object.assign({source:t},S(this.options,JG.LayerOptionsKeys)));const e=new NG([this.dotLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),e.addLayer(this.labelLayer)),e}updateLayers(t){const e=S(t,JG.LayerOptionsKeys);this.dotLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}getLegendOptions(){const t=this.dotLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}}}tj.DefaultOptions=KG;const ej=PG({},YG.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}});class rj extends JG{constructor(){super(...arguments),this.type=JG.LayerType.DotDensity,this.interaction=!1}getDefaultOptions(){return PG({},JG.DefaultOptions,{shape:"dot",size:1})}}rj.LayerOptionsKeys=JG.LayerConfigkeys.concat(["color","size","style","state","animate"]);class nj extends YG{constructor(){super(...arguments),this.type=YG.PlotType.DotDensity}getDefaultOptions(){return nj.DefaultOptions}createLayers(t){this.dotDensityLayer=new rj(Object.assign({source:t},S(this.options,rj.LayerOptionsKeys)));return new NG([this.dotDensityLayer])}updateLayers(t){const e=S(t,rj.LayerOptionsKeys);this.dotDensityLayer.update(e)}}nj.DefaultOptions=ej;const ij=PG({},YG.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}});const oj={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"heatmap",size:{value:[0,1]},style:{intensity:3,radius:20,opacity:1,colorsRamp:[{color:"rgba(33,102,172,0.0)",position:0},{color:"rgb(103,169,207)",position:.2},{color:"rgb(209,229,240)",position:.4},{color:"rgb(253,219,199)",position:.6},{color:"rgb(239,138,98)",position:.8},{color:"rgb(178,24,43,1.0)",position:1}]}};class aj extends HG{constructor(t){super(t),this.type=HG.LayerType.HeatmapLayer,this.interaction=!1;const{name:e,source:r}=this.options,n=this.pickLayerConfig(this.options);this.name=e||w(this.type),this.layer=new tI(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(r)}getDefaultOptions(){return oj}mappingLayer(t,e){!function(t,e){const{shape:r,size:n,style:i,state:o}=e;r&&XG.shape(t,r),n&&XG.size(t,n),i&&("colorsRamp"in i&&(i.rampColors=function(t){const{colorsRamp:e}=t,r={colors:[],positions:[]};return e.forEach((({color:t,position:e})=>{r.colors.push(t),r.positions.push(e)})),r}(i)),XG.style(t,i)),o&&XG.state(t,o)}(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}}aj.DefaultOptions=oj,aj.LayerOptionsKeys=HG.LayerConfigkeys.concat(["shape","color","size","style","state"]);class sj extends YG{constructor(){super(...arguments),this.type=YG.PlotType.Heatmap}getDefaultOptions(){return sj.DefaultOptions}createLayers(t){this.heatmapLayer=new aj(Object.assign({source:t},S(this.options,aj.LayerOptionsKeys)));const e=new NG([this.heatmapLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),e.addLayer(this.labelLayer)),e}updateLayers(t){const e=S(t,aj.LayerOptionsKeys);this.heatmapLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}getLegendOptions(){var t;const e=this.heatmapLayer.layer.getLegendItems("size");if(Array.isArray(e)&&0!==e.length){const r=e[0].value,n=e[e.length-1].value,i=null===(t=this.heatmapLayer.options.style)||void 0===t?void 0:t.colorsRamp.map((({color:t})=>t));return{type:"continue",min:r,max:n,colors:i}}return{}}}sj.DefaultOptions=ij;const lj=PG({},YG.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"grid",radius:15e3,method:"sum"}}});const uj={source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"grid",field:"",radius:15e3,method:"sum"}},shape:"square",color:"#5FD3A6",style:{coverage:.9,angle:0,opacity:1}};class cj extends HG{constructor(t){super(t),this.type=HG.LayerType.GridLayer,this.interaction=!1;const{name:e,source:r}=this.options,n=this.pickLayerConfig(this.options);this.name=e||w(this.type),this.layer=new tI(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(r)}getDefaultOptions(){return uj}mappingLayer(t,e){!function(t,e){const{shape:r,color:n,size:i,style:o,state:a}=e;r&&XG.shape(t,r),i&&XG.size(t,i),n&&XG.color(t,n),o&&XG.style(t,o),a&&XG.state(t,a)}(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}}cj.DefaultOptions=uj,cj.LayerOptionsKeys=HG.LayerConfigkeys.concat(["shape","color","size","style","state"]);class hj extends YG{constructor(){super(...arguments),this.type=YG.PlotType.Grid}getDefaultOptions(){return hj.DefaultOptions}createLayers(t){this.gridLayer=new cj(Object.assign({source:t},S(this.options,cj.LayerOptionsKeys)));const e=new NG([this.gridLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),e.addLayer(this.labelLayer)),e}updateLayers(t){const e=S(t,cj.LayerOptionsKeys);this.gridLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}}hj.DefaultOptions=lj;const pj=PG({},YG.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"hexagon",radius:15e3,method:"sum"}}});const dj={source:{data:[],parser:{type:"json",x:"x",y:"y"},aggregation:{type:"hexagon",field:"",radius:15e3,method:"sum"}},shape:"hexagon",color:"#5FD3A6",style:{coverage:.9,angle:0,opacity:1}};class fj extends HG{constructor(t){super(t),this.type=HG.LayerType.HexbinLayer,this.interaction=!1;const{name:e,source:r}=this.options,n=this.pickLayerConfig(this.options);this.name=e||w(this.type),this.layer=new tI(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(r)}getDefaultOptions(){return dj}mappingLayer(t,e){!function(t,e){const{shape:r,color:n,size:i,style:o,state:a}=e;r&&XG.shape(t,r),i&&XG.size(t,i),n&&XG.color(t,n),o&&XG.style(t,o),a&&XG.state(t,a)}(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}}fj.DefaultOptions=dj,fj.LayerOptionsKeys=HG.LayerConfigkeys.concat(["shape","color","size","style","state"]);class mj extends YG{constructor(){super(...arguments),this.type=YG.PlotType.Hexbin}getDefaultOptions(){return mj.DefaultOptions}createLayers(t){this.hexbinLayer=new fj(Object.assign({source:t},S(this.options,fj.LayerOptionsKeys)));const e=new NG([this.hexbinLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(this.source,this.options.label,this.options),e.addLayer(this.labelLayer)),e}updateLayers(t){const e=S(t,fj.LayerOptionsKeys);this.hexbinLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}}mj.DefaultOptions=pj;const gj=PG({},YG.DefaultOptions,{source:{data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}}});const _j={};class vj extends HG{constructor(t){super(t),this.type=HG.LayerType.LinesLayer,this.interaction=!0;const{name:e,source:r}=this.options,n=this.pickLayerConfig(this.options);this.name=e||w(this.type),this.layer=new gI(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(r)}getDefaultOptions(){return _j}mappingLayer(t,e){!function(t,e){const{shape:r,color:n,size:i,style:o,state:a,animate:s,texture:l}=e;r&&XG.shape(t,r),i&&XG.size(t,i),n&&XG.color(t,n),o&&XG.style(t,o),a&&XG.state(t,a),s&&XG.animate(t,s),l&&XG.texture(t,l)}(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}getColorLegendItems(){const t=this.layer.getLegendItems("color");if(Array.isArray(t)&&0!==t.length){return $G(t)}return[]}}vj.DefaultOptions=_j,vj.LayerOptionsKeys=HG.LayerConfigkeys.concat(["shape","color","size","style","state","animate"]);class yj extends vj{constructor(){super(...arguments),this.type=vj.LayerType.PathLayer}getDefaultOptions(){return PG({},vj.DefaultOptions,{shape:"line"})}}yj.LayerOptionsKeys=vj.LayerConfigkeys.concat(["color","size","style","state","animate"]);class xj extends YG{constructor(){super(...arguments),this.type=YG.PlotType.Path}getDefaultOptions(){return xj.DefaultOptions}createLayers(t){this.pathLayer=new yj(Object.assign({source:t},S(this.options,yj.LayerOptionsKeys)));return new NG([this.pathLayer])}updateLayers(t){const e=S(t,yj.LayerOptionsKeys);this.pathLayer.update(e)}getLegendOptions(){const t=this.pathLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}}}xj.DefaultOptions=gj;const bj=PG({},YG.DefaultOptions,{source:{data:[],parser:{type:"json"}},shape:"arc"});class Ej extends vj{constructor(){super(...arguments),this.type=vj.LayerType.ArcLayer}getDefaultOptions(){return PG({},vj.DefaultOptions,{shape:"arc"})}}class Tj extends YG{constructor(){super(...arguments),this.type=YG.PlotType.Flow}getDefaultOptions(){return Tj.DefaultOptions}createLayers(t){this.flowLayer=new Ej(Object.assign({name:"flowLayer",source:t},S(this.options,Ej.LayerOptionsKeys)));const e=new NG([this.flowLayer]);return this.options.radiation&&(this.radiationLayer=this.createRadiationLayer(t),e.addLayer(this.radiationLayer)),this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),e.addLayer(this.labelLayer)),e}parserPointData(t){const e=[];return t.data.dataArray.forEach((t=>{const{coordinates:r}=t,[,n]=r;e.push(Object.assign(Object.assign({},t),{coordinates:n}))})),e}createRadiationLayer(t){const e=this.parserPointData(t),{enabled:r=!0,color:n,size:i=20,shape:o="circle",animate:a=!0}=this.options.radiation||{},s=new JG({name:"radiationLayer",source:{data:e,parser:{type:"json",coordinates:"coordinates"}},visible:r,color:n,size:i,shape:o,animate:a}),l=()=>{const t=this.parserPointData(this.source);s.layer.setData(t)};return t.on("update",l),s.on("remove",(()=>{t.off("update",l)})),s}createLabelLayer(t,e){const r=this.parserPointData(t),{visible:n,minZoom:i,maxZoom:o,zIndex:a=0}=this.options,s=new qG(Object.assign({name:"labelLayer",source:{data:r,parser:{type:"json",coordinates:"coordinates"}},visible:n,minZoom:i,maxZoom:o,zIndex:a+.1},e)),l=()=>{const t=this.parserPointData(this.source);s.layer.setData(t)};return t.on("update",l),s.on("remove",(()=>{t.off("update",l)})),s}updateLayers(t){const e=S(t,Ej.LayerOptionsKeys);if(this.flowLayer.update(e),t.radiation)if(this.radiationLayer){const e=Object.assign(Object.assign({},t.radiation),{visible:t.radiation.enabled});this.radiationLayer.update(e)}else this.radiationLayer=this.createRadiationLayer(this.source),this.layerGroup.addLayer(this.radiationLayer);this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}getLegendOptions(){const t=this.flowLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}}}Tj.DefaultOptions=bj;const Sj=PG({},YG.DefaultOptions,{source:{data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}}}),Aj="#2f54eb",wj={active:{fill:!1,stroke:Aj,lineWidth:1.5,lineOpacity:.8},select:{fill:!1,stroke:Aj,lineWidth:1.5,lineOpacity:.8}},Cj=t=>(v(t)||(!1===t.active?wj.active=Object.assign(wj.active,{fill:!1,stroke:!1}):"object"==typeof t.active&&(!1===t.active.fill?wj.active.fill=!1:"string"==typeof t.active.fill&&(wj.active.fill=t.active.fill),!1===t.active.stroke?wj.active.stroke=!1:"string"==typeof t.active.stroke&&(wj.active.stroke=t.active.stroke),"number"==typeof t.active.lineWidth&&(wj.active.lineWidth=t.active.lineWidth),"number"==typeof t.active.lineOpacity&&(wj.active.lineOpacity=t.active.lineOpacity)),!1===t.select?wj.select=Object.assign(wj.select,{fill:!1,stroke:!1}):"object"==typeof t.select&&(!1===t.select.fill?wj.select.fill=!1:"string"==typeof t.select.fill&&(wj.select.fill=t.select.fill),!1===t.select.stroke?wj.select.stroke=!1:"string"==typeof t.select.stroke&&(wj.select.stroke=t.select.stroke),"number"==typeof t.select.lineWidth&&(wj.select.lineWidth=t.select.lineWidth),"number"==typeof t.select.lineOpacity&&(wj.select.lineOpacity=t.select.lineOpacity))),wj);const Rj={visible:!0,state:{active:!1,select:!1},enabledMultiSelect:!1};class Lj extends HG{constructor(t){super(t),this.selectData=[],this.type=HG.LayerType.AreaLayer,this.interaction=!0,this.onHighlighHandle=t=>{const{feature:e,featureId:r}=t;this.setHighlightLayerSource(e,r)},this.onUnhighlighHandle=()=>{this.setHighlightLayerSource()},this.onSelectHandle=t=>{const e=this.options.enabledMultiSelect,{feature:r,featureId:n}=t;let i=y(this.selectData);const o=i.findIndex((t=>t.featureId===n));if(-1===o)e?i.push({feature:r,featureId:n}):i=[{feature:r,featureId:n}],this.emit("select",r,y(i));else{const t=i[o];e?i.splice(o,1):i=[],this.emit("unselect",t,y(i))}this.setSelectLayerSource(i)};const{name:e,source:r,visible:n,minZoom:i,maxZoom:o,zIndex:a=0}=this.options,s=this.pickLayerConfig(this.options),l=Cj(this.options.state);this.name=e||w(this.type),this.layer=new GI(Object.assign(Object.assign({},s),{name:this.name})),this.strokeLayer=new gI({name:"strokeLayer",visible:n,zIndex:a,minZoom:i,maxZoom:o}),this.highlightLayer=new gI({name:"highlightLayer",visible:n&&Boolean(l.active.stroke),zIndex:a+.1,minZoom:i,maxZoom:o}),this.selectFillLayer=new GI({name:"selectFillLayer",visible:n&&Boolean(l.select.fill),zIndex:a+.1,minZoom:i,maxZoom:o}),this.selectStrokeLayer=new gI({name:"selectStrokeLayer",visible:n&&Boolean(l.select.stroke),zIndex:a+.1,minZoom:i,maxZoom:o}),this.mappingLayer(this.options),this.setSource(r),this.initEvent()}getDefaultOptions(){return Rj}mappingLayer(t){!function(t,e,r,n,i,o){const{color:a,style:s,state:l}=o,u=Cj(l),c={active:!1!==u.active.fill&&{color:u.active.fill},select:!1},h={opacity:null==s?void 0:s.opacity},p=null==s?void 0:s.lineWidth,d=null==s?void 0:s.stroke,f={opacity:null==s?void 0:s.lineOpacity,dashArray:null==s?void 0:s.lineDash,lineType:null==s?void 0:s.lineType};if(XG.shape(t,"fill"),a&&XG.color(t,a),h&&XG.style(t,h),c&&XG.state(t,c),XG.shape(e,"line"),p&&XG.size(e,p),d&&XG.color(e,d),f&&XG.style(e,f),u.active.stroke){const t=u.active.stroke,e=u.active.lineWidth||p,n={opacity:u.active.lineOpacity};XG.shape(r,"line"),e&&XG.size(r,e),t&&XG.color(r,t),n&&XG.style(r,n)}if(u.select.fill){const t=u.select.fill;XG.shape(n,"fill"),t&&XG.color(n,t),h&&XG.style(n,h),XG.state(n,{select:!1,active:!1})}if(u.select.stroke){const t=u.select.stroke,e=u.select.lineWidth||p,r={opacity:u.select.lineOpacity};XG.shape(i,"line"),e&&XG.size(i,e),t&&XG.color(i,t),r&&XG.style(i,r)}}(this.layer,this.strokeLayer,this.highlightLayer,this.selectFillLayer,this.selectStrokeLayer,t)}setSource(t){super.setSource(t),this.setStrokeLayerSource(),this.setHighlightLayerSource(),this.selectFillLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.selectStrokeLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}})}setStrokeLayerSource(){const t=this.layer.getSource();if(t)this.strokeLayer.setSource(t);else{const{data:t,options:e}=this.layer.sourceOption;this.strokeLayer.source(t,e)}}setHighlightLayerSource(t,e=-999){if(this.highlightLayerData===e)return;const r=t?[t]:[];this.highlightLayer.getSource()?this.highlightLayer.setData({type:"FeatureCollection",features:r},{parser:{type:"geojson"}}):this.highlightLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.highlightLayerData=e}setSelectLayerSource(t=[]){if(this.selectData.length===t.length&&E(this.selectData.map((({featureId:t})=>t)),t.map((({featureId:t})=>t))))return;const e=t.map((({feature:t})=>t));this.selectFillLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.selectStrokeLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.selectData=t}initEvent(){this.layer.off("mousemove",this.onHighlighHandle),this.layer.off("unmousemove",this.onHighlighHandle),this.layer.off("click",this.onSelectHandle),this.selectData=[],this.highlightLayerData=null,this.options.state&&(this.options.state.active&&(this.layer.on("mousemove",this.onHighlighHandle),this.layer.on("unmousemove",this.onUnhighlighHandle)),this.options.state.select&&this.layer.on("click",this.onSelectHandle))}addTo(t){t.addLayer(this.layer),t.addLayer(this.strokeLayer),t.addLayer(this.highlightLayer),t.addLayer(this.selectFillLayer),t.addLayer(this.selectStrokeLayer)}remove(t){t.removeLayer(this.layer),t.removeLayer(this.strokeLayer),t.removeLayer(this.highlightLayer),t.removeLayer(this.selectFillLayer),t.removeLayer(this.selectStrokeLayer)}update(t){if(super.update(t),this.mappingLayer(this.options),this.options.visible){v(t.state)||E(this.lastOptions.state,this.options.state)||this.updateHighlightLayer();const e=Cj(this.options.state);e.active.stroke&&this.setHighlightLayerSource(),(e.select.fill||e.select.stroke)&&this.setSelectLayerSource()}this.initEvent()}updateHighlightLayer(){const t=Cj(this.options.state),e=Cj(this.lastOptions.state);e.active.stroke!==t.active.stroke&&(t.active.stroke?this.highlightLayer.show():this.highlightLayer.hide()),e.select.fill!==t.select.fill&&(t.select.fill?this.selectFillLayer.show():this.selectFillLayer.hide()),e.select.stroke!==t.select.stroke&&(t.select.stroke?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())}setIndex(t){this.layer.setIndex(t),this.strokeLayer.setIndex(t),this.highlightLayer.setIndex(t+.1),this.selectFillLayer.setIndex(t+.1),this.selectStrokeLayer.setIndex(t+.1)}setMinZoom(t){this.layer.setMinZoom(t),this.strokeLayer.setMinZoom(t),this.highlightLayer.setMinZoom(t),this.selectFillLayer.setMinZoom(t),this.selectStrokeLayer.setMinZoom(t)}setMaxZoom(t){this.layer.setMaxZoom(t),this.strokeLayer.setMaxZoom(t),this.highlightLayer.setMaxZoom(t),this.selectFillLayer.setMaxZoom(t),this.selectStrokeLayer.setMaxZoom(t)}show(){this.layer.inited&&(this.layer.show(),this.strokeLayer.show(),this.selectFillLayer.show(),this.selectStrokeLayer.show())}hide(){this.layer.inited&&(this.layer.hide(),this.strokeLayer.hide(),this.selectFillLayer.hide(),this.selectStrokeLayer.hide())}getColorLegendItems(){const t=this.layer.getLegendItems("color");if(Array.isArray(t)&&0!==t.length){return $G(t)}return[]}setActive(t){}setSelect(t){}}Lj.DefaultOptions=Rj,Lj.LayerOptionsKeys=HG.LayerConfigkeys.concat(["color","style","state","enabledMultiSelect"]);class Ij extends YG{constructor(){super(...arguments),this.type=YG.PlotType.Area}getDefaultOptions(){return Ij.DefaultOptions}createLayers(t){this.areaLayer=new Lj(Object.assign({source:t},S(this.options,Lj.LayerOptionsKeys)));const e=new NG([this.areaLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),e.addLayer(this.labelLayer)),e}updateLayers(t){const e=S(t,Lj.LayerOptionsKeys);this.areaLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}initLayersEvent(){}getLegendOptions(){const t=this.areaLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}}}Ij.DefaultOptions=Sj;const Mj=new Map;const Oj=PG({},YG.DefaultOptions,{source:{data:[],joinBy:{geoField:"adcode"}},viewLevel:{level:"country",adcode:"100000"},chinaBorder:!0}),Pj={world:"country",country:"province",province:"city",city:"district",district:"district"},Dj="https://gw.alipayobjects.com/os/alisis/geo-data-v0.1.2",Bj=`${Dj}/choropleth-data`,Nj={national:{color:"red",width:1,opacity:1},dispute:{color:"red",width:1,opacity:.8,dashArray:[2,4]},coast:{color:"blue",width:.7,opacity:.8},hkm:{color:"gray",width:.7,opacity:.8,dashArray:[2,4]}};function Fj(t){return t}function kj(t,e){var r=e.id,n=e.bbox,i=null==e.properties?{}:e.properties,o=function(t,e){var r=function(t){if(null==t)return Fj;var e,r,n=t.scale[0],i=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=r=0);var l=2,u=t.length,c=new Array(u);for(c[0]=(e+=t[0])*n+o,c[1]=(r+=t[1])*i+a;l<u;)c[l]=t[l],++l;return c}}(t.transform),n=t.arcs;function i(t,e){e.length&&e.pop();for(var i=n[t<0?~t:t],o=0,a=i.length;o<a;++o)e.push(r(i[o],o));t<0&&function(t,e){for(var r,n=t.length,i=n-e;i<--n;)r=t[i],t[i++]=t[n],t[n]=r}(e,a)}function o(t){return r(t)}function a(t){for(var e=[],r=0,n=t.length;r<n;++r)i(t[r],e);return e.length<2&&e.push(e[0]),e}function s(t){for(var e=a(t);e.length<4;)e.push(e[0]);return e}function l(t){return t.map(s)}function u(t){var e,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(u)};case"Point":e=o(t.coordinates);break;case"MultiPoint":e=t.coordinates.map(o);break;case"LineString":e=a(t.arcs);break;case"MultiLineString":e=t.arcs.map(a);break;case"Polygon":e=l(t.arcs);break;case"MultiPolygon":e=t.arcs.map(l);break;default:return null}return{type:r,coordinates:e}}return u(e)}(t,e);return null==r&&null==n?{type:"Feature",properties:i,geometry:o}:null==n?{type:"Feature",id:r,properties:i,geometry:o}:{type:"Feature",id:r,bbox:n,properties:i,geometry:o}}const Uj=t=>{try{return e=t,"string"==typeof(r="json")&&(r=e.objects[r]),"GeometryCollection"===r.type?{type:"FeatureCollection",features:r.geometries.map((function(t){return kj(e,t)}))}:kj(e,r)}catch(t){throw new Error('Failed convert to geojson from topojson, topojson default layer name "json"')}var e,r},zj=t=>S(t,["source","color","style","state","label","tooltip"]);class Gj extends YG{constructor(){super(...arguments),this.type=YG.PlotType.Choropleth,this.chinaBoundaryData={type:"FeatureCollection",features:[]},this.currentDistrictData={type:"FeatureCollection",features:[]},this.drillSteps=[],this.drillStacks=[],this.onDrillDownHander=t=>{var e;const{steps:r,onDown:n}=this.options.drill,i=null===(e=t.feature)||void 0===e?void 0:e.properties,{adcode:o}=i;if(this.drillStacks.length===r.length+1)return;const a=this.drillStacks.slice(-1)[0],s=this.drillStacks.length-1,l=this.drillSteps[s],{level:u,granularity:c=Pj[u]}=l,h=M(l,["level","granularity"]),p={nativeEvent:!0,from:{level:a.level,adcode:a.adcode,granularity:a.granularity},to:{level:u,adcode:o,granularity:c,properties:i}},d=(t={})=>{const e={level:u,adcode:o,granularity:c},r=PG({},h,t);this.changeView(e,r).then((t=>{t&&(this.drillStacks.push(t),this.emit("drilldown",p))}))};n?n(p.from,p.to,d):d()},this.onDrillUpHander=()=>{const{onUp:t}=this.options.drill;if(0===this.drillStacks.length||1===this.drillStacks.length)return;const e=this.drillStacks.length-1,r=this.drillStacks[e],n=this.drillStacks[e-1],i={nativeEvent:!0,from:{level:r.level,adcode:r.adcode,granularity:r.granularity},to:{level:n.level,adcode:n.adcode,granularity:n.granularity}},o=(t={})=>{const e=i.to,r=PG({},n.config,t);this.changeView(e,r).then((t=>{t&&(this.drillStacks.pop(),this.emit("drillup",i))}))};t?t(i.from,i.to,o):o()}}initSource(){this.getInitDistrictData().then((()=>{this.source=this.createSource(),this.render(),this.inited=!0}))}render(){if(this.inited)this.scene.setEnableRender(!0),this.scene.render();else{const t=this.createLayers(this.source);this.layerGroup=t,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",(()=>{this.onSceneLoaded()})),this.initLayersEvent()}}update(t){var e,r,n;if(this.updateOption(t),t.map&&!E(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),t.drill&&!1!==t.drill.enabled&&!E(null===(e=this.lastOptions.drill)||void 0===e?void 0:e.steps,null===(r=this.options.drill)||void 0===r?void 0:r.steps)&&(this.drillReset(),this.initDrillEvent()),this.scene.setEnableRender(!1),t.viewLevel&&!E(this.lastOptions.viewLevel,this.options.viewLevel)){const e=null===(n=t.source)||void 0===n?void 0:n.joinBy.geoData;this.getDistrictData(e).then((()=>{const e=this.options.source,{data:r}=e,n=M(e,["data"]);this.changeData(r,n),this.updateLayers(t),this.render(),this.updateComponents(),this.emit("update")}))}else{if(t.source&&!E(this.lastOptions.source,this.options.source)){const t=this.options.source,{data:e}=t,r=M(t,["data"]);this.changeData(e,r)}this.updateLayers(t),this.render(),this.updateComponents(),this.emit("update")}}getDefaultOptions(){return Gj.DefaultOptions}parserSourceConfig(t){const{data:e,joinBy:r}=t,n=M(t,["data","joinBy"]),{sourceField:i,geoField:o,geoData:a}=r,s=a,l={type:"join",sourceField:i,targetField:o,data:e};return n.transforms?n.transforms.push(l):n.transforms=[l],n.parser&&delete n.parser,{data:s,sourceCFG:n}}createSource(){const{data:t,sourceCFG:e}=this.parserSourceConfig(this.options.source);return new MT(t,e)}changeData(t,e){this.options.source=PG({},this.options.source,Object.assign({data:t},e));const{data:r,sourceCFG:n}=this.parserSourceConfig(this.options.source);this.source.setData(r,n),this.emit("change-data")}createLayers(t){this.fillAreaLayer=new Lj(Object.assign({name:"fillAreaLayer",source:t},S(this.options,Lj.LayerOptionsKeys)));const e=new NG([this.fillAreaLayer]);if(this.options.chinaBorder){this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options).forEach((t=>e.addLayer(t)))}return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),e.addLayer(this.labelLayer)),e}createCountryBoundaryLayer(t,e){const{chinaBoundaryLayer:r,chinaHkmBoundaryLayer:n,chinaDisputeBoundaryLayer:i}=((t,e)=>{const{visible:r,minZoom:n,maxZoom:i,zIndex:o=0,chinaBorder:a}=e||{},s="object"==typeof a?PG({},Nj,a):Nj,l=t.features.filter((({properties:t})=>["coast","national"].includes(null==t?void 0:t.type))),u=t.features.filter((({properties:t})=>"dispute"===(null==t?void 0:t.type))),c=t.features.filter((({properties:t})=>"hkm"===(null==t?void 0:t.type)));return{chinaBoundaryLayer:new yj({name:"chinaBoundaryLayer",visible:r,minZoom:n,maxZoom:i,zIndex:o+.1,source:{data:{type:"FeatureCollection",features:l},parser:{type:"geojson"}},color:{field:"type",value:({type:t})=>s[t].color},size:{field:"type",value:({type:t})=>s[t].width},style:{opacity:s.national.opacity}}),chinaHkmBoundaryLayer:new yj({name:"chinaHkmBoundaryLayer",visible:r,minZoom:n,maxZoom:i,zIndex:o+.1,source:{data:{type:"FeatureCollection",features:c},parser:{type:"geojson"}},color:s.hkm.color,size:s.hkm.width,style:{opacity:s.hkm.opacity,lineType:"dash",dashArray:s.hkm.dashArray}}),chinaDisputeBoundaryLayer:new yj({name:"chinaDisputeBoundaryLayer",visible:r,minZoom:n,maxZoom:i,zIndex:o+.1,source:{data:{type:"FeatureCollection",features:u},parser:{type:"geojson"}},color:s.dispute.color,size:s.dispute.width,style:{opacity:s.dispute.opacity,lineType:"dash",dashArray:s.dispute.dashArray}})}})(t,e);return this.chinaBoundaryLayer=r,this.chinaHkmBoundaryLayer=n,this.chinaDisputeBoundaryLayer=i,[r,n,i]}createLabelLayer(t,e){const r=t.originData.features.map((({properties:t})=>Object.assign({},t,{centroid:t.centroid||t.center}))).filter((({centroid:t})=>t)),{visible:n,minZoom:i,maxZoom:o,zIndex:a=0}=this.options,s=new qG(Object.assign({name:"labelLayer",source:{data:r,parser:{type:"json",coordinates:"centroid"},transforms:t.transforms},visible:n,minZoom:i,maxZoom:o,zIndex:a+.1},e)),l=()=>{const e=this.source.originData.features.map((({properties:t})=>t)).filter((({centroid:t})=>t));s.layer.setData(e,{transforms:t.transforms})};return t.on("update",l),s.on("remove",(()=>{t.off("update",l)})),s}updateLayers(t){const e=S(t,Lj.LayerOptionsKeys);this.fillAreaLayer.update(e);const r=()=>{this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options).forEach((t=>this.layerGroup.addLayer(t)))},n=()=>{this.chinaBoundaryLayer&&this.layerGroup.removeLayer(this.chinaBoundaryLayer),this.chinaHkmBoundaryLayer&&this.layerGroup.removeLayer(this.chinaHkmBoundaryLayer),this.chinaDisputeBoundaryLayer&&this.layerGroup.removeLayer(this.chinaDisputeBoundaryLayer)};t.chinaBorder?this.chinaBoundaryLayer?(n(),r()):r():!1===t.chinaBorder&&n(),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}initLayersEvent(){this.initDrillEvent(),this.initLegendEvent()}initDrillEvent(){if(this.lastOptions.drill){const{triggerUp:t="unclick",triggerDown:e="click"}=this.lastOptions.drill;this.fillAreaLayer.off(t,this.onDrillUpHander),this.fillAreaLayer.off(e,this.onDrillDownHander)}if(!this.options.drill||!1===this.options.drill.enabled)return;const{steps:t,triggerUp:e="unclick",triggerDown:r="click"}=this.options.drill,n=t.map((t=>"string"==typeof t?{level:t,granularity:Pj[t]}:(t.granularity||(t.granularity=Pj[t.level]),t)));if(((t,e)=>{if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const{level:n,granularity:i}=t[r];if(e[r].level!==n||e[r].granularity!==i)return!1}return!0})(n,this.drillSteps)||(this.drillSteps=n,this.drillStacks=[]),!this.drillStacks.length){const{level:t,adcode:e,granularity:r=Pj[t]}=this.options.viewLevel,n=zj(this.options);this.drillStacks=[{level:t,adcode:e,granularity:r,config:n}]}this.fillAreaLayer.on(e,this.onDrillUpHander),this.fillAreaLayer.on(r,this.onDrillDownHander)}initLegendEvent(){const t=this.options.legend;if(!t)return;this.fillAreaLayer.on("legend:color",(()=>{this.updateLegendControl(t)}))}drillReset(){this.drillStacks=[]}getCurrentDrillSteps(){return this.drillStacks.map((t=>S(t,["level","adcode","granularity"])))}getLegendOptions(){const t=this.fillAreaLayer.getColorLegendItems();return 0!==t.length?{type:"category",items:t}:{}}fetchData(t,e,r){return O(this,void 0,void 0,(function*(){const n=`${e}_${t}_${r}`,i=(o=n,Mj.get(o));var o;if(i)return i;const{url:a,type:s,extension:l}=(t=>{const e={url:Bj,type:"topojson",extension:"topo.json"};return v(t)||("string"==typeof t?e.url=t:(e.url=(null==t?void 0:t.url)||Bj,e.type=t.type,e.extension="topojson"===t.type?"topo.json":"json")),e})(this.options.geoArea);let u;const c=this.options.customFetchGeoData;if(c)u=yield c({url:a,level:t,adcode:e,granularity:r,extension:l});else{const e=yield fetch(`${a}/${t}/${n}.${l}`);u=yield e.json()}return"topojson"===s&&(u=Uj(u)),function(t,e){Mj.set(t,e)}(n,u),u}))}getInitDistrictData(){return O(this,void 0,void 0,(function*(){var t;const e=this.fetchData("country","100000","boundary"),r=null===(t=this.options.source)||void 0===t?void 0:t.joinBy.geoData;try{[this.chinaBoundaryData]=yield Promise.all([e,this.getDistrictData(r)])}catch(t){throw new Error(`Failed to get china boundary data，${t}`)}}))}getDistrictData(t){return O(this,void 0,void 0,(function*(){const{level:e,adcode:r,granularity:n=Pj[e]}=this.options.viewLevel,i=t?Promise.resolve(t):this.fetchData(e,r,n);try{this.currentDistrictData=yield i,this.options.source=PG({},this.options.source,{joinBy:{geoData:this.currentDistrictData}})}catch(t){throw new Error(`Failed to get district data，${t}`)}}))}drillDown(t,e={}){const r=this.drillStacks.slice(-1)[0],{level:n,adcode:i,granularity:o}=t,a={nativeEvent:!1,from:{level:r.level,adcode:r.adcode,granularity:r.granularity},to:{level:n,adcode:i,granularity:o}};this.changeView(t,e).then((t=>{t&&(this.drillStacks.push(t),this.emit("drilldown",a))}))}drillUp(t={},e){const r=this.drillStacks.length;if([0,1].includes(r))return;const n=e?this.drillStacks.findIndex((t=>t.level===e)):-1,i=-1!==n,o=i?n:r-2,a=this.drillStacks[o],{config:s}=a,l=M(a,["config"]),u=PG({},s,t),c=this.drillStacks[this.drillStacks.length-1],h={nativeEvent:!1,from:{level:c.level,adcode:c.adcode,granularity:c.granularity},to:{level:l.level,adcode:l.adcode,granularity:l.granularity}};this.changeView(l,u).then((t=>{t&&(i?this.drillStacks.splice(n+1):this.drillStacks.pop(),this.emit("drillup",h))}))}changeView(t){return O(this,arguments,void 0,(function*(t,e={}){const{level:r,adcode:n,granularity:i=Pj[r]}=t,o=yield this.fetchData(r,n,i);if(!o.features.length)return;const a=PG({},zj(this.options),e,{viewLevel:{level:r,adcode:n,granularity:i},source:{joinBy:{geoData:o}}});this.update(a);return{level:r,adcode:n,granularity:i,config:a}}))}}Gj.DefaultOptions=Oj,Gj.GeoDataUrl=Dj,Gj.GeoAreaUrl=Bj;class jj extends JG{constructor(){super(...arguments),this.type=JG.LayerType.IconLayer}getDefaultOptions(){return PG({},JG.DefaultOptions,{color:void 0})}}const Vj={};class Hj extends HG{constructor(t){super(t),this.type=HG.LayerType.PrismLayer,this.interaction=!0;const{name:e,source:r}=this.options,n=this.pickLayerConfig(this.options);this.name=e||w(this.type),this.layer=new GI(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(r)}getDefaultOptions(){return Vj}mappingLayer(t,e){!function(t,e){const{color:r,size:n,style:i,state:o}=e;XG.shape(t,"extrude"),n&&XG.size(t,n),r&&XG.color(t,r),i&&XG.style(t,i),o&&XG.state(t,o)}(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}getColorLegendItems(){const t=this.layer.getLegendItems("color");if(Array.isArray(t)&&0!==t.length){return $G(t)}return[]}}Hj.DefaultOptions=Vj,Hj.LayerOptionsKeys=HG.LayerConfigkeys.concat(["color","size","style","state"]);const Wj={[t.PlotType.Dot]:tj,[t.PlotType.DotDensity]:nj,[t.PlotType.Heatmap]:sj,[t.PlotType.Grid]:hj,[t.PlotType.Hexbin]:mj,[t.PlotType.Path]:xj,[t.PlotType.Flow]:Tj,[t.PlotType.Area]:Ij,[t.PlotType.Choropleth]:Gj},Xj={[t.LayerType.TextLayer]:qG,[t.LayerType.DotLayer]:JG,[t.LayerType.IconLayer]:jj,[t.LayerType.DotDensity]:rj,[t.LayerType.ColumnLayer]:class extends JG{constructor(){super(...arguments),this.type=JG.LayerType.ColumnLayer}getDefaultOptions(){return PG({},JG.DefaultOptions,{shape:"cylinder"})}},[t.LayerType.HeatmapLayer]:aj,[t.LayerType.GridLayer]:cj,[t.LayerType.HexbinLayer]:fj,[t.LayerType.PathLayer]:yj,[t.LayerType.ArcLayer]:Ej,[t.LayerType.AreaLayer]:Lj,[t.LayerType.PrismLayer]:Hj};class Zj extends GG{constructor(t,e){super(e),this.plots=[],this.container=this.createContainer(t),this.theme=this.createTheme(),this.scene=this.createScene(),this.registerResources(),this.render(),this.inited=!0}getDefaultOptions(){return PG({},GG.DefaultOptions,Zj.DefaultOptions)}createLayers(){const t=new NG([]),e=this.options.layers||[];for(let r=0;r<e.length;r++){const n=this.createLayer(e[r]);t.addLayer(n)}return t}createLayer(t){const{type:e}=t,r=M(t,["type"]),n=Xj[e];if(v(n))throw new Error(`Don't exist ${e} layer`);return new n(r)}addLayer(t){if((t=>"function"==typeof t.render)(t))super.addLayer(t);else{const e=this.createLayer(t);super.addLayer(e)}}removeLayerByName(t){const e=this.layerGroup.getLayerByName(t);return!!e&&this.layerGroup.removeLayer(e)}updateLayers(t){}updatePlots(t){}render(){const t=this.createLayers();this.inited?(this.layerGroup.removeAllLayer(),t.addTo(this.scene),this.layerGroup=t,this.updateControls()):(this.layerGroup=t,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",(()=>{this.onSceneLoaded()})))}onSceneLoaded(){this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",(()=>{this.onLayersLoaded()})),this.layerGroup.addTo(this.scene)}onLayersLoaded(){this.layersLoaded=!0,this.renderPlots(),this.initControls(),this.loaded=!0,this.emit("loaded")}renderPlots(){const t=this.options.plots||[];for(let e=0;e<t.length;e++){const r=t[e],n=this.createPlot(r);this.plots.push(n)}}createPlot(t){const{type:e,legend:r,layerMenu:n}=t,i=M(t,["type","legend","layerMenu"]),o=Wj[e];if(v(o))throw new Error(`Don't exist ${e} plot`);const a=new o(i);return a.attachToScene(this.scene,this.theme),a}addPlot(t){const e=this.createPlot(t);this.plots.push(e)}getPlots(){return this.plots}getPlotByName(t){return this.plots.find((e=>{var r;return(null===(r=e.options)||void 0===r?void 0:r.name)===t}))}removePlotByName(t){const e=this.plots.findIndex((e=>{var r;return(null===(r=e.options)||void 0===r?void 0:r.name)===t}));if(-1===e)return!1;const[r]=this.plots.splice(e,1);return r.unattachFromScene(),!0}removeAllPlot(){this.plots.forEach((t=>{t.unattachFromScene()})),this.plots=[]}}Zj.DefaultOptions={},t.ArcLayer=Ej,t.Area=Ij,t.AreaLayer=Lj,t.Choropleth=Gj,t.Dot=tj,t.DotDensity=nj,t.DotDensityLayer=rj,t.DotLayer=JG,t.Flow=Tj,t.Grid=hj,t.GridLayer=cj,t.Heatmap=sj,t.HeatmapLayer=aj,t.Hexbin=mj,t.HexbinLayer=fj,t.IconLayer=jj,t.L7Plot=Zj,t.Map=GG,t.Path=xj,t.PathLayer=yj,t.Plot=YG,t.PrismLayer=Hj,t.TextLayer=qG,t.TooltipAnchorType=te,t.getTheme=at,t.registerFontFace=function(t,e){r.set(t,e)},t.registerIconFont=function(t,e){n.set(t,e)},t.registerIconFonts=function(t){t.forEach((t=>{n.set(t.name,t.fontUnicode)}))},t.registerImage=function(t,r){e.set(t,r)},t.registerImages=function(t){t.forEach((t=>{e.set(t.id,t.image)}))},t.registerTheme=function(t,e,r="light"){ot[m(t)]="light"===r?rt(e):nt(e)},t.unregisterFontFace=function(t){return r.delete(t)},t.unregisterIconFont=function(t){return n.delete(t)},t.unregisterImage=function(t){return e.delete(t)},t.version="0.5.11",Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=l7plot.min.js.map
